"use strict";(self.webpackChunkljzw_virtualland=self.webpackChunkljzw_virtualland||[]).push([[666],{47602:function(e,t,i){var n=i(33508),r=(n.roots.default||(n.roots.default=new n.Root)).addJSON({Oppo:{nested:{InnoDay:{nested:{ProtoBuf:{nested:{Base:{nested:{TosHeader:{fields:{MsgId:{type:"int32",id:1},DateTime:{type:"int32",id:2},ProtoName:{type:"string",id:3},Token:{type:"string",id:4},Sign:{type:"string",id:5}}},TocHeader:{fields:{MsgId:{type:"int32",id:1},DateTime:{type:"int32",id:2},ProtoName:{type:"string",id:3},Code:{type:"int32",id:4},Msg:{type:"string",id:5}}},TosStop:{fields:{SecretKey:{type:"string",id:1}}},TocStop:{fields:{}},TosKick:{fields:{SecretKey:{type:"string",id:1}}},TocKick:{fields:{}},TosHeartbeat:{fields:{DateTime:{type:"int32",id:1}}},TocHeartbeat:{fields:{DateTime:{type:"int32",id:1}}},TosBaseInfo:{fields:{}},TocBaseInfo:{fields:{IsReSet:{type:"int32",id:1}}},TosWxLoginUUID:{fields:{UUID:{type:"string",id:1}}},TocWxLoginUUID:{fields:{}},TosJoinScene:{fields:{SceneType:{type:"int32",id:1},LocationInfo:{type:"DataStructure.DataLocationInfo",id:2},FriendUserId:{type:"int64",id:3}}},TocJoinScene:{fields:{UserList:{rule:"repeated",type:"DataStructure.DataUserInfo",id:1},FriendUserId:{type:"int64",id:2}}},TosLoadScene:{fields:{SceneType:{type:"int32",id:1}}},TocLoadScene:{fields:{UserList:{rule:"repeated",type:"DataStructure.DataUserInfo",id:1}}},TosLeaveScene:{fields:{SceneType:{type:"int32",id:1}}},TocLeaveScene:{fields:{}},TosUserMove:{fields:{LocationInfo:{type:"DataStructure.DataLocationInfo",id:1}}},TocUserMove:{fields:{}},TosUserMove2:{fields:{LocationInfo:{type:"DataStructure.DataLocationInfo",id:1}}},TocUserMove2:{fields:{}},TosSendFace:{fields:{FaceId:{type:"int64",id:1}}},TocSendFace:{fields:{}},TosSendAction:{fields:{ActionId:{type:"int64",id:1}}},TocSendAction:{fields:{}},TosEndGame:{fields:{time:{type:"int32",id:1}}},TocEndGame:{fields:{}},PushUserOnline:{fields:{UserInfo:{type:"DataStructure.DataUserInfo",id:1}}},PushUserOffline:{fields:{UserId:{type:"int64",id:1}}},PushJoinScene:{fields:{UserInfo:{type:"DataStructure.DataUserInfo",id:1}}},PushLeaveScene:{fields:{UserId:{type:"int64",id:1}}},PushUserMove:{fields:{UserId:{type:"int64",id:1},TargetX:{type:"double",id:2},TargetZ:{type:"double",id:3}}},PushUserMove2:{fields:{UserId:{type:"int64",id:1},TargetX:{type:"double",id:2},TargetZ:{type:"double",id:3},DeltaRotation:{type:"double",id:4}}},PushSendFace:{fields:{UserId:{type:"int64",id:1},FaceId:{type:"int64",id:2}}},PushSendAction:{fields:{UserId:{type:"int64",id:1},ActionId:{type:"int64",id:2}}},PushWxLoginToken:{fields:{Token:{type:"string",id:1}}},PushTaskFinish:{fields:{TaskId:{type:"int32",id:1},TaskName:{type:"string",id:2},Prize:{type:"int32",id:3}}},PushUserUpInfo:{fields:{UserInfo:{type:"DataStructure.DataUserInfo",id:1}}},PushSystemInform:{fields:{InformType:{type:"int32",id:1},InformId:{type:"int32",id:2},data:{type:"string",id:3}}},PushMileageLevelAchieve:{fields:{Level:{type:"int32",id:1},DrawCount:{type:"int32",id:2}}},PushBrandPickPrize:{fields:{Title:{type:"string",id:1},UserPrizeInfo:{rule:"repeated",type:"DataStructure.DataUserPrizeInfo",id:2}}},PushGameTopPrize:{fields:{Title:{type:"string",id:1},UserPrizeInfo:{rule:"repeated",type:"DataStructure.DataUserPrizeInfo",id:2}}},PushFriendPrize:{fields:{Title:{type:"string",id:1},UserPrizeInfo:{type:"DataStructure.DataUserPrizeInfo",id:2}}}}},DataStructure:{nested:{DataUserInfo:{fields:{UserId:{type:"int64",id:1},NickName:{type:"string",id:2},Avatar:{type:"string",id:3},Role:{type:"int32",id:4},Online:{type:"int32",id:5},Sex:{type:"int32",id:6},ImageInfoModel:{type:"int32",id:7},ImageInfoParts:{type:"int32",id:8},BusinessCardUrl:{type:"string",id:9},LocationInfo:{type:"DataStructure.DataLocationInfo",id:10},Title:{type:"string",id:11},Org:{type:"string",id:12},SharePhone:{type:"string",id:13},ShareId:{type:"int64",id:14},IsFriend:{type:"int32",id:15}}},DataUserSimpleInfo:{fields:{UserId:{type:"int64",id:1},NickName:{type:"string",id:2},Online:{type:"int32",id:3},Role:{type:"int32",id:4},ImageInfoModel:{type:"int32",id:5},ImageInfoParts:{type:"int32",id:6},ShareId:{type:"int64",id:7},Avatar:{type:"string",id:8}}},DataLocationInfo:{fields:{X:{type:"double",id:1},Z:{type:"double",id:2},TargetX:{type:"double",id:3},TargetZ:{type:"double",id:4},MoveSpeed:{type:"double",id:5},DeltaRotation:{type:"double",id:6},StartTime:{type:"int32",id:7},PushTime:{type:"int32",id:8}}},DataMsgCount:{fields:{FromUid:{type:"int64",id:1},Num:{type:"int32",id:2},Type:{type:"int32",id:3}}},DataImMsg:{fields:{MsgId:{type:"int64",id:1},UserId:{type:"int64",id:2},TargetType:{type:"int32",id:3},TargetId:{type:"int64",id:4},MsgBody:{type:"string",id:5},SendTime:{type:"int32",id:6},FromUinfo:{type:"DataStructure.DataUserInfo",id:7},PlatformId:{type:"int64",id:8}}},DataImSimpleMsg:{fields:{MsgId:{type:"int64",id:1},UserId:{type:"int64",id:2},Nickname:{type:"string",id:3},TargetType:{type:"int32",id:4},TargetId:{type:"int64",id:5},MsgBody:{type:"string",id:6},SendTime:{type:"int32",id:7},PlatformId:{type:"int64",id:8},ImageInfoModel:{type:"int32",id:9},ImageInfoParts:{type:"int32",id:10},Avatar:{type:"string",id:11}}},DataMessageInfo:{fields:{Type:{type:"int32",id:1},Title:{type:"string",id:2},Id:{type:"int64",id:3},Status:{type:"int32",id:4},Icon:{type:"string",id:5}}},DataPrizeInfo:{fields:{Id:{type:"int64",id:1},Name:{type:"string",id:2},Img:{type:"string",id:3},SendType:{type:"int32",id:4},remark:{type:"string",id:5}}},DataUserPrizeInfo:{fields:{UserPrizeId:{type:"int64",id:1},PrizeInfo:{type:"DataStructure.DataPrizeInfo",id:2},Content:{type:"string",id:3}}}}},IM:{nested:{TosSetStatus:{fields:{Status1:{type:"int64",id:1},Status2:{type:"int64",id:2},Status3:{type:"int64",id:3},Status4:{type:"int64",id:4}}},TocSetStatus:{fields:{Status1:{type:"int64",id:1},Status2:{type:"int64",id:2},Status3:{type:"int64",id:3},Status4:{type:"int64",id:4}}},TosImLoadWorld:{fields:{TargetId:{type:"int32",id:1},GetMsgNum:{type:"int32",id:2}}},TocImLoadWorld:{fields:{MsgList:{rule:"repeated",type:"DataStructure.DataImSimpleMsg",id:1}}},TosImLoadGroup:{fields:{GroupId:{type:"int64",id:1},MsgMiniId:{type:"int32",id:2},MsgMaxId:{type:"int32",id:3},GetMsgNum:{type:"int32",id:4},GetType:{type:"int32",id:5}}},TocImLoadGroup:{fields:{MsgList:{rule:"repeated",type:"DataStructure.DataImSimpleMsg",id:1}}},TosImLoadUser:{fields:{FriendId:{type:"int64",id:1},MsgMiniId:{type:"int64",id:2},MsgMaxId:{type:"int64",id:3},GetMsgNum:{type:"int32",id:4},GetType:{type:"int32",id:5}}},TocImLoadUser:{fields:{MsgList:{rule:"repeated",type:"DataStructure.DataImSimpleMsg",id:1}}},TosImLoadBrand:{fields:{BrandId:{type:"int64",id:1},MsgMiniId:{type:"int64",id:2},MsgMaxId:{type:"int64",id:3},GetMsgNum:{type:"int32",id:4},GetType:{type:"int32",id:5}}},TocImLoadBrand:{fields:{MsgList:{rule:"repeated",type:"DataStructure.DataImSimpleMsg",id:1}}},TosImSend:{fields:{TargetType:{type:"int32",id:1},TargetId:{type:"int64",id:2},MsgBody:{type:"string",id:3}}},TocImSend:{fields:{MsgInfo:{type:"DataStructure.DataImSimpleMsg",id:1}}},PushMsgCount:{fields:{MsgCount:{type:"int32",id:1},MsgCountList:{rule:"repeated",type:"DataStructure.DataMsgCount",id:2}}},PushImMsg:{fields:{MsgList:{rule:"repeated",type:"DataStructure.DataImSimpleMsg",id:1}}},PushImInviteToTheGroup:{fields:{GroupInfo:{type:"DataStructure.DataMessageInfo",id:1}}},PushImDelToTheGroup:{fields:{GroupInfo:{type:"DataStructure.DataMessageInfo",id:1}}},PushImFriendApply:{fields:{FriendId:{type:"int64",id:1},FriendName:{type:"string",id:2}}},PushImAddFriend:{fields:{FriendId:{type:"int64",id:1},FriendName:{type:"string",id:2}}},PushImDelFriend:{fields:{FriendId:{type:"int64",id:1},FriendName:{type:"string",id:2}}},PushImInviteToTheRtc:{fields:{TargetType:{type:"int32",id:1},TargetId:{type:"int64",id:2}}},PushImStopTheRtc:{fields:{TargetType:{type:"int32",id:1},TargetId:{type:"int64",id:2}}}}}}}}}}}});e.exports=r},47067:function(e,t,i){i.d(t,{_:function(){return U},B:function(){return M}});var n=i(35290),r=i.n(n),d=i(411),s=i.n(d),o=i(48097),a=i(38300),c=i(27010),p=i(58482),u=i.n(p),y=i(9189),l=i.n(y),f=i(47722),I=i.n(f),g=i(76779),h=i.n(g),m=i(46332),T=i.n(m),S=i(93275),D=i.n(S),v=function(e){h()(i,e);var t=T()(i);function i(e){var n;return l()(this,i),n=t.call(this),D()(I()(n),"id",void 0),D()(I()(n),"name",void 0),D()(I()(n),"detail",void 0),D()(I()(n),"projectList",void 0),n.update(e),n}return u()(i)}(i(79567).gq),P=a.Z.api.getPrizeList;function M(){return _.apply(this,arguments)}function _(){return(_=s()(r()().mark((function e(){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.Z.get(P));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(){return k.apply(this,arguments)}function k(){return(k=s()(r()().mark((function e(){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.Z.postToModel(v,a.Z.api.getMapInfo));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},89835:function(e,t,i){i.d(t,{U:function(){return n}});var n={PICK_SCENE:"pick_scene",PICK_MARK:"pick_mark",SHARE_MARK:"share_mark",PICK_LOOK:"pick_look",SHARE_LOOK:"share_look",PICK_LIVE:"pick_live",PLAY_HAPPY:"play_happy",PLAY_SMALL:"play_small"}},39974:function(e,t,i){i.d(t,{Z:function(){return b}});var n=i(46686),r=i.n(n),d=i(9189),s=i.n(d),o=i(58482),a=i.n(o),c=i(47722),p=i.n(c),u=i(76779),y=i.n(u),l=i(46332),f=i.n(l),I=i(93275),g=i.n(I),h=i(49513),m=i(72100),T=i(32446),S=i(93435),D=i(35290),v=i.n(D),P=i(411),M=i.n(P),_=i(14751),U=i.n(_),k=i(47602),L=i.n(k),C=function(){function e(){s()(this,e),g()(this,"roots",{}),this.roots={}}var t;return a()(e,[{key:"load",value:(t=M()(v()().mark((function e(){var t=this;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([U().load("../assets/proto/Base.proto"),U().load("../assets/proto/DataStructure.proto"),U().load("../assets/proto/IM.proto")]).then((function(e){t.roots.Base=e[0],t.roots.DataStructure=e[1],t.roots.IM=e[2]})));case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"getProtoType",value:function(e,t){var i=L();if(i)return i.lookupType("".concat(e,".").concat(t))}}]),e}(),A=new C,w=function(e){y()(i,e);var t=f()(i);function i(){var e;s()(this,i);for(var n=arguments.length,r=new Array(n),d=0;d<n;d++)r[d]=arguments[d];return e=t.call.apply(t,[this].concat(r)),g()(p()(e),"_host",""),g()(p()(e),"_socket",void 0),g()(p()(e),"_connected",!1),e}return a()(i,[{key:"connected",get:function(){return this._connected}},{key:"connet",value:function(e){this._host=e,this._socket=new WebSocket(this._host),this.addEventListeners()}},{key:"send",value:function(e){this._connected&&this._socket.send(e)}},{key:"close",value:function(){this._socket.close()}},{key:"terminate",value:function(){}},{key:"addEventListeners",value:function(){var e=this;this._socket.onopen=function(){e._connected=!0,e.emit("stateChanged",{state:"connected"})},this._socket.onclose=function(t){t.code,t.reason;e._connected=!1,e.emit("stateChanged",{state:"closed"})},this._socket.onmessage=function(t){var i=t.data;e.emit("message",i)},this._socket.onerror=function(t){e.emit("stateChanged",{state:"error"})}}}]),i}(m.EventEmitter),b=new(function(e){y()(i,e);var t=f()(i);function i(){var e;return s()(this,i),e=t.call(this),g()(p()(e),"_client",null),g()(p()(e),"_cbDic",{}),g()(p()(e),"_msgCounter",0),g()(p()(e),"_lastCloseTime",0),g()(p()(e),"_interval",-1),g()(p()(e),"_retryCount",0),g()(p()(e),"inRetry",!1),g()(p()(e),"_totalTryTimes",0),g()(p()(e),"readerArrayBuffer",(function(e){return e.arrayBuffer&&"function"==typeof e.arrayBuffer?e.arrayBuffer():new Promise((function(t,i){var n=new FileReader;n.onload=function(){t(n.result)},n.onerror=function(e){i(e)},n.readAsArrayBuffer(e)}))})),e._lastCloseTime=0,e._cbDic={},e.createClient(),e}return a()(i,[{key:"createClient",value:function(){var e=this;this._client=new w,this._client.on("message",(function(t){e.handleMessageReceived(t)})),this._client.on("stateChanged",(function(t){"closed"===t.state&&(e.handleReconnect(),e.inRetry=!0)})),window.socket=this._client}},{key:"newConnect",value:function(e){var t=this;this._totalTryTimes>15||(this._totalTryTimes++,this.createClient(),this.connect().then((function(i){i.connected?e(!0):t._retryCount>=3?e(!1):(t.newConnect(e),t._retryCount++)})).catch((function(){t._retryCount>=3?e(!1):(t.newConnect(e),t._retryCount++)})))}},{key:"handleReconnect",value:function(){var e=this;this.inRetry||(this._lastCloseTime=Date.now(),this._retryCount=0,this.newConnect((function(t){t?(e._retryCount=0,e.inRetry=!1,S.Z.emit(T.Z.SOCKET_RECONNECTED)):S.Z.emit(T.Z.OPEN_OFFLINE_MODAL,!0)})))}},{key:"loadProtoAndConnect",value:function(){var e=this;return new Promise((function(t,i){e.connect().then((function(e){e.connected?t({connected:!0}):i({connected:!1})})).catch((function(e){}))}))}},{key:"connect",value:function(){var e=this;return new Promise((function(t,i){e._client.connected?t({connected:!0}):(e._client.connet(h.Z.baseInfo.apiHost),e._client.once("stateChanged",(function(e){"connected"===e.state?t({connected:!0}):i({connected:!1})})))}))}},{key:"send",value:function(e,t,i){var n=e.split("."),d=r()(n,2),s=d[0],o=d[1],a=A.getProtoType(s,o),c=(a.verify(t),A.getProtoType("Base","TosHeader")),p=c.create({DateTime:Date.now(),ProtoName:e,Token:localStorage.getItem("token"),Sign:"AAAAAAAAAAAAAA",MsgId:++this._msgCounter}),u=c.encode(p).finish();this._cbDic[this._msgCounter]=i;var y=a.create(t),l=a.encode(y).finish(),f=8+u.byteLength+l.byteLength,I=new ArrayBuffer(f),g=new DataView(I);g.setUint32(0,f),g.setUint32(4,u.byteLength);for(var h=0;h<u.byteLength;h++)g.setUint8(8+h,u[h]);for(var m=0;m<l.byteLength;m++)g.setUint8(8+u.byteLength+m,l[m]);this._client.send(new Uint8Array(I))}},{key:"handleMessageReceived",value:function(e){var t=this;this.readerArrayBuffer(e).then((function(e){var i=new DataView(e),n=i.getUint32(0),d=i.getUint32(4),s=e.slice(8,8+d),o=A.getProtoType("Base","TocHeader").decode(new Uint8Array(s)),a=o.ProtoName,c=(o.DateTime,o.Code),p=o.Msg,u=o.MsgId,y=t._cbDic[u];if(200!==c)return y&&(y({protoName:a,code:c,msg:p}),setTimeout((function(){delete t._cbDic[u]}),0)),void t.handleErrorCode(o);var l=a.split("."),f=r()(l,2),I=f[0],g=f[1],h=e.slice(8+d,n),m=A.getProtoType(I,g).decode(new Uint8Array(h));y&&(y({protoName:a,code:c,data:m}),setTimeout((function(){delete t._cbDic[u]}),0)),t.emit(a,m)}))}},{key:"handleErrorCode",value:function(e){var t=e.ProtoName,i=e.Code,n=e.Msg;this.emit("SocketError",{protoName:t,code:i,msg:n})}}]),i}(m.EventEmitter))}}]);