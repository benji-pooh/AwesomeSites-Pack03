(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{382:function(e,t,r){!function(e,t,r,n){"use strict";var o,l=r.defineWorkerModule({name:"Typr Font Parser",dependencies:[function(){var e=self,t={parse:function(e){var r=t._bin,data=new Uint8Array(e);if("ttcf"==r.readASCII(data,0,4)){var n=4;r.readUshort(data,n),n+=2,r.readUshort(data,n),n+=2;var o=r.readUint(data,n);n+=4;for(var l=[],i=0;i<o;i++){var h=r.readUint(data,n);n+=4,l.push(t._readFont(data,h))}return l}return[t._readFont(data,0)]},_readFont:function(data,e){var r=t._bin,n=e;r.readFixed(data,e),e+=4;var o=r.readUshort(data,e);e+=2,r.readUshort(data,e),e+=2,r.readUshort(data,e),e+=2,r.readUshort(data,e),e+=2;for(var l=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],h={_data:data,_offset:n},c={},i=0;i<o;i++){var d=r.readASCII(data,e,4);e+=4,r.readUint(data,e),e+=4;var f=r.readUint(data,e);e+=4;var v=r.readUint(data,e);e+=4,c[d]={offset:f,length:v}}for(i=0;i<l.length;i++){var m=l[i];c[m]&&(h[m.trim()]=t[m.trim()].parse(data,c[m].offset,c[m].length,h))}return h},_tabOffset:function(data,e,r){for(var n=t._bin,o=n.readUshort(data,r+4),l=r+12,i=0;i<o;i++){var h=n.readASCII(data,l,4);l+=4,n.readUint(data,l),l+=4;var c=n.readUint(data,l);if(l+=4,n.readUint(data,l),l+=4,h==e)return c}return 0}};return t._bin={readFixed:function(data,e){return(data[e]<<8|data[e+1])+(data[e+2]<<8|data[e+3])/65540},readF2dot14:function(data,e){return t._bin.readShort(data,e)/16384},readInt:function(e,p){var a=t._bin.t.uint8;return a[0]=e[p+3],a[1]=e[p+2],a[2]=e[p+1],a[3]=e[p],t._bin.t.int32[0]},readInt8:function(e,p){return t._bin.t.uint8[0]=e[p],t._bin.t.int8[0]},readShort:function(e,p){var a=t._bin.t.uint8;return a[1]=e[p],a[0]=e[p+1],t._bin.t.int16[0]},readUshort:function(e,p){return e[p]<<8|e[p+1]},readUshorts:function(e,p,r){for(var n=[],i=0;i<r;i++)n.push(t._bin.readUshort(e,p+2*i));return n},readUint:function(e,p){var a=t._bin.t.uint8;return a[3]=e[p],a[2]=e[p+1],a[1]=e[p+2],a[0]=e[p+3],t._bin.t.uint32[0]},readUint64:function(e,p){return 4294967296*t._bin.readUint(e,p)+t._bin.readUint(e,p+4)},readASCII:function(e,p,t){for(var s="",i=0;i<t;i++)s+=String.fromCharCode(e[p+i]);return s},readUnicode:function(e,p,t){for(var s="",i=0;i<t;i++){var r=e[p++]<<8|e[p++];s+=String.fromCharCode(r)}return s},_tdec:e.TextDecoder?new e.TextDecoder:null,readUTF8:function(e,p,r){var n=t._bin._tdec;return n&&0==p&&r==e.length?n.decode(e):t._bin.readASCII(e,p,r)},readBytes:function(e,p,t){for(var r=[],i=0;i<t;i++)r.push(e[p+i]);return r},readASCIIArray:function(e,p,t){for(var s=[],i=0;i<t;i++)s.push(String.fromCharCode(e[p+i]));return s}},t._bin.t={buff:new ArrayBuffer(8)},t._bin.t.int8=new Int8Array(t._bin.t.buff),t._bin.t.uint8=new Uint8Array(t._bin.t.buff),t._bin.t.int16=new Int16Array(t._bin.t.buff),t._bin.t.uint16=new Uint16Array(t._bin.t.buff),t._bin.t.int32=new Int32Array(t._bin.t.buff),t._bin.t.uint32=new Uint32Array(t._bin.t.buff),t._lctf={},t._lctf.parse=function(data,e,r,n,o){var l=t._bin,h={},c=e;l.readFixed(data,e),e+=4;var d=l.readUshort(data,e);e+=2;var f=l.readUshort(data,e);e+=2;var v=l.readUshort(data,e);return e+=2,h.scriptList=t._lctf.readScriptList(data,c+d),h.featureList=t._lctf.readFeatureList(data,c+f),h.lookupList=t._lctf.readLookupList(data,c+v,o),h},t._lctf.readLookupList=function(data,e,r){var n=t._bin,o=e,l=[],h=n.readUshort(data,e);e+=2;for(var i=0;i<h;i++){var c=n.readUshort(data,e);e+=2;var d=t._lctf.readLookupTable(data,o+c,r);l.push(d)}return l},t._lctf.readLookupTable=function(data,e,r){var n=t._bin,o=e,l={tabs:[]};l.ltype=n.readUshort(data,e),e+=2,l.flag=n.readUshort(data,e),e+=2;var h=n.readUshort(data,e);e+=2;for(var i=0;i<h;i++){var c=n.readUshort(data,e);e+=2;var d=r(data,l.ltype,o+c);l.tabs.push(d)}return l},t._lctf.numOfOnes=function(e){for(var t=0,i=0;i<32;i++)0!=(e>>>i&1)&&t++;return t},t._lctf.readClassDef=function(data,e){var r=t._bin,n=[],o=r.readUshort(data,e);if(e+=2,1==o){var l=r.readUshort(data,e);e+=2;var h=r.readUshort(data,e);e+=2;for(var i=0;i<h;i++)n.push(l+i),n.push(l+i),n.push(r.readUshort(data,e)),e+=2}if(2==o){var c=r.readUshort(data,e);for(e+=2,i=0;i<c;i++)n.push(r.readUshort(data,e)),e+=2,n.push(r.readUshort(data,e)),e+=2,n.push(r.readUshort(data,e)),e+=2}return n},t._lctf.getInterval=function(e,t){for(var i=0;i<e.length;i+=3){var r=e[i],n=e[i+1];if(e[i+2],r<=t&&t<=n)return i}return-1},t._lctf.readCoverage=function(data,e){var r=t._bin,n={};n.fmt=r.readUshort(data,e),e+=2;var o=r.readUshort(data,e);return e+=2,1==n.fmt&&(n.tab=r.readUshorts(data,e,o)),2==n.fmt&&(n.tab=r.readUshorts(data,e,3*o)),n},t._lctf.coverageIndex=function(e,r){var n=e.tab;if(1==e.fmt)return n.indexOf(r);if(2==e.fmt){var o=t._lctf.getInterval(n,r);if(-1!=o)return n[o+2]+(r-n[o])}return-1},t._lctf.readFeatureList=function(data,e){var r=t._bin,n=e,o=[],l=r.readUshort(data,e);e+=2;for(var i=0;i<l;i++){var h=r.readASCII(data,e,4);e+=4;var c=r.readUshort(data,e);e+=2,o.push({tag:h.trim(),tab:t._lctf.readFeatureTable(data,n+c)})}return o},t._lctf.readFeatureTable=function(data,e){var r=t._bin;r.readUshort(data,e),e+=2;var n=r.readUshort(data,e);e+=2;for(var o=[],i=0;i<n;i++)o.push(r.readUshort(data,e+2*i));return o},t._lctf.readScriptList=function(data,e){var r=t._bin,n=e,o={},l=r.readUshort(data,e);e+=2;for(var i=0;i<l;i++){var h=r.readASCII(data,e,4);e+=4;var c=r.readUshort(data,e);e+=2,o[h.trim()]=t._lctf.readScriptTable(data,n+c)}return o},t._lctf.readScriptTable=function(data,e){var r=t._bin,n=e,o={},l=r.readUshort(data,e);e+=2,o.default=t._lctf.readLangSysTable(data,n+l);var h=r.readUshort(data,e);e+=2;for(var i=0;i<h;i++){var c=r.readASCII(data,e,4);e+=4;var d=r.readUshort(data,e);e+=2,o[c.trim()]=t._lctf.readLangSysTable(data,n+d)}return o},t._lctf.readLangSysTable=function(data,e){var r=t._bin,n={};r.readUshort(data,e),e+=2,n.reqFeature=r.readUshort(data,e),e+=2;var o=r.readUshort(data,e);return e+=2,n.features=r.readUshorts(data,e,o),n},t.CFF={},t.CFF.parse=function(data,e,r){var n=t._bin;(data=new Uint8Array(data.buffer,e,r))[e=0],data[++e],data[++e],data[++e],e++;var o=[];e=t.CFF.readIndex(data,e,o);for(var l=[],i=0;i<o.length-1;i++)l.push(n.readASCII(data,e+o[i],o[i+1]-o[i]));e+=o[o.length-1];var h=[];e=t.CFF.readIndex(data,e,h);var c=[];for(i=0;i<h.length-1;i++)c.push(t.CFF.readDict(data,e+h[i],e+h[i+1]));e+=h[h.length-1];var d=c[0],f=[];e=t.CFF.readIndex(data,e,f);var v=[];for(i=0;i<f.length-1;i++)v.push(n.readASCII(data,e+f[i],f[i+1]-f[i]));if(e+=f[f.length-1],t.CFF.readSubrs(data,e,d),d.CharStrings){e=d.CharStrings,f=[],e=t.CFF.readIndex(data,e,f);var m=[];for(i=0;i<f.length-1;i++)m.push(n.readBytes(data,e+f[i],f[i+1]-f[i]));d.CharStrings=m}if(d.ROS){e=d.FDArray;var y=[];for(e=t.CFF.readIndex(data,e,y),d.FDArray=[],i=0;i<y.length-1;i++){var x=t.CFF.readDict(data,e+y[i],e+y[i+1]);t.CFF._readFDict(data,x,v),d.FDArray.push(x)}e+=y[y.length-1],e=d.FDSelect,d.FDSelect=[];var w=data[e];if(e++,3!=w)throw w;var S=n.readUshort(data,e);for(e+=2,i=0;i<S+1;i++)d.FDSelect.push(n.readUshort(data,e),data[e+2]),e+=3}return d.Encoding&&(d.Encoding=t.CFF.readEncoding(data,d.Encoding,d.CharStrings.length)),d.charset&&(d.charset=t.CFF.readCharset(data,d.charset,d.CharStrings.length)),t.CFF._readFDict(data,d,v),d},t.CFF._readFDict=function(data,e,r){var n;for(var p in e.Private&&(n=e.Private[1],e.Private=t.CFF.readDict(data,n,n+e.Private[0]),e.Private.Subrs&&t.CFF.readSubrs(data,n+e.Private.Subrs,e.Private)),e)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(p)&&(e[p]=r[e[p]-426+35])},t.CFF.readSubrs=function(data,e,r){var n=t._bin,o=[];e=t.CFF.readIndex(data,e,o);var l,h=o.length;l=h<1240?107:h<33900?1131:32768,r.Bias=l,r.Subrs=[];for(var i=0;i<o.length-1;i++)r.Subrs.push(n.readBytes(data,e+o[i],o[i+1]-o[i]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,code){for(var i=0;i<e.charset.length;i++)if(e.charset[i]==code)return i;return-1},t.CFF.glyphBySE=function(e,r){return r<0||r>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[r])},t.CFF.readEncoding=function(data,e,r){t._bin;var n=[".notdef"],o=data[e];if(e++,0!=o)throw"error: unknown encoding format: "+o;var l=data[e];e++;for(var i=0;i<l;i++)n.push(data[e+i]);return n},t.CFF.readCharset=function(data,e,r){var n=t._bin,o=[".notdef"],l=data[e];if(e++,0==l)for(var i=0;i<r;i++){var h=n.readUshort(data,e);e+=2,o.push(h)}else{if(1!=l&&2!=l)throw"error: format: "+l;for(;o.length<r;){h=n.readUshort(data,e),e+=2;var c=0;for(1==l?(c=data[e],e++):(c=n.readUshort(data,e),e+=2),i=0;i<=c;i++)o.push(h),h++}}return o},t.CFF.readIndex=function(data,e,r){var n=t._bin,o=n.readUshort(data,e)+1,l=data[e+=2];if(e++,1==l)for(var i=0;i<o;i++)r.push(data[e+i]);else if(2==l)for(i=0;i<o;i++)r.push(n.readUshort(data,e+2*i));else if(3==l)for(i=0;i<o;i++)r.push(16777215&n.readUint(data,e+3*i-1));else if(1!=o)throw"unsupported offset size: "+l+", count: "+o;return(e+=o*l)-1},t.CFF.getCharString=function(data,e,r){var n=t._bin,o=data[e],l=data[e+1],h=(data[e+2],data[e+3],data[e+4],1),c=null,d=null;o<=20&&(c=o,h=1),12==o&&(c=100*o+l,h=2),21<=o&&o<=27&&(c=o,h=1),28==o&&(d=n.readShort(data,e+1),h=3),29<=o&&o<=31&&(c=o,h=1),32<=o&&o<=246&&(d=o-139,h=1),247<=o&&o<=250&&(d=256*(o-247)+l+108,h=2),251<=o&&o<=254&&(d=256*-(o-251)-l-108,h=2),255==o&&(d=n.readInt(data,e+1)/65535,h=5),r.val=null!=d?d:"o"+c,r.size=h},t.CFF.readCharString=function(data,e,r){for(var n=e+r,o=t._bin,l=[];e<n;){var h=data[e],c=data[e+1],d=(data[e+2],data[e+3],data[e+4],1),f=null,v=null;h<=20&&(f=h,d=1),12==h&&(f=100*h+c,d=2),19!=h&&20!=h||(f=h,d=2),21<=h&&h<=27&&(f=h,d=1),28==h&&(v=o.readShort(data,e+1),d=3),29<=h&&h<=31&&(f=h,d=1),32<=h&&h<=246&&(v=h-139,d=1),247<=h&&h<=250&&(v=256*(h-247)+c+108,d=2),251<=h&&h<=254&&(v=256*-(h-251)-c-108,d=2),255==h&&(v=o.readInt(data,e+1)/65535,d=5),l.push(null!=v?v:"o"+f),e+=d}return l},t.CFF.readDict=function(data,e,r){for(var n=t._bin,o={},l=[];e<r;){var h=data[e],c=data[e+1],d=(data[e+2],data[e+3],data[e+4],1),f=null,v=null;if(28==h&&(v=n.readShort(data,e+1),d=3),29==h&&(v=n.readInt(data,e+1),d=5),32<=h&&h<=246&&(v=h-139,d=1),247<=h&&h<=250&&(v=256*(h-247)+c+108,d=2),251<=h&&h<=254&&(v=256*-(h-251)-c-108,d=2),255==h)throw v=n.readInt(data,e+1)/65535,d=5,"unknown number";if(30==h){var m=[];for(d=1;;){var b=data[e+d];d++;var y=b>>4,x=15&b;if(15!=y&&m.push(y),15!=x&&m.push(x),15==x)break}for(var s="",w=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],i=0;i<m.length;i++)s+=w[m[i]];v=parseFloat(s)}h<=21&&(f=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][h],d=1,12==h&&(f=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][c],d=2)),null!=f?(o[f]=1==l.length?l[0]:l,l=[]):l.push(v),e+=d}return o},t.cmap={},t.cmap.parse=function(data,e,r){data=new Uint8Array(data.buffer,e,r),e=0;var n=t._bin,o={};n.readUshort(data,e),e+=2;var l=n.readUshort(data,e);e+=2;var h=[];o.tables=[];for(var i=0;i<l;i++){var c=n.readUshort(data,e);e+=2;var d=n.readUshort(data,e);e+=2;var f=n.readUint(data,e);e+=4;var v="p"+c+"e"+d,m=h.indexOf(f);if(-1==m){var y;m=o.tables.length,h.push(f);var x=n.readUshort(data,f);0==x?y=t.cmap.parse0(data,f):4==x?y=t.cmap.parse4(data,f):6==x?y=t.cmap.parse6(data,f):12==x?y=t.cmap.parse12(data,f):console.log("unknown format: "+x,c,d,f),o.tables.push(y)}if(null!=o[v])throw"multiple tables for one platform+encoding";o[v]=m}return o},t.cmap.parse0=function(data,e){var r=t._bin,n={};n.format=r.readUshort(data,e),e+=2;var o=r.readUshort(data,e);e+=2,r.readUshort(data,e),e+=2,n.map=[];for(var i=0;i<o-6;i++)n.map.push(data[e+i]);return n},t.cmap.parse4=function(data,e){var r=t._bin,n=e,o={};o.format=r.readUshort(data,e),e+=2;var l=r.readUshort(data,e);e+=2,r.readUshort(data,e),e+=2;var h=r.readUshort(data,e);e+=2;var c=h/2;o.searchRange=r.readUshort(data,e),e+=2,o.entrySelector=r.readUshort(data,e),e+=2,o.rangeShift=r.readUshort(data,e),e+=2,o.endCount=r.readUshorts(data,e,c),e+=2*c,e+=2,o.startCount=r.readUshorts(data,e,c),e+=2*c,o.idDelta=[];for(var i=0;i<c;i++)o.idDelta.push(r.readShort(data,e)),e+=2;for(o.idRangeOffset=r.readUshorts(data,e,c),e+=2*c,o.glyphIdArray=[];e<n+l;)o.glyphIdArray.push(r.readUshort(data,e)),e+=2;return o},t.cmap.parse6=function(data,e){var r=t._bin,n={};n.format=r.readUshort(data,e),e+=2,r.readUshort(data,e),e+=2,r.readUshort(data,e),e+=2,n.firstCode=r.readUshort(data,e),e+=2;var o=r.readUshort(data,e);e+=2,n.glyphIdArray=[];for(var i=0;i<o;i++)n.glyphIdArray.push(r.readUshort(data,e)),e+=2;return n},t.cmap.parse12=function(data,e){var r=t._bin,n={};n.format=r.readUshort(data,e),e+=2,e+=2,r.readUint(data,e),e+=4,r.readUint(data,e),e+=4;var o=r.readUint(data,e);e+=4,n.groups=[];for(var i=0;i<o;i++){var l=e+12*i,h=r.readUint(data,l+0),c=r.readUint(data,l+4),d=r.readUint(data,l+8);n.groups.push([h,c,d])}return n},t.glyf={},t.glyf.parse=function(data,e,t,r){for(var n=[],g=0;g<r.maxp.numGlyphs;g++)n.push(null);return n},t.glyf._parseGlyf=function(e,g){var r=t._bin,data=e._data,n=t._tabOffset(data,"glyf",e._offset)+e.loca[g];if(e.loca[g]==e.loca[g+1])return null;var o={};if(o.noc=r.readShort(data,n),n+=2,o.xMin=r.readShort(data,n),n+=2,o.yMin=r.readShort(data,n),n+=2,o.xMax=r.readShort(data,n),n+=2,o.yMax=r.readShort(data,n),n+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var i=0;i<o.noc;i++)o.endPts.push(r.readUshort(data,n)),n+=2;var l=r.readUshort(data,n);if(n+=2,data.length-n<l)return null;o.instructions=r.readBytes(data,n,l),n+=l;var h=o.endPts[o.noc-1]+1;for(o.flags=[],i=0;i<h;i++){var c=data[n];if(n++,o.flags.push(c),0!=(8&c)){var d=data[n];n++;for(var f=0;f<d;f++)o.flags.push(c),i++}}for(o.xs=[],i=0;i<h;i++){var v=0!=(2&o.flags[i]),m=0!=(16&o.flags[i]);v?(o.xs.push(m?data[n]:-data[n]),n++):m?o.xs.push(0):(o.xs.push(r.readShort(data,n)),n+=2)}for(o.ys=[],i=0;i<h;i++)v=0!=(4&o.flags[i]),m=0!=(32&o.flags[i]),v?(o.ys.push(m?data[n]:-data[n]),n++):m?o.ys.push(0):(o.ys.push(r.readShort(data,n)),n+=2);var y=0,x=0;for(i=0;i<h;i++)y+=o.xs[i],x+=o.ys[i],o.xs[i]=y,o.ys[i]=x}else{var w;o.parts=[];do{w=r.readUshort(data,n),n+=2;var S={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(S),S.glyphIndex=r.readUshort(data,n),n+=2,1&w){var T=r.readShort(data,n);n+=2;var M=r.readShort(data,n);n+=2}else T=r.readInt8(data,n),n++,M=r.readInt8(data,n),n++;2&w?(S.m.tx=T,S.m.ty=M):(S.p1=T,S.p2=M),8&w?(S.m.a=S.m.d=r.readF2dot14(data,n),n+=2):64&w?(S.m.a=r.readF2dot14(data,n),n+=2,S.m.d=r.readF2dot14(data,n),n+=2):128&w&&(S.m.a=r.readF2dot14(data,n),n+=2,S.m.b=r.readF2dot14(data,n),n+=2,S.m.c=r.readF2dot14(data,n),n+=2,S.m.d=r.readF2dot14(data,n),n+=2)}while(32&w);if(256&w){var A=r.readUshort(data,n);for(n+=2,o.instr=[],i=0;i<A;i++)o.instr.push(data[n]),n++}}return o},t.GPOS={},t.GPOS.parse=function(data,e,r,n){return t._lctf.parse(data,e,r,n,t.GPOS.subt)},t.GPOS.subt=function(data,e,r){var n=t._bin,o=r,l={};if(l.fmt=n.readUshort(data,r),r+=2,1==e||2==e||3==e||7==e||8==e&&l.fmt<=2){var h=n.readUshort(data,r);r+=2,l.coverage=t._lctf.readCoverage(data,h+o)}if(1==e&&1==l.fmt){var c=n.readUshort(data,r);r+=2;var d=t._lctf.numOfOnes(c);0!=c&&(l.pos=t.GPOS.readValueRecord(data,r,c))}else if(2==e){c=n.readUshort(data,r),r+=2;var f=n.readUshort(data,r);r+=2,d=t._lctf.numOfOnes(c);var v=t._lctf.numOfOnes(f);if(1==l.fmt){l.pairsets=[];var m=n.readUshort(data,r);r+=2;for(var i=0;i<m;i++){var y=o+n.readUshort(data,r);r+=2;var x=n.readUshort(data,y);y+=2;for(var w=[],S=0;S<x;S++){var T=n.readUshort(data,y);y+=2,0!=c&&(C=t.GPOS.readValueRecord(data,y,c),y+=2*d),0!=f&&(F=t.GPOS.readValueRecord(data,y,f),y+=2*v),w.push({gid2:T,val1:C,val2:F})}l.pairsets.push(w)}}if(2==l.fmt){var M=n.readUshort(data,r);r+=2;var A=n.readUshort(data,r);r+=2;var _=n.readUshort(data,r);r+=2;var U=n.readUshort(data,r);for(r+=2,l.classDef1=t._lctf.readClassDef(data,o+M),l.classDef2=t._lctf.readClassDef(data,o+A),l.matrix=[],i=0;i<_;i++){var E=[];for(S=0;S<U;S++){var C=null,F=null;0!=l.valFmt1&&(C=t.GPOS.readValueRecord(data,r,l.valFmt1),r+=2*d),0!=l.valFmt2&&(F=t.GPOS.readValueRecord(data,r,l.valFmt2),r+=2*v),E.push({val1:C,val2:F})}l.matrix.push(E)}}}return l},t.GPOS.readValueRecord=function(data,e,r){var n=t._bin,o=[];return o.push(1&r?n.readShort(data,e):0),e+=1&r?2:0,o.push(2&r?n.readShort(data,e):0),e+=2&r?2:0,o.push(4&r?n.readShort(data,e):0),e+=4&r?2:0,o.push(8&r?n.readShort(data,e):0),e+=8&r?2:0,o},t.GSUB={},t.GSUB.parse=function(data,e,r,n){return t._lctf.parse(data,e,r,n,t.GSUB.subt)},t.GSUB.subt=function(data,e,r){var n=t._bin,o=r,l={};if(l.fmt=n.readUshort(data,r),r+=2,1!=e&&4!=e&&5!=e&&6!=e)return null;if(1==e||4==e||5==e&&l.fmt<=2||6==e&&l.fmt<=2){var h=n.readUshort(data,r);r+=2,l.coverage=t._lctf.readCoverage(data,o+h)}if(1==e){if(1==l.fmt)l.delta=n.readShort(data,r),r+=2;else if(2==l.fmt){var c=n.readUshort(data,r);r+=2,l.newg=n.readUshorts(data,r,c),r+=2*l.newg.length}}else if(4==e){l.vals=[],c=n.readUshort(data,r),r+=2;for(var i=0;i<c;i++){var d=n.readUshort(data,r);r+=2,l.vals.push(t.GSUB.readLigatureSet(data,o+d))}}else if(5==e){if(2==l.fmt){var f=n.readUshort(data,r);r+=2,l.cDef=t._lctf.readClassDef(data,o+f),l.scset=[];var v=n.readUshort(data,r);for(r+=2,i=0;i<v;i++){var m=n.readUshort(data,r);r+=2,l.scset.push(0==m?null:t.GSUB.readSubClassSet(data,o+m))}}}else if(6==e&&3==l.fmt){for(i=0;i<3;i++){c=n.readUshort(data,r),r+=2;for(var y=[],x=0;x<c;x++)y.push(t._lctf.readCoverage(data,o+n.readUshort(data,r+2*x)));r+=2*c,0==i&&(l.backCvg=y),1==i&&(l.inptCvg=y),2==i&&(l.ahedCvg=y)}c=n.readUshort(data,r),r+=2,l.lookupRec=t.GSUB.readSubstLookupRecords(data,r,c)}return l},t.GSUB.readSubClassSet=function(data,e){var r=t._bin.readUshort,n=e,o=[],l=r(data,e);e+=2;for(var i=0;i<l;i++){var h=r(data,e);e+=2,o.push(t.GSUB.readSubClassRule(data,n+h))}return o},t.GSUB.readSubClassRule=function(data,e){var r=t._bin.readUshort,n={},o=r(data,e),l=r(data,e+=2);e+=2,n.input=[];for(var i=0;i<o-1;i++)n.input.push(r(data,e)),e+=2;return n.substLookupRecords=t.GSUB.readSubstLookupRecords(data,e,l),n},t.GSUB.readSubstLookupRecords=function(data,e,r){for(var n=t._bin.readUshort,o=[],i=0;i<r;i++)o.push(n(data,e),n(data,e+2)),e+=4;return o},t.GSUB.readChainSubClassSet=function(data,e){var r=t._bin,n=e,o=[],l=r.readUshort(data,e);e+=2;for(var i=0;i<l;i++){var h=r.readUshort(data,e);e+=2,o.push(t.GSUB.readChainSubClassRule(data,n+h))}return o},t.GSUB.readChainSubClassRule=function(data,e){for(var r=t._bin,n={},o=["backtrack","input","lookahead"],l=0;l<o.length;l++){var h=r.readUshort(data,e);e+=2,1==l&&h--,n[o[l]]=r.readUshorts(data,e,h),e+=2*n[o[l]].length}return h=r.readUshort(data,e),e+=2,n.subst=r.readUshorts(data,e,2*h),e+=2*n.subst.length,n},t.GSUB.readLigatureSet=function(data,e){var r=t._bin,n=e,o=[],l=r.readUshort(data,e);e+=2;for(var h=0;h<l;h++){var c=r.readUshort(data,e);e+=2,o.push(t.GSUB.readLigature(data,n+c))}return o},t.GSUB.readLigature=function(data,e){var r=t._bin,n={chain:[]};n.nglyph=r.readUshort(data,e),e+=2;var o=r.readUshort(data,e);e+=2;for(var l=0;l<o-1;l++)n.chain.push(r.readUshort(data,e)),e+=2;return n},t.head={},t.head.parse=function(data,e,r){var n=t._bin,o={};return n.readFixed(data,e),e+=4,o.fontRevision=n.readFixed(data,e),e+=4,n.readUint(data,e),e+=4,n.readUint(data,e),e+=4,o.flags=n.readUshort(data,e),e+=2,o.unitsPerEm=n.readUshort(data,e),e+=2,o.created=n.readUint64(data,e),e+=8,o.modified=n.readUint64(data,e),e+=8,o.xMin=n.readShort(data,e),e+=2,o.yMin=n.readShort(data,e),e+=2,o.xMax=n.readShort(data,e),e+=2,o.yMax=n.readShort(data,e),e+=2,o.macStyle=n.readUshort(data,e),e+=2,o.lowestRecPPEM=n.readUshort(data,e),e+=2,o.fontDirectionHint=n.readShort(data,e),e+=2,o.indexToLocFormat=n.readShort(data,e),e+=2,o.glyphDataFormat=n.readShort(data,e),e+=2,o},t.hhea={},t.hhea.parse=function(data,e,r){var n=t._bin,o={};return n.readFixed(data,e),e+=4,o.ascender=n.readShort(data,e),e+=2,o.descender=n.readShort(data,e),e+=2,o.lineGap=n.readShort(data,e),e+=2,o.advanceWidthMax=n.readUshort(data,e),e+=2,o.minLeftSideBearing=n.readShort(data,e),e+=2,o.minRightSideBearing=n.readShort(data,e),e+=2,o.xMaxExtent=n.readShort(data,e),e+=2,o.caretSlopeRise=n.readShort(data,e),e+=2,o.caretSlopeRun=n.readShort(data,e),e+=2,o.caretOffset=n.readShort(data,e),e+=2,e+=8,o.metricDataFormat=n.readShort(data,e),e+=2,o.numberOfHMetrics=n.readUshort(data,e),e+=2,o},t.hmtx={},t.hmtx.parse=function(data,e,r,n){for(var o=t._bin,l={aWidth:[],lsBearing:[]},h=0,c=0,i=0;i<n.maxp.numGlyphs;i++)i<n.hhea.numberOfHMetrics&&(h=o.readUshort(data,e),e+=2,c=o.readShort(data,e),e+=2),l.aWidth.push(h),l.lsBearing.push(c);return l},t.kern={},t.kern.parse=function(data,e,r,n){var o=t._bin,l=o.readUshort(data,e);if(e+=2,1==l)return t.kern.parseV1(data,e-2,r,n);var h=o.readUshort(data,e);e+=2;for(var map={glyph1:[],rval:[]},i=0;i<h;i++){e+=2,r=o.readUshort(data,e),e+=2;var c=o.readUshort(data,e);e+=2;var d=c>>>8;if(0!=(d&=15))throw"unknown kern table format: "+d;e=t.kern.readFormat0(data,e,map)}return map},t.kern.parseV1=function(data,e,r,n){var o=t._bin;o.readFixed(data,e),e+=4;var l=o.readUint(data,e);e+=4;for(var map={glyph1:[],rval:[]},i=0;i<l;i++){o.readUint(data,e),e+=4;var h=o.readUshort(data,e);e+=2,o.readUshort(data,e),e+=2;var c=h>>>8;if(0!=(c&=15))throw"unknown kern table format: "+c;e=t.kern.readFormat0(data,e,map)}return map},t.kern.readFormat0=function(data,e,map){var r=t._bin,n=-1,o=r.readUshort(data,e);e+=2,r.readUshort(data,e),e+=2,r.readUshort(data,e),e+=2,r.readUshort(data,e),e+=2;for(var l=0;l<o;l++){var h=r.readUshort(data,e);e+=2;var c=r.readUshort(data,e);e+=2;var d=r.readShort(data,e);e+=2,h!=n&&(map.glyph1.push(h),map.rval.push({glyph2:[],vals:[]}));var f=map.rval[map.rval.length-1];f.glyph2.push(c),f.vals.push(d),n=h}return e},t.loca={},t.loca.parse=function(data,e,r,n){var o=t._bin,l=[],h=n.head.indexToLocFormat,c=n.maxp.numGlyphs+1;if(0==h)for(var i=0;i<c;i++)l.push(o.readUshort(data,e+(i<<1))<<1);if(1==h)for(i=0;i<c;i++)l.push(o.readUint(data,e+(i<<2)));return l},t.maxp={},t.maxp.parse=function(data,e,r){var n=t._bin,o={},l=n.readUint(data,e);return e+=4,o.numGlyphs=n.readUshort(data,e),e+=2,65536==l&&(o.maxPoints=n.readUshort(data,e),e+=2,o.maxContours=n.readUshort(data,e),e+=2,o.maxCompositePoints=n.readUshort(data,e),e+=2,o.maxCompositeContours=n.readUshort(data,e),e+=2,o.maxZones=n.readUshort(data,e),e+=2,o.maxTwilightPoints=n.readUshort(data,e),e+=2,o.maxStorage=n.readUshort(data,e),e+=2,o.maxFunctionDefs=n.readUshort(data,e),e+=2,o.maxInstructionDefs=n.readUshort(data,e),e+=2,o.maxStackElements=n.readUshort(data,e),e+=2,o.maxSizeOfInstructions=n.readUshort(data,e),e+=2,o.maxComponentElements=n.readUshort(data,e),e+=2,o.maxComponentDepth=n.readUshort(data,e),e+=2),o},t.name={},t.name.parse=function(data,e,r){var n=t._bin,o={};n.readUshort(data,e),e+=2;var l=n.readUshort(data,e);e+=2,n.readUshort(data,e);for(var h,c=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=e+=2,i=0;i<l;i++){var f=n.readUshort(data,e);e+=2;var v=n.readUshort(data,e);e+=2;var m=n.readUshort(data,e);e+=2;var y=n.readUshort(data,e);e+=2;var x=n.readUshort(data,e);e+=2;var w=n.readUshort(data,e);e+=2;var S,T=c[y],M=d+12*l+w;if(0==f)S=n.readUnicode(data,M,x/2);else if(3==f&&0==v)S=n.readUnicode(data,M,x/2);else if(0==v)S=n.readASCII(data,M,x);else if(1==v)S=n.readUnicode(data,M,x/2);else if(3==v)S=n.readUnicode(data,M,x/2);else{if(1!=f)throw"unknown encoding "+v+", platformID: "+f;S=n.readASCII(data,M,x),console.log("reading unknown MAC encoding "+v+" as ASCII")}var A="p"+f+","+m.toString(16);null==o[A]&&(o[A]={}),o[A][T]=S,o[A]._lang=m}for(var p in o)if(null!=o[p].postScriptName&&1033==o[p]._lang)return o[p];for(var p in o)if(null!=o[p].postScriptName&&0==o[p]._lang)return o[p];for(var p in o)if(null!=o[p].postScriptName&&3084==o[p]._lang)return o[p];for(var p in o)if(null!=o[p].postScriptName)return o[p];for(var p in o){h=p;break}return console.log("returning name table with languageID "+o[h]._lang),o[h]},t["OS/2"]={},t["OS/2"].parse=function(data,e,r){var n=t._bin.readUshort(data,e);e+=2;var o={};if(0==n)t["OS/2"].version0(data,e,o);else if(1==n)t["OS/2"].version1(data,e,o);else if(2==n||3==n||4==n)t["OS/2"].version2(data,e,o);else{if(5!=n)throw"unknown OS/2 table version: "+n;t["OS/2"].version5(data,e,o)}return o},t["OS/2"].version0=function(data,e,r){var n=t._bin;return r.xAvgCharWidth=n.readShort(data,e),e+=2,r.usWeightClass=n.readUshort(data,e),e+=2,r.usWidthClass=n.readUshort(data,e),e+=2,r.fsType=n.readUshort(data,e),e+=2,r.ySubscriptXSize=n.readShort(data,e),e+=2,r.ySubscriptYSize=n.readShort(data,e),e+=2,r.ySubscriptXOffset=n.readShort(data,e),e+=2,r.ySubscriptYOffset=n.readShort(data,e),e+=2,r.ySuperscriptXSize=n.readShort(data,e),e+=2,r.ySuperscriptYSize=n.readShort(data,e),e+=2,r.ySuperscriptXOffset=n.readShort(data,e),e+=2,r.ySuperscriptYOffset=n.readShort(data,e),e+=2,r.yStrikeoutSize=n.readShort(data,e),e+=2,r.yStrikeoutPosition=n.readShort(data,e),e+=2,r.sFamilyClass=n.readShort(data,e),e+=2,r.panose=n.readBytes(data,e,10),e+=10,r.ulUnicodeRange1=n.readUint(data,e),e+=4,r.ulUnicodeRange2=n.readUint(data,e),e+=4,r.ulUnicodeRange3=n.readUint(data,e),e+=4,r.ulUnicodeRange4=n.readUint(data,e),e+=4,r.achVendID=[n.readInt8(data,e),n.readInt8(data,e+1),n.readInt8(data,e+2),n.readInt8(data,e+3)],e+=4,r.fsSelection=n.readUshort(data,e),e+=2,r.usFirstCharIndex=n.readUshort(data,e),e+=2,r.usLastCharIndex=n.readUshort(data,e),e+=2,r.sTypoAscender=n.readShort(data,e),e+=2,r.sTypoDescender=n.readShort(data,e),e+=2,r.sTypoLineGap=n.readShort(data,e),e+=2,r.usWinAscent=n.readUshort(data,e),e+=2,r.usWinDescent=n.readUshort(data,e),e+=2},t["OS/2"].version1=function(data,e,r){var n=t._bin;return e=t["OS/2"].version0(data,e,r),r.ulCodePageRange1=n.readUint(data,e),e+=4,r.ulCodePageRange2=n.readUint(data,e),e+=4},t["OS/2"].version2=function(data,e,r){var n=t._bin;return e=t["OS/2"].version1(data,e,r),r.sxHeight=n.readShort(data,e),e+=2,r.sCapHeight=n.readShort(data,e),e+=2,r.usDefault=n.readUshort(data,e),e+=2,r.usBreak=n.readUshort(data,e),e+=2,r.usMaxContext=n.readUshort(data,e),e+=2},t["OS/2"].version5=function(data,e,r){var n=t._bin;return e=t["OS/2"].version2(data,e,r),r.usLowerOpticalPointSize=n.readUshort(data,e),e+=2,r.usUpperOpticalPointSize=n.readUshort(data,e),e+=2},t.post={},t.post.parse=function(data,e,r){var n=t._bin,o={};return o.version=n.readFixed(data,e),e+=4,o.italicAngle=n.readFixed(data,e),e+=4,o.underlinePosition=n.readShort(data,e),e+=2,o.underlineThickness=n.readShort(data,e),e+=2,o},t.SVG={},t.SVG.parse=function(data,e,r){var n=t._bin,o={entries:[]},l=e;n.readUshort(data,e),e+=2;var h=n.readUint(data,e);e+=4,n.readUint(data,e),e+=4,e=h+l;var c=n.readUshort(data,e);e+=2;for(var i=0;i<c;i++){var d=n.readUshort(data,e);e+=2;var f=n.readUshort(data,e);e+=2;var v=n.readUint(data,e);e+=4;var m=n.readUint(data,e);e+=4;for(var y=new Uint8Array(data.buffer,l+v+h,m),svg=n.readUTF8(y,0,y.length),x=d;x<=f;x++)o.entries[x]=svg}return o},t.SVG.toPath=function(e){var r={cmds:[],crds:[]};if(null==e)return r;for(var svg=(new DOMParser).parseFromString(e,"image/svg+xml").firstChild;"svg"!=svg.tagName;)svg=svg.nextSibling;var n=svg.getAttribute("viewBox");n=n?n.trim().split(" ").map(parseFloat):[0,0,1e3,1e3],t.SVG._toPath(svg.children,r);for(var i=0;i<r.crds.length;i+=2){var o=r.crds[i],l=r.crds[i+1];o-=n[0],l=-(l-=n[1]),r.crds[i]=o,r.crds[i+1]=l}return r},t.SVG._toPath=function(e,r,n){for(var o=0;o<e.length;o++){var l=e[o],h=l.tagName,c=l.getAttribute("fill");if(null==c&&(c=n),"g"==h)t.SVG._toPath(l.children,r,c);else if("path"==h){r.cmds.push(c||"#000000");var d=l.getAttribute("d"),f=t.SVG._tokens(d);t.SVG._toksToPath(f,r),r.cmds.push("X")}else"defs"==h||console.log(h,l)}},t.SVG._tokens=function(e){for(var t=[],r=0,n=!1,o="";r<e.length;){var l=e.charCodeAt(r),h=e.charAt(r);r++;var c=48<=l&&l<=57||"."==h||"-"==h;n?"-"==h?(t.push(parseFloat(o)),o=h):c?o+=h:(t.push(parseFloat(o)),","!=h&&" "!=h&&t.push(h),n=!1):c?(o=h,n=!0):","!=h&&" "!=h&&t.push(h)}return n&&t.push(parseFloat(o)),t},t.SVG._toksToPath=function(e,r){for(var i=0,n=0,o=0,l=0,h=0,c={M:2,L:2,H:1,V:1,S:4,C:6},d=r.cmds,f=r.crds;i<e.length;){var v=e[i];if(i++,"z"==v)d.push("Z"),n=l,o=h;else for(var m=v.toUpperCase(),y=c[m],x=t.SVG._reps(e,i,y),w=0;w<x;w++){var S=0,T=0;if(v!=m&&(S=n,T=o),"M"==m)n=S+e[i++],o=T+e[i++],d.push("M"),f.push(n,o),l=n,h=o;else if("L"==m)n=S+e[i++],o=T+e[i++],d.push("L"),f.push(n,o);else if("H"==m)n=S+e[i++],d.push("L"),f.push(n,o);else if("V"==m)o=T+e[i++],d.push("L"),f.push(n,o);else if("C"==m){var M=S+e[i++],A=T+e[i++],_=S+e[i++],U=T+e[i++],E=S+e[i++],C=T+e[i++];d.push("C"),f.push(M,A,_,U,E,C),n=E,o=C}else if("S"==m){var F=Math.max(f.length-4,0);M=n+n-f[F],A=o+o-f[F+1],_=S+e[i++],U=T+e[i++],E=S+e[i++],C=T+e[i++],d.push("C"),f.push(M,A,_,U,E,C),n=E,o=C}else console.log("Unknown SVG command "+v)}}},t.SVG._reps=function(e,t,r){for(var i=t;i<e.length&&"string"!=typeof e[i];)i+=r;return(i-t)/r},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,code){var t=e.cmap,r=-1;if(null!=t.p0e4?r=t.p0e4:null!=t.p3e1?r=t.p3e1:null!=t.p1e0?r=t.p1e0:null!=t.p0e3&&(r=t.p0e3),-1==r)throw"no familiar platform and encoding!";var n=t.tables[r];if(0==n.format)return code>=n.map.length?0:n.map[code];if(4==n.format){for(var o=-1,i=0;i<n.endCount.length;i++)if(code<=n.endCount[i]){o=i;break}return-1==o||n.startCount[o]>code?0:65535&(0!=n.idRangeOffset[o]?n.glyphIdArray[code-n.startCount[o]+(n.idRangeOffset[o]>>1)-(n.idRangeOffset.length-o)]:code+n.idDelta[o])}if(12==n.format){if(code>n.groups[n.groups.length-1][1])return 0;for(i=0;i<n.groups.length;i++){var l=n.groups[i];if(l[0]<=code&&code<=l[1])return l[2]+(code-l[0])}return 0}throw"unknown cmap table format "+n.format},t.U.glyphToPath=function(e,r){var path={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[r]){var p=e.SVG.entries[r];return null==p?path:("string"==typeof p&&(p=t.SVG.toPath(p),e.SVG.entries[r]=p),p)}if(e.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},o=e.CFF,l=e.CFF.Private;if(o.ROS){for(var h=0;o.FDSelect[h+2]<=r;)h+=2;l=o.FDArray[o.FDSelect[h+1]].Private}t.U._drawCFF(e.CFF.CharStrings[r],n,o,l,path)}else e.glyf&&t.U._drawGlyf(r,e,path);return path},t.U._drawGlyf=function(e,r,path){var n=r.glyf[e];null==n&&(n=r.glyf[e]=t.glyf._parseGlyf(r,e)),null!=n&&(n.noc>-1?t.U._simpleGlyph(n,path):t.U._compoGlyph(n,r,path))},t.U._simpleGlyph=function(e,p){for(var r=0;r<e.noc;r++){for(var n=0==r?0:e.endPts[r-1]+1,o=e.endPts[r],i=n;i<=o;i++){var l=i==n?o:i-1,h=i==o?n:i+1,c=1&e.flags[i],d=1&e.flags[l],f=1&e.flags[h],v=e.xs[i],m=e.ys[i];if(i==n)if(c){if(!d){t.U.P.moveTo(p,v,m);continue}t.U.P.moveTo(p,e.xs[l],e.ys[l])}else d?t.U.P.moveTo(p,e.xs[l],e.ys[l]):t.U.P.moveTo(p,(e.xs[l]+v)/2,(e.ys[l]+m)/2);c?d&&t.U.P.lineTo(p,v,m):f?t.U.P.qcurveTo(p,v,m,e.xs[h],e.ys[h]):t.U.P.qcurveTo(p,v,m,(v+e.xs[h])/2,(m+e.ys[h])/2)}t.U.P.closePath(p)}},t.U._compoGlyph=function(e,r,p){for(var n=0;n<e.parts.length;n++){var path={cmds:[],crds:[]},o=e.parts[n];t.U._drawGlyf(o.glyphIndex,r,path);for(var l=o.m,i=0;i<path.crds.length;i+=2){var h=path.crds[i],c=path.crds[i+1];p.crds.push(h*l.a+c*l.b+l.tx),p.crds.push(h*l.c+c*l.d+l.ty)}for(i=0;i<path.cmds.length;i++)p.cmds.push(path.cmds[i])}},t.U._getGlyphClass=function(g,e){var r=t._lctf.getInterval(e,g);return-1==r?0:e[r+2]},t.U.getPairAdjustment=function(e,r,n){if(e.GPOS)for(var o=e.GPOS,l=o.lookupList,h=o.featureList,c=[],i=0;i<h.length;i++){var d=h[i];if("kern"==d.tag)for(var f=0;f<d.tab.length;f++)if(!c[d.tab[f]]){c[d.tab[f]]=!0;for(var v=l[d.tab[f]],m=0;m<v.tabs.length;m++)if(null!=v.tabs[i]){var y,x=v.tabs[m];if(!x.coverage||-1!=(y=t._lctf.coverageIndex(x.coverage,r)))if(1==v.ltype);else if(2==v.ltype){var w;if(1==x.fmt){var S=x.pairsets[y];for(i=0;i<S.length;i++)S[i].gid2==n&&(w=S[i])}else if(2==x.fmt){var T=t.U._getGlyphClass(r,x.classDef1),M=t.U._getGlyphClass(n,x.classDef2);w=x.matrix[T][M]}if(w&&w.val2)return w.val2[2]}}}}if(e.kern){var A=e.kern.glyph1.indexOf(r);if(-1!=A){var _=e.kern.rval[A].glyph2.indexOf(n);if(-1!=_)return e.kern.rval[A].vals[_]}}return 0},t.U.stringToGlyphs=function(e,r){for(var n=[],i=0;i<r.length;i++)(o=r.codePointAt(i))>65535&&i++,n.push(t.U.codeToGlyph(e,o));for(i=0;i<r.length;i++){var o;if(2367==(o=r.codePointAt(i))){var l=n[i-1];n[i-1]=n[i],n[i]=l}o>65535&&i++}var h=e.GSUB;if(null==h)return n;for(var c=h.lookupList,d=h.featureList,f=["rlig","liga","mset","isol","init","fina","medi","half","pres","blws"],v=[],m=0;m<d.length;m++){var y=d[m];if(-1!=f.indexOf(y.tag))for(var x=0;x<y.tab.length;x++)if(!v[y.tab[x]]){v[y.tab[x]]=!0;for(var w=c[y.tab[x]],S=0;S<n.length;S++){var T=t.U._getWPfeature(r,S);-1!="isol,init,fina,medi".indexOf(y.tag)&&y.tag!=T||t.U._applySubs(n,S,w,c)}}}return n},t.U._getWPfeature=function(e,t){var r='\n\t" ,.:;!?()  ،',n="آأؤإاةدذرزوٱٲٳٵٶٷڈډڊڋڌڍڎڏڐڑڒړڔڕږڗژڙۀۃۄۅۆۇۈۉۊۋۍۏےۓەۮۯܐܕܖܗܘܙܞܨܪܬܯݍݙݚݛݫݬݱݳݴݸݹࡀࡆࡇࡉࡔࡧࡩࡪࢪࢫࢬࢮࢱࢲࢹૅેૉ૊૎૏ૐ૑૒૝ૡ૤૯஁ஃ஄அஉ஌எஏ஑னப஫஬",o=0==t||-1!=r.indexOf(e[t-1]),l=t==e.length-1||-1!=r.indexOf(e[t+1]);return o||-1==n.indexOf(e[t-1])||(o=!0),l||-1==n.indexOf(e[t])||(l=!0),l||-1=="ꡲ્૗".indexOf(e[t+1])||(l=!0),o||-1=="ꡲ્૗".indexOf(e[t])||(o=!0),o?l?"isol":"init":l?"fina":"medi"},t.U._applySubs=function(e,r,n,o){for(var l=e.length-r-1,h=0;h<n.tabs.length;h++)if(null!=n.tabs[h]){var c,d=n.tabs[h];if(!d.coverage||-1!=(c=t._lctf.coverageIndex(d.coverage,e[r])))if(1==n.ltype)e[r],1==d.fmt?e[r]=e[r]+d.delta:e[r]=d.newg[c];else if(4==n.ltype)for(var f=d.vals[c],v=0;v<f.length;v++){var m=f[v],y=m.chain.length;if(!(y>l)){for(var x=!0,w=0,S=0;S<y;S++){for(;-1==e[r+w+(1+S)];)w++;m.chain[S]!=e[r+w+(1+S)]&&(x=!1)}if(x){for(e[r]=m.nglyph,S=0;S<y+w;S++)e[r+S+1]=-1;break}}}else if(5==n.ltype&&2==d.fmt)for(var T=t._lctf.getInterval(d.cDef,e[r]),M=d.cDef[T+2],A=d.scset[M],i=0;i<A.length;i++){var _=A[i],U=_.input;if(!(U.length>l)){for(x=!0,S=0;S<U.length;S++){var E=t._lctf.getInterval(d.cDef,e[r+1+S]);if(-1==T&&d.cDef[E+2]!=U[S]){x=!1;break}}if(x){var C=_.substLookupRecords;for(v=0;v<C.length;v+=2)C[v],C[v+1]}}}else if(6==n.ltype&&3==d.fmt){if(!t.U._glsCovered(e,d.backCvg,r-d.backCvg.length))continue;if(!t.U._glsCovered(e,d.inptCvg,r))continue;if(!t.U._glsCovered(e,d.ahedCvg,r+d.inptCvg.length))continue;var F=d.lookupRec;for(i=0;i<F.length;i+=2){T=F[i];var R=o[F[i+1]];t.U._applySubs(e,r+T,R,o)}}}},t.U._glsCovered=function(e,r,n){for(var i=0;i<r.length;i++)if(-1==t._lctf.coverageIndex(r[i],e[n+i]))return!1;return!0},t.U.glyphsToPath=function(e,r,n){for(var o={cmds:[],crds:[]},l=0,i=0;i<r.length;i++){var h=r[i];if(-1!=h){for(var c=i<r.length-1&&-1!=r[i+1]?r[i+1]:0,path=t.U.glyphToPath(e,h),d=0;d<path.crds.length;d+=2)o.crds.push(path.crds[d]+l),o.crds.push(path.crds[d+1]);for(n&&o.cmds.push(n),d=0;d<path.cmds.length;d++)o.cmds.push(path.cmds[d]);n&&o.cmds.push("X"),l+=e.hmtx.aWidth[h],i<r.length-1&&(l+=t.U.getPairAdjustment(e,h,c))}}return o},t.U.pathToSVG=function(path,e){null==e&&(e=5);for(var t=[],r=0,n={M:2,L:2,Q:4,C:6},i=0;i<path.cmds.length;i++){var o=path.cmds[i],l=r+(n[o]?n[o]:0);for(t.push(o);r<l;){var h=path.crds[r++];t.push(parseFloat(h.toFixed(e))+(r==l?"":" "))}}return t.join("")},t.U.pathToContext=function(path,e){for(var t=0,r=path.crds,n=0;n<path.cmds.length;n++){var o=path.cmds[n];"M"==o?(e.moveTo(r[t],r[t+1]),t+=2):"L"==o?(e.lineTo(r[t],r[t+1]),t+=2):"C"==o?(e.bezierCurveTo(r[t],r[t+1],r[t+2],r[t+3],r[t+4],r[t+5]),t+=6):"Q"==o?(e.quadraticCurveTo(r[t],r[t+1],r[t+2],r[t+3]),t+=4):"#"==o.charAt(0)?(e.beginPath(),e.fillStyle=o):"Z"==o?e.closePath():"X"==o&&e.fill()}},t.U.P={},t.U.P.moveTo=function(p,e,t){p.cmds.push("M"),p.crds.push(e,t)},t.U.P.lineTo=function(p,e,t){p.cmds.push("L"),p.crds.push(e,t)},t.U.P.curveTo=function(p,a,b,e,t,r,n){p.cmds.push("C"),p.crds.push(a,b,e,t,r,n)},t.U.P.qcurveTo=function(p,a,b,e,t){p.cmds.push("Q"),p.crds.push(a,b,e,t)},t.U.P.closePath=function(p){p.cmds.push("Z")},t.U._drawCFF=function(e,r,n,o,p){for(var l=r.stack,h=r.nStems,c=r.haveWidth,d=r.width,f=r.open,i=0,v=r.x,m=r.y,y=0,x=0,w=0,S=0,T=0,M=0,A=0,_=0,U=0,E=0,C={val:0,size:0};i<e.length;){t.CFF.getCharString(e,i,C);var F=C.val;if(i+=C.size,"o1"==F||"o18"==F)l.length%2!=0&&!c&&(d=l.shift()+o.nominalWidthX),h+=l.length>>1,l.length=0,c=!0;else if("o3"==F||"o23"==F)l.length%2!=0&&!c&&(d=l.shift()+o.nominalWidthX),h+=l.length>>1,l.length=0,c=!0;else if("o4"==F)l.length>1&&!c&&(d=l.shift()+o.nominalWidthX,c=!0),f&&t.U.P.closePath(p),m+=l.pop(),t.U.P.moveTo(p,v,m),f=!0;else if("o5"==F)for(;l.length>0;)v+=l.shift(),m+=l.shift(),t.U.P.lineTo(p,v,m);else if("o6"==F||"o7"==F)for(var R=l.length,B="o6"==F,P=0;P<R;P++){var I=l.shift();B?v+=I:m+=I,B=!B,t.U.P.lineTo(p,v,m)}else if("o8"==F||"o24"==F){R=l.length;for(var L=0;L+6<=R;)y=v+l.shift(),x=m+l.shift(),w=y+l.shift(),S=x+l.shift(),v=w+l.shift(),m=S+l.shift(),t.U.P.curveTo(p,y,x,w,S,v,m),L+=6;"o24"==F&&(v+=l.shift(),m+=l.shift(),t.U.P.lineTo(p,v,m))}else{if("o11"==F)break;if("o1234"==F||"o1235"==F||"o1236"==F||"o1237"==F)"o1234"==F&&(x=m,w=(y=v+l.shift())+l.shift(),E=S=x+l.shift(),M=S,_=m,v=(A=(T=(U=w+l.shift())+l.shift())+l.shift())+l.shift(),t.U.P.curveTo(p,y,x,w,S,U,E),t.U.P.curveTo(p,T,M,A,_,v,m)),"o1235"==F&&(y=v+l.shift(),x=m+l.shift(),w=y+l.shift(),S=x+l.shift(),U=w+l.shift(),E=S+l.shift(),T=U+l.shift(),M=E+l.shift(),A=T+l.shift(),_=M+l.shift(),v=A+l.shift(),m=_+l.shift(),l.shift(),t.U.P.curveTo(p,y,x,w,S,U,E),t.U.P.curveTo(p,T,M,A,_,v,m)),"o1236"==F&&(y=v+l.shift(),x=m+l.shift(),w=y+l.shift(),E=S=x+l.shift(),M=S,A=(T=(U=w+l.shift())+l.shift())+l.shift(),_=M+l.shift(),v=A+l.shift(),t.U.P.curveTo(p,y,x,w,S,U,E),t.U.P.curveTo(p,T,M,A,_,v,m)),"o1237"==F&&(y=v+l.shift(),x=m+l.shift(),w=y+l.shift(),S=x+l.shift(),U=w+l.shift(),E=S+l.shift(),T=U+l.shift(),M=E+l.shift(),A=T+l.shift(),_=M+l.shift(),Math.abs(A-v)>Math.abs(_-m)?v=A+l.shift():m=_+l.shift(),t.U.P.curveTo(p,y,x,w,S,U,E),t.U.P.curveTo(p,T,M,A,_,v,m));else if("o14"==F){if(l.length>0&&!c&&(d=l.shift()+n.nominalWidthX,c=!0),4==l.length){var k=l.shift(),z=l.shift(),O=l.shift(),D=l.shift(),N=t.CFF.glyphBySE(n,O),G=t.CFF.glyphBySE(n,D);t.U._drawCFF(n.CharStrings[N],r,n,o,p),r.x=k,r.y=z,t.U._drawCFF(n.CharStrings[G],r,n,o,p)}f&&(t.U.P.closePath(p),f=!1)}else if("o19"==F||"o20"==F)l.length%2!=0&&!c&&(d=l.shift()+o.nominalWidthX),h+=l.length>>1,l.length=0,c=!0,i+=h+7>>3;else if("o21"==F)l.length>2&&!c&&(d=l.shift()+o.nominalWidthX,c=!0),m+=l.pop(),v+=l.pop(),f&&t.U.P.closePath(p),t.U.P.moveTo(p,v,m),f=!0;else if("o22"==F)l.length>1&&!c&&(d=l.shift()+o.nominalWidthX,c=!0),v+=l.pop(),f&&t.U.P.closePath(p),t.U.P.moveTo(p,v,m),f=!0;else if("o25"==F){for(;l.length>6;)v+=l.shift(),m+=l.shift(),t.U.P.lineTo(p,v,m);y=v+l.shift(),x=m+l.shift(),w=y+l.shift(),S=x+l.shift(),v=w+l.shift(),m=S+l.shift(),t.U.P.curveTo(p,y,x,w,S,v,m)}else if("o26"==F)for(l.length%2&&(v+=l.shift());l.length>0;)y=v,x=m+l.shift(),v=w=y+l.shift(),m=(S=x+l.shift())+l.shift(),t.U.P.curveTo(p,y,x,w,S,v,m);else if("o27"==F)for(l.length%2&&(m+=l.shift());l.length>0;)x=m,w=(y=v+l.shift())+l.shift(),S=x+l.shift(),v=w+l.shift(),m=S,t.U.P.curveTo(p,y,x,w,S,v,m);else if("o10"==F||"o29"==F){var j="o10"==F?o:n;if(0==l.length)console.log("error: empty stack");else{var V=l.pop(),H=j.Subrs[V+j.Bias];r.x=v,r.y=m,r.nStems=h,r.haveWidth=c,r.width=d,r.open=f,t.U._drawCFF(H,r,n,o,p),v=r.x,m=r.y,h=r.nStems,c=r.haveWidth,d=r.width,f=r.open}}else if("o30"==F||"o31"==F){var W=l.length,X=(L=0,"o31"==F);for(L+=W-(R=-3&W);L<R;)X?(x=m,w=(y=v+l.shift())+l.shift(),m=(S=x+l.shift())+l.shift(),R-L==5?(v=w+l.shift(),L++):v=w,X=!1):(y=v,x=m+l.shift(),w=y+l.shift(),S=x+l.shift(),v=w+l.shift(),R-L==5?(m=S+l.shift(),L++):m=S,X=!0),t.U.P.curveTo(p,y,x,w,S,v,m),L+=4}else{if("o"==(F+"").charAt(0))throw console.log("Unknown operation: "+F,e),F;l.push(F)}}}r.x=v,r.y=m,r.nStems=h,r.haveWidth=c,r.width=d,r.open=f},t},function(){var e=function(){var e={};function t(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function r(source,e){this.source=source,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new t,this.dtree=new t}var n=new t,o=new t,l=new Uint8Array(30),h=new Uint16Array(30),c=new Uint8Array(30),d=new Uint16Array(30),f=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),v=new t,m=new Uint8Array(320);function y(e,base,t,r){var i,n;for(i=0;i<t;++i)e[i]=0;for(i=0;i<30-t;++i)e[i+t]=i/t|0;for(n=r,i=0;i<30;++i)base[i]=n,n+=1<<e[i]}var x=new Uint16Array(16);function w(e,t,r,n){var i,o;for(i=0;i<16;++i)e.table[i]=0;for(i=0;i<n;++i)e.table[t[r+i]]++;for(e.table[0]=0,o=0,i=0;i<16;++i)x[i]=o,o+=e.table[i];for(i=0;i<n;++i)t[r+i]&&(e.trans[x[t[r+i]]++]=i)}function S(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}function T(e,t,base){if(!t)return base;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,r+base}function M(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=0,n=0,o=0,l=e.tag;do{n=2*n+(1&l),l>>>=1,++o,r+=t.table[o],n-=t.table[o]}while(n>=0);return e.tag=l,e.bitcount-=o,t.trans[r+n]}function A(e,t,dt){var r,n,o,i,l,h;for(r=T(e,5,257),n=T(e,5,1),o=T(e,4,4),i=0;i<19;++i)m[i]=0;for(i=0;i<o;++i){var c=T(e,3,0);m[f[i]]=c}for(w(v,m,0,19),l=0;l<r+n;){var d=M(e,v);switch(d){case 16:var y=m[l-1];for(h=T(e,2,3);h;--h)m[l++]=y;break;case 17:for(h=T(e,3,3);h;--h)m[l++]=0;break;case 18:for(h=T(e,7,11);h;--h)m[l++]=0;break;default:m[l++]=d}}w(t,m,0,r),w(dt,m,r,n)}function _(e,t,dt){for(;;){var r,n,o,i,f=M(e,t);if(256===f)return 0;if(f<256)e.dest[e.destLen++]=f;else for(r=T(e,l[f-=257],h[f]),n=M(e,dt),i=o=e.destLen-T(e,c[n],d[n]);i<o+r;++i)e.dest[e.destLen++]=e.dest[i]}}function U(e){for(var t,i;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if((t=256*(t=e.source[e.sourceIndex+1])+e.source[e.sourceIndex])!==(65535&~(256*e.source[e.sourceIndex+3]+e.source[e.sourceIndex+2])))return-3;for(e.sourceIndex+=4,i=t;i;--i)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,0}return function(e,dt){var i;for(i=0;i<7;++i)e.table[i]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,i=0;i<24;++i)e.trans[i]=256+i;for(i=0;i<144;++i)e.trans[24+i]=i;for(i=0;i<8;++i)e.trans[168+i]=280+i;for(i=0;i<112;++i)e.trans[176+i]=144+i;for(i=0;i<5;++i)dt.table[i]=0;for(dt.table[5]=32,i=0;i<32;++i)dt.trans[i]=i}(n,o),y(l,h,4,3),y(c,d,2,1),l[28]=0,h[28]=258,e.exports=function(source,e){var t,l,h=new r(source,e);do{switch(t=S(h),T(h,2,0)){case 0:l=U(h);break;case 1:l=_(h,n,o);break;case 2:A(h,h.ltree,h.dtree),l=_(h,h.ltree,h.dtree);break;default:l=-3}if(0!==l)throw new Error("Data error")}while(!t);return h.destLen<h.dest.length?"function"==typeof h.dest.slice?h.dest.slice(0,h.destLen):h.dest.subarray(0,h.destLen):h.dest},e.exports}();return function(t){return function(e,t){var r=new DataView(e),n=0;function o(){var e=r.getUint16(n);return n+=2,e}function l(){var e=r.getUint32(n);return n+=4,e}function h(e){M.setUint16(A,e),A+=2}function c(e){M.setUint32(A,e),A+=4}for(var d={signature:l(),flavor:l(),length:l(),numTables:o(),reserved:o(),totalSfntSize:l(),majorVersion:o(),minorVersion:o(),metaOffset:l(),metaLength:l(),metaOrigLength:l(),privOffset:l(),privLength:l()},f=0;Math.pow(2,f)<=d.numTables;)f++;f--;for(var v=16*Math.pow(2,f),m=16*d.numTables-v,y=12,x=[],i=0;i<d.numTables;i++)x.push({tag:l(),offset:l(),compLength:l(),origLength:l(),origChecksum:l()}),y+=16;var w,S=new Uint8Array(12+16*x.length+x.reduce((function(e,t){return e+t.origLength+4}),0)),T=S.buffer,M=new DataView(T),A=0;return c(d.flavor),h(d.numTables),h(v),h(f),h(m),x.forEach((function(e){c(e.tag),c(e.origChecksum),c(y),c(e.origLength),e.outOffset=y,(y+=e.origLength)%4!=0&&(y+=4-y%4)})),x.forEach((function(r){var n=e.slice(r.offset,r.offset+r.compLength);if(r.compLength!=r.origLength){var o=new Uint8Array(r.origLength);t(new Uint8Array(n,2),o)}else o=new Uint8Array(n);S.set(o,r.outOffset);var l=0;(y=r.outOffset+r.origLength)%4!=0&&(l=4-y%4),S.set(new Uint8Array(l).buffer,r.outOffset+r.origLength),w=y+l})),T.slice(0,w)}(t,e)}},function(e,t){var r={M:2,L:2,Q:4,C:6,Z:0};return function(n){var o,l,h,c=new Uint8Array(n,0,4),d=e._bin.readASCII(c,0,4);if("wOFF"===d)n=t(n);else if("wOF2"===d)throw new Error("woff2 fonts not supported");return o=e.parse(n)[0],l=Object.create(null),h={unitsPerEm:o.head.unitsPerEm,ascender:o.hhea.ascender,descender:o.hhea.descender,forEachGlyph:function(text,t,n,c){var d=0,f=1/h.unitsPerEm*t,v=e.U.stringToGlyphs(o,text),m=0;return v.forEach((function(h){if(-1!==h){var v=l[h];if(!v){var y,x,w,S,T=e.U.glyphToPath(o,h),M=T.cmds,A=T.crds;if(A.length){y=x=1/0,w=S=-1/0;for(var i=0,_=A.length;i<_;i+=2){var U=A[i],E=A[i+1];U<y&&(y=U),E<x&&(x=E),U>w&&(w=U),E>S&&(S=E)}}else y=w=x=S=0;v=l[h]={index:h,advanceWidth:o.hmtx.aWidth[h],xMin:y,yMin:x,xMax:w,yMax:S,pathCommandCount:M.length,forEachPathCommand:function(e){for(var t=0,n=[],i=0,o=M.length;i<o;i++){var l=r[M[i]];n.length=1+l,n[0]=M[i];for(var h=1;h<=l;h++)n[h]=A[t++];e.apply(null,n)}}}}c.call(null,v,d,m),v.advanceWidth&&(d+=v.advanceWidth*f),n&&(d+=n*t)}m+=text.codePointAt(m)>65535?2:1})),d}}}}],init:function(e,t,r){return r(e(),t())}}),h={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,textureWidth:2048},c=new t.Color,d=Object.create(null);function f(e,r){if((e=v({},e)).font=(path=e.font||h.defaultFontURL,o||(o="undefined"==typeof document?{}:document.createElement("a")),o.href=path,o.href),e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||h.sdfGlyphSize,null!=e.colorRanges){var n={};for(var l in e.colorRanges)if(e.colorRanges.hasOwnProperty(l)){var f=e.colorRanges[l];"number"!=typeof f&&(f=c.set(f).getHex()),n[l]=f}e.colorRanges=n}var path;Object.freeze(e);var m=h.textureWidth,x=e.sdfGlyphSize,w=e.font+"@"+x,S=d[w];S||((S=d[w]={sdfTexture:new t.DataTexture(new Uint8Array(x*m),m,x,t.LuminanceFormat,void 0,void 0,void 0,void 0,t.LinearFilter,t.LinearFilter)}).sdfTexture.font=e.font),y(e).then((function(t){t.newGlyphSDFs&&(t.newGlyphSDFs.forEach((function(e){for(var t=e.textureData,r=e.atlasIndex,n=S.sdfTexture.image;n.data.length<(r+1)*x*x;){var o=new Uint8Array(2*n.data.length);o.set(n.data),n.data=o,n.height*=2}for(var l=n.width/x,h=0;h<x;h++)for(var c=h*x,d=n.width*x*Math.floor(r/l)+r%l*x+h*n.width,f=0;f<x;f++)n.data[d+f]=t[c+f]})),S.sdfTexture.needsUpdate=!0),r(Object.freeze({parameters:e,sdfTexture:S.sdfTexture,sdfGlyphSize:x,sdfMinDistancePercent:1/8,glyphBounds:t.glyphBounds,glyphAtlasIndices:t.glyphAtlasIndices,glyphColors:t.glyphColors,caretPositions:t.caretPositions,caretHeight:t.caretHeight,chunkedBounds:t.chunkedBounds,ascender:t.ascender,descender:t.descender,lineHeight:t.lineHeight,topBaseline:t.topBaseline,totalBounds:t.totalBounds,totalBlockSize:t.totalBlockSize,timings:t.timings}))}))}function v(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}var m=r.defineWorkerModule({name:"FontProcessor",dependencies:[h,1/8,l,function(e){var t=e.xMin,r=e.yMin,n=e.xMax-t,o=e.yMax-r,l={0:null,1:null,2:null,3:null,data:null,cx:Math.round(t+n/2),cy:Math.round(r+o/2),r:Math.pow(2,Math.floor(Math.log(Math.max(n,o))*Math.LOG2E)),minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};function h(e){!function e(t,r){if(!1!==r(t)&&!t.data)for(var i=0;i<4;i++)null!==t[i]&&e(t[i],r)}(l,e)}function c(e,t,r,n,o,l){var h=o-r,c=l-n,d=h*h+c*c,f=d?Math.max(0,Math.min(1,((e-r)*h+(t-n)*c)/d)):0,v=e-(r+f*h),m=t-(n+f*c);return v*v+m*m}return{addLineSegment:function(e,t,r,n){!function e(t,r){var n=t.minX,o=t.minY,l=t.maxX,h=t.maxY,c=t.cx,d=t.cy;n<r.minX&&(r.minX=n),o<r.minY&&(r.minY=o),l>r.maxX&&(r.maxX=l),h>r.maxY&&(r.maxY=h);var f=r.data;if(f)if(f.cx===c&&f.cy===d){for(;f.next;)f=f.next;f.next=t}else r.data=null,e(f,r),e(t,r);else{var v=(d<r.cy?0:2)+(c<r.cx?0:1);r[v]?e(t,r[v]):r[v]={0:null,1:null,2:null,3:null,data:t,cx:r.cx+r.r/2*(v%2?1:-1),cy:r.cy+r.r/2*(v<2?-1:1),r:r.r/2,minX:n,minY:o,maxX:l,maxY:h}}}({x0:e,y0:t,x1:r,y1:n,cx:(e+r)/2,cy:(t+n)/2,minX:Math.min(e,r),minY:Math.min(t,n),maxX:Math.max(e,r),maxY:Math.max(t,n),next:null},l)},findNearestSignedDistance:function(e,t,r){var n=r,o=n*n;return h((function(r){if(e-n>r.maxX||e+n<r.minX||t-n>r.maxY||t+n<r.minY)return!1;for(var l=r.data;l;l=l.next){var h=c(e,t,l.x0,l.y0,l.x1,l.y1);h<o&&(o=h,n=Math.sqrt(h))}})),function(e,t){var r=!1;return h((function(n){if(n.maxX<e||n.minY>t||n.maxY<t)return!1;for(var o=n.data;o;o=o.next){var l=o.x0,h=o.y0,c=o.x1,d=o.y1;h>t!=d>t&&e<(c-l)*(t-h)/(d-h)+l&&(r=!r)}})),r}(e,t)||(n=-n),n}}},function(e,t){var r=t.sdfDistancePercent;function n(e,t,r,n,o,l,h){var c=1-h;return{x:c*c*e+2*c*h*r+h*h*o,y:c*c*t+2*c*h*n+h*h*l}}function o(e,t,r,n,o,l,h,c,d){var f=1-d;return{x:f*f*f*e+3*f*f*d*r+3*f*d*d*o+d*d*d*h,y:f*f*f*t+3*f*f*d*n+3*f*d*d*l+d*d*d*c}}return function(t,l){var h=new Uint8Array(l*l),c=t.xMax-t.xMin,d=t.yMax-t.yMin,f=Math.max(c,d)*r,v=(c+2*f)/l,m=(d+2*f)/l,y=t.xMin-f-v,x=t.yMin-f-m,w=t.xMax+f+v,S=t.yMax+f+m;if(t.pathCommandCount){var T,M,A,_,U=e(t);t.forEachPathCommand((function(e,t,r,l,h,c,d){switch(e){case"M":A=T=t,_=M=r;break;case"L":t===A&&r===_||U.addLineSegment(A,_,A=t,_=r);break;case"Q":for(var f={x:A,y:_},i=1;i<16;i++){var v=n(A,_,t,r,l,h,i/15);U.addLineSegment(f.x,f.y,v.x,v.y),f=v}A=l,_=h;break;case"C":for(var m={x:A,y:_},y=1;y<16;y++){var x=o(A,_,t,r,l,h,c,d,y/15);U.addLineSegment(m.x,m.y,x.x,x.y),m=x}A=c,_=d;break;case"Z":A===T&&_===M||U.addLineSegment(A,_,T,M)}}));for(var E=0;E<l;E++)for(var C=0;C<l;C++){var F=U.findNearestSignedDistance(y+(w-y)*(E+.5)/l,x+(S-x)*(C+.5)/l,f),R=isFinite(F)?Math.round(255*(1+F/f)*.5):F;R=Math.max(0,Math.min(255,R)),h[C*l+E]=R}}return{textureData:h,renderingBounds:[y,x,w,S]}}},function(e,t,r){var n=r.defaultFontUrl,o=Object.create(null),l=Object.create(null);function h(t,r){t||(t=n);var o=l[t];o?o.pending?o.pending.push(r):r(o):(l[t]={pending:[r]},function(t,r){!function o(){var l=function(e){console.error("Failure loading font "+t+(t===n?"":"; trying fallback"),e),t!==n&&(t=n,o())};try{var h=new XMLHttpRequest;h.open("get",t,!0),h.responseType="arraybuffer",h.onload=function(){if(h.status>=400)l(new Error(h.statusText));else if(h.status>0)try{var t=e(h.response);r(t)}catch(e){l(e)}},h.onerror=l,h.send()}catch(e){l(e)}}()}(t,(function(e){var r=l[t].pending;l[t]=e,r.forEach((function(t){return t(e)}))})))}function c(e,r,l){var text=e.text;void 0===text&&(text="");var c=e.font;void 0===c&&(c=n);var m=e.sdfGlyphSize;void 0===m&&(m=64);var y=e.fontSize;void 0===y&&(y=1);var x=e.letterSpacing;void 0===x&&(x=0);var w=e.lineHeight;void 0===w&&(w="normal");var S=e.maxWidth;void 0===S&&(S=1/0);var T=e.textAlign;void 0===T&&(T="left");var M=e.textIndent;void 0===M&&(M=0);var A=e.whiteSpace;void 0===A&&(A="normal");var _=e.overflowWrap;void 0===_&&(_="normal");var U=e.anchorX;void 0===U&&(U=0);var E=e.anchorY;void 0===E&&(E=0);var C=e.includeCaretPositions;void 0===C&&(C=!1);var F=e.chunkedBoundsSize;void 0===F&&(F=8192);var R=e.colorRanges;void 0===R&&(R=null),void 0===l&&(l=!1);var B=f(),P={total:0,fontLoad:0,layout:0,sdf:{},sdfTotal:0};text.indexOf("\r")>-1&&(console.warn("FontProcessor.process: got text with \\r chars; normalizing to \\n"),text=text.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),y=+y,x=+x,S=+S,w=w||"normal",M=+M,function(e,t,r){e||(e=n);var l=e+"@"+t,c=o[l];c?r(c):h(e,(function(e){c=o[l]||(o[l]={fontObj:e,glyphs:{},glyphCount:0}),r(c)}))}(c,m,(function(e){var n=e.fontObj,o=isFinite(S),h=null,c=null,I=null,L=null,k=null,z=null,O=null,D=0,N=0,G="nowrap"!==A,j=n.ascender,V=n.descender,H=n.unitsPerEm;P.fontLoad=f()-B;var W=f(),X=y/H;"normal"===w&&(w=(j-V)/H);var K=((w*=y)-(j-V)*X)/2,Y=-(y+K),Z=Math.min(w,(j-V)*X),Q=(j+V)/2*X-Z/2,$=M,J=new v,ee=[J];if(n.forEachGlyph(text,y,x,(function(e,t,r){var n,l=text.charAt(r),h=e.advanceWidth*X,c=J.count;if("isEmpty"in e||(e.isWhitespace=!!l&&/\s/.test(l),e.isEmpty=e.xMin===e.xMax||e.yMin===e.yMax),e.isWhitespace||e.isEmpty||N++,G&&o&&!e.isWhitespace&&t+h+$>S&&c){if(J.glyphAt(c-1).glyphObj.isWhitespace)n=new v,$=-t;else for(var i=c;i--;){if(0===i&&"break-word"===_){n=new v,$=-t;break}if(J.glyphAt(i).glyphObj.isWhitespace){var d=(n=J.splitAt(i+1)).glyphAt(0).x;$-=d;for(var f=n.count;f--;)n.glyphAt(f).x-=d;break}}n&&(J.isSoftWrapped=!0,J=n,ee.push(J),D=S)}var m=J.glyphAt(J.count);m.glyphObj=e,m.x=t+$,m.width=h,m.charIndex=r,"\n"===l&&(J=new v,ee.push(J),$=-(t+h+x*y)+M)})),ee.forEach((function(line){for(var i=line.count;i--;){var e=line.glyphAt(i),t=e.glyphObj,r=e.x,n=e.width;if(!t.isWhitespace)return line.width=r+n,void(line.width>D&&(D=line.width))}})),!l){var te=0,re=0;if(U&&("number"==typeof U?te=-U:"string"==typeof U&&(te=-D*("left"===U?0:"center"===U?.5:"right"===U?1:d(U)))),E)if("number"==typeof E)re=-E;else if("string"==typeof E){var ne=ee.length*w;re="top"===E?0:"top-baseline"===E?-Y:"middle"===E?ne/2:"bottom"===E?ne:"bottom-baseline"===E?ne-K+V*X:d(E)*ne}c=new Float32Array(4*N),I=new Float32Array(N),z=[1/0,1/0,-1/0,-1/0],O=[];var ie=Y;C&&(k=new Float32Array(3*text.length)),R&&(L=new Uint8Array(3*N));var se,oe,ae=0,le=-1,he=-1;ee.forEach((function(line){var r=line.count,n=line.width;if(r>0){var o=0,l=0;if("center"===T)o=(D-n)/2;else if("right"===T)o=D-n;else if("justify"===T&&line.isSoftWrapped){for(var d=0,i=r;i--;)if(!line.glyphAt(i).glyphObj.isWhitespace){for(;i--;)line.glyphAt(i).glyphObj,line.glyphAt(i).glyphObj.isWhitespace&&d++;break}l=(D-n)/d}for(var v=0;v<r;v++){var y=line.glyphAt(v),x=y.glyphObj;if(o&&(y.x+=o),0!==l&&x.isWhitespace&&(o+=l,y.width+=l),C){var S=y.charIndex;for(k[3*S]=y.x+te,k[3*S+1]=y.x+y.width+te,k[3*S+2]=ie+Q+re;S-le>1;)k[3*(le+1)]=k[3*le+1],k[3*(le+1)+1]=k[3*le+1],k[3*(le+1)+2]=k[3*le+2],le++;le=S}if(R)for(var M=y.charIndex;M>he;)he++,R.hasOwnProperty(he)&&(oe=R[he]);if(!x.isWhitespace&&!x.isEmpty){var A=ae++,_=e.glyphs[x.index];if(!_){var U=f(),E=t(x,m);P.sdf[text.charAt(y.charIndex)]=f()-U,E.atlasIndex=e.glyphCount++,h||(h=[]),h.push(E),_=e.glyphs[x.index]={atlasIndex:E.atlasIndex,glyphObj:x,renderingBounds:E.renderingBounds}}var B=_.renderingBounds,N=4*A,G=c[N]=y.x+B[0]*X+te,j=c[N+1]=ie+B[1]*X+re,V=c[N+2]=y.x+B[2]*X+te,H=c[N+3]=ie+B[3]*X+re;if(G<z[0]&&(z[0]=G),j<z[1]&&(z[1]=j),V>z[2]&&(z[2]=V),H>z[3]&&(z[3]=H),A%F==0&&(se={start:A,end:A,rect:[1/0,1/0,-1/0,-1/0]},O.push(se)),se.end++,G<se.rect[0]&&(se.rect[0]=G),j<se.rect[1]&&(se.rect[1]=j),V>se.rect[2]&&(se.rect[2]=V),H>se.rect[3]&&(se.rect[3]=H),I[A]=_.atlasIndex,R){var W=3*A;L[W]=oe>>16&255,L[W+1]=oe>>8&255,L[W+2]=255&oe}}}}ie-=w}))}for(var ce in P.sdf)P.sdfTotal+=P.sdf[ce];P.layout=f()-W-P.sdfTotal,P.total=f()-B,r({glyphBounds:c,glyphAtlasIndices:I,caretPositions:k,caretHeight:Z,glyphColors:L,chunkedBounds:O,ascender:j*X,descender:V*X,lineHeight:w,topBaseline:Y,totalBounds:z,totalBlockSize:[D,ee.length*w],newGlyphSDFs:h,timings:P})}))}function d(e){var t=e.match(/^([\d.]+)%$/),r=t?parseFloat(t[1]):NaN;return isNaN(r)?0:r/100}function f(){return(self.performance||Date).now()}function v(){this.data=[]}return v.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/4)},glyphAt:function(i){var e=v.flyweight;return e.data=this.data,e.index=i,e},splitAt:function(i){var e=new v;return e.data=this.data.splice(4*i),e}},v.flyweight=["glyphObj","x","width","charIndex"].reduce((function(e,t,i,r){return Object.defineProperty(e,t,{get:function(){return this.data[4*this.index+i]},set:function(e){this.data[4*this.index+i]=e}}),e}),{data:null,index:0}),{process:c,measure:function(e,t){c(e,(function(e){t({width:e.totalBlockSize[0],height:e.totalBlockSize[1]})}),{metricsOnly:!0})},loadFont:h}}],init:function(e,t,r,n,o,l){return l(r,o(n,{sdfDistancePercent:t}),{defaultFontUrl:e.defaultFontURL})}}),y=r.defineWorkerModule({name:"TextBuilder",dependencies:[m,r.ThenableWorkerModule],init:function(e,t){return function(r){var n=new t;return e.process(r,n.resolve),n}},getTransferables:function(e){var t=[e.glyphBounds.buffer,e.glyphAtlasIndices.buffer];return e.caretPositions&&t.push(e.caretPositions.buffer),e.newGlyphSDFs&&e.newGlyphSDFs.forEach((function(e){t.push(e.textureData.buffer)})),t}}),x={},w=new t.Vector3,S=function(e){function r(){e.call(this),this.detail=1,this.boundingSphere=new t.Sphere}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var n={detail:{configurable:!0}};return r.prototype.computeBoundingSphere=function(){},n.detail.set=function(e){var r=this;if(e!==this._detail){this._detail=e,("number"!=typeof e||e<1)&&(e=1);var n=function(e){var r=x[e];return r||(r=x[e]=new t.PlaneBufferGeometry(1,1,e,e).translate(.5,.5,0)),r}(e);["position","normal","uv"].forEach((function(e){r.attributes[e]=n.attributes[e]})),this.setIndex(n.getIndex())}},n.detail.get=function(){return this._detail},r.prototype.updateGlyphs=function(e,t,r,n,o){T(this,"aTroikaGlyphBounds",e,4),T(this,"aTroikaGlyphIndex",t,1),T(this,"aTroikaGlyphColor",o,3),this._chunkedBounds=n,M(this,t.length);var l=this.boundingSphere;l.center.set((r[0]+r[2])/2,(r[1]+r[3])/2,0),l.radius=l.center.distanceTo(w.set(r[0],r[1],0))},r.prototype.applyClipRect=function(e){var t=this.getAttribute("aTroikaGlyphIndex").count,r=this._chunkedBounds;if(r)for(var i=r.length;i--;){t=r[i].end;var rect=r[i].rect;if(rect[1]<e.w&&rect[3]>e.y&&rect[0]<e.z&&rect[2]>e.x)break}M(this,t)},Object.defineProperties(r.prototype,n),r}(t.InstancedBufferGeometry);function T(e,r,n,o){var l=e.getAttribute(r);n?l&&l.array.length===n.length?(l.array.set(n),l.needsUpdate=!0):(e.setAttribute(r,new t.InstancedBufferAttribute(n,o)),delete e._maxInstanceCount,e.dispose()):l&&e.deleteAttribute(r)}function M(e,t){e[e.hasOwnProperty("instanceCount")?"instanceCount":"maxInstancedCount"]=t}function A(e){var r=n.createDerivedMaterial(e,{extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new t.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFMinDistancePct:{value:0},uTroikaTotalBounds:{value:new t.Vector4(0,0,0,0)},uTroikaClipRect:{value:new t.Vector4(0,0,0,0)},uTroikaOrient:{value:new t.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaSDFTextureUV;\nvarying vec2 vTroikaGlyphUV;\nvarying vec3 vTroikaGlyphColor;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nvec4 clippedBounds = vec4(\n  clamp(bounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(bounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\nvTroikaGlyphUV = clippedXY.xy;\n\nfloat cols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvTroikaSDFTextureUV = vec2(\n  mod(aTroikaGlyphIndex, cols) + clippedXY.x,\n  floor(aTroikaGlyphIndex / cols) + clippedXY.y\n) * uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = vec2(\n  (position.x - uTroikaTotalBounds.x) / (uTroikaTotalBounds.z - uTroikaTotalBounds.x),\n  (position.y - uTroikaTotalBounds.y) / (uTroikaTotalBounds.w - uTroikaTotalBounds.y)\n);\n\nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform float uTroikaSDFMinDistancePct;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaSDFTextureUV;\nvarying vec2 vTroikaGlyphUV;\n\nfloat troikaGetTextAlpha() {\n  float troikaSDFValue = texture2D(uTroikaSDFTexture, vTroikaSDFTextureUV).r;\n  \n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(0.5, troikaSDFValue);\n  #else\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  float aaDist = min(\n    0.5,\n    0.5 * min(\n      fwidth(vTroikaGlyphUV.x),\n      fwidth(vTroikaGlyphUV.y)\n    )\n  ) / uTroikaSDFMinDistancePct;\n  #else\n  float aaDist = 0.01;\n  #endif\n  \n  float alpha = uTroikaSDFDebug ? troikaSDFValue : smoothstep(\n    0.5 - aaDist,\n    0.5 + aaDist,\n    troikaSDFValue\n  );\n  #endif\n  \n  return alpha;\n}\n",fragmentColorTransform:"\nfloat troikaAlphaMult = troikaGetTextAlpha();\nif (troikaAlphaMult == 0.0) {\n  discard;\n} else {\n  gl_FragColor.a *= troikaAlphaMult;\n}\n",customRewriter:function(e){var t=e.vertexShader,r=e.fragmentShader,o=/\buniform\s+vec3\s+diffuse\b/;return o.test(r)&&(r=r.replace(o,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),o.test(t)||(t=t.replace(n.voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:t,fragmentShader:r}}});return r.transparent=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get:function(){return this.side},set:function(){}}}),r}S.prototype.setAttribute||(S.prototype.setAttribute=function(e,t){return this.attributes[e]=t,this});var _=new t.MeshBasicMaterial({color:16777215,side:t.DoubleSide,transparent:!0}),U=new t.Matrix4,E=new t.Vector3,C=new t.Vector3,F=[],R=new t.Vector3,B=new t.Mesh(new t.PlaneBufferGeometry(1,1).translate(.5,.5,0),_),P={type:"syncstart"},I={type:"synccomplete"},L=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],k=L.concat("material","color","depthOffset","clipRect","orientation","glyphGeometryDetail"),z=function(e){function t(){var t=new S;e.call(this,t,null),this.text="",this.anchorX=0,this.anchorY=0,this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.depthOffset=0,this.clipRect=null,this.orientation="+x+y",this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.debugSDF=!1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={textRenderInfo:{configurable:!0},material:{configurable:!0},glyphGeometryDetail:{configurable:!0},customDepthMaterial:{configurable:!0},customDistanceMaterial:{configurable:!0}};return t.prototype.sync=function(e){var t=this;this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(P),f({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize},(function(r){t._isSyncing=!1,t._textRenderInfo=r,t.geometry.updateGlyphs(r.glyphBounds,r.glyphAtlasIndices,r.totalBounds,r.chunkedBounds,r.glyphColors);var n=t._queuedSyncs;n&&(t._queuedSyncs=null,t._needsSync=!0,t.sync((function(){n.forEach((function(e){return e&&e()}))}))),t.dispatchEvent(I),e&&e()}))))},t.prototype.onBeforeRender=function(){this.sync(),this._prepareForRender()},t.prototype.dispose=function(){this.geometry.dispose()},r.textRenderInfo.get=function(){return this._textRenderInfo||null},r.material.get=function(){var e=this._derivedMaterial,t=this._baseMaterial||_;return e&&e.baseMaterial===t||(e=this._derivedMaterial=A(t),t.addEventListener("dispose",(function r(){t.removeEventListener("dispose",r),e.dispose()}))),e},r.material.set=function(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e},r.glyphGeometryDetail.get=function(){return this.geometry.detail},r.glyphGeometryDetail.set=function(e){this.geometry.detail=e},r.customDepthMaterial.get=function(){return this.material.getDepthMaterial()},r.customDistanceMaterial.get=function(){return this.material.getDistanceMaterial()},t.prototype._prepareForRender=function(){var e=this._derivedMaterial,t=e.uniforms,r=this.textRenderInfo;if(r){var n=r.sdfTexture,o=r.totalBounds;t.uTroikaSDFTexture.value=n,t.uTroikaSDFTextureSize.value.set(n.image.width,n.image.height),t.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,t.uTroikaSDFMinDistancePct.value=r.sdfMinDistancePercent,t.uTroikaTotalBounds.value.fromArray(o),t.uTroikaUseGlyphColors.value=!!r.glyphColors;var l=this.clipRect;l&&Array.isArray(l)&&4===l.length?t.uTroikaClipRect.value.set(Math.max(o[0],l[0]),Math.max(o[1],l[1]),Math.min(o[2],l[2]),Math.min(o[3],l[3])):t.uTroikaClipRect.value.fromArray(o),this.geometry.applyClipRect(t.uTroikaClipRect.value)}t.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;var h=this.color;null!=h&&e.color&&e.color.isColor&&h!==e._troikaColor&&e.color.set(e._troikaColor=h);var c=this.orientation||"+x+y";if(c!==e._orientation){var d=t.uTroikaOrient.value,f="+x+y"!==(c=c.replace(/[^-+xyz]/g,""))&&c.match(/^([-+])([xyz])([-+])([xyz])$/);if(f){var v=f[1],m=f[2],y=f[3],x=f[4];E.set(0,0,0)[m]="-"===v?1:-1,C.set(0,0,0)[x]="-"===y?-1:1,U.lookAt(R,E.cross(C),C),d.setFromMatrix4(U)}else d.identity();e._orientation=c}},t.prototype.raycast=function(e,t){var r=this.textRenderInfo;if(r){var n=r.totalBounds;B.matrixWorld.multiplyMatrices(this.matrixWorld,U.set(n[2]-n[0],0,0,n[0],0,n[3]-n[1],0,n[1],0,0,1,0,0,0,0,1)),F.length=0,B.raycast(e,F);for(var i=0;i<F.length;i++)F[i].object=this,t.push(F[i])}},t.prototype.copy=function(source){var t=this;return e.prototype.copy.call(this,source),k.forEach((function(e){t[e]=source[e]})),this},t.prototype.clone=function(){return(new this.constructor).copy(this)},Object.defineProperties(t.prototype,r),t}(t.Mesh);L.forEach((function(e){var t="_private_"+e;Object.defineProperty(z.prototype,e,{get:function(){return this[t]},set:function(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}));var O=!1;Object.defineProperty(z.prototype,"anchor",{get:function(){return this._deprecated_anchor},set:function(e){this._deprecated_anchor=e,O||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),O=!0),Array.isArray(e)?(this.anchorX=100*(+e[0]||0)+"%",this.anchorY=100*(+e[1]||0)+"%"):this.anchorX=this.anchorY=0}});var D=new WeakMap,N=new WeakMap;e.GlyphsGeometry=S,e.Text=z,e.configureTextBuilder=function(e){v(h,e)},e.createTextDerivedMaterial=A,e.fontProcessorWorkerModule=m,e.getCaretAtPoint=function(e,t,r){var n=null,o=e.caretHeight,l=function(e){var t=N.get(e);if(!t){var r=e.caretPositions,n=e.caretHeight;t=new Map;for(var i=0;i<r.length;i+=3){var o=r[i+2],l=t.get(o);l||t.set(o,l=[]),l.push({x:r[i],y:o,height:n,charIndex:i/3}),i+3>=r.length&&l.push({x:r[i+1],y:o,height:n,charIndex:i/3+1})}}return N.set(e,t),t}(e),h=1/0;return l.forEach((function(e,t){Math.abs(r-(t+o/2))<Math.abs(r-(h+o/2))&&(h=t)})),l.get(h).forEach((function(e){(!n||Math.abs(t-e.x)<Math.abs(t-n.x))&&(n=e)})),n},e.getSelectionRects=function(e,t,r){var n;if(e){var o=D.get(e);if(o&&o.start===t&&o.end===r)return o.rects;var l=e.caretPositions,h=e.caretHeight,c=e.totalBounds;if(r<t){var s=t;t=r,r=s}t=Math.max(t,0),r=Math.min(r,l.length+1);for(var d=new Map,i=t;i<r;i++){var f=l[3*i],v=l[3*i+1],m=l[3*i+2],y=d.get(m);y?(y.left=Math.max(Math.min(y.left,f),c[0]),y.right=Math.min(Math.max(y.right,v),c[2])):(y={left:f,right:v,bottom:m,top:m+h},d.set(m,y))}n=[],d.forEach((function(rect){n.push(rect)})),D.set(e,{start:t,end:r,rects:n})}return n},e.preloadFont=function(e,t){var r=e.font,n=e.characters;f({font:r,sdfGlyphSize:e.sdfGlyphSize,text:Array.isArray(n)?n.join("\n"):""+n},t)},Object.defineProperty(e,"__esModule",{value:!0})}(t,r(18),r(391),r(392))},385:function(e,t,r){"use strict";r.d(t,"a",(function(){return L})),r.d(t,"b",(function(){return C})),r.d(t,"c",(function(){return _})),r.d(t,"d",(function(){return ut})),r.d(t,"e",(function(){return tt})),r.d(t,"f",(function(){return te})),r.d(t,"g",(function(){return ht})),r.d(t,"h",(function(){return x})),r.d(t,"i",(function(){return T})),r.d(t,"j",(function(){return lt})),r.d(t,"k",(function(){return Ut})),r.d(t,"l",(function(){return o})),r.d(t,"m",(function(){return Ln}));class n{constructor(e=[0,0,0,0,0,0,0,0,0]){this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e=new o){const t=this.elements;e.x=t[0],e.y=t[4],e.z=t[8]}vmult(e,t=new o){const r=this.elements,n=e.x,l=e.y,h=e.z;return t.x=r[0]*n+r[1]*l+r[2]*h,t.y=r[3]*n+r[4]*l+r[5]*h,t.z=r[6]*n+r[7]*l+r[8]*h,t}smult(s){for(let i=0;i<this.elements.length;i++)this.elements[i]*=s}mmult(e,t=new n){const{elements:r}=e;for(let i=0;i<3;i++)for(let e=0;e<3;e++){let n=0;for(let t=0;t<3;t++)n+=r[i+3*t]*this.elements[t+3*e];t.elements[i+3*e]=n}return t}scale(e,t=new n){const r=this.elements,o=t.elements;for(let i=0;3!==i;i++)o[3*i+0]=e.x*r[3*i+0],o[3*i+1]=e.y*r[3*i+1],o[3*i+2]=e.z*r[3*i+2];return t}solve(b,e=new o){const t=[];let i,r;for(i=0;i<12;i++)t.push(0);for(i=0;i<3;i++)for(r=0;r<3;r++)t[i+4*r]=this.elements[i+3*r];t[3]=b.x,t[7]=b.y,t[11]=b.z;let n=3;const l=n;let h;let p;do{if(i=l-n,0===t[i+4*i])for(r=i+1;r<l;r++)if(0!==t[i+4*r]){h=4;do{p=4-h,t[p+4*i]+=t[p+4*r]}while(--h);break}if(0!==t[i+4*i])for(r=i+1;r<l;r++){const e=t[i+4*r]/t[i+4*i];h=4;do{p=4-h,t[p+4*r]=p<=i?0:t[p+4*r]-t[p+4*i]*e}while(--h)}}while(--n);if(e.z=t[11]/t[10],e.y=(t[7]-t[6]*e.z)/t[5],e.x=(t[3]-t[2]*e.z-t[1]*e.y)/t[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw"Could not solve equation! Got x=["+e.toString()+"], b=["+b.toString()+"], A=["+this.toString()+"]";return e}e(e,t,r){if(void 0===r)return this.elements[t+3*e];this.elements[t+3*e]=r}copy(e){for(let i=0;i<e.elements.length;i++)this.elements[i]=e.elements[i];return this}toString(){let e="";for(let i=0;i<9;i++)e+=this.elements[i]+",";return e}reverse(e=new n){const t=[];let i,r;for(i=0;i<18;i++)t.push(0);for(i=0;i<3;i++)for(r=0;r<3;r++)t[i+6*r]=this.elements[i+3*r];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let o=3;const l=o;let h;let p;do{if(i=l-o,0===t[i+6*i])for(r=i+1;r<l;r++)if(0!==t[i+6*r]){h=6;do{p=6-h,t[p+6*i]+=t[p+6*r]}while(--h);break}if(0!==t[i+6*i])for(r=i+1;r<l;r++){const e=t[i+6*r]/t[i+6*i];h=6;do{p=6-h,t[p+6*r]=p<=i?0:t[p+6*r]-t[p+6*i]*e}while(--h)}}while(--o);i=2;do{r=i-1;do{const e=t[i+6*r]/t[i+6*i];h=6;do{p=6-h,t[p+6*r]=t[p+6*r]-t[p+6*i]*e}while(--h)}while(r--)}while(--i);i=2;do{const e=1/t[i+6*i];h=6;do{p=6-h,t[p+6*i]=t[p+6*i]*e}while(--h)}while(i--);i=2;do{r=2;do{if(p=t[3+r+6*i],isNaN(p)||p===1/0)throw"Could not reverse! A=["+this.toString()+"]";e.e(i,r,p)}while(r--)}while(i--);return e}setRotationFromQuaternion(q){const e=q.x,t=q.y,r=q.z,n=q.w,o=e+e,l=t+t,h=r+r,c=e*o,d=e*l,f=e*h,v=t*l,m=t*h,y=r*h,x=n*o,w=n*l,S=n*h,T=this.elements;return T[0]=1-(v+y),T[1]=d-S,T[2]=f+w,T[3]=d+S,T[4]=1-(c+y),T[5]=m-x,T[6]=f-w,T[7]=m+x,T[8]=1-(c+v),this}transpose(e=new n){const t=e.elements,r=this.elements;for(let i=0;3!==i;i++)for(let e=0;3!==e;e++)t[3*i+e]=r[3*e+i];return e}}class o{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}cross(e,t=new o){const r=e.x,n=e.y,l=e.z,h=this.x,c=this.y,d=this.z;return t.x=c*l-d*n,t.y=d*r-h*l,t.z=h*n-c*r,t}set(e,t,r){return this.x=e,this.y=t,this.z=r,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new o(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new o(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new n([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,r=this.z,n=Math.sqrt(e*e+t*t+r*r);if(n>0){const e=1/n;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return n}unit(e=new o){const t=this.x,r=this.y,n=this.z;let l=Math.sqrt(t*t+r*r+n*n);return l>0?(l=1/l,e.x=t*l,e.y=r*l,e.z=n*l):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,r=this.z;return Math.sqrt(e*e+t*t+r*r)}lengthSquared(){return this.dot(this)}distanceTo(p){const e=this.x,t=this.y,r=this.z,n=p.x,o=p.y,l=p.z;return Math.sqrt((n-e)*(n-e)+(o-t)*(o-t)+(l-r)*(l-r))}distanceSquared(p){const e=this.x,t=this.y,r=this.z,n=p.x,o=p.y,l=p.z;return(n-e)*(n-e)+(o-t)*(o-t)+(l-r)*(l-r)}scale(e,t=new o){const r=this.x,n=this.y,l=this.z;return t.x=e*r,t.y=e*n,t.z=e*l,t}vmul(e,t=new o){return t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,r=new o){return r.x=this.x+e*t.x,r.y=this.y+e*t.y,r.z=this.z+e*t.z,r}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(e=new o){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const r=this.length();if(r>0){const n=l,o=1/r;n.set(this.x*o,this.y*o,this.z*o);const c=h;Math.abs(n.x)<.9?(c.set(1,0,0),n.cross(c,e)):(c.set(0,1,0),n.cross(c,e)),n.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return this.x+","+this.y+","+this.z}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,r){const n=this.x,o=this.y,l=this.z;r.x=n+(e.x-n)*t,r.y=o+(e.y-o)*t,r.z=l+(e.z-l)*t}almostEquals(e,t=1e-6){return!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e=1e-6){return!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(c),c.almostEquals(e,t)}clone(){return new o(this.x,this.y,this.z)}}o.ZERO=new o(0,0,0),o.UNIT_X=new o(1,0,0),o.UNIT_Y=new o(0,1,0),o.UNIT_Z=new o(0,0,1);const l=new o,h=new o,c=new o;class d{constructor(e={}){this.lowerBound=new o,this.upperBound=new o,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,r,n){const o=this.lowerBound,u=this.upperBound,q=r;o.copy(e[0]),q&&q.vmult(o,o),u.copy(o);for(let i=1;i<e.length;i++){let p=e[i];q&&(q.vmult(p,f),p=f),p.x>u.x&&(u.x=p.x),p.x<o.x&&(o.x=p.x),p.y>u.y&&(u.y=p.y),p.y<o.y&&(o.y=p.y),p.z>u.z&&(u.z=p.z),p.z<o.z&&(o.z=p.z)}return t&&(t.vadd(o,o),t.vadd(u,u)),n&&(o.x-=n,o.y-=n,o.z-=n,u.x+=n,u.y+=n,u.z+=n),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return(new d).copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,r=this.upperBound,n=e.lowerBound,o=e.upperBound,l=n.x<=r.x&&r.x<=o.x||t.x<=o.x&&o.x<=r.x,h=n.y<=r.y&&r.y<=o.y||t.y<=o.y&&o.y<=r.y,c=n.z<=r.z&&r.z<=o.z||t.z<=o.z&&o.z<=r.z;return l&&h&&c}volume(){const e=this.lowerBound,u=this.upperBound;return(u.x-e.x)*(u.y-e.y)*(u.z-e.z)}contains(e){const t=this.lowerBound,r=this.upperBound,n=e.lowerBound,o=e.upperBound;return t.x<=n.x&&r.x>=o.x&&t.y<=n.y&&r.y>=o.y&&t.z<=n.z&&r.z>=o.z}getCorners(a,b,e,t,r,n,g,o){const l=this.lowerBound,u=this.upperBound;a.copy(l),b.set(u.x,l.y,l.z),e.set(u.x,u.y,l.z),t.set(l.x,u.y,u.z),r.set(u.x,l.y,u.z),n.set(l.x,u.y,l.z),g.set(l.x,l.y,u.z),o.copy(u)}toLocalFrame(e,t){const r=v,a=r[0],b=r[1],n=r[2],o=r[3],l=r[4],h=r[5],g=r[6],c=r[7];this.getCorners(a,b,n,o,l,h,g,c);for(let i=0;8!==i;i++){const t=r[i];e.pointToLocal(t,t)}return t.setFromPoints(r)}toWorldFrame(e,t){const r=v,a=r[0],b=r[1],n=r[2],o=r[3],l=r[4],h=r[5],g=r[6],c=r[7];this.getCorners(a,b,n,o,l,h,g,c);for(let i=0;8!==i;i++){const t=r[i];e.pointToWorld(t,t)}return t.setFromPoints(r)}overlapsRay(e){const{direction:t,from:r}=e,n=1/t.x,o=1/t.y,l=1/t.z,h=(this.lowerBound.x-r.x)*n,c=(this.upperBound.x-r.x)*n,d=(this.lowerBound.y-r.y)*o,f=(this.upperBound.y-r.y)*o,v=(this.lowerBound.z-r.z)*l,m=(this.upperBound.z-r.z)*l,y=Math.max(Math.max(Math.min(h,c),Math.min(d,f)),Math.min(v,m)),x=Math.min(Math.min(Math.max(h,c),Math.max(d,f)),Math.max(v,m));return!(x<0)&&!(y>x)}}const f=new o,v=[new o,new o,new o,new o,new o,new o,new o,new o];class m{constructor(){this.matrix=[]}get(e,t){let{index:i}=e,{index:r}=t;if(r>i){const e=r;r=i,i=e}return this.matrix[(i*(i+1)>>1)+r-1]}set(e,t,r){let{index:i}=e,{index:n}=t;if(n>i){const e=n;n=i,i=e}this.matrix[(i*(i+1)>>1)+n-1]=r?1:0}reset(){for(let i=0,e=this.matrix.length;i!==e;i++)this.matrix[i]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class y{constructor(){}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;return void 0===r[e]&&(r[e]=[]),r[e].includes(t)||r[e].push(t),this}hasEventListener(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return!(void 0===r[e]||!r[e].includes(t))}hasAnyEventListener(e){if(void 0===this._listeners)return!1;return void 0!==this._listeners[e]}removeEventListener(e,t){if(void 0===this._listeners)return this;const r=this._listeners;if(void 0===r[e])return this;const n=r[e].indexOf(t);return-1!==n&&r[e].splice(n,1),this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){e.target=this;for(let i=0,r=t.length;i<r;i++)t[i].call(this,e)}return this}}class x{constructor(e=0,t=0,r=0,n=1){this.x=e,this.y=t,this.z=r,this.w=n}set(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}toString(){return this.x+","+this.y+","+this.z+","+this.w}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const s=Math.sin(.5*t);return this.x=e.x*s,this.y=e.y*s,this.z=e.z*s,this.w=Math.cos(.5*t),this}toAxisAngle(e=new o){this.normalize();const t=2*Math.acos(this.w),s=Math.sqrt(1-this.w*this.w);return s<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/s,e.y=this.y/s,e.z=this.z/s),[e,t]}setFromVectors(u,e){if(u.isAntiparallelTo(e)){const e=w,t=S;u.tangents(e,t),this.setFromAxisAngle(e,Math.PI)}else{const a=u.cross(e);this.x=a.x,this.y=a.y,this.z=a.z,this.w=Math.sqrt(u.length()**2*e.length()**2)+u.dot(e),this.normalize()}return this}mult(e,t=new x){const r=this.x,n=this.y,o=this.z,l=this.w,h=e.x,c=e.y,d=e.z,f=e.w;return t.x=r*f+l*h+n*d-o*c,t.y=n*f+l*c+o*h-r*d,t.z=o*f+l*d+r*c-n*h,t.w=l*f-r*h-n*c-o*d,t}inverse(e=new x){const t=this.x,r=this.y,n=this.z,o=this.w;this.conjugate(e);const l=1/(t*t+r*r+n*n+o*o);return e.x*=l,e.y*=l,e.z*=l,e.w*=l,e}conjugate(e=new x){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t=new o){const r=e.x,n=e.y,l=e.z,h=this.x,c=this.y,d=this.z,f=this.w,v=f*r+c*l-d*n,m=f*n+d*r-h*l,y=f*l+h*n-c*r,x=-h*r-c*n-d*l;return t.x=v*f+x*-h+m*-d-y*-c,t.y=m*f+x*-c+y*-h-v*-d,t.z=y*f+x*-d+v*-c-m*-h,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t="YZX"){let r,n,o;const l=this.x,h=this.y,c=this.z,d=this.w;switch(t){case"YZX":const e=l*h+c*d;if(e>.499&&(r=2*Math.atan2(l,d),n=Math.PI/2,o=0),e<-.499&&(r=-2*Math.atan2(l,d),n=-Math.PI/2,o=0),void 0===r){const t=l*l,f=h*h,v=c*c;r=Math.atan2(2*h*d-2*l*c,1-2*f-2*v),n=Math.asin(2*e),o=Math.atan2(2*l*d-2*h*c,1-2*t-2*v)}break;default:throw new Error("Euler order "+t+" not supported yet.")}e.y=r,e.z=n,e.x=o}setFromEuler(e,t,r,n="XYZ"){const o=Math.cos(e/2),l=Math.cos(t/2),h=Math.cos(r/2),c=Math.sin(e/2),d=Math.sin(t/2),f=Math.sin(r/2);return"XYZ"===n?(this.x=c*l*h+o*d*f,this.y=o*d*h-c*l*f,this.z=o*l*f+c*d*h,this.w=o*l*h-c*d*f):"YXZ"===n?(this.x=c*l*h+o*d*f,this.y=o*d*h-c*l*f,this.z=o*l*f-c*d*h,this.w=o*l*h+c*d*f):"ZXY"===n?(this.x=c*l*h-o*d*f,this.y=o*d*h+c*l*f,this.z=o*l*f+c*d*h,this.w=o*l*h-c*d*f):"ZYX"===n?(this.x=c*l*h-o*d*f,this.y=o*d*h+c*l*f,this.z=o*l*f-c*d*h,this.w=o*l*h+c*d*f):"YZX"===n?(this.x=c*l*h+o*d*f,this.y=o*d*h+c*l*f,this.z=o*l*f-c*d*h,this.w=o*l*h-c*d*f):"XZY"===n&&(this.x=c*l*h-o*d*f,this.y=o*d*h-c*l*f,this.z=o*l*f+c*d*h,this.w=o*l*h+c*d*f),this}clone(){return new x(this.x,this.y,this.z,this.w)}slerp(e,t,r=new x){const n=this.x,o=this.y,l=this.z,h=this.w;let c,d,f,v,m,y=e.x,w=e.y,S=e.z,T=e.w;return d=n*y+o*w+l*S+h*T,d<0&&(d=-d,y=-y,w=-w,S=-S,T=-T),1-d>1e-6?(c=Math.acos(d),f=Math.sin(c),v=Math.sin((1-t)*c)/f,m=Math.sin(t*c)/f):(v=1-t,m=t),r.x=v*n+m*y,r.y=v*o+m*w,r.z=v*l+m*S,r.w=v*h+m*T,r}integrate(e,dt,t,r=new x){const n=e.x*t.x,o=e.y*t.y,l=e.z*t.z,h=this.x,c=this.y,d=this.z,f=this.w,v=.5*dt;return r.x+=v*(n*f+o*d-l*c),r.y+=v*(o*f+l*h-n*d),r.z+=v*(l*f+n*c-o*h),r.w+=v*(-n*h-o*c-l*d),r}}const w=new o,S=new o;class T{constructor(e={}){this.id=T.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}volume(){throw"volume() not implemented for shape type "+this.type}calculateLocalInertia(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}calculateWorldAABB(e,t,r,n){throw"calculateWorldAABB() not implemented for shape type "+this.type}}T.idCounter=0,T.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class M{constructor(e={}){this.position=new o,this.quaternion=new x,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return M.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return M.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t=new o){return this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,r,n=new o){return r.vsub(e,n),t.conjugate(A),A.vmult(n,n),n}static pointToWorldFrame(e,t,r,n=new o){return t.vmult(r,n),n.vadd(e,n),n}static vectorToWorldFrame(e,t,r=new o){return e.vmult(t,r),r}static vectorToLocalFrame(e,t,r,n=new o){return t.w*=-1,t.vmult(r,n),t.w*=-1,n}}const A=new x;class _ extends T{constructor(e={}){const{vertices:t=[],faces:r=[],normals:n=[],axes:o,boundingSphereRadius:l}=e;super({type:T.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=r,this.faceNormals=n,0===this.faceNormals.length&&this.computeNormals(),l?this.boundingSphereRadius=l:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=o?o.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,r=this.uniqueEdges;r.length=0;const n=new o;for(let i=0;i!==e.length;i++){const o=e[i],l=o.length;for(let e=0;e!==l;e++){const h=(e+1)%l;t[o[e]].vsub(t[o[h]],n),n.normalize();let c=!1;for(let p=0;p!==r.length;p++)if(r[p].almostEquals(n)||r[p].almostEquals(n)){c=!0;break}c||r.push(n.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let i=0;i<this.faces.length;i++){for(let e=0;e<this.faces[i].length;e++)if(!this.vertices[this.faces[i][e]])throw new Error("Vertex "+this.faces[i][e]+" not found!");const e=this.faceNormals[i]||new o;this.getFaceNormal(i,e),e.negate(e),this.faceNormals[i]=e;const t=this.vertices[this.faces[i][0]];if(e.dot(t)<0){console.error(".faceNormals["+i+"] = Vec3("+e.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(let e=0;e<this.faces[i].length;e++)console.warn(".vertices["+this.faces[i][e]+"] = Vec3("+this.vertices[this.faces[i][e]].toString()+")")}}}getFaceNormal(i,e){const t=this.faces[i],r=this.vertices[t[0]],n=this.vertices[t[1]],o=this.vertices[t[2]];_.computeNormal(r,n,o,e)}clipAgainstHull(e,t,r,n,l,h,c,d,f){const v=new o;let m=-1,y=-Number.MAX_VALUE;for(let e=0;e<r.faces.length;e++){v.copy(r.faceNormals[e]),l.vmult(v,v);const t=v.dot(h);t>y&&(y=t,m=e)}const x=[];for(let i=0;i<r.faces[m].length;i++){const b=r.vertices[r.faces[m][i]],e=new o;e.copy(b),l.vmult(e,e),n.vadd(e,e),x.push(e)}m>=0&&this.clipFaceAgainstHull(h,e,t,x,c,d,f)}findSeparatingAxis(e,t,r,n,l,h,c,d){const f=new o,v=new o,m=new o,y=new o,x=new o,w=new o;let S=Number.MAX_VALUE;const T=this;if(T.uniqueAxes)for(let i=0;i!==T.uniqueAxes.length;i++){r.vmult(T.uniqueAxes[i],f);const o=T.testSepAxis(f,e,t,r,n,l);if(!1===o)return!1;o<S&&(S=o,h.copy(f))}else{const o=c?c.length:T.faces.length;for(let i=0;i<o;i++){const o=c?c[i]:i;f.copy(T.faceNormals[o]),r.vmult(f,f);const d=T.testSepAxis(f,e,t,r,n,l);if(!1===d)return!1;d<S&&(S=d,h.copy(f))}}if(e.uniqueAxes)for(let i=0;i!==e.uniqueAxes.length;i++){l.vmult(e.uniqueAxes[i],v);const o=T.testSepAxis(v,e,t,r,n,l);if(!1===o)return!1;o<S&&(S=o,h.copy(v))}else{const o=d?d.length:e.faces.length;for(let i=0;i<o;i++){const o=d?d[i]:i;v.copy(e.faceNormals[o]),l.vmult(v,v);const c=T.testSepAxis(v,e,t,r,n,l);if(!1===c)return!1;c<S&&(S=c,h.copy(v))}}for(let o=0;o!==T.uniqueEdges.length;o++){r.vmult(T.uniqueEdges[o],y);for(let o=0;o!==e.uniqueEdges.length;o++)if(l.vmult(e.uniqueEdges[o],x),y.cross(x,w),!w.almostZero()){w.normalize();const o=T.testSepAxis(w,e,t,r,n,l);if(!1===o)return!1;o<S&&(S=o,h.copy(w))}}return n.vsub(t,m),m.dot(h)>0&&h.negate(h),!0}testSepAxis(e,t,r,n,o,l){_.project(this,e,r,n,U),_.project(t,e,o,l,E);const h=U[0],c=U[1],d=E[0],f=E[1];if(h<f||d<c)return!1;const v=h-f,m=d-c;return v<m?v:m}calculateLocalInertia(e,t){const r=new o,n=new o;this.computeLocalAABB(n,r);const l=r.x-n.x,h=r.y-n.y,c=r.z-n.z;t.x=1/12*e*(2*h*2*h+2*c*2*c),t.y=1/12*e*(2*l*2*l+2*c*2*c),t.z=1/12*e*(2*h*2*h+2*l*2*l)}getPlaneConstantOfFace(e){const t=this.faces[e],r=this.faceNormals[e],n=this.vertices[t[0]];return-r.dot(n)}clipFaceAgainstHull(e,t,r,n,l,h,c){const d=new o,f=new o,v=new o,m=new o,y=new o,x=new o,w=new o,S=new o,T=this,M=n,A=[];let _=-1,U=Number.MAX_VALUE;for(let t=0;t<T.faces.length;t++){d.copy(T.faceNormals[t]),r.vmult(d,d);const n=d.dot(e);n<U&&(U=n,_=t)}if(_<0)return;const E=T.faces[_];E.connectedFaces=[];for(let i=0;i<T.faces.length;i++)for(let e=0;e<T.faces[i].length;e++)-1!==E.indexOf(T.faces[i][e])&&i!==_&&-1===E.connectedFaces.indexOf(i)&&E.connectedFaces.push(i);const C=E.length;for(let i=0;i<C;i++){const a=T.vertices[E[i]],b=T.vertices[E[(i+1)%C]];a.vsub(b,f),v.copy(f),r.vmult(v,v),t.vadd(v,v),m.copy(this.faceNormals[_]),r.vmult(m,m),t.vadd(m,m),v.cross(m,y),y.negate(y),x.copy(a),r.vmult(x,x),t.vadd(x,x);const e=E.connectedFaces[i];w.copy(this.faceNormals[e]);const n=this.getPlaneConstantOfFace(e);S.copy(w),r.vmult(S,S);const o=n-S.dot(t);for(this.clipFaceAgainstPlane(M,A,S,o);M.length;)M.shift();for(;A.length;)M.push(A.shift())}w.copy(this.faceNormals[_]);const F=this.getPlaneConstantOfFace(_);S.copy(w),r.vmult(S,S);const R=F-S.dot(t);for(let i=0;i<M.length;i++){let e=S.dot(M[i])+R;if(e<=l&&(console.log("clamped: depth="+e+" to minDist="+l),e=l),e<=h){const t=M[i];if(e<=1e-6){const p={point:t,normal:S,depth:e};c.push(p)}}}}clipFaceAgainstPlane(e,t,r,n){let l,h;const c=e.length;if(c<2)return t;let d=e[e.length-1],f=e[0];l=r.dot(d)+n;for(let v=0;v<c;v++){if(f=e[v],h=r.dot(f)+n,l<0)if(h<0){const e=new o;e.copy(f),t.push(e)}else{const e=new o;d.lerp(f,l/(l-h),e),t.push(e)}else if(h<0){const e=new o;d.lerp(f,l/(l-h),e),t.push(e),t.push(f)}d=f,l=h}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new o);const r=this.vertices,n=this.worldVertices;for(let i=0;i!==this.vertices.length;i++)t.vmult(r[i],n[i]),e.vadd(n[i],n[i]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const r=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const n=r[i];n.x<e.x?e.x=n.x:n.x>t.x&&(t.x=n.x),n.y<e.y?e.y=n.y:n.y>t.y&&(t.y=n.y),n.z<e.z?e.z=n.z:n.z>t.z&&(t.z=n.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new o);const r=this.faceNormals,n=this.worldFaceNormals;for(let i=0;i!==t;i++)e.vmult(r[i],n[i]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let i=0;i!==t.length;i++){const r=t[i].lengthSquared();r>e&&(e=r)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,r,n){const l=this.vertices;let h,c,d,f,v,m,y=new o;for(let i=0;i<l.length;i++){y.copy(l[i]),t.vmult(y,y),e.vadd(y,y);const r=y;(void 0===h||r.x<h)&&(h=r.x),(void 0===f||r.x>f)&&(f=r.x),(void 0===c||r.y<c)&&(c=r.y),(void 0===v||r.y>v)&&(v=r.y),(void 0===d||r.z<d)&&(d=r.z),(void 0===m||r.z>m)&&(m=r.z)}r.set(h,c,d),n.set(f,v,m)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e=new o){const t=this.vertices;for(let i=0;i<t.length;i++)e.vadd(t[i],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const r=this.vertices.length,n=this.vertices;if(t){for(let i=0;i<r;i++){const e=n[i];t.vmult(e,e)}for(let i=0;i<this.faceNormals.length;i++){const e=this.faceNormals[i];t.vmult(e,e)}}if(e)for(let i=0;i<r;i++){const t=n[i];t.vadd(e,t)}}pointIsInside(p){const e=this.vertices,t=this.faces,r=this.faceNormals,n=new o;this.getAveragePointLocal(n);for(let i=0;i<this.faces.length;i++){let l=r[i];const h=e[t[i][0]],c=new o;p.vsub(h,c);const d=l.dot(c),f=new o;n.vsub(h,f);const v=l.dot(f);if(d<0&&v>0||d>0&&v<0)return!1}return-1}}_.computeNormal=(e,t,r,n)=>{const l=new o,h=new o;t.vsub(e,h),r.vsub(t,l),l.cross(h,n),n.isZero()||n.normalize()};const U=[],E=[];_.project=(e,t,r,n,l)=>{const h=e.vertices.length,c=new o;let d=0,f=0;const v=new o,m=e.vertices;v.setZero(),M.vectorToLocalFrame(r,n,t,c),M.pointToLocalFrame(r,n,v,v);const y=v.dot(c);f=d=m[0].dot(c);for(let i=1;i<h;i++){const e=m[i].dot(c);e>d&&(d=e),e<f&&(f=e)}if(f-=y,d-=y,f>d){const e=f;f=d,d=e}l[0]=d,l[1]=f};class C extends T{constructor(e){super({type:T.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,r=this.halfExtents.z,n=o,l=[new n(-e,-t,-r),new n(e,-t,-r),new n(e,t,-r),new n(-e,t,-r),new n(-e,-t,r),new n(e,-t,r),new n(e,t,r),new n(-e,t,r)],h=[new n(0,0,1),new n(0,1,0),new n(1,0,0)],c=new _({vertices:l,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:h});this.convexPolyhedronRepresentation=c,c.material=this.material}calculateLocalInertia(e,t=new o){return C.calculateInertia(this.halfExtents,e,t),t}getSideNormals(e,t){const r=e,n=this.halfExtents;if(r[0].set(n.x,0,0),r[1].set(0,n.y,0),r[2].set(0,0,n.z),r[3].set(-n.x,0,0),r[4].set(0,-n.y,0),r[5].set(0,0,-n.z),void 0!==t)for(let i=0;i!==r.length;i++)t.vmult(r[i],r[i]);return r}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,r){const n=this.halfExtents,o=[[n.x,n.y,n.z],[-n.x,n.y,n.z],[-n.x,-n.y,n.z],[-n.x,-n.y,-n.z],[n.x,-n.y,-n.z],[n.x,n.y,-n.z],[-n.x,n.y,-n.z],[n.x,-n.y,n.z]];for(let i=0;i<o.length;i++)F.set(o[i][0],o[i][1],o[i][2]),t.vmult(F,F),e.vadd(F,F),r(F.x,F.y,F.z)}calculateWorldAABB(e,t,r,n){const o=this.halfExtents;R[0].set(o.x,o.y,o.z),R[1].set(-o.x,o.y,o.z),R[2].set(-o.x,-o.y,o.z),R[3].set(-o.x,-o.y,-o.z),R[4].set(o.x,-o.y,-o.z),R[5].set(o.x,o.y,-o.z),R[6].set(-o.x,o.y,-o.z),R[7].set(o.x,-o.y,o.z);const l=R[0];t.vmult(l,l),e.vadd(l,l),n.copy(l),r.copy(l);for(let i=1;i<8;i++){const o=R[i];t.vmult(o,o),e.vadd(o,o);const l=o.x,h=o.y,c=o.z;l>n.x&&(n.x=l),h>n.y&&(n.y=h),c>n.z&&(n.z=c),l<r.x&&(r.x=l),h<r.y&&(r.y=h),c<r.z&&(r.z=c)}}}C.calculateInertia=(e,t,r)=>{const n=e;r.x=1/12*t*(2*n.y*2*n.y+2*n.z*2*n.z),r.y=1/12*t*(2*n.x*2*n.x+2*n.z*2*n.z),r.z=1/12*t*(2*n.y*2*n.y+2*n.x*2*n.x)};const F=new o,R=[new o,new o,new o,new o,new o,new o,new o,new o],B=0,P=1,I=2;class L extends y{constructor(e={}){super(),this.id=L.idCounter++,this.index=-1,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new o,this.collisionFilterGroup="number"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof e.collisionResponse||e.collisionResponse,this.position=new o,this.previousPosition=new o,this.interpolatedPosition=new o,this.initPosition=new o,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new o,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new o,this.force=new o;const t="number"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping="number"==typeof e.linearDamping?e.linearDamping:.01,this.type=t<=0?L.STATIC:L.DYNAMIC,typeof e.type==typeof L.STATIC&&(this.type=e.type),this.allowSleep=void 0===e.allowSleep||e.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new o,this.quaternion=new x,this.initQuaternion=new x,this.previousQuaternion=new x,this.interpolatedQuaternion=new x,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new o,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new o,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new o,this.invInertia=new o,this.invInertiaWorld=new n,this.invMassSolve=0,this.invInertiaSolve=new o,this.invInertiaWorldSolve=new n,this.fixedRotation=void 0!==e.fixedRotation&&e.fixedRotation,this.angularDamping=void 0!==e.angularDamping?e.angularDamping:.01,this.linearFactor=new o(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new o(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new d,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new o,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=0,this.wakeUpAfterNarrowphase=!1,e===L.SLEEPING&&this.dispatchEvent(L.wakeupEvent)}sleep(){this.sleepState=L.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(time){if(this.allowSleep){const e=this.sleepState,t=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),r=this.sleepSpeedLimit**2;e===L.AWAKE&&t<r?(this.sleepState=L.SLEEPY,this.timeLastSleepy=time,this.dispatchEvent(L.sleepyEvent)):e===L.SLEEPY&&t>r?this.wakeUp():e===L.SLEEPY&&time-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(L.sleepEvent))}}updateSolveMassProperties(){this.sleepState===L.SLEEPING||this.type===L.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t=new o){return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t=new o){return this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t=new o){return this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t=new o){return this.quaternion.vmult(e,t),t}addShape(e,t,r){const n=new o,l=new x;return t&&n.copy(t),r&&l.copy(r),this.shapes.push(e),this.shapeOffsets.push(n),this.shapeOrientations.push(l),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,r=e.length;let n=0;for(let i=0;i!==r;i++){const r=e[i];r.updateBoundingSphereRadius();const o=t[i].length(),l=r.boundingSphereRadius;o+l>n&&(n=o+l)}this.boundingRadius=n}computeAABB(){const e=this.shapes,t=this.shapeOffsets,r=this.shapeOrientations,n=e.length,o=k,l=z,h=this.quaternion,c=this.aabb,d=O;for(let i=0;i!==n;i++){const n=e[i];h.vmult(t[i],o),o.vadd(this.position,o),h.mult(r[i],l),n.calculateWorldAABB(o,l,d.lowerBound,d.upperBound),0===i?c.copy(d):c.extend(d)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){const e=D,r=N;e.setRotationFromQuaternion(this.quaternion),e.transpose(r),e.scale(t,e),e.mmult(r,this.invInertiaWorld)}else;}applyForce(e,t){if(this.type!==L.DYNAMIC)return;const r=G;t.cross(e,r),this.force.vadd(e,this.force),this.torque.vadd(r,this.torque)}applyLocalForce(e,t){if(this.type!==L.DYNAMIC)return;const r=j,n=V;this.vectorToWorldFrame(e,r),this.vectorToWorldFrame(t,n),this.applyForce(r,n)}applyImpulse(e,t){if(this.type!==L.DYNAMIC)return;const r=t,n=H;n.copy(e),n.scale(this.invMass,n),this.velocity.vadd(n,this.velocity);const o=W;r.cross(e,o),this.invInertiaWorld.vmult(o,o),this.angularVelocity.vadd(o,this.angularVelocity)}applyLocalImpulse(e,t){if(this.type!==L.DYNAMIC)return;const r=X,n=K;this.vectorToWorldFrame(e,r),this.vectorToWorldFrame(t,n),this.applyImpulse(r,n)}updateMassProperties(){const e=Y;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,r=this.fixedRotation;this.computeAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),C.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!r?1/t.x:0,t.y>0&&!r?1/t.y:0,t.z>0&&!r?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const r=new o;return e.vsub(this.position,r),this.angularVelocity.cross(r,t),this.velocity.vadd(t,t),t}integrate(dt,e,t){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==L.DYNAMIC&&this.type!==L.KINEMATIC||this.sleepState===L.SLEEPING)return;const r=this.velocity,n=this.angularVelocity,o=this.position,l=this.force,h=this.torque,c=this.quaternion,d=this.invMass,f=this.invInertiaWorld,v=this.linearFactor,m=d*dt;r.x+=l.x*m*v.x,r.y+=l.y*m*v.y,r.z+=l.z*m*v.z;const y=f.elements,x=this.angularFactor,w=h.x*x.x,S=h.y*x.y,T=h.z*x.z;n.x+=dt*(y[0]*w+y[1]*S+y[2]*T),n.y+=dt*(y[3]*w+y[4]*S+y[5]*T),n.z+=dt*(y[6]*w+y[7]*S+y[8]*T),o.x+=r.x*dt,o.y+=r.y*dt,o.z+=r.z*dt,c.integrate(this.angularVelocity,dt,this.angularFactor,c),e&&(t?c.normalizeFast():c.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}L.COLLIDE_EVENT_NAME="collide",L.DYNAMIC=1,L.STATIC=2,L.KINEMATIC=4,L.AWAKE=B,L.SLEEPY=P,L.SLEEPING=I,L.idCounter=0,L.wakeupEvent={type:"wakeup"},L.sleepyEvent={type:"sleepy"},L.sleepEvent={type:"sleep"};const k=new o,z=new x,O=new d,D=new n,N=new n,G=new o,j=new o,V=new o,H=new o,W=new o,X=new o,K=new o,Y=new o;class Z{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,r){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return 0!=(e.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&e.collisionFilterMask)&&(0==(e.type&L.STATIC)&&e.sleepState!==L.SLEEPING||0==(t.type&L.STATIC)&&t.sleepState!==L.SLEEPING)}intersectionTest(e,t,r,n){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,r,n):this.doBoundingSphereBroadphase(e,t,r,n)}doBoundingSphereBroadphase(e,t,r,n){const o=Q;t.position.vsub(e.position,o);const l=(e.boundingRadius+t.boundingRadius)**2;o.lengthSquared()<l&&(r.push(e),n.push(t))}doBoundingBoxBroadphase(e,t,r,n){e.aabbNeedsUpdate&&e.computeAABB(),t.aabbNeedsUpdate&&t.computeAABB(),e.aabb.overlaps(t.aabb)&&(r.push(e),n.push(t))}makePairsUnique(e,t){const r=$,n=J,o=ee,l=e.length;for(let i=0;i!==l;i++)n[i]=e[i],o[i]=t[i];e.length=0,t.length=0;for(let i=0;i!==l;i++){const e=n[i].id,t=o[i].id,l=e<t?e+","+t:t+","+e;r[l]=i,r.keys.push(l)}for(let i=0;i!==r.keys.length;i++){const l=r.keys.pop(),h=r[l];e.push(n[h]),t.push(o[h]),delete r[l]}}setWorld(e){}aabbQuery(e,t,r){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const Q=new o,$={keys:[]},J=[],ee=[];Z.boundingSphereCheck=(e,t)=>{const r=new o;e.position.vsub(t.position,r);const n=e.shapes[0],l=t.shapes[0];return Math.pow(n.boundingSphereRadius+l.boundingSphereRadius,2)>r.lengthSquared()};new o;class te extends Z{constructor(){super()}collisionPairs(e,t,r){const n=e.bodies,o=n.length;let l,h;for(let i=0;i!==o;i++)for(let e=0;e!==i;e++)l=n[i],h=n[e],this.needBroadphaseCollision(l,h)&&this.intersectionTest(l,h,t,r)}aabbQuery(e,t,r=[]){for(let i=0;i<e.bodies.length;i++){const b=e.bodies[i];b.aabbNeedsUpdate&&b.computeAABB(),b.aabb.overlaps(t)&&r.push(b)}return r}}class re{constructor(){this.rayFromWorld=new o,this.rayToWorld=new o,this.hitNormalWorld=new o,this.hitPointWorld=new o,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,r,n,o,body,l){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(r),this.hitPointWorld.copy(n),this.shape=o,this.body=body,this.distance=l}}class ne{constructor(e=new o,t=new o){this.from=e.clone(),this.to=t.clone(),this.direction=new o,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ne.ANY,this.result=new re,this.hasHit=!1,this.callback=e=>{}}intersectWorld(e,t){return this.mode=t.mode||ne.ANY,this.result=t.result||new re,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(ie),se.length=0,e.broadphase.aabbQuery(e,ie,se),this.intersectBodies(se),this.hasHit}intersectBody(body,e){e&&(this.result=e,this.updateDirection());const t=this.checkCollisionResponse;if(t&&!body.collisionResponse)return;if(0==(this.collisionFilterGroup&body.collisionFilterMask)||0==(body.collisionFilterGroup&this.collisionFilterMask))return;const r=he,n=ce;for(let i=0,e=body.shapes.length;i<e;i++){const e=body.shapes[i];if((!t||e.collisionResponse)&&(body.quaternion.mult(body.shapeOrientations[i],n),body.quaternion.vmult(body.shapeOffsets[i],r),r.vadd(body.position,r),this.intersectShape(e,n,r,body),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let i=0,t=e.length;!this.result.shouldStop&&i<t;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,r,body){if(function(e,t,r){r.vsub(e,Ce);const n=Ce.dot(t);return t.scale(n,Fe),Fe.vadd(e,Fe),r.distanceTo(Fe)}(this.from,this.direction,r)>e.boundingSphereRadius)return;const n=this[e.type];n&&n.call(this,e,t,r,body,e)}_intersectBox(e,t,r,body,n){return this._intersectConvex(e.convexPolyhedronRepresentation,t,r,body,n)}_intersectPlane(e,t,r,body,n){const l=this.from,h=this.to,c=this.direction,d=new o(0,0,1);t.vmult(d,d);const f=new o;l.vsub(r,f);const v=f.dot(d);if(h.vsub(r,f),v*f.dot(d)>0)return;if(l.distanceTo(h)<v)return;const m=d.dot(c);if(Math.abs(m)<this.precision)return;const y=new o,x=new o,w=new o;l.vsub(r,y);const S=-d.dot(y)/m;c.scale(S,x),l.vadd(x,w),this.reportIntersection(d,w,n,body,-1)}getAABB(e){const{lowerBound:t,upperBound:r}=e,n=this.to,o=this.from;t.x=Math.min(n.x,o.x),t.y=Math.min(n.y,o.y),t.z=Math.min(n.z,o.z),r.x=Math.max(n.x,o.x),r.y=Math.max(n.y,o.y),r.z=Math.max(n.z,o.z)}_intersectHeightfield(e,t,r,body,n){e.data,e.elementSize;const o=ve;o.from.copy(this.from),o.to.copy(this.to),M.pointToLocalFrame(r,t,o.from,o.from),M.pointToLocalFrame(r,t,o.to,o.to),o.updateDirection();const l=me;let h,c,f,v;h=c=0,f=v=e.data.length-1;const m=new d;o.getAABB(m),e.getIndexOfPosition(m.lowerBound.x,m.lowerBound.y,l,!0),h=Math.max(h,l[0]),c=Math.max(c,l[1]),e.getIndexOfPosition(m.upperBound.x,m.upperBound.y,l,!0),f=Math.min(f,l[0]+1),v=Math.min(v,l[1]+1);for(let i=h;i<f;i++)for(let l=c;l<v;l++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(i,l,m),m.overlapsRay(o)){if(e.getConvexTrianglePillar(i,l,!1),M.pointToWorldFrame(r,t,e.pillarOffset,fe),this._intersectConvex(e.pillarConvex,t,fe,body,n,pe),this.result.shouldStop)return;e.getConvexTrianglePillar(i,l,!0),M.pointToWorldFrame(r,t,e.pillarOffset,fe),this._intersectConvex(e.pillarConvex,t,fe,body,n,pe)}}}_intersectSphere(e,t,r,body,n){const o=this.from,l=this.to,h=e.radius,a=(l.x-o.x)**2+(l.y-o.y)**2+(l.z-o.z)**2,b=2*((l.x-o.x)*(o.x-r.x)+(l.y-o.y)*(o.y-r.y)+(l.z-o.z)*(o.z-r.z)),c=b**2-4*a*((o.x-r.x)**2+(o.y-r.y)**2+(o.z-r.z)**2-h**2),d=ge,f=ye;if(!(c<0))if(0===c)o.lerp(l,c,d),d.vsub(r,f),f.normalize(),this.reportIntersection(f,d,n,body,-1);else{const e=(-b-Math.sqrt(c))/(2*a),t=(-b+Math.sqrt(c))/(2*a);if(e>=0&&e<=1&&(o.lerp(l,e,d),d.vsub(r,f),f.normalize(),this.reportIntersection(f,d,n,body,-1)),this.result.shouldStop)return;t>=0&&t<=1&&(o.lerp(l,t,d),d.vsub(r,f),f.normalize(),this.reportIntersection(f,d,n,body,-1))}}_intersectConvex(e,t,r,body,n,o){const l=xe,h=be,c=o&&o.faceList||null,d=e.faces,f=e.vertices,v=e.faceNormals,m=this.direction,y=this.from,x=this.to,w=y.distanceTo(x),S=c?c.length:d.length,T=this.result;for(let e=0;!T.shouldStop&&e<S;e++){const o=c?c[e]:e,x=d[o],S=v[o],q=t,M=r;h.copy(f[x[0]]),q.vmult(h,h),h.vadd(M,h),h.vsub(y,h),q.vmult(S,l);const A=m.dot(l);if(Math.abs(A)<this.precision)continue;const _=l.dot(h)/A;if(!(_<0)){m.scale(_,ue),ue.vadd(y,ue),a.copy(f[x[0]]),q.vmult(a,a),M.vadd(a,a);for(let i=1;!T.shouldStop&&i<x.length-1;i++){b.copy(f[x[i]]),de.copy(f[x[i+1]]),q.vmult(b,b),q.vmult(de,de),M.vadd(b,b),M.vadd(de,de);const e=ue.distanceTo(y);!le(ue,a,b,de)&&!le(ue,b,a,de)||e>w||this.reportIntersection(l,ue,n,body,o)}}}}_intersectTrimesh(e,t,r,body,n,o){const l=we,h=Ue,c=Ee,d=be,f=Se,v=Te,m=Me,y=_e,x=Ae,w=(o&&o.faceList,e.indices),S=(e.vertices,this.from),T=this.to,A=this.direction;c.position.copy(r),c.quaternion.copy(t),M.vectorToLocalFrame(r,t,A,f),M.pointToLocalFrame(r,t,S,v),M.pointToLocalFrame(r,t,T,m),m.x*=e.scale.x,m.y*=e.scale.y,m.z*=e.scale.z,v.x*=e.scale.x,v.y*=e.scale.y,v.z*=e.scale.z,m.vsub(v,f),f.normalize();const _=v.distanceSquared(m);e.tree.rayQuery(this,c,h);for(let i=0,o=h.length;!this.result.shouldStop&&i!==o;i++){const o=h[i];e.getNormal(o,l),e.getVertex(w[3*o],a),a.vsub(v,d);const c=f.dot(l),m=l.dot(d)/c;if(m<0)continue;f.scale(m,ue),ue.vadd(v,ue),e.getVertex(w[3*o+1],b),e.getVertex(w[3*o+2],de);const S=ue.distanceSquared(v);!le(ue,b,a,de)&&!le(ue,a,b,de)||S>_||(M.vectorToWorldFrame(t,l,x),M.pointToWorldFrame(r,t,ue,y),this.reportIntersection(x,y,n,body,o))}h.length=0}reportIntersection(e,t,r,body,n){const o=this.from,l=this.to,h=o.distanceTo(t),c=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(c.hitFaceIndex=void 0!==n?n:-1,this.mode){case ne.ALL:this.hasHit=!0,c.set(o,l,e,t,r,body,h),c.hasHit=!0,this.callback(c);break;case ne.CLOSEST:(h<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(o,l,e,t,r,body,h));break;case ne.ANY:this.hasHit=!0,c.hasHit=!0,c.set(o,l,e,t,r,body,h),c.shouldStop=!0}}}ne.CLOSEST=1,ne.ANY=2,ne.ALL=4;const ie=new d,se=[],oe=new o,ae=new o;function le(p,a,b,e){e.vsub(a,Ce),b.vsub(a,oe),p.vsub(a,ae);const t=Ce.dot(Ce),r=Ce.dot(oe),n=Ce.dot(ae),o=oe.dot(oe),l=oe.dot(ae);let u,h;return(u=o*n-r*l)>=0&&(h=t*l-r*n)>=0&&u+h<t*o-r*r}ne.pointInTriangle=le;const he=new o,ce=new x,ue=new o,a=new o,b=new o,de=new o;ne.prototype[T.types.BOX]=ne.prototype._intersectBox,ne.prototype[T.types.PLANE]=ne.prototype._intersectPlane;const pe={faceList:[0]},fe=new o,ve=new ne,me=[];ne.prototype[T.types.HEIGHTFIELD]=ne.prototype._intersectHeightfield;const ge=new o,ye=new o;ne.prototype[T.types.SPHERE]=ne.prototype._intersectSphere;const xe=new o,be=new o;ne.prototype[T.types.CONVEXPOLYHEDRON]=ne.prototype._intersectConvex;const we=new o,Se=new o,Te=new o,Me=new o,Ae=new o,_e=new o,Ue=(new d,[]),Ee=new M;ne.prototype[T.types.TRIMESH]=ne.prototype._intersectTrimesh;const Ce=new o,Fe=new o;class Re extends Z{constructor(e){super(),this.axisList=[],this.world=null,this.axisIndex=0;const t=this.axisList;this._addBodyHandler=e=>{t.push(e.body)},this._removeBodyHandler=e=>{const r=t.indexOf(e.body);-1!==r&&t.splice(r,1)},e&&this.setWorld(e)}setWorld(e){this.axisList.length=0;for(let i=0;i<e.bodies.length;i++)this.axisList.push(e.bodies[i]);e.removeEventListener("addBody",this._addBodyHandler),e.removeEventListener("removeBody",this._removeBodyHandler),e.addEventListener("addBody",this._addBodyHandler),e.addEventListener("removeBody",this._removeBodyHandler),this.world=e,this.dirty=!0}collisionPairs(e,t,r){const n=this.axisList,o=n.length,l=this.axisIndex;let i,h;for(this.dirty&&(this.sortList(),this.dirty=!1),i=0;i!==o;i++){const e=n[i];for(h=i+1;h<o;h++){const o=n[h];if(this.needBroadphaseCollision(e,o)){if(!Re.checkBounds(e,o,l))break;this.intersectionTest(e,o,t,r)}}}}sortList(){const e=this.axisList,t=this.axisIndex,r=e.length;for(let i=0;i!==r;i++){const t=e[i];t.aabbNeedsUpdate&&t.computeAABB()}0===t?Re.insertionSortX(e):1===t?Re.insertionSortY(e):2===t&&Re.insertionSortZ(e)}autoDetectAxis(){let e=0,t=0,r=0,n=0,o=0,l=0;const h=this.axisList,c=h.length,d=1/c;for(let i=0;i!==c;i++){const b=h[i],c=b.position.x;e+=c,t+=c*c;const d=b.position.y;r+=d,n+=d*d;const f=b.position.z;o+=f,l+=f*f}const f=t-e*e*d,v=n-r*r*d,m=l-o*o*d;this.axisIndex=f>v?f>m?0:2:v>m?1:2}aabbQuery(e,t,r=[]){this.dirty&&(this.sortList(),this.dirty=!1);const n=this.axisIndex;let o="x";1===n&&(o="y"),2===n&&(o="z");const l=this.axisList;t.lowerBound[o],t.upperBound[o];for(let i=0;i<l.length;i++){const b=l[i];b.aabbNeedsUpdate&&b.computeAABB(),b.aabb.overlaps(t)&&r.push(b)}return r}}function Be(){}Re.insertionSortX=a=>{for(let i=1,e=a.length;i<e;i++){const e=a[i];let t;for(t=i-1;t>=0&&!(a[t].aabb.lowerBound.x<=e.aabb.lowerBound.x);t--)a[t+1]=a[t];a[t+1]=e}return a},Re.insertionSortY=a=>{for(let i=1,e=a.length;i<e;i++){const e=a[i];let t;for(t=i-1;t>=0&&!(a[t].aabb.lowerBound.y<=e.aabb.lowerBound.y);t--)a[t+1]=a[t];a[t+1]=e}return a},Re.insertionSortZ=a=>{for(let i=1,e=a.length;i<e;i++){const e=a[i];let t;for(t=i-1;t>=0&&!(a[t].aabb.lowerBound.z<=e.aabb.lowerBound.z);t--)a[t+1]=a[t];a[t+1]=e}return a},Re.checkBounds=(e,t,r)=>{let n,o;0===r?(n=e.position.x,o=t.position.x):1===r?(n=e.position.y,o=t.position.y):2===r&&(n=e.position.z,o=t.position.z);const l=e.boundingRadius;return o-t.boundingRadius<n+l},Be.defaults=(e={},t)=>{for(let r in t)r in e||(e[r]=t[r]);return e};class Pe{constructor(e,t,r={}){r=Be.defaults(r,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=Pe.idCounter++,this.collideConnected=r.collideConnected,r.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const e=this.equations;for(let i=0;i<e.length;i++)e[i].enabled=!0}disable(){const e=this.equations;for(let i=0;i<e.length;i++)e[i].enabled=!1}}Pe.idCounter=0;class Ie{constructor(){this.spatial=new o,this.rotational=new o}multiplyElement(element){return element.spatial.dot(this.spatial)+element.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class Le{constructor(e,t,r=-1e6,n=1e6){this.id=Le.id++,this.minForce=r,this.maxForce=n,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Ie,this.jacobianElementB=new Ie,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,r){const n=t,o=e,l=r;this.a=4/(l*(1+4*n)),this.b=4*n/(1+4*n),this.eps=4/(l*l*o*(1+4*n))}computeB(a,b,e){const t=this.computeGW();return-this.computeGq()*a-t*b-this.computeGiMf()*e}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,r=this.bi,n=this.bj,o=r.position,l=n.position;return e.spatial.dot(o)+t.spatial.dot(l)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,r=this.bi,n=this.bj,o=r.velocity,l=n.velocity,h=r.angularVelocity,c=n.angularVelocity;return e.multiplyVectors(o,h)+t.multiplyVectors(l,c)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,r=this.bi,n=this.bj,o=r.vlambda,l=n.vlambda,h=r.wlambda,c=n.wlambda;return e.multiplyVectors(o,h)+t.multiplyVectors(l,c)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,r=this.bi,n=this.bj,o=r.force,l=r.torque,h=n.force,c=n.torque,d=r.invMassSolve,f=n.invMassSolve;return o.scale(d,ke),h.scale(f,ze),r.invInertiaWorldSolve.vmult(l,Oe),n.invInertiaWorldSolve.vmult(c,De),e.multiplyVectors(ke,Oe)+t.multiplyVectors(ze,De)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,r=this.bi,n=this.bj,o=r.invMassSolve,l=n.invMassSolve,h=r.invInertiaWorldSolve,c=n.invInertiaWorldSolve;let d=o+l;return h.vmult(e.rotational,Ne),d+=Ne.dot(e.rotational),c.vmult(t.rotational,Ne),d+=Ne.dot(t.rotational),d}addToWlambda(e){const t=this.jacobianElementA,r=this.jacobianElementB,n=this.bi,o=this.bj,l=Ge;n.vlambda.addScaledVector(n.invMassSolve*e,t.spatial,n.vlambda),o.vlambda.addScaledVector(o.invMassSolve*e,r.spatial,o.vlambda),n.invInertiaWorldSolve.vmult(t.rotational,l),n.wlambda.addScaledVector(e,l,n.wlambda),o.invInertiaWorldSolve.vmult(r.rotational,l),o.wlambda.addScaledVector(e,l,o.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Le.id=0;const ke=new o,ze=new o,Oe=new o,De=new o,Ne=new o,Ge=new o;class je extends Le{constructor(e,t,r=1e6){super(e,t,0,r),this.restitution=0,this.ri=new o,this.rj=new o,this.ni=new o}computeB(e){const a=this.a,b=this.b,t=this.bi,r=this.bj,n=this.ri,o=this.rj,l=Ve,h=qe,c=t.velocity,d=t.angularVelocity,f=(t.force,t.torque,r.velocity),v=r.angularVelocity,m=(r.force,r.torque,He),y=this.jacobianElementA,x=this.jacobianElementB,w=this.ni;n.cross(w,l),o.cross(w,h),w.negate(y.spatial),l.negate(y.rotational),x.spatial.copy(w),x.rotational.copy(h),m.copy(r.position),m.vadd(o,m),m.vsub(t.position,m),m.vsub(n,m);const g=w.dot(m),S=this.restitution+1;return-g*a-(S*f.dot(w)-S*c.dot(w)+v.dot(h)-d.dot(l))*b-e*this.computeGiMf()}getImpactVelocityAlongNormal(){const e=We,t=Xe,r=Ke,n=Ye,o=Ze;return this.bi.position.vadd(this.ri,r),this.bj.position.vadd(this.rj,n),this.bi.getVelocityAtWorldPoint(r,e),this.bj.getVelocityAtWorldPoint(n,t),e.vsub(t,o),this.ni.dot(o)}}const Ve=new o,qe=new o,He=new o,We=new o,Xe=new o,Ke=new o,Ye=new o,Ze=new o;class Qe extends Pe{constructor(e,t=new o,r,n=new o,l=1e6){super(e,r),this.pivotA=t.clone(),this.pivotB=n.clone();const h=this.equationX=new je(e,r),c=this.equationY=new je(e,r),d=this.equationZ=new je(e,r);this.equations.push(h,c,d),h.minForce=c.minForce=d.minForce=-l,h.maxForce=c.maxForce=d.maxForce=l,h.ni.set(1,0,0),c.ni.set(0,1,0),d.ni.set(0,0,1)}update(){const e=this.bodyA,t=this.bodyB,r=this.equationX,n=this.equationY,o=this.equationZ;e.quaternion.vmult(this.pivotA,r.ri),t.quaternion.vmult(this.pivotB,r.rj),n.ri.copy(r.ri),n.rj.copy(r.rj),o.ri.copy(r.ri),o.rj.copy(r.rj)}}new o,new o;class $e extends Le{constructor(e,t,r={}){const n=void 0!==r.maxForce?r.maxForce:1e6;super(e,t,-n,n),this.axisA=r.axisA?r.axisA.clone():new o(1,0,0),this.axisB=r.axisB?r.axisB.clone():new o(0,1,0),this.maxAngle=Math.PI/2}computeB(e){const a=this.a,b=this.b,t=this.axisA,r=this.axisB,n=Je,o=et,l=this.jacobianElementA,h=this.jacobianElementB;return t.cross(r,n),r.cross(t,o),l.rotational.copy(o),h.rotational.copy(n),-(Math.cos(this.maxAngle)-t.dot(r))*a-this.computeGW()*b-e*this.computeGiMf()}}const Je=new o,et=new o;class tt extends Qe{constructor(e,t,r={}){const n=void 0!==r.maxForce?r.maxForce:1e6,l=new o,h=new o,c=new o;e.position.vadd(t.position,c),c.scale(.5,c),t.pointToLocalFrame(c,h),e.pointToLocalFrame(c,l),super(e,l,t,h,n),this.xA=e.vectorToLocalFrame(o.UNIT_X),this.xB=t.vectorToLocalFrame(o.UNIT_X),this.yA=e.vectorToLocalFrame(o.UNIT_Y),this.yB=t.vectorToLocalFrame(o.UNIT_Y),this.zA=e.vectorToLocalFrame(o.UNIT_Z),this.zB=t.vectorToLocalFrame(o.UNIT_Z);const d=this.rotationalEquation1=new $e(e,t,r),f=this.rotationalEquation2=new $e(e,t,r),v=this.rotationalEquation3=new $e(e,t,r);this.equations.push(d,f,v)}update(){const e=this.bodyA,t=this.bodyB,r=(this.motorEquation,this.rotationalEquation1),n=this.rotationalEquation2,o=this.rotationalEquation3;super.update(),e.vectorToWorldFrame(this.xA,r.axisA),t.vectorToWorldFrame(this.yB,r.axisB),e.vectorToWorldFrame(this.yA,n.axisA),t.vectorToWorldFrame(this.zB,n.axisB),e.vectorToWorldFrame(this.zA,o.axisA),t.vectorToWorldFrame(this.xB,o.axisB)}}new o,new o;class nt extends Le{constructor(e,t,r){super(e,t,-r,r),this.ri=new o,this.rj=new o,this.t=new o}computeB(e){this.a;const b=this.b,t=(this.bi,this.bj,this.ri),r=this.rj,n=it,o=st,l=this.t;t.cross(l,n),r.cross(l,o);const h=this.jacobianElementA,c=this.jacobianElementB;return l.negate(h.spatial),n.negate(h.rotational),c.spatial.copy(l),c.rotational.copy(o),-this.computeGW()*b-e*this.computeGiMf()}}const it=new o,st=new o;class ot{constructor(e,t,r){r=Be.defaults(r,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=ot.idCounter++,this.materials=[e,t],this.friction=r.friction,this.restitution=r.restitution,this.contactEquationStiffness=r.contactEquationStiffness,this.contactEquationRelaxation=r.contactEquationRelaxation,this.frictionEquationStiffness=r.frictionEquationStiffness,this.frictionEquationRelaxation=r.frictionEquationRelaxation}}ot.idCounter=0;class at{constructor(e={}){let t="";"string"==typeof e&&(t=e,e={}),this.name=t,this.id=at.idCounter++,this.friction=void 0!==e.friction?e.friction:-1,this.restitution=void 0!==e.restitution?e.restitution:-1}}at.idCounter=0;new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o;new o,new o;new o,new o,new o,new ne,new o,new o,new o(1,0,0),new o(0,1,0),new o(0,0,1),new o,new o,new o,new o;new o,new o,new o,new o;new o,new o,new o;class lt extends T{constructor(e){if(super({type:T.types.SPHERE}),this.radius=void 0!==e?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t=new o){const r=2*e*this.radius*this.radius/5;return t.x=r,t.y=r,t.z=r,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,r,n){const o=this.radius,l=["x","y","z"];for(let i=0;i<l.length;i++){const t=l[i];r[t]=e[t]-o,n[t]=e[t]+o}}}new o,new o;new o,new o,new o,new o,new o,new o,new o;class ht extends T{constructor(){super({type:T.types.PLANE}),this.worldNormal=new o,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t=new o){return t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,r,n){ct.set(0,0,1),t.vmult(ct,ct);const o=Number.MAX_VALUE;r.set(-o,-o,-o),n.set(o,o,o),1===ct.x?n.x=e.x:-1===ct.x&&(r.x=e.x),1===ct.y?n.y=e.y:-1===ct.y&&(r.y=e.y),1===ct.z?n.z=e.z:-1===ct.z&&(r.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const ct=new o;class ut extends T{constructor(data,e={}){e=Be.defaults(e,{maxValue:null,minValue:null,elementSize:1}),super({type:T.types.HEIGHTFIELD}),this.data=data,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,this.pillarConvex=new _,this.pillarOffset=new o,this.updateBoundingSphereRadius(),this._cachedPillars={}}update(){this._cachedPillars={}}updateMinValue(){const data=this.data;let e=data[0][0];for(let i=0;i!==data.length;i++)for(let t=0;t!==data[i].length;t++){const r=data[i][t];r<e&&(e=r)}this.minValue=e}updateMaxValue(){const data=this.data;let e=data[0][0];for(let i=0;i!==data.length;i++)for(let t=0;t!==data[i].length;t++){const r=data[i][t];r>e&&(e=r)}this.maxValue=e}setHeightValueAtIndex(e,t,r){this.data[e][t]=r,this.clearCachedConvexTrianglePillar(e,t,!1),e>0&&(this.clearCachedConvexTrianglePillar(e-1,t,!0),this.clearCachedConvexTrianglePillar(e-1,t,!1)),t>0&&(this.clearCachedConvexTrianglePillar(e,t-1,!0),this.clearCachedConvexTrianglePillar(e,t-1,!1)),t>0&&e>0&&this.clearCachedConvexTrianglePillar(e-1,t-1,!0)}getRectMinMax(e,t,r,n,o=[]){const data=this.data;let l=this.minValue;for(let i=e;i<=r;i++)for(let e=t;e<=n;e++){const t=data[i][e];t>l&&(l=t)}o[0]=this.minValue,o[1]=l}getIndexOfPosition(e,t,r,n){const o=this.elementSize,data=this.data;let l=Math.floor(e/o),h=Math.floor(t/o);return r[0]=l,r[1]=h,n&&(l<0&&(l=0),h<0&&(h=0),l>=data.length-1&&(l=data.length-1),h>=data[0].length-1&&(h=data[0].length-1)),!(l<0||h<0||l>=data.length-1||h>=data[0].length-1)}getTriangleAt(e,t,r,a,b,n){const o=pt;this.getIndexOfPosition(e,t,o,r);let l=o[0],h=o[1];const data=this.data;r&&(l=Math.min(data.length-2,Math.max(0,l)),h=Math.min(data[0].length-2,Math.max(0,h)));const c=this.elementSize,d=(e/c-l)**2+(t/c-h)**2>(e/c-(l+1))**2+(t/c-(h+1))**2;return this.getTriangle(l,h,d,a,b,n),d}getNormalAt(e,t,r,n){const a=yt,b=xt,o=bt,l=wt,h=St;this.getTriangleAt(e,t,r,a,b,o),b.vsub(a,l),o.vsub(a,h),l.cross(h,n),n.normalize()}getAabbAtIndex(e,t,{lowerBound:r,upperBound:n}){const data=this.data,o=this.elementSize;r.set(e*o,t*o,data[e][t]),n.set((e+1)*o,(t+1)*o,data[e+1][t+1])}getHeightAt(e,t,r){const data=this.data,a=vt,b=mt,n=gt,o=pt;this.getIndexOfPosition(e,t,o,r);let l=o[0],h=o[1];r&&(l=Math.min(data.length-2,Math.max(0,l)),h=Math.min(data[0].length-2,Math.max(0,h)));const c=this.getTriangleAt(e,t,r,a,b,n);!function(e,t,r,n,o,l,h,c,d){d.x=((l-c)*(e-h)+(h-o)*(t-c))/((l-c)*(r-h)+(h-o)*(n-c)),d.y=((c-n)*(e-h)+(r-h)*(t-c))/((l-c)*(r-h)+(h-o)*(n-c)),d.z=1-d.x-d.y}(e,t,a.x,a.y,b.x,b.y,n.x,n.y,ft);const d=ft;return c?data[l+1][h+1]*d.x+data[l][h+1]*d.y+data[l+1][h]*d.z:data[l][h]*d.x+data[l+1][h]*d.y+data[l][h+1]*d.z}getCacheConvexTrianglePillarKey(e,t,r){return e+"_"+t+"_"+(r?1:0)}getCachedConvexTrianglePillar(e,t,r){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,r)]}setCachedConvexTrianglePillar(e,t,r,n,o){this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,r)]={convex:n,offset:o}}clearCachedConvexTrianglePillar(e,t,r){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,r)]}getTriangle(e,t,r,a,b,n){const data=this.data,o=this.elementSize;r?(a.set((e+1)*o,(t+1)*o,data[e+1][t+1]),b.set(e*o,(t+1)*o,data[e][t+1]),n.set((e+1)*o,t*o,data[e+1][t])):(a.set(e*o,t*o,data[e][t]),b.set((e+1)*o,t*o,data[e+1][t]),n.set(e*o,(t+1)*o,data[e][t+1]))}getConvexTrianglePillar(e,t,r){let n=this.pillarConvex,l=this.pillarOffset;if(this.cacheEnabled){const data=this.getCachedConvexTrianglePillar(e,t,r);if(data)return this.pillarConvex=data.convex,void(this.pillarOffset=data.offset);n=new _,l=new o,this.pillarConvex=n,this.pillarOffset=l}const data=this.data,h=this.elementSize,c=n.faces;n.vertices.length=6;for(let i=0;i<6;i++)n.vertices[i]||(n.vertices[i]=new o);c.length=5;for(let i=0;i<5;i++)c[i]||(c[i]=[]);const d=n.vertices,f=(Math.min(data[e][t],data[e+1][t],data[e][t+1],data[e+1][t+1])-this.minValue)/2+this.minValue;r?(l.set((e+.75)*h,(t+.75)*h,f),d[0].set(.25*h,.25*h,data[e+1][t+1]-f),d[1].set(-.75*h,.25*h,data[e][t+1]-f),d[2].set(.25*h,-.75*h,data[e+1][t]-f),d[3].set(.25*h,.25*h,-Math.abs(f)-1),d[4].set(-.75*h,.25*h,-Math.abs(f)-1),d[5].set(.25*h,-.75*h,-Math.abs(f)-1),c[0][0]=0,c[0][1]=1,c[0][2]=2,c[1][0]=5,c[1][1]=4,c[1][2]=3,c[2][0]=2,c[2][1]=5,c[2][2]=3,c[2][3]=0,c[3][0]=3,c[3][1]=4,c[3][2]=1,c[3][3]=0,c[4][0]=1,c[4][1]=4,c[4][2]=5,c[4][3]=2):(l.set((e+.25)*h,(t+.25)*h,f),d[0].set(-.25*h,-.25*h,data[e][t]-f),d[1].set(.75*h,-.25*h,data[e+1][t]-f),d[2].set(-.25*h,.75*h,data[e][t+1]-f),d[3].set(-.25*h,-.25*h,-Math.abs(f)-1),d[4].set(.75*h,-.25*h,-Math.abs(f)-1),d[5].set(-.25*h,.75*h,-Math.abs(f)-1),c[0][0]=0,c[0][1]=1,c[0][2]=2,c[1][0]=5,c[1][1]=4,c[1][2]=3,c[2][0]=0,c[2][1]=2,c[2][2]=5,c[2][3]=3,c[3][0]=1,c[3][1]=0,c[3][2]=3,c[3][3]=4,c[4][0]=4,c[4][1]=5,c[4][2]=2,c[4][3]=1),n.computeNormals(),n.computeEdges(),n.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(e,t,r,n,l)}calculateLocalInertia(e,t=new o){return t.set(0,0,0),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,r,n){r.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}updateBoundingSphereRadius(){const data=this.data,s=this.elementSize;this.boundingSphereRadius=new o(data.length*s,data[0].length*s,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).length()}setHeightsFromImage(image,e){const{x:t,z:r,y:n}=e,canvas=document.createElement("canvas");canvas.width=image.width,canvas.height=image.height;const o=canvas.getContext("2d");o.drawImage(image,0,0);const l=o.getImageData(0,0,image.width,image.height),h=this.data;h.length=0,this.elementSize=Math.abs(t)/l.width;for(let i=0;i<l.height;i++){const e=[];for(let n=0;n<l.width;n++){const o=(l.data[4*(i*l.height+n)]+l.data[4*(i*l.height+n)+1]+l.data[4*(i*l.height+n)+2])/4/255*r;t<0?e.push(o):e.unshift(o)}n<0?h.unshift(e):h.push(e)}this.updateMaxValue(),this.updateMinValue(),this.update()}}const pt=[],ft=new o,vt=new o,mt=new o,gt=new o,yt=new o,xt=new o,bt=new o,wt=new o,St=new o;class Tt{constructor(e={}){this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new d,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,t,r=0){const n=this.data;if(!this.aabb.contains(e))return!1;const o=this.children;if(r<(this.maxDepth||this.root.maxDepth)){let n=!1;o.length||(this.subdivide(),n=!0);for(let i=0;8!==i;i++)if(o[i].insert(e,t,r+1))return!0;n&&(o.length=0)}return n.push(t),!0}subdivide(){const e=this.aabb,t=e.lowerBound,u=e.upperBound,r=this.children;r.push(new Tt({aabb:new d({lowerBound:new o(0,0,0)})}),new Tt({aabb:new d({lowerBound:new o(1,0,0)})}),new Tt({aabb:new d({lowerBound:new o(1,1,0)})}),new Tt({aabb:new d({lowerBound:new o(1,1,1)})}),new Tt({aabb:new d({lowerBound:new o(0,1,1)})}),new Tt({aabb:new d({lowerBound:new o(0,0,1)})}),new Tt({aabb:new d({lowerBound:new o(1,0,1)})}),new Tt({aabb:new d({lowerBound:new o(0,1,0)})})),u.vsub(t,At),At.scale(.5,At);const n=this.root||this;for(let i=0;8!==i;i++){const e=r[i];e.root=n;const o=e.aabb.lowerBound;o.x*=At.x,o.y*=At.y,o.z*=At.z,o.vadd(t,o),o.vadd(At,e.aabb.upperBound)}}aabbQuery(e,t){this.data,this.children;const r=[this];for(;r.length;){const n=r.pop();n.aabb.overlaps(e)&&Array.prototype.push.apply(t,n.data),Array.prototype.push.apply(r,n.children)}return t}rayQuery(e,t,r){return e.getAABB(_t),_t.toLocalFrame(t,_t),this.aabbQuery(_t,r),r}removeEmptyNodes(){for(let i=this.children.length-1;i>=0;i--)this.children[i].removeEmptyNodes(),this.children[i].children.length||this.children[i].data.length||this.children.splice(i,1)}}class Mt extends Tt{constructor(e,t={}){super({root:null,aabb:e}),this.maxDepth=void 0!==t.maxDepth?t.maxDepth:8}}const At=new o,_t=new d;class Ut extends T{constructor(e,t){super({type:T.types.TRIMESH}),this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new d,this.edges=null,this.scale=new o(1,1,1),this.tree=new Mt,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const e=this.tree;e.reset(),e.aabb.copy(this.aabb);const t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;const r=new d,a=new o,b=new o,n=new o,l=[a,b,n];for(let i=0;i<this.indices.length/3;i++){const t=3*i;this._getUnscaledVertex(this.indices[t],a),this._getUnscaledVertex(this.indices[t+1],b),this._getUnscaledVertex(this.indices[t+2],n),r.setFromPoints(l),e.insert(r,i)}e.removeEmptyNodes()}getTrianglesInAABB(e,t){Ct.copy(e);const r=this.scale,n=r.x,o=r.y,l=r.z,h=Ct.lowerBound,u=Ct.upperBound;return h.x/=n,h.y/=o,h.z/=l,u.x/=n,u.y/=o,u.z/=l,this.tree.aabbQuery(Ct,t)}setScale(e){const t=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,r=e.x===e.y&&e.y===e.z;t&&r||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const e=Et,t=this.normals;for(let i=0;i<this.indices.length/3;i++){const r=3*i,a=this.indices[r],b=this.indices[r+1],n=this.indices[r+2];this.getVertex(a,It),this.getVertex(b,Lt),this.getVertex(n,kt),Ut.computeNormal(Lt,It,kt,e),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z}}updateEdges(){const e={},t=(a,b)=>{e[a<b?a+"_"+b:b+"_"+a]=!0};for(let i=0;i<this.indices.length/3;i++){const e=3*i,a=this.indices[e],b=this.indices[e+1],r=this.indices[e+2];t(a,b),t(b,r),t(r,a)}const r=Object.keys(e);this.edges=new Int16Array(2*r.length);for(let i=0;i<r.length;i++){const e=r[i].split("_");this.edges[2*i]=parseInt(e[0],10),this.edges[2*i+1]=parseInt(e[1],10)}}getEdgeVertex(e,t,r){const n=this.edges[2*e+(t?1:0)];this.getVertex(n,r)}getEdgeVector(e,t){const r=Ft,n=Rt;this.getEdgeVertex(e,0,r),this.getEdgeVertex(e,1,n),n.vsub(r,t)}getVertex(i,e){const t=this.scale;return this._getUnscaledVertex(i,e),e.x*=t.x,e.y*=t.y,e.z*=t.z,e}_getUnscaledVertex(i,e){const t=3*i,r=this.vertices;return e.set(r[t],r[t+1],r[t+2])}getWorldVertex(i,e,t,r){return this.getVertex(i,r),M.pointToWorldFrame(e,t,r,r),r}getTriangleVertices(i,a,b,e){const t=3*i;this.getVertex(this.indices[t],a),this.getVertex(this.indices[t+1],b),this.getVertex(this.indices[t+2],e)}getNormal(i,e){const t=3*i;return e.set(this.normals[t],this.normals[t+1],this.normals[t+2])}calculateLocalInertia(e,t){this.computeLocalAABB(zt);const r=zt.upperBound.x-zt.lowerBound.x,n=zt.upperBound.y-zt.lowerBound.y,o=zt.upperBound.z-zt.lowerBound.z;return t.set(1/12*e*(2*n*2*n+2*o*2*o),1/12*e*(2*r*2*r+2*o*2*o),1/12*e*(2*n*2*n+2*r*2*r))}computeLocalAABB(e){const t=e.lowerBound,u=e.upperBound,r=this.vertices.length,n=(this.vertices,Ot);this.getVertex(0,n),t.copy(n),u.copy(n);for(let i=0;i!==r;i++)this.getVertex(i,n),n.x<t.x?t.x=n.x:n.x>u.x&&(u.x=n.x),n.y<t.y?t.y=n.y:n.y>u.y&&(u.y=n.y),n.z<t.z?t.z=n.z:n.z>u.z&&(u.z=n.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;const t=this.vertices,r=new o;for(let i=0,n=t.length/3;i!==n;i++){this.getVertex(i,r);const t=r.lengthSquared();t>e&&(e=t)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,r,n){const o=Dt,l=Nt;o.position=e,o.quaternion=t,this.aabb.toWorldFrame(o,l),r.copy(l.lowerBound),n.copy(l.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}}const Et=new o,Ct=new d,Ft=new o,Rt=new o,Bt=new o,Pt=new o;Ut.computeNormal=(e,t,r,n)=>{t.vsub(e,Pt),r.vsub(t,Bt),Bt.cross(Pt,n),n.isZero()||n.normalize()};const It=new o,Lt=new o,kt=new o,zt=new d,Ot=new o,Dt=new M,Nt=new d;Ut.createTorus=(e=1,t=.5,r=8,n=6,o=2*Math.PI)=>{const l=[],h=[];for(let h=0;h<=r;h++)for(let i=0;i<=n;i++){const u=i/n*o,c=h/r*Math.PI*2,d=(e+t*Math.cos(c))*Math.cos(u),f=(e+t*Math.cos(c))*Math.sin(u),v=t*Math.sin(c);l.push(d,f,v)}for(let e=1;e<=r;e++)for(let i=1;i<=n;i++){const a=(n+1)*e+i-1,b=(n+1)*(e-1)+i-1,t=(n+1)*(e-1)+i,r=(n+1)*e+i;h.push(a,b,r),h.push(b,t,r)}return new Ut(l,h)};class Gt{constructor(){this.equations=[]}solve(dt,e){return 0}addEquation(e){e.enabled&&this.equations.push(e)}removeEquation(e){const t=this.equations,i=t.indexOf(e);-1!==i&&t.splice(i,1)}removeAllEquations(){this.equations.length=0}}class jt extends Gt{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(dt,e){let t=0;const r=this.iterations,n=this.tolerance*this.tolerance,o=this.equations,l=o.length,h=e.bodies,c=h.length,d=dt;let f,v,m,y,x,w;if(0!==l)for(let i=0;i!==c;i++)h[i].updateSolveMassProperties();const S=qt,T=Ht,M=Vt;S.length=l,T.length=l,M.length=l;for(let i=0;i!==l;i++){const e=o[i];M[i]=0,T[i]=e.computeB(d),S[i]=1/e.computeC()}if(0!==l){for(let i=0;i!==c;i++){const b=h[i],e=b.vlambda,t=b.wlambda;e.set(0,0,0),t.set(0,0,0)}for(t=0;t!==r;t++){y=0;for(let e=0;e!==l;e++){const t=o[e];f=T[e],v=S[e],w=M[e],x=t.computeGWlambda(),m=v*(f-x-t.eps*w),w+m<t.minForce?m=t.minForce-w:w+m>t.maxForce&&(m=t.maxForce-w),M[e]+=m,y+=m>0?m:-m,t.addToWlambda(m)}if(y*y<n)break}for(let i=0;i!==c;i++){const b=h[i],e=b.velocity,t=b.angularVelocity;b.vlambda.vmul(b.linearFactor,b.vlambda),e.vadd(b.vlambda,e),b.wlambda.vmul(b.angularFactor,b.wlambda),t.vadd(b.wlambda,t)}let e=o.length;const A=1/d;for(;e--;)o[e].multiplier=M[e]*A}return t}}const Vt=[],qt=[],Ht=[];L.STATIC;class Wt extends class{constructor(){this.objects=[],this.type=Object}release(...e){const t=e.length;for(let i=0;i!==t;i++)this.objects.push(e[i]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}{constructor(){super(),this.type=o}constructObject(){return new o}}const Xt=T.types.SPHERE,Kt=T.types.SPHERE|T.types.PLANE,Yt=T.types.BOX|T.types.BOX,Zt=T.types.SPHERE|T.types.BOX,Qt=T.types.PLANE|T.types.BOX,$t=T.types.CONVEXPOLYHEDRON,Jt=T.types.SPHERE|T.types.CONVEXPOLYHEDRON,er=T.types.PLANE|T.types.CONVEXPOLYHEDRON,rr=T.types.BOX|T.types.CONVEXPOLYHEDRON,nr=T.types.SPHERE|T.types.HEIGHTFIELD,ir=T.types.BOX|T.types.HEIGHTFIELD,sr=T.types.CONVEXPOLYHEDRON|T.types.HEIGHTFIELD,or=T.types.PARTICLE|T.types.SPHERE,ar=T.types.PLANE|T.types.PARTICLE,lr=T.types.BOX|T.types.PARTICLE,cr=T.types.PARTICLE|T.types.CONVEXPOLYHEDRON,ur=T.types.SPHERE|T.types.TRIMESH,dr=T.types.PLANE|T.types.TRIMESH;class pr{constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new Wt,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,r,n,o,l){let h;this.contactPointPool.length?(h=this.contactPointPool.pop(),h.bi=e,h.bj=t):h=new je(e,t),h.enabled=e.collisionResponse&&t.collisionResponse&&r.collisionResponse&&n.collisionResponse;const c=this.currentContactMaterial;h.restitution=c.restitution,h.setSpookParams(c.contactEquationStiffness,c.contactEquationRelaxation,this.world.dt);const d=r.material||e.material,f=n.material||t.material;return d&&f&&d.restitution>=0&&f.restitution>=0&&(h.restitution=d.restitution*f.restitution),h.si=o||r,h.sj=l||n,h}createFrictionEquationsFromContact(e,t){const r=e.bi,n=e.bj,o=e.si,l=e.sj,h=this.world,c=this.currentContactMaterial;let d=c.friction;const f=o.material||r.material,v=l.material||n.material;if(f&&v&&f.friction>=0&&v.friction>=0&&(d=f.friction*v.friction),d>0){const o=d*h.gravity.length();let l=r.invMass+n.invMass;l>0&&(l=1/l);const f=this.frictionEquationPool,v=f.length?f.pop():new nt(r,n,o*l),m=f.length?f.pop():new nt(r,n,o*l);return v.bi=m.bi=r,v.bj=m.bj=n,v.minForce=m.minForce=-o*l,v.maxForce=m.maxForce=o*l,v.ri.copy(e.ri),v.rj.copy(e.rj),m.ri.copy(e.ri),m.rj.copy(e.rj),e.ni.tangents(v.t,m.t),v.setSpookParams(c.frictionEquationStiffness,c.frictionEquationRelaxation,h.dt),m.setSpookParams(c.frictionEquationStiffness,c.frictionEquationRelaxation,h.dt),v.enabled=m.enabled=e.enabled,t.push(v,m),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||1===e)return;const r=this.frictionResult[this.frictionResult.length-2],n=this.frictionResult[this.frictionResult.length-1];fr.setZero(),vr.setZero(),mr.setZero();const o=t.bi;t.bj;for(let i=0;i!==e;i++)t=this.result[this.result.length-1-i],t.bi!==o?(fr.vadd(t.ni,fr),vr.vadd(t.ri,vr),mr.vadd(t.rj,mr)):(fr.vsub(t.ni,fr),vr.vadd(t.rj,vr),mr.vadd(t.ri,mr));const l=1/e;vr.scale(l,r.ri),mr.scale(l,r.rj),n.ri.copy(r.ri),n.rj.copy(r.rj),fr.normalize(),fr.tangents(r.t,n.t)}getContacts(e,t,r,n,o,l,h){this.contactPointPool=o,this.frictionEquationPool=h,this.result=n,this.frictionResult=l;const c=xr,d=wr,f=gr,v=yr;for(let n=0,o=e.length;n!==o;n++){const o=e[n],l=t[n];let h=null;o.material&&l.material&&(h=r.getContactMaterial(o.material,l.material)||null);const m=o.type&L.KINEMATIC&&l.type&L.STATIC||o.type&L.STATIC&&l.type&L.KINEMATIC||o.type&L.KINEMATIC&&l.type&L.KINEMATIC;for(let i=0;i<o.shapes.length;i++){o.quaternion.mult(o.shapeOrientations[i],c),o.quaternion.vmult(o.shapeOffsets[i],f),f.vadd(o.position,f);const e=o.shapes[i];for(let t=0;t<l.shapes.length;t++){l.quaternion.mult(l.shapeOrientations[t],d),l.quaternion.vmult(l.shapeOffsets[t],v),v.vadd(l.position,v);const n=l.shapes[t];if(!(e.collisionFilterMask&n.collisionFilterGroup&&n.collisionFilterMask&e.collisionFilterGroup))continue;if(f.distanceTo(v)>e.boundingSphereRadius+n.boundingSphereRadius)continue;let y=null;e.material&&n.material&&(y=r.getContactMaterial(e.material,n.material)||null),this.currentContactMaterial=y||h||r.defaultContactMaterial;const x=this[e.type|n.type];if(x){let t=!1;t=e.type<n.type?x.call(this,e,n,f,v,c,d,o,l,e,n,m):x.call(this,n,e,v,f,d,c,l,o,e,n,m),t&&m&&(r.shapeOverlapKeeper.set(e.id,n.id),r.bodyOverlapKeeper.set(o.id,l.id))}}}}}sphereSphere(e,t,r,n,o,l,h,c,d,f,v){if(v)return r.distanceSquared(n)<(e.radius+t.radius)**2;const m=this.createContactEquation(h,c,e,t,d,f);n.vsub(r,m.ni),m.ni.normalize(),m.ri.copy(m.ni),m.rj.copy(m.ni),m.ri.scale(e.radius,m.ri),m.rj.scale(-t.radius,m.rj),m.ri.vadd(r,m.ri),m.ri.vsub(h.position,m.ri),m.rj.vadd(n,m.rj),m.rj.vsub(c.position,m.rj),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}spherePlane(e,t,r,n,o,l,h,c,d,f,v){const m=this.createContactEquation(h,c,e,t,d,f);if(m.ni.set(0,0,1),l.vmult(m.ni,m.ni),m.ni.negate(m.ni),m.ni.normalize(),m.ni.scale(e.radius,m.ri),r.vsub(n,Nr),m.ni.scale(m.ni.dot(Nr),Gr),Nr.vsub(Gr,m.rj),-Nr.dot(m.ni)<=e.radius){if(v)return!0;const e=m.ri,t=m.rj;e.vadd(r,e),e.vsub(h.position,e),t.vadd(n,t),t.vsub(c.position,t),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}boxBox(e,t,r,n,o,l,h,c,d,f,v){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,r,n,o,l,h,c,e,t,v)}sphereBox(e,t,r,n,o,l,h,c,d,f,v){const m=this.v3pool,y=Zr;r.vsub(n,Wr),t.getSideNormals(y,l);const x=e.radius;let w=!1;const S=$r,T=Jr,M=en;let A=null,_=0,U=0,E=0,C=null;for(let e=0,t=y.length;e!==t&&!1===w;e++){const t=Xr;t.copy(y[e]);const r=t.length();t.normalize();const n=Wr.dot(t);if(n<r+x&&n>0){const o=Kr,l=Yr;o.copy(y[(e+1)%3]),l.copy(y[(e+2)%3]);const h1=o.length(),h2=l.length();o.normalize(),l.normalize();const h=Wr.dot(o),c=Wr.dot(l);if(h<h1&&h>-h1&&c<h2&&c>-h2){const e=Math.abs(n-r-x);if((null===C||e<C)&&(C=e,U=h,E=c,A=r,S.copy(t),T.copy(o),M.copy(l),_++,v))return!0}}}if(_){w=!0;const o=this.createContactEquation(h,c,e,t,d,f);S.scale(-x,o.ri),o.ni.copy(S),o.ni.negate(o.ni),S.scale(A,S),T.scale(U,T),S.vadd(T,S),M.scale(E,M),S.vadd(M,o.rj),o.ri.vadd(r,o.ri),o.ri.vsub(h.position,o.ri),o.rj.vadd(n,o.rj),o.rj.vsub(c.position,o.rj),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult)}let F=m.get();const R=Qr;for(let o=0;2!==o&&!w;o++)for(let l=0;2!==l&&!w;l++)for(let m=0;2!==m&&!w;m++)if(F.set(0,0,0),o?F.vadd(y[0],F):F.vsub(y[0],F),l?F.vadd(y[1],F):F.vsub(y[1],F),m?F.vadd(y[2],F):F.vsub(y[2],F),n.vadd(F,R),R.vsub(r,R),R.lengthSquared()<x*x){if(v)return!0;w=!0;const o=this.createContactEquation(h,c,e,t,d,f);o.ri.copy(R),o.ri.normalize(),o.ni.copy(o.ri),o.ri.scale(x,o.ri),o.rj.copy(F),o.ri.vadd(r,o.ri),o.ri.vsub(h.position,o.ri),o.rj.vadd(n,o.rj),o.rj.vsub(c.position,o.rj),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult)}m.release(F),F=null;const B=m.get(),P=m.get(),I=m.get(),L=m.get(),k=m.get(),z=y.length;for(let o=0;o!==z&&!w;o++)for(let l=0;l!==z&&!w;l++)if(o%3!=l%3){y[l].cross(y[o],B),B.normalize(),y[o].vadd(y[l],P),I.copy(r),I.vsub(P,I),I.vsub(n,I);const m=I.dot(B);B.scale(m,L);let S=0;for(;S===o%3||S===l%3;)S++;k.copy(r),k.vsub(L,k),k.vsub(P,k),k.vsub(n,k);const T=Math.abs(m),M=k.length();if(T<y[S].length()&&M<x){if(v)return!0;w=!0;const o=this.createContactEquation(h,c,e,t,d,f);P.vadd(L,o.rj),o.rj.copy(o.rj),k.negate(o.ni),o.ni.normalize(),o.ri.copy(o.rj),o.ri.vadd(n,o.ri),o.ri.vsub(r,o.ri),o.ri.normalize(),o.ri.scale(x,o.ri),o.ri.vadd(r,o.ri),o.ri.vsub(h.position,o.ri),o.rj.vadd(n,o.rj),o.rj.vsub(c.position,o.rj),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult)}}m.release(B,P,I,L,k)}planeBox(e,t,r,n,o,l,h,c,d,f,v){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,r,n,o,l,h,c,e,t,v)}convexConvex(e,t,r,n,o,l,h,c,d,f,v,m,y){const x=mn;if(!(r.distanceTo(n)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,r,o,n,l,x,m,y)){const m=[],q=gn;e.clipAgainstHull(r,o,t,n,l,x,-100,100,m);let y=0;for(let o=0;o!==m.length;o++){if(v)return!0;const l=this.createContactEquation(h,c,e,t,d,f),w=l.ri,S=l.rj;x.negate(l.ni),m[o].normal.negate(q),q.scale(m[o].depth,q),m[o].point.vadd(q,w),S.copy(m[o].point),w.vsub(r,w),S.vsub(n,S),w.vadd(r,w),w.vsub(h.position,w),S.vadd(n,S),S.vsub(c.position,S),this.result.push(l),y++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(l,this.frictionResult)}this.enableFrictionReduction&&y&&this.createFrictionFromAverage(y)}}sphereConvex(e,t,r,n,o,l,h,c,d,f,v){const m=this.v3pool;r.vsub(n,tn);const y=t.faceNormals,x=t.faces,w=t.vertices,S=e.radius;let T=!1;for(let i=0;i!==w.length;i++){const o=w[i],m=on;l.vmult(o,m),n.vadd(m,m);const y=sn;if(m.vsub(r,y),y.lengthSquared()<S*S){if(v)return!0;T=!0;const o=this.createContactEquation(h,c,e,t,d,f);return o.ri.copy(y),o.ri.normalize(),o.ni.copy(o.ri),o.ri.scale(S,o.ri),m.vsub(n,o.rj),o.ri.vadd(r,o.ri),o.ri.vsub(h.position,o.ri),o.rj.vadd(n,o.rj),o.rj.vsub(c.position,o.rj),this.result.push(o),void this.createFrictionEquationsFromContact(o,this.frictionResult)}}for(let i=0,o=x.length;i!==o&&!1===T;i++){const o=y[i],M=x[i],A=an;l.vmult(o,A);const _=ln;l.vmult(w[M[0]],_),_.vadd(n,_);const U=hn;A.scale(-S,U),r.vadd(U,U);const E=cn;U.vsub(_,E);const C=E.dot(A),F=un;if(r.vsub(_,F),C<0&&F.dot(A)>0){const o=[];for(let e=0,t=M.length;e!==t;e++){const t=m.get();l.vmult(w[M[e]],t),n.vadd(t,t),o.push(t)}if(Hr(o,A,r)){if(v)return!0;T=!0;const l=this.createContactEquation(h,c,e,t,d,f);A.scale(-S,l.ri),A.negate(l.ni);const y=m.get();A.scale(-C,y);const x=m.get();A.scale(-S,x),r.vsub(n,l.rj),l.rj.vadd(x,l.rj),l.rj.vadd(y,l.rj),l.rj.vadd(n,l.rj),l.rj.vsub(c.position,l.rj),l.ri.vadd(r,l.ri),l.ri.vsub(h.position,l.ri),m.release(y),m.release(x),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult);for(let e=0,t=o.length;e!==t;e++)m.release(o[e]);return}for(let y=0;y!==M.length;y++){const x=m.get(),T=m.get();l.vmult(w[M[(y+1)%M.length]],x),l.vmult(w[M[(y+2)%M.length]],T),n.vadd(x,x),n.vadd(T,T);const A=rn;T.vsub(x,A);const _=nn;A.unit(_);const p=m.get(),U=m.get();r.vsub(x,U);const E=U.dot(_);_.scale(E,p),p.vadd(x,p);const C=m.get();if(p.vsub(r,C),E>0&&E*E<A.lengthSquared()&&C.lengthSquared()<S*S){if(v)return!0;const l=this.createContactEquation(h,c,e,t,d,f);p.vsub(n,l.rj),p.vsub(r,l.ni),l.ni.normalize(),l.ni.scale(S,l.ri),l.rj.vadd(n,l.rj),l.rj.vsub(c.position,l.rj),l.ri.vadd(r,l.ri),l.ri.vsub(h.position,l.ri),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult);for(let e=0,t=o.length;e!==t;e++)m.release(o[e]);return m.release(x),m.release(T),m.release(p),m.release(C),void m.release(U)}m.release(x),m.release(T),m.release(p),m.release(C),m.release(U)}for(let e=0,t=o.length;e!==t;e++)m.release(o[e])}}}planeConvex(e,t,r,n,o,l,h,c,d,f,v){const m=dn,y=pn;y.set(0,0,1),o.vmult(y,y);let x=0;const w=fn;for(let i=0;i!==t.vertices.length;i++){if(m.copy(t.vertices[i]),l.vmult(m,m),n.vadd(m,m),m.vsub(r,w),y.dot(w)<=0){if(v)return!0;const o=this.createContactEquation(h,c,e,t,d,f),l=vn;y.scale(y.dot(w),l),m.vsub(l,l),l.vsub(r,o.ri),o.ni.copy(y),m.vsub(n,o.rj),o.ri.vadd(r,o.ri),o.ri.vsub(h.position,o.ri),o.rj.vadd(n,o.rj),o.rj.vsub(c.position,o.rj),this.result.push(o),x++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(o,this.frictionResult)}}this.enableFrictionReduction&&x&&this.createFrictionFromAverage(x)}boxConvex(e,t,r,n,o,l,h,c,d,f,v){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,r,n,o,l,h,c,e,t,v)}sphereHeightfield(e,t,r,n,o,l,h,c,d,f,v){const data=t.data,m=e.radius,y=t.elementSize,x=Rn,w=Fn;M.pointToLocalFrame(n,l,r,w);let S=Math.floor((w.x-m)/y)-1,T=Math.ceil((w.x+m)/y)+1,A=Math.floor((w.y-m)/y)-1,_=Math.ceil((w.y+m)/y)+1;if(T<0||_<0||S>data.length||A>data[0].length)return;S<0&&(S=0),T<0&&(T=0),A<0&&(A=0),_<0&&(_=0),S>=data.length&&(S=data.length-1),T>=data.length&&(T=data.length-1),_>=data[0].length&&(_=data[0].length-1),A>=data[0].length&&(A=data[0].length-1);const U=[];t.getRectMinMax(S,A,T,_,U);const E=U[0],C=U[1];if(w.z-m>C||w.z+m<E)return;const F=this.result;for(let i=S;i<T;i++)for(let d=A;d<_;d++){const f=F.length;let m=!1;if(t.getConvexTrianglePillar(i,d,!1),M.pointToWorldFrame(n,l,t.pillarOffset,x),r.distanceTo(x)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(m=this.sphereConvex(e,t.pillarConvex,r,x,o,l,h,c,e,t,v)),v&&m)return!0;if(t.getConvexTrianglePillar(i,d,!0),M.pointToWorldFrame(n,l,t.pillarOffset,x),r.distanceTo(x)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(m=this.sphereConvex(e,t.pillarConvex,r,x,o,l,h,c,e,t,v)),v&&m)return!0;if(F.length-f>2)return}}boxHeightfield(e,t,r,n,o,l,h,c,d,f,v){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,r,n,o,l,h,c,e,t,v)}convexHeightfield(e,t,r,n,o,l,h,c,d,f,v){const data=t.data,m=t.elementSize,y=e.boundingSphereRadius,x=En,w=Cn,S=Un;M.pointToLocalFrame(n,l,r,S);let T=Math.floor((S.x-y)/m)-1,A=Math.ceil((S.x+y)/m)+1,_=Math.floor((S.y-y)/m)-1,U=Math.ceil((S.y+y)/m)+1;if(A<0||U<0||T>data.length||_>data[0].length)return;T<0&&(T=0),A<0&&(A=0),_<0&&(_=0),U<0&&(U=0),T>=data.length&&(T=data.length-1),A>=data.length&&(A=data.length-1),U>=data[0].length&&(U=data[0].length-1),_>=data[0].length&&(_=data[0].length-1);const E=[];t.getRectMinMax(T,_,A,U,E);const C=E[0],F=E[1];if(!(S.z-y>F||S.z+y<C))for(let i=T;i<A;i++)for(let d=_;d<U;d++){let f=!1;if(t.getConvexTrianglePillar(i,d,!1),M.pointToWorldFrame(n,l,t.pillarOffset,x),r.distanceTo(x)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(f=this.convexConvex(e,t.pillarConvex,r,x,o,l,h,c,null,null,v,w,null)),v&&f)return!0;if(t.getConvexTrianglePillar(i,d,!0),M.pointToWorldFrame(n,l,t.pillarOffset,x),r.distanceTo(x)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(f=this.convexConvex(e,t.pillarConvex,r,x,o,l,h,c,null,null,v,w,null)),v&&f)return!0}}sphereParticle(e,t,r,n,o,l,h,c,d,f,v){const m=wn;if(m.set(0,0,1),n.vsub(r,m),m.lengthSquared()<=e.radius*e.radius){if(v)return!0;const r=this.createContactEquation(c,h,t,e,d,f);m.normalize(),r.rj.copy(m),r.rj.scale(e.radius,r.rj),r.ni.copy(m),r.ni.negate(r.ni),r.ri.set(0,0,0),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}planeParticle(e,t,r,n,o,l,h,c,d,f,v){const m=yn;m.set(0,0,1),h.quaternion.vmult(m,m);const y=xn;if(n.vsub(h.position,y),m.dot(y)<=0){if(v)return!0;const r=this.createContactEquation(c,h,t,e,d,f);r.ni.copy(m),r.ni.negate(r.ni),r.ri.set(0,0,0);const o=bn;m.scale(m.dot(n),o),n.vsub(o,o),r.rj.copy(o),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}boxParticle(e,t,r,n,o,l,h,c,d,f,v){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,r,n,o,l,h,c,e,t,v)}convexParticle(e,t,r,n,o,l,h,c,d,f,v){let m=-1;const y=Mn,x=_n;let w=null;const S=Tn;if(S.copy(n),S.vsub(r,S),o.conjugate(Sn),Sn.vmult(S,S),e.pointIsInside(S)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(r,o),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(o);for(let i=0,t=e.faces.length;i!==t;i++){const t=[e.worldVertices[e.faces[i][0]]],r=e.worldFaceNormals[i];n.vsub(t[0],An);const o=-r.dot(An);if(null===w||Math.abs(o)<Math.abs(w)){if(v)return!0;w=o,m=i,y.copy(r)}}if(-1!==m){const o=this.createContactEquation(c,h,t,e,d,f);y.scale(w,x),x.vadd(n,x),x.vsub(r,x),o.rj.copy(x),y.negate(o.ni),o.ri.set(0,0,0);const l=o.ri,v=o.rj;l.vadd(n,l),l.vsub(c.position,l),v.vadd(r,v),v.vsub(h.position,v),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}sphereTrimesh(e,t,r,n,o,l,h,c,d,f,v){const m=Cr,y=Fr,x=Rr,w=Br,S=Pr,T=Ir,A=Or,_=Er,U=_r,E=Dr;M.pointToLocalFrame(n,l,r,S);const C=e.radius;A.lowerBound.set(S.x-C,S.y-C,S.z-C),A.upperBound.set(S.x+C,S.y+C,S.z+C),t.getTrianglesInAABB(A,E);const F=Ur,R=e.radius*e.radius;for(let i=0;i<E.length;i++)for(let o=0;o<3;o++)if(t.getVertex(t.indices[3*E[i]+o],F),F.vsub(S,U),U.lengthSquared()<=R){if(_.copy(F),M.pointToWorldFrame(n,l,_,F),F.vsub(r,U),v)return!0;let o=this.createContactEquation(h,c,e,t,d,f);o.ni.copy(U),o.ni.normalize(),o.ri.copy(o.ni),o.ri.scale(e.radius,o.ri),o.ri.vadd(r,o.ri),o.ri.vsub(h.position,o.ri),o.rj.copy(F),o.rj.vsub(c.position,o.rj),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult)}for(let i=0;i<E.length;i++)for(let o=0;o<3;o++){t.getVertex(t.indices[3*E[i]+o],m),t.getVertex(t.indices[3*E[i]+(o+1)%3],y),y.vsub(m,x),S.vsub(y,T);const A=T.dot(x);S.vsub(m,T);let _=T.dot(x);if(_>0&&A<0){if(S.vsub(m,T),w.copy(x),w.normalize(),_=T.dot(w),w.scale(_,T),T.vadd(m,T),T.distanceTo(S)<e.radius){if(v)return!0;const o=this.createContactEquation(h,c,e,t,d,f);T.vsub(S,o.ni),o.ni.normalize(),o.ni.scale(e.radius,o.ri),o.ri.vadd(r,o.ri),o.ri.vsub(h.position,o.ri),M.pointToWorldFrame(n,l,T,T),T.vsub(c.position,o.rj),M.vectorToWorldFrame(l,o.ni,o.ni),M.vectorToWorldFrame(l,o.ri,o.ri),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult)}}}const B=Lr,P=kr,I=zr,L=Ar;for(let i=0,o=E.length;i!==o;i++){t.getTriangleVertices(E[i],B,P,I),t.getNormal(E[i],L),S.vsub(B,T);let o=T.dot(L);if(L.scale(o,T),S.vsub(T,T),o=T.distanceTo(S),ne.pointInTriangle(T,B,P,I)&&o<e.radius){if(v)return!0;let o=this.createContactEquation(h,c,e,t,d,f);T.vsub(S,o.ni),o.ni.normalize(),o.ni.scale(e.radius,o.ri),o.ri.vadd(r,o.ri),o.ri.vsub(h.position,o.ri),M.pointToWorldFrame(n,l,T,T),T.vsub(c.position,o.rj),M.vectorToWorldFrame(l,o.ni,o.ni),M.vectorToWorldFrame(l,o.ri,o.ri),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult)}}E.length=0}planeTrimesh(e,t,r,n,l,h,c,d,f,v,m){const y=new o,x=Sr;x.set(0,0,1),l.vmult(x,x);for(let i=0;i<t.vertices.length/3;i++){t.getVertex(i,y);const l=new o;l.copy(y),M.pointToWorldFrame(n,h,l,y);const w=Tr;if(y.vsub(r,w),x.dot(w)<=0){if(m)return!0;const r=this.createContactEquation(c,d,e,t,f,v);r.ni.copy(x);const n=Mr;x.scale(w.dot(x),n),y.vsub(n,n),r.ri.copy(n),r.ri.vsub(c.position,r.ri),r.rj.copy(y),r.rj.vsub(d.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}}}const fr=new o,vr=new o,mr=new o,gr=new o,yr=new o,xr=new x,wr=new x;pr.prototype[Yt]=pr.prototype.boxBox,pr.prototype[rr]=pr.prototype.boxConvex,pr.prototype[lr]=pr.prototype.boxParticle,pr.prototype[Xt]=pr.prototype.sphereSphere;const Sr=new o,Tr=new o,Mr=new o;pr.prototype[dr]=pr.prototype.planeTrimesh;const Ar=new o,_r=new o,Ur=new o,Er=new o,Cr=new o,Fr=new o,Rr=new o,Br=new o,Pr=new o,Ir=new o,Lr=new o,kr=new o,zr=new o,Or=new d,Dr=[];pr.prototype[ur]=pr.prototype.sphereTrimesh;const Nr=new o,Gr=new o;pr.prototype[Kt]=pr.prototype.spherePlane;const jr=new o,Vr=new o,qr=new o;function Hr(e,t,p){let r=null;const n=e.length;for(let i=0;i!==n;i++){const o=e[i],l=jr;e[(i+1)%n].vsub(o,l);const h=Vr;l.cross(t,h);const c=qr;p.vsub(o,c);const d=h.dot(c);if(!(null===r||d>0&&!0===r||d<=0&&!1===r))return!1;null===r&&(r=d>0)}return!0}const Wr=new o,Xr=new o,Kr=new o,Yr=new o,Zr=[new o,new o,new o,new o,new o,new o],Qr=new o,$r=new o,Jr=new o,en=new o;pr.prototype[Zt]=pr.prototype.sphereBox;const tn=new o,rn=new o,nn=new o,sn=new o,on=new o,an=new o,ln=new o,hn=new o,cn=new o,un=new o;pr.prototype[Jt]=pr.prototype.sphereConvex,pr.prototype[Qt]=pr.prototype.planeBox;const dn=new o,pn=new o,fn=new o,vn=new o;pr.prototype[er]=pr.prototype.planeConvex;const mn=new o,gn=new o;pr.prototype[$t]=pr.prototype.convexConvex;const yn=new o,xn=new o,bn=new o;pr.prototype[ar]=pr.prototype.planeParticle;const wn=new o;pr.prototype[or]=pr.prototype.sphereParticle;const Sn=new x,Tn=new o,Mn=new o,An=new o,_n=new o;pr.prototype[cr]=pr.prototype.convexParticle,pr.prototype[ir]=pr.prototype.boxHeightfield;const Un=new o,En=new o,Cn=[0];pr.prototype[sr]=pr.prototype.convexHeightfield;const Fn=new o,Rn=new o;pr.prototype[nr]=pr.prototype.sphereHeightfield;class Bn{constructor(){this.current=[],this.previous=[]}getKey(i,e){if(e<i){const t=e;e=i,i=t}return i<<16|e}set(i,e){const t=this.getKey(i,e),r=this.current;let n=0;for(;t>r[n];)n++;if(t!==r[n]){for(let e=r.length-1;e>=n;e--)r[e+1]=r[e];r[n]=t}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const a=this.current,b=this.previous,r=a.length,n=b.length;let o=0;for(let i=0;i<r;i++){let t=!1;const r=a[i];for(;r>b[o];)o++;t=r===b[o],t||Pn(e,r)}o=0;for(let i=0;i<n;i++){let e=!1;const r=b[i];for(;r>a[o];)o++;e=a[o]===r,e||Pn(t,r)}}}function Pn(e,t){e.push((4294901760&t)>>16,65535&t)}class In{constructor(){this.data={keys:[]}}get(i,e){if(i>e){const t=e;e=i,i=t}return this.data[i+"-"+e]}set(i,e,t){if(i>e){const t=e;e=i,i=t}const r=i+"-"+e;this.get(i,e)||this.data.keys.push(r),this.data[r]=t}reset(){const data=this.data,e=data.keys;for(;e.length>0;){delete data[e.pop()]}}}class Ln extends y{constructor(e={}){super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==e.quatNormalizeSkip?e.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==e.quatNormalizeFast&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new o,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=void 0!==e.broadphase?e.broadphase:new te,this.bodies=[],this.hasActiveBodies=!1,this.solver=void 0!==e.solver?e.solver:new jt,this.constraints=[],this.narrowphase=new pr(this),this.collisionMatrix=new m,this.collisionMatrixPrevious=new m,this.bodyOverlapKeeper=new Bn,this.shapeOverlapKeeper=new Bn,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new In,this.defaultMaterial=new at("default"),this.defaultContactMaterial=new ot(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}numObjects(){return this.bodies.length}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)}rayTest(e,t,r){r instanceof re?this.raycastClosest(e,t,{skipBackfaces:!0},r):this.raycastAll(e,t,{skipBackfaces:!0},r)}raycastAll(e,t,r={},n){return r.mode=ne.ALL,r.from=e,r.to=t,r.callback=n,kn.intersectWorld(this,r)}raycastAny(e,t,r={},n){return r.mode=ne.ANY,r.from=e,r.to=t,r.result=n,kn.intersectWorld(this,r)}raycastClosest(e,t,r={},n){return r.mode=ne.CLOSEST,r.from=e,r.to=t,r.result=n,kn.intersectWorld(this,r)}addBody(body){this.bodies.includes(body)||(body.index=this.bodies.length,this.bodies.push(body),body.world=this,body.initPosition.copy(body.position),body.initVelocity.copy(body.velocity),body.timeLastSleepy=this.time,body instanceof L&&(body.initAngularVelocity.copy(body.angularVelocity),body.initQuaternion.copy(body.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=body,this.idToBodyMap[body.id]=body,this.dispatchEvent(this.addBodyEvent))}removeBody(body){body.world=null;const e=this.bodies.length-1,t=this.bodies,r=t.indexOf(body);if(-1!==r){t.splice(r,1);for(let i=0;i!==t.length;i++)t[i].index=i;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=body,delete this.idToBodyMap[body.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let i=0,r=t.length;i<r;i++){const r=t[i].shapes;for(let t=0,n=r.length;t<n;t++){const n=r[t];if(n.id===e)return n}}}addMaterial(e){this.materials.push(e)}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}step(dt,e,t=10){if(void 0===e)this.internalStep(dt),this.time+=dt;else{this.accumulator+=e;const r=zn.now();let n=0;for(;this.accumulator>=dt&&n<t&&(this.internalStep(dt),this.accumulator-=dt,n++,!(zn.now()-r>2*dt*1e3)););this.accumulator=this.accumulator%dt;const o=this.accumulator/dt;for(let e=0;e!==this.bodies.length;e++){const b=this.bodies[e];b.previousPosition.lerp(b.position,o,b.interpolatedPosition),b.previousQuaternion.slerp(b.quaternion,o,b.interpolatedQuaternion),b.previousQuaternion.normalize()}this.time+=e}}internalStep(dt){this.dt=dt;const e=this.contacts,t=Vn,r=qn,n=this.numObjects(),o=this.bodies,l=this.solver,h=this.gravity,c=this.doProfiling,d=this.profile,f=L.DYNAMIC;let v=-1/0;const m=this.constraints,y=jn,x=(h.length(),h.x),w=h.y,S=h.z;let i=0;for(c&&(v=zn.now()),i=0;i!==n;i++){const e=o[i];if(e.type===f){const t=e.force,r=e.mass;t.x+=r*x,t.y+=r*w,t.z+=r*S}}for(let i=0,e=this.subsystems.length;i!==e;i++)this.subsystems[i].update();c&&(v=zn.now()),t.length=0,r.length=0,this.broadphase.collisionPairs(this,t,r),c&&(d.broadphase=zn.now()-v);let T=m.length;for(i=0;i!==T;i++){const e=m[i];if(!e.collideConnected)for(let n=t.length-1;n>=0;n-=1)(e.bodyA===t[n]&&e.bodyB===r[n]||e.bodyB===t[n]&&e.bodyA===r[n])&&(t.splice(n,1),r.splice(n,1))}this.collisionMatrixTick(),c&&(v=zn.now());const M=Gn,A=e.length;for(i=0;i!==A;i++)M.push(e[i]);e.length=0;const _=this.frictionEquations.length;for(i=0;i!==_;i++)y.push(this.frictionEquations[i]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(t,r,this,e,M,this.frictionEquations,y),c&&(d.narrowphase=zn.now()-v),c&&(v=zn.now()),i=0;i<this.frictionEquations.length;i++)l.addEquation(this.frictionEquations[i]);const U=e.length;for(let t=0;t!==U;t++){const r=e[t],n=r.bi,o=r.bj,h=r.si,c=r.sj;let d;d=n.material&&o.material&&this.getContactMaterial(n.material,o.material)||this.defaultContactMaterial;let f=d.friction;if(n.material&&o.material&&(n.material.friction>=0&&o.material.friction>=0&&(f=n.material.friction*o.material.friction),n.material.restitution>=0&&o.material.restitution>=0&&(r.restitution=n.material.restitution*o.material.restitution)),l.addEquation(r),n.allowSleep&&n.type===L.DYNAMIC&&n.sleepState===L.SLEEPING&&o.sleepState===L.AWAKE&&o.type!==L.STATIC){o.velocity.lengthSquared()+o.angularVelocity.lengthSquared()>=2*o.sleepSpeedLimit**2&&(n.wakeUpAfterNarrowphase=!0)}if(o.allowSleep&&o.type===L.DYNAMIC&&o.sleepState===L.SLEEPING&&n.sleepState===L.AWAKE&&n.type!==L.STATIC){n.velocity.lengthSquared()+n.angularVelocity.lengthSquared()>=2*n.sleepSpeedLimit**2&&(o.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(n,o,!0),this.collisionMatrixPrevious.get(n,o)||(Nn.body=o,Nn.contact=r,n.dispatchEvent(Nn),Nn.body=n,o.dispatchEvent(Nn)),this.bodyOverlapKeeper.set(n.id,o.id),this.shapeOverlapKeeper.set(h.id,c.id)}for(this.emitContactEvents(),c&&(d.makeContactConstraints=zn.now()-v,v=zn.now()),i=0;i!==n;i++){const e=o[i];e.wakeUpAfterNarrowphase&&(e.wakeUp(),e.wakeUpAfterNarrowphase=!1)}for(T=m.length,i=0;i!==T;i++){const e=m[i];e.update();for(let t=0,r=e.equations.length;t!==r;t++){const r=e.equations[t];l.addEquation(r)}}l.solve(dt,this),c&&(d.solve=zn.now()-v),l.removeAllEquations();const E=Math.pow;for(i=0;i!==n;i++){const e=o[i];if(e.type&f){const t=E(1-e.linearDamping,dt),r=e.velocity;r.scale(t,r);const n=e.angularVelocity;if(n){const t=E(1-e.angularDamping,dt);n.scale(t,n)}}}for(this.dispatchEvent(Dn),i=0;i!==n;i++){const e=o[i];e.preStep&&e.preStep.call(e)}c&&(v=zn.now());const C=this.stepnumber%(this.quatNormalizeSkip+1)==0,F=this.quatNormalizeFast;for(i=0;i!==n;i++)o[i].integrate(dt,C,F);for(this.clearForces(),this.broadphase.dirty=!0,c&&(d.integrate=zn.now()-v),this.time+=dt,this.stepnumber+=1,this.dispatchEvent(On),i=0;i!==n;i++){const e=o[i],t=e.postStep;t&&t.call(e)}let R=!0;if(this.allowSleep)for(R=!1,i=0;i!==n;i++){const e=o[i];e.sleepTick(this.time),e.sleepState!==L.SLEEPING&&(R=!0)}this.hasActiveBodies=R}clearForces(){const e=this.bodies,t=e.length;for(let i=0;i!==t;i++){const b=e[i];b.force,b.torque;b.force.set(0,0,0),b.torque.set(0,0,0)}}}new d;const kn=new ne,zn=globalThis.performance||{};if(!zn.now){let e=Date.now();zn.timing&&zn.timing.navigationStart&&(e=zn.timing.navigationStart),zn.now=()=>Date.now()-e}const On={type:"postStep"},Dn={type:"preStep"},Nn={type:L.COLLIDE_EVENT_NAME,body:null,contact:null},Gn=[],jn=[],Vn=[],qn=[];Ln.prototype.emitContactEvents=(()=>{const e=[],t=[],r={type:"beginContact",bodyA:null,bodyB:null},n={type:"endContact",bodyA:null,bodyB:null},o={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},l={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};return function(){const h=this.hasAnyEventListener("beginContact"),c=this.hasAnyEventListener("endContact");if((h||c)&&this.bodyOverlapKeeper.getDiff(e,t),h){for(let i=0,t=e.length;i<t;i+=2)r.bodyA=this.getBodyById(e[i]),r.bodyB=this.getBodyById(e[i+1]),this.dispatchEvent(r);r.bodyA=r.bodyB=null}if(c){for(let i=0,e=t.length;i<e;i+=2)n.bodyA=this.getBodyById(t[i]),n.bodyB=this.getBodyById(t[i+1]),this.dispatchEvent(n);n.bodyA=n.bodyB=null}e.length=t.length=0;const d=this.hasAnyEventListener("beginShapeContact"),f=this.hasAnyEventListener("endShapeContact");if((d||f)&&this.shapeOverlapKeeper.getDiff(e,t),d){for(let i=0,t=e.length;i<t;i+=2){const t=this.getShapeById(e[i]),r=this.getShapeById(e[i+1]);o.shapeA=t,o.shapeB=r,o.bodyA=t.body,o.bodyB=r.body,this.dispatchEvent(o)}o.bodyA=o.bodyB=o.shapeA=o.shapeB=null}if(f){for(let i=0,e=t.length;i<e;i+=2){const e=this.getShapeById(t[i]),r=this.getShapeById(t[i+1]);l.shapeA=e,l.shapeB=r,l.bodyA=e.body,l.bodyB=r.body,this.dispatchEvent(l)}l.bodyA=l.bodyB=l.shapeA=l.shapeB=null}}})()},390:function(e,t,r){"use strict";function n(e,t,r){return Math.min(t,Math.max(e,r))}r.d(t,"a",(function(){return n}))},391:function(e,t,r){!function(e){"use strict";function t(){var e,r=0,n=[],o=0,l=0,h=x((function(e){l||d(1,e)})),c=x((function(e){l||d(-1,e)}));function d(t,n){l++;var o=0;try{n===T&&w();var h=t>0&&y(n);h?h.call(n,x((function(e){o++,d(1,e)})),x((function(e){o++,d(-1,e)}))):(r=t,e=n,f())}catch(e){r||o||d(-1,e)}}function f(){o||(setTimeout(v,0),o=1)}function v(){var q=n;o=0,n=[],q.forEach(m)}function m(e){e()}function y(e){var t=e&&(S(e)||"object"==typeof e)&&e.then;return S(t)&&t}function x(e){var t=0;return function(){for(var r=[],n=arguments.length;n--;)r[n]=arguments[n];t++||e.apply(this,r)}}function w(){throw new TypeError("Chaining cycle detected")}var S=function(e){return"function"==typeof e},T={then:function(o,l){var h=t();return n.push((function(){var t=r>0?o:l;if(S(t))try{var n=t(e);n===h&&w();var c=y(n);c?c.call(n,h.resolve,h.reject):h.resolve(n)}catch(e){h.reject(e)}else h[r>0?"resolve":"reject"](e)})),r&&f(),h},resolve:h,reject:c};return T}function r(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return{then:r.then.bind(r),resolve:e,reject:t}}t.all=r.all=function(e){var t=0,r=[],o=n();return 0===e.length?o.resolve([]):e.forEach((function(l,i){var h=n();h.resolve(l),h.then((function(n){t++,r[i]=n,t===e.length&&o.resolve(r)}),o.reject)})),o};var n="function"==typeof Promise?r:t;function o(){var e=Object.create(null);function t(e,t){var r=void 0;self.troikaDefine=function(e){return r=e};var n=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(n)}catch(e){console.error(e)}return URL.revokeObjectURL(n),delete self.troikaDefine,r}self.addEventListener("message",(function(r){var n=r.data,o=n.messageId,l=n.action,data=n.data;try{"registerModule"===l&&function r(n,o){var l=n.id,h=n.name,c=n.dependencies;void 0===c&&(c=[]);var d=n.init;void 0===d&&(d=function(){});var f=n.getTransferables;if(void 0===f&&(f=null),!e[l])try{c=c.map((function(t){return t&&t.isWorkerModule&&(r(t,(function(e){if(e instanceof Error)throw e})),t=e[t.id].value),t})),d=t("<"+h+">.init",d),f&&(f=t("<"+h+">.getTransferables",f));var v=null;"function"==typeof d?v=d.apply(void 0,c):console.error("worker module init function failed to rehydrate"),e[l]={id:l,value:v,getTransferables:f},o(v)}catch(e){e&&e.noLog||console.error(e),o(e)}}(data,(function(e){e instanceof Error?postMessage({messageId:o,success:!1,error:e.message}):postMessage({messageId:o,success:!0,result:{isCallable:"function"==typeof e}})})),"callModule"===l&&function(t,r){var n,o=t.id,l=t.args;e[o]&&"function"==typeof e[o].value||r(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var h=(n=e[o]).value.apply(n,l);h&&"function"==typeof h.then?h.then(c,(function(e){return r(e instanceof Error?e:new Error(""+e))})):c(h)}catch(e){r(e)}function c(t){try{var n=e[o].getTransferables&&e[o].getTransferables(t);n&&Array.isArray(n)&&n.length||(n=void 0),r(t,n)}catch(e){console.error(e),r(e)}}}(data,(function(e,t){e instanceof Error?postMessage({messageId:o,success:!1,error:e.message}):postMessage({messageId:o,success:!0,result:e},t||void 0)}))}catch(e){postMessage({messageId:o,success:!1,error:e.stack})}}))}var l=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+e.message+"]")}return l=function(){return e},e},h=0,c=0,d=!1,f=Object.create(null),v=Object.create(null);function m(e){if(!(e&&"function"==typeof e.init||d))throw new Error("requires `options.init` function");var t=e.dependencies,r=e.init,o=e.getTransferables,c=e.workerId;if(!l())return function(e){var t=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return t._getInitResult().then((function(t){if("function"==typeof t)return t.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return t._getInitResult=function(){var r=e.dependencies,o=e.init;r=Array.isArray(r)?r.map((function(e){return e&&e._getInitResult?e._getInitResult():e})):[];var l=n.all(r).then((function(e){return o.apply(null,e)}));return t._getInitResult=function(){return l},l},t}(e);null==c&&(c="#default");var f="workerModule"+ ++h,v=e.name||f,w=null;function S(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return w||(w=x(c,"registerModule",S.workerModuleData)),w.then((function(t){if(t.isCallable)return x(c,"callModule",{id:f,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return t=t&&t.map((function(e){return"function"!=typeof e||e.workerModuleData||(d=!0,e=m({workerId:c,name:"<"+v+"> function dependency: "+e.name,init:"function(){return (\n"+y(e)+"\n)}"}),d=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e})),S.workerModuleData={isWorkerModule:!0,id:f,name:v,dependencies:t,init:y(r),getTransferables:o&&y(o)},S}function y(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function x(e,t,data){var r=n(),l=++c;return v[l]=function(e){e.success?r.resolve(e.result):r.reject(new Error("Error in worker "+t+" call: "+e.error))},v._count++,v.count>1e3&&console.warn("Large number of open WorkerModule requests, some may not be returning"),function(e){var t=f[e];if(!t){var r=y(o);(t=f[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,r=t.messageId,n=v[r];if(!n)throw new Error("WorkerModule response with empty or unknown messageId");delete v[r],v.count--,n(t)}}return t}(e).postMessage({messageId:l,action:t,data:data}),r}v._count=0;var w=m({name:"Thenable",dependencies:[n],init:function(e){return e}});e.Thenable=n,e.ThenableWorkerModule=w,e.defineWorkerModule=m,e.stringifyFunction=y,Object.defineProperty(e,"__esModule",{value:!0})}(t)},392:function(e,t,r){!function(e,t){"use strict";var r=/\bvoid\s+main\s*\(\s*\)\s*{/g;function n(source){return source.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(e,r){var o=t.ShaderChunk[r];return o?n(o):e}))}var o=Object.assign||function(){for(var e=arguments,t=arguments[0],i=1,r=arguments.length;i<r;i++){var source=e[i];if(source)for(var n in source)source.hasOwnProperty(n)&&(t[n]=source[n])}return t},l=Date.now(),h=new WeakMap;function c(e,r){var y=function(e){return JSON.stringify(e,f)}(r),x=h.get(e);if(x||(x=Object.create(null),h.set(e,x)),x[y])return x[y].clone();var w,S,T=function(e){var t=m.get(e);return null==t&&m.set(e,t=++v),t}(y),M="_derivedShaders"+T,A="_onBeforeCompile"+T;function _(t){e.onBeforeCompile.call(this,t);var h=this[M]||(this[M]={vertex:{},fragment:{}}),c=h.vertex,f=h.fragment;if(c.source!==t.vertexShader||f.source!==t.fragmentShader){var v=function(e,t,r){var o=e.vertexShader,l=e.fragmentShader,h=t.vertexDefs,c=t.vertexMainIntro,f=t.vertexMainOutro,v=t.vertexTransform,m=t.fragmentDefs,y=t.fragmentMainIntro,x=t.fragmentMainOutro,w=t.fragmentColorTransform,S=t.customRewriter,T=t.timeUniform;if(h=h||"",c=c||"",f=f||"",m=m||"",y=y||"",x=x||"",(v||S)&&(o=n(o)),(w||S)&&(l=n(l=l.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n"))),S){var M=S({vertexShader:o,fragmentShader:l});o=M.vertexShader,l=M.fragmentShader}if(w){var A=[];l=l.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,(function(e){return A.push(e),""})),x=w+"\n"+A.join("\n")+"\n"+x}if(T){var code="\nuniform float "+T+";\n";h=code+h,m=code+m}return v&&(h=h+"\nvec3 troika_position_"+r+";\nvec3 troika_normal_"+r+";\nvec2 troika_uv_"+r+";\nvoid troikaVertexTransform"+r+"(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  "+v+"\n}\n",c="\ntroika_position_"+r+" = vec3(position);\ntroika_normal_"+r+" = vec3(normal);\ntroika_uv_"+r+" = vec2(uv);\ntroikaVertexTransform"+r+"(troika_position_"+r+", troika_normal_"+r+", troika_uv_"+r+");\n"+c+"\n",o=o.replace(/\b(position|normal|uv)\b/g,(function(e,t,n,o){return/\battribute\s+vec[23]\s+$/.test(o.substr(0,n))?t:"troika_"+t+"_"+r}))),o=d(o,r,h,c,f),l=d(l,r,m,y,x),{vertexShader:o,fragmentShader:l}}(t,r,T);c.source=t.vertexShader,c.result=v.vertexShader,f.source=t.fragmentShader,f.result=v.fragmentShader}t.vertexShader=c.result,t.fragmentShader=f.result,o(t.uniforms,this.uniforms),r.timeUniform&&(t.uniforms[r.timeUniform]={get value(){return Date.now()-l}}),this[A]&&this[A](t)}function U(){e.constructor.apply(this,arguments),this._listeners=void 0}U.prototype=Object.create(e,{constructor:{value:U},isDerivedMaterial:{value:!0},baseMaterial:{value:e},onBeforeCompile:{get:function(){return _},set:function(e){this[A]=e}},copy:{value:function(source){return e.copy.call(this,source),e.isShaderMaterial||e.isDerivedMaterial||(this.extensions=o({},source.extensions),this.defines=o({},source.defines),this.uniforms=t.UniformsUtils.clone(source.uniforms)),this}},getDepthMaterial:{value:function(){var n=this._depthMaterial;return n||(S||((S=c(e.isDerivedMaterial?e.getDepthMaterial():new t.MeshDepthMaterial({depthPacking:t.RGBADepthPacking}),r)).defines.IS_DEPTH_MATERIAL=""),(n=this._depthMaterial=S.clone()).uniforms=this.uniforms),n}},getDistanceMaterial:{value:function(){var n=this._distanceMaterial;return n||(w||((w=c(e.isDerivedMaterial?e.getDistanceMaterial():new t.MeshDistanceMaterial,r)).defines.IS_DISTANCE_MATERIAL=""),(n=this._distanceMaterial=w.clone()).uniforms=this.uniforms),n}},dispose:{value:function(){var t=this._depthMaterial,r=this._distanceMaterial;t&&t.dispose(),r&&r.dispose(),e.dispose.call(this)}}});var E=new U;return E.copy(e),E.uniforms=o(t.UniformsUtils.clone(e.uniforms||{}),r.uniforms),E.defines=o({},e.defines,r.defines),E.defines["TROIKA_DERIVED_MATERIAL_"+T]="",E.extensions=o({},e.extensions,r.extensions),x[y]=E,E.clone()}function d(e,t,defs,n,o){return(n||o||defs)&&(e=e.replace(r,"\n"+defs+"\nvoid troikaOrigMain"+t+"() {"),e+="\nvoid main() {\n  "+n+"\n  troikaOrigMain"+t+"();\n  "+o+"\n}"),e}function f(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}var v=0,m=new Map,y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},x=function(e){this.name=e,this.textureUniform="dataTex_"+e,this.textureSizeUniform="dataTexSize_"+e,this.multiplierUniform="dataMultiplier_"+e,this.dataSizeUniform="dataSize_"+e,this.readFunction="readData_"+e,this._raw=new Float32Array(0),this._texture=new t.DataTexture(new Uint8Array(0),0,1),this._length=0,this._multiplier=1},w={length:{configurable:!0}};function S(e,t,r){var n=255*e,o=n%1*255,l=o%1*255,h=l%1*255;return n&=255,o&=255,l&=255,h=255&Math.round(h),t[r]=n,t[r+1]=o,t[r+2]=l,t[r+3]=h,t}w.length.set=function(e){if(e!==this._length){var t=Math.pow(2,Math.ceil(Math.log2(e))),r=this._raw;t<r.length?this._raw=r.subarray(0,t):t>r.length&&(this._raw=new Float32Array(t),this._raw.set(r)),this._length=e}},w.length.get=function(){return this._length},x.prototype.push=function(e){return this.set(this.length++,e)},x.prototype.setArray=function(e){this.length=e.length,this._raw.set(e),this._needsRepack=!0},x.prototype.get=function(e){return this._raw[e]},x.prototype.set=function(e,t){e+1>this._length&&(this.length=e+1),t!==this._raw[e]&&(this._raw[e]=t,S(t/this._multiplier,this._texture.image.data,4*e),this._needsMultCheck=!0)},x.prototype.clone=function(){var e=new x(this.name);return e.setArray(this._raw),e},x.prototype.getShaderUniforms=function(){var e,t=this;return(e={})[this.textureUniform]={get value(){return t._sync(),t._texture}},e[this.textureSizeUniform]={get value(){return t._sync(),t._texture.image.width}},e[this.dataSizeUniform]={get value(){return t._sync(),t.length}},e[this.multiplierUniform]={get value(){return t._sync(),t._multiplier}},e},x.prototype.getShaderHeaderCode=function(){var e=this.textureUniform,t=this.textureSizeUniform,r=this.dataSizeUniform,n=this.multiplierUniform;return"\nuniform sampler2D "+e+";\nuniform float "+t+";\nuniform float "+r+";\nuniform float "+n+";\n\nfloat "+this.readFunction+"(float index) {\n  vec2 texUV = vec2((index + 0.5) / "+t+", 0.5);\n  vec4 pixel = texture2D("+e+", texUV);\n  return dot(pixel, 1.0 / vec4(1.0, 255.0, 65025.0, 16581375.0)) * "+n+";\n}\n"},x.prototype._sync=function(){var e=this._texture,t=this._raw,r=this._needsRepack;if(t.length!==e.image.width&&(e.image={data:new Uint8Array(4*t.length),width:t.length,height:1},r=!0),r||this._needsMultCheck){var n=this._raw.reduce((function(a,b){return Math.max(a,b)}),0),o=Math.pow(2,Math.ceil(Math.log2(n)));o!==this._multiplier&&(this._multiplier=o,r=!0),e.needsUpdate=!0,this._needsMultCheck=!1}if(r){for(var i=0,l=t.length,h=this._multiplier;i<l;i++)S(t[i]/h,e.image.data,4*i);this._needsRepack=!1}},Object.defineProperties(x.prototype,w);var T=null,M=new t.MeshStandardMaterial({color:16777215,side:t.DoubleSide}),A=function(e){function r(){e.call(this,r.getGeometry(),M),this.pointA=new t.Vector3,this.controlA=new t.Vector3,this.controlB=new t.Vector3,this.pointB=new t.Vector3,this.radius=.01,this.dashArray=new t.Vector2,this.dashOffset=0,this.frustumCulled=!1}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var n={material:{configurable:!0},customDepthMaterial:{configurable:!0},customDistanceMaterial:{configurable:!0}};return r.getGeometry=function(){return T||(T=new t.CylinderBufferGeometry(1,1,1,6,64).translate(0,.5,0))},n.material.get=function(){var e=this._derivedMaterial,r=this._baseMaterial||M;return e&&e.baseMaterial===r||(e=this._derivedMaterial=function(e){return c(e,{uniforms:{pointA:{value:new t.Vector3},controlA:{value:new t.Vector3},controlB:{value:new t.Vector3},pointB:{value:new t.Vector3},radius:{value:.01},dashing:{value:new t.Vector3}},vertexDefs:"\nuniform vec3 pointA;\nuniform vec3 controlA;\nuniform vec3 controlB;\nuniform vec3 pointB;\nuniform float radius;\nvarying float bezierT;\n\nvec3 cubicBezier(vec3 p1, vec3 c1, vec3 c2, vec3 p2, float t) {\n  float t2 = 1.0 - t;\n  float b0 = t2 * t2 * t2;\n  float b1 = 3.0 * t * t2 * t2;\n  float b2 = 3.0 * t * t * t2;\n  float b3 = t * t * t;\n  return b0 * p1 + b1 * c1 + b2 * c2 + b3 * p2;\n}\n\nvec3 cubicBezierDerivative(vec3 p1, vec3 c1, vec3 c2, vec3 p2, float t) {\n  float t2 = 1.0 - t;\n  return -3.0 * p1 * t2 * t2 +\n    c1 * (3.0 * t2 * t2 - 6.0 * t2 * t) +\n    c2 * (6.0 * t2 * t - 3.0 * t * t) +\n    3.0 * p2 * t * t;\n}\n",vertexTransform:'\nfloat t = position.y;\nbezierT = t;\nvec3 bezierCenterPos = cubicBezier(pointA, controlA, controlB, pointB, t);\nvec3 bezierDir = normalize(cubicBezierDerivative(pointA, controlA, controlB, pointB, t));\n\n// Make "sideways" always perpendicular to the camera ray; this ensures that any twists\n// in the cylinder occur where you won\'t see them: \nvec3 viewDirection = normalMatrix * vec3(0.0, 0.0, 1.0);\nif (bezierDir == viewDirection) {\n  bezierDir = normalize(cubicBezierDerivative(pointA, controlA, controlB, pointB, t == 1.0 ? t - 0.0001 : t + 0.0001));\n}\nvec3 sideways = normalize(cross(bezierDir, viewDirection));\nvec3 upish = normalize(cross(sideways, bezierDir));\n\n// Build a matrix for transforming this disc in the cylinder:\nmat4 discTx;\ndiscTx[0].xyz = sideways * radius;\ndiscTx[1].xyz = bezierDir * radius;\ndiscTx[2].xyz = upish * radius;\ndiscTx[3].xyz = bezierCenterPos;\ndiscTx[3][3] = 1.0;\n\n// Apply transform, ignoring original y\nposition = (discTx * vec4(position.x, 0.0, position.z, 1.0)).xyz;\nnormal = normalize(mat3(discTx) * normal);\n',fragmentDefs:"\nuniform vec3 dashing;\nvarying float bezierT;\n",fragmentMainIntro:"\nif (dashing.x + dashing.y > 0.0) {\n  float dashFrac = mod(bezierT - dashing.z, dashing.x + dashing.y);\n  if (dashFrac > dashing.x) {\n    discard;\n  }\n}\n"})}(r),r.addEventListener("dispose",(function t(){r.removeEventListener("dispose",t),e.dispose()}))),e},n.material.set=function(e){this._baseMaterial=e},n.customDepthMaterial.get=function(){return this.material.getDepthMaterial()},n.customDistanceMaterial.get=function(){return this.material.getDistanceMaterial()},r.prototype.onBeforeRender=function(e){var t=this.material.uniforms,r=this.pointA,n=this.controlA,o=this.controlB,l=this.pointB,h=this.radius,c=this.dashArray,d=this.dashOffset;t.pointA.value.copy(r),t.controlA.value.copy(n),t.controlB.value.copy(o),t.pointB.value.copy(l),t.radius.value=h,t.dashing.value.set(c.x,c.y,d||0)},r.prototype.raycast=function(e,t){},Object.defineProperties(r.prototype,n),r}(t.Mesh);e.BezierMesh=A,e.ShaderFloatArray=x,e.createDerivedMaterial=c,e.expandShaderIncludes=n,e.getShaderUniformTypes=function(e){for(var t,r=/\buniform\s+(int|float|vec[234])\s+([A-Za-z_][\w]*)/g,n=Object.create(null);null!==(t=r.exec(e));)n[t[2]]=t[1];return n},e.getShadersForMaterial=function(e){var r=y[e.type];return r?t.ShaderLib[r]:e},e.voidMainRegExp=r,Object.defineProperty(e,"__esModule",{value:!0})}(t,r(18))},393:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(18),o=function(e){n.Loader.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};o.prototype=Object.assign(Object.create(n.Loader.prototype),{constructor:o,setDecoderPath:function(path){return this.decoderPath=path,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,r,o){var l=new n.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),"use-credentials"===this.crossOrigin&&l.setWithCredentials(!0),l.load(e,e=>{var r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,r).then(t).catch(o)},r,o)},decodeDracoFile:function(e,t,r,n){var o={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,o).then(t)},decodeGeometry:function(e,t){for(var r in t.attributeTypes){var n=t.attributeTypes[r];void 0!==n.BYTES_PER_ELEMENT&&(t.attributeTypes[r]=n.name)}var l,h=JSON.stringify(t);if(o.taskCache.has(e)){var c=o.taskCache.get(e);if(c.key===h)return c.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var d=this.workerNextTaskID++,f=e.byteLength,v=this._getWorker(d,f).then(r=>(l=r,new Promise((r,n)=>{l._callbacks[d]={resolve:r,reject:n},l.postMessage({type:"decode",id:d,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return v.catch(()=>!0).then(()=>{l&&d&&this._releaseTask(l,d)}),o.taskCache.set(e,{key:h,promise:v}),v},_createGeometry:function(e){var t=new n.BufferGeometry;e.index&&t.setIndex(new n.BufferAttribute(e.index.array,1));for(var i=0;i<e.attributes.length;i++){var r=e.attributes[i],o=r.name,l=r.array,h=r.itemSize;t.setAttribute(o,new n.BufferAttribute(l,h))}return t},_loadLibrary:function(e,t){var r=new n.FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),new Promise((t,n)=>{r.load(e,t,void 0,n)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{var r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);var n=o.DRACOWorker.toString(),body=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([body]))}),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then(()=>{var r;this.workerPool.length<this.workerLimit?((r=new Worker(this.workerSourceURL))._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(r)):this.workerPool.sort((function(a,b){return a._taskLoad>b._taskLoad?-1:1}));return(r=this.workerPool[this.workerPool.length-1])._taskCosts[e]=t,r._taskLoad+=t,r})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))},dispose:function(){for(var i=0;i<this.workerPool.length;++i)this.workerPool[i].terminate();return this.workerPool.length=0,this}}),o.DRACOWorker=function(){var e,t;function r(e,t,r,n,o,l){var h,c,d=l.num_components(),f=r.num_points()*d;switch(o){case Float32Array:h=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(r,l,h),c=new Float32Array(f);break;case Int8Array:h=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(r,l,h),c=new Int8Array(f);break;case Int16Array:h=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(r,l,h),c=new Int16Array(f);break;case Int32Array:h=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(r,l,h),c=new Int32Array(f);break;case Uint8Array:h=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(r,l,h),c=new Uint8Array(f);break;case Uint16Array:h=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(r,l,h),c=new Uint16Array(f);break;case Uint32Array:h=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(r,l,h),c=new Uint32Array(f);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var i=0;i<f;i++)c[i]=h.GetValue(i);return e.destroy(h),{name:n,array:c,itemSize:d}}onmessage=function(n){var o=n.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var l=o.buffer,h=o.taskConfig;t.then(e=>{var t=e.draco,n=new t.Decoder,c=new t.DecoderBuffer;c.Init(new Int8Array(l),l.byteLength);try{var d=function(e,t,n,o){var l,h,c=o.attributeIDs,d=o.attributeTypes,f=t.GetEncodedGeometryType(n);if(f===e.TRIANGULAR_MESH)l=new e.Mesh,h=t.DecodeBufferToMesh(n,l);else{if(f!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");l=new e.PointCloud,h=t.DecodeBufferToPointCloud(n,l)}if(!h.ok()||0===l.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+h.error_msg());var v={index:null,attributes:[]};for(var m in c){var y,x,w=self[d[m]];if(o.useUniqueIDs)x=c[m],y=t.GetAttributeByUniqueId(l,x);else{if(-1===(x=t.GetAttributeId(l,e[c[m]])))continue;y=t.GetAttribute(l,x)}v.attributes.push(r(e,t,l,m,w,y))}if(f===e.TRIANGULAR_MESH){for(var S=l.num_faces(),T=new Uint32Array(3*S),M=new e.DracoInt32Array,i=0;i<S;++i){t.GetFaceFromMesh(l,i,M);for(var A=0;A<3;++A)T[3*i+A]=M.GetValue(A)}v.index={array:T,itemSize:1},e.destroy(M)}return e.destroy(l),v}(t,n,c,h),f=d.attributes.map(e=>e.array.buffer);d.index&&f.push(d.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:d},f)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}finally{t.destroy(c),t.destroy(n)}})}}},o.taskCache=new WeakMap,o.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},o.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},o.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},o.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")}},394:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(18),o=function(){function e(e){n.Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.pluginCallbacks=[],this.register((function(e){return new c(e)})),this.register((function(e){return new f(e)})),this.register((function(e){return new d(e)}))}function t(){var e={};return{get:function(t){return e[t]},add:function(t,object){e[t]=object},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(n.Loader.prototype),{constructor:e,load:function(e,t,r,o){var l,h=this;l=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:n.LoaderUtils.extractUrlBase(e),h.manager.itemStart(e);var c=function(t){o?o(t):console.error(t),h.manager.itemError(e),h.manager.itemEnd(e)},d=new n.FileLoader(h.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),"use-credentials"===h.crossOrigin&&d.setWithCredentials(!0),d.load(e,(function(data){try{h.parse(data,l,(function(r){t(r),h.manager.itemEnd(e)}),c)}catch(e){c(e)}}),r,c)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(data,path,e,t){var content,c={},d={};if("string"==typeof data)content=data;else if(n.LoaderUtils.decodeText(new Uint8Array(data,0,4))===v){try{c[r.KHR_BINARY_GLTF]=new x(data)}catch(e){return void(t&&t(e))}content=c[r.KHR_BINARY_GLTF].content}else content=n.LoaderUtils.decodeText(new Uint8Array(data));var f=JSON.parse(content);if(void 0===f.asset||f.asset.version[0]<2)t&&t(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var m=new Z(f,{path:path||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader});m.fileLoader.setRequestHeader(this.requestHeader);for(var i=0;i<this.pluginCallbacks.length;i++){var y=this.pluginCallbacks[i](m);d[y.name]=y,c[y.name]=!0}if(f.extensionsUsed)for(i=0;i<f.extensionsUsed.length;++i){var T=f.extensionsUsed[i],_=f.extensionsRequired||[];switch(T){case r.KHR_LIGHTS_PUNCTUAL:c[T]=new l(f);break;case r.KHR_MATERIALS_UNLIT:c[T]=new h;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:c[T]=new M;break;case r.KHR_DRACO_MESH_COMPRESSION:c[T]=new w(f,this.dracoLoader);break;case r.MSFT_TEXTURE_DDS:c[T]=new o(this.ddsLoader);break;case r.KHR_TEXTURE_TRANSFORM:c[T]=new S;break;case r.KHR_MESH_QUANTIZATION:c[T]=new A;break;default:_.indexOf(T)>=0&&void 0===d[T]&&console.warn('THREE.GLTFLoader: Unknown extension "'+T+'".')}}m.setExtensions(c),m.setPlugins(d),m.parse(e,t)}}});var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function o(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=r.MSFT_TEXTURE_DDS,this.ddsLoader=e}function l(e){this.name=r.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[r.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function h(){this.name=r.KHR_MATERIALS_UNLIT}function c(e){this.parser=e,this.name=r.KHR_MATERIALS_CLEARCOAT}function d(e){this.parser=e,this.name=r.KHR_MATERIALS_TRANSMISSION}function f(e){this.parser=e,this.name=r.KHR_TEXTURE_BASISU}l.prototype.loadLight=function(e){var t,r=this.lightDefs[e],o=new n.Color(16777215);void 0!==r.color&&o.fromArray(r.color);var l=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new n.DirectionalLight(o)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new n.PointLight(o)).distance=l;break;case"spot":(t=new n.SpotLight(o)).distance=l,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},h.prototype.getMaterialType=function(){return n.MeshBasicMaterial},h.prototype.extendParams=function(e,t,r){var o=[];e.color=new n.Color(1,1,1),e.opacity=1;var l=t.pbrMetallicRoughness;if(l){if(Array.isArray(l.baseColorFactor)){var h=l.baseColorFactor;e.color.fromArray(h),e.opacity=h[3]}void 0!==l.baseColorTexture&&o.push(r.assignTexture(e,"map",l.baseColorTexture))}return Promise.all(o)},c.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null},c.prototype.extendMaterialParams=function(e,t){var r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();var l=[],h=o.extensions[this.name];if(void 0!==h.clearcoatFactor&&(t.clearcoat=h.clearcoatFactor),void 0!==h.clearcoatTexture&&l.push(r.assignTexture(t,"clearcoatMap",h.clearcoatTexture)),void 0!==h.clearcoatRoughnessFactor&&(t.clearcoatRoughness=h.clearcoatRoughnessFactor),void 0!==h.clearcoatRoughnessTexture&&l.push(r.assignTexture(t,"clearcoatRoughnessMap",h.clearcoatRoughnessTexture)),void 0!==h.clearcoatNormalTexture&&(l.push(r.assignTexture(t,"clearcoatNormalMap",h.clearcoatNormalTexture)),void 0!==h.clearcoatNormalTexture.scale)){var c=h.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new n.Vector2(c,c)}return Promise.all(l)},d.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null},d.prototype.extendMaterialParams=function(e,t){var r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var o=[],l=n.extensions[this.name];return void 0!==l.transmissionFactor&&(t.transmission=l.transmissionFactor),void 0!==l.transmissionTexture&&o.push(r.assignTexture(t,"transmissionMap",l.transmissionTexture)),Promise.all(o)},f.prototype.loadTexture=function(e){var t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;var o=n.extensions[this.name],source=r.images[o.source],l=t.options.ktx2Loader;if(!l)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return t.loadTextureImage(e,source,l)};var v="glTF",m=1313821514,y=5130562;function x(data){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var e=new DataView(data,0,12);if(this.header={magic:n.LoaderUtils.decodeText(new Uint8Array(data.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==v)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var t=new DataView(data,12),o=0;o<t.byteLength;){var l=t.getUint32(o,!0);o+=4;var h=t.getUint32(o,!0);if(o+=4,h===m){var c=new Uint8Array(data,12+o,l);this.content=n.LoaderUtils.decodeText(c)}else if(h===y){var d=12+o;this.body=data.slice(d,d+l)}o+=l}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function w(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function S(){this.name=r.KHR_TEXTURE_TRANSFORM}function T(e){n.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),l=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),h=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),c={specular:{value:(new n.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=c,this.onBeforeCompile=function(e){for(var n in c)e.uniforms[n]=c[n];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",t),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",r),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",o),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",l),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",h)},Object.defineProperties(this,{specular:{get:function(){return c.specular.value},set:function(e){c.specular.value=e}},specularMap:{get:function(){return c.specularMap.value},set:function(e){c.specularMap.value=e}},glossiness:{get:function(){return c.glossiness.value},set:function(e){c.glossiness.value=e}},glossinessMap:{get:function(){return c.glossinessMap.value},set:function(e){c.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function M(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return T},extendParams:function(e,t,r){var o=t.extensions[this.name];e.color=new n.Color(1,1,1),e.opacity=1;var l=[];if(Array.isArray(o.diffuseFactor)){var h=o.diffuseFactor;e.color.fromArray(h),e.opacity=h[3]}if(void 0!==o.diffuseTexture&&l.push(r.assignTexture(e,"map",o.diffuseTexture)),e.emissive=new n.Color(0,0,0),e.glossiness=void 0!==o.glossinessFactor?o.glossinessFactor:1,e.specular=new n.Color(1,1,1),Array.isArray(o.specularFactor)&&e.specular.fromArray(o.specularFactor),void 0!==o.specularGlossinessTexture){var c=o.specularGlossinessTexture;l.push(r.assignTexture(e,"glossinessMap",c)),l.push(r.assignTexture(e,"specularMap",c))}return Promise.all(l)},createMaterial:function(e){var t=new T(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=n.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function A(){this.name=r.KHR_MESH_QUANTIZATION}function _(e,t,r,o){n.Interpolant.call(this,e,t,r,o)}w.prototype.decodePrimitive=function(e,t){var r=this.json,n=this.dracoLoader,o=e.extensions[this.name].bufferView,l=e.extensions[this.name].attributes,h={},c={},d={};for(var f in l){var v=O[f]||f.toLowerCase();h[v]=l[f]}for(f in e.attributes){v=O[f]||f.toLowerCase();if(void 0!==l[f]){var m=r.accessors[e.attributes[f]],y=I[m.componentType];d[v]=y,c[v]=!0===m.normalized}}return t.getDependency("bufferView",o).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(var r in e.attributes){var n=e.attributes[r],o=c[r];void 0!==o&&(n.normalized=o)}t(e)}),h,d)}))}))},S.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},T.prototype=Object.create(n.MeshStandardMaterial.prototype),T.prototype.constructor=T,T.prototype.copy=function(source){return n.MeshStandardMaterial.prototype.copy.call(this,source),this.specularMap=source.specularMap,this.specular.copy(source.specular),this.glossinessMap=source.glossinessMap,this.glossiness=source.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},_.prototype=Object.create(n.Interpolant.prototype),_.prototype.constructor=_,_.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,o=e*n*3+n,i=0;i!==n;i++)t[i]=r[o+i];return t},_.prototype.beforeStart_=_.prototype.copySampleValue_,_.prototype.afterEnd_=_.prototype.copySampleValue_,_.prototype.interpolate_=function(e,t,r,n){for(var o=this.resultBuffer,l=this.sampleValues,h=this.valueSize,c=2*h,d=3*h,td=n-t,p=(r-t)/td,f=p*p,v=f*p,m=e*d,y=m-d,x=-2*v+3*f,w=v-f,S=1-x,T=w-f+p,i=0;i!==h;i++){var M=l[y+i+h],A=l[y+i+c]*td,_=l[m+i+h],U=l[m+i]*td;o[i]=S*M+T*A+x*_+w*U}return o};var U=0,E=1,C=2,F=3,R=4,B=5,P=6,I={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},L={9728:n.NearestFilter,9729:n.LinearFilter,9984:n.NearestMipmapNearestFilter,9985:n.LinearMipmapNearestFilter,9986:n.NearestMipmapLinearFilter,9987:n.LinearMipmapLinearFilter},k={33071:n.ClampToEdgeWrapping,33648:n.MirroredRepeatWrapping,10497:n.RepeatWrapping},z={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},O={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},D={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},N={CUBICSPLINE:void 0,LINEAR:n.InterpolateLinear,STEP:n.InterpolateDiscrete},G="OPAQUE",j="MASK",V="BLEND";function H(e,path){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(path)&&/^\//.test(e)&&(path=path.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:path+e)}function W(e,object,t){for(var r in t.extensions)void 0===e[r]&&(object.userData.gltfExtensions=object.userData.gltfExtensions||{},object.userData.gltfExtensions[r]=t.extensions[r])}function X(object,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(object.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function K(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(i=0,r=n.length;i<r;i++)e.morphTargetDictionary[n[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Y(e){for(var t="",r=Object.keys(e).sort(),i=0,n=r.length;i<n;i++)t+=r[i]+":"+e[r[i]]+";";return t}function Z(e,r){this.json=e||{},this.extensions={},this.plugins={},this.options=r||{},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new n.ImageBitmapLoader(this.options.manager):this.textureLoader=new n.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new n.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function Q(e,t,r){var o=t.attributes,l=[];function h(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(var c in o){var d=O[c]||c.toLowerCase();d in e.attributes||l.push(h(o[c],d))}if(void 0!==t.indices&&!e.index){var f=r.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));l.push(f)}return X(e,t),function(e,t,r){var o=t.attributes,l=new n.Box3;if(void 0!==o.POSITION){var h=(x=r.json.accessors[o.POSITION]).min,c=x.max;if(void 0!==h&&void 0!==c){l.set(new n.Vector3(h[0],h[1],h[2]),new n.Vector3(c[0],c[1],c[2]));var d=t.targets;if(void 0!==d){for(var f=new n.Vector3,v=new n.Vector3,i=0,m=d.length;i<m;i++){var y=d[i];if(void 0!==y.POSITION){var x;h=(x=r.json.accessors[y.POSITION]).min,c=x.max;void 0!==h&&void 0!==c?(v.setX(Math.max(Math.abs(h[0]),Math.abs(c[0]))),v.setY(Math.max(Math.abs(h[1]),Math.abs(c[1]))),v.setZ(Math.max(Math.abs(h[2]),Math.abs(c[2]))),f.max(v)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}l.expandByVector(f)}e.boundingBox=l;var w=new n.Sphere;l.getCenter(w.center),w.radius=l.min.distanceTo(l.max)/2,e.boundingSphere=w}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,r),Promise.all(l).then((function(){return void 0!==t.targets?function(e,t,r){for(var n=!1,o=!1,i=0,l=t.length;i<l;i++){if(void 0!==(d=t[i]).POSITION&&(n=!0),void 0!==d.NORMAL&&(o=!0),n&&o)break}if(!n&&!o)return Promise.resolve(e);var h=[],c=[];for(i=0,l=t.length;i<l;i++){var d=t[i];if(n){var f=void 0!==d.POSITION?r.getDependency("accessor",d.POSITION):e.attributes.position;h.push(f)}if(o){f=void 0!==d.NORMAL?r.getDependency("accessor",d.NORMAL):e.attributes.normal;c.push(f)}}return Promise.all([Promise.all(h),Promise.all(c)]).then((function(t){var r=t[0],l=t[1];return n&&(e.morphAttributes.position=r),o&&(e.morphAttributes.normal=l),e.morphTargetsRelative=!0,e}))}(e,t.targets,r):e}))}function $(e,t){var r=e.getIndex();if(null===r){var o=[],l=e.getAttribute("position");if(void 0===l)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<l.count;i++)o.push(i);e.setIndex(o),r=e.getIndex()}var h=r.count-2,c=[];if(t===n.TriangleFanDrawMode)for(i=1;i<=h;i++)c.push(r.getX(0)),c.push(r.getX(i)),c.push(r.getX(i+1));else for(i=0;i<h;i++)i%2==0?(c.push(r.getX(i)),c.push(r.getX(i+1)),c.push(r.getX(i+2))):(c.push(r.getX(i+2)),c.push(r.getX(i+1)),c.push(r.getX(i)));c.length/3!==h&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var d=e.clone();return d.setIndex(c),d}return Z.prototype.setExtensions=function(e){this.extensions=e},Z.prototype.setPlugins=function(e){this.plugins=e},Z.prototype.parse=function(e,t){var r=this,n=this.json,o=this.extensions;this.cache.removeAll(),this._markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var l={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};W(o,l,n),X(l,n),e(l)})).catch(t)},Z.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],o=0,l=t.length;o<l;o++)for(var h=t[o].joints,i=0,c=h.length;i<c;i++)e[h[i]].isBone=!0;for(var d=0,f=e.length;d<f;d++){var v=e[d];void 0!==v.mesh&&(this._addNodeRef(this.meshCache,v.mesh),void 0!==v.skin&&(n[v.mesh].isSkinnedMesh=!0)),void 0!==v.camera&&this._addNodeRef(this.cameraCache,v.camera),v.extensions&&v.extensions[r.KHR_LIGHTS_PUNCTUAL]&&void 0!==v.extensions[r.KHR_LIGHTS_PUNCTUAL].light&&this._addNodeRef(this.lightCache,v.extensions[r.KHR_LIGHTS_PUNCTUAL].light)}},Z.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},Z.prototype._getNodeRef=function(e,t,object){if(e.refs[t]<=1)return object;var r=object.clone();return r.name+="_instance_"+e.uses[t]++,r},Z.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var i=0;i<t.length;i++){var r=e(t[i]);if(r)return r}},Z.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var r=[],i=0;i<t.length;i++)r.push(e(t[i]));return Promise.all(r)},Z.prototype.getDependency=function(e,t){var n=e+":"+t,o=this.cache.get(n);if(!o){switch(e){case"scene":o=this.loadScene(t);break;case"node":o=this.loadNode(t);break;case"mesh":o=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":o=this.loadAccessor(t);break;case"bufferView":o=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":o=this.loadBuffer(t);break;case"material":o=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":o=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":o=this.loadSkin(t);break;case"animation":o=this.loadAnimation(t);break;case"camera":o=this.loadCamera(t);break;case"light":o=this.extensions[r.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,o)}return o},Z.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,defs=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(defs.map((function(t,n){return r.getDependency(e,n)}))),this.cache.add(e,t)}return t},Z.prototype.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var o=this.options;return new Promise((function(e,r){n.load(H(t.uri,o.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},Z.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)}))},Z.prototype.loadAccessor=function(e){var t=this,r=this.json,o=this.json.accessors[e];if(void 0===o.bufferView&&void 0===o.sparse)return Promise.resolve(null);var l=[];return void 0!==o.bufferView?l.push(this.getDependency("bufferView",o.bufferView)):l.push(null),void 0!==o.sparse&&(l.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),l.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(l).then((function(e){var l,h,c=e[0],d=z[o.type],f=I[o.componentType],v=f.BYTES_PER_ELEMENT,m=v*d,y=o.byteOffset||0,x=void 0!==o.bufferView?r.bufferViews[o.bufferView].byteStride:void 0,w=!0===o.normalized;if(x&&x!==m){var S=Math.floor(y/x),T="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+S+":"+o.count,M=t.cache.get(T);M||(l=new f(c,S*x,o.count*x/v),M=new n.InterleavedBuffer(l,x/v),t.cache.add(T,M)),h=new n.InterleavedBufferAttribute(M,d,y%x/v,w)}else l=null===c?new f(o.count*d):new f(c,y,o.count*d),h=new n.BufferAttribute(l,d,w);if(void 0!==o.sparse){var A=z.SCALAR,_=I[o.sparse.indices.componentType],U=o.sparse.indices.byteOffset||0,E=o.sparse.values.byteOffset||0,C=new _(e[1],U,o.sparse.count*A),F=new f(e[2],E,o.sparse.count*d);null!==c&&(h=new n.BufferAttribute(h.array.slice(),h.itemSize,h.normalized));for(var i=0,R=C.length;i<R;i++){var B=C[i];if(h.setX(B,F[i*d]),d>=2&&h.setY(B,F[i*d+1]),d>=3&&h.setZ(B,F[i*d+2]),d>=4&&h.setW(B,F[i*d+3]),d>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return h}))},Z.prototype.loadTexture=function(e){var source,t,n=this.json,o=this.options,l=n.textures[e],h=l.extensions||{};return(source=h[r.MSFT_TEXTURE_DDS]?n.images[h[r.MSFT_TEXTURE_DDS].source]:n.images[l.source]).uri&&(t=o.manager.getHandler(source.uri)),t||(t=h[r.MSFT_TEXTURE_DDS]?this.extensions[r.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(e,source,t)},Z.prototype.loadTextureImage=function(e,source,t){var r=this,o=this.json,l=this.options,h=o.textures[e],c=self.URL||self.webkitURL,d=source.uri,f=!1,v=!0;return"image/jpeg"===source.mimeType&&(v=!1),void 0!==source.bufferView&&(d=r.getDependency("bufferView",source.bufferView).then((function(e){"image/png"===source.mimeType&&(v=6===new DataView(e,25,1).getUint8(0,!1)),f=!0;var t=new Blob([e],{type:source.mimeType});return d=c.createObjectURL(t)}))),Promise.resolve(d).then((function(e){return new Promise((function(r,o){var h=r;!0===t.isImageBitmapLoader&&(h=function(e){r(new n.CanvasTexture(e))}),t.load(H(e,l.path),h,void 0,o)}))})).then((function(t){!0===f&&c.revokeObjectURL(d),t.flipY=!1,h.name&&(t.name=h.name),v||(t.format=n.RGBFormat);var l=(o.samplers||{})[h.sampler]||{};return t.magFilter=L[l.magFilter]||n.LinearFilter,t.minFilter=L[l.minFilter]||n.LinearMipmapLinearFilter,t.wrapS=k[l.wrapS]||n.RepeatWrapping,t.wrapT=k[l.wrapT]||n.RepeatWrapping,r.associations.set(t,{type:"textures",index:e}),t}))},Z.prototype.assignTexture=function(e,t,n){var o=this;return this.getDependency("texture",n.index).then((function(l){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),o.extensions[r.KHR_TEXTURE_TRANSFORM]){var h=void 0!==n.extensions?n.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;if(h){var c=o.associations.get(l);l=o.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(l,h),o.associations.set(l,c)}}e[t]=l}))},Z.prototype.assignFinalMaterial=function(e){var t=e.geometry,r=e.material,o=void 0!==t.attributes.tangent,l=void 0!==t.attributes.color,h=void 0===t.attributes.normal,c=!0===e.isSkinnedMesh,d=Object.keys(t.morphAttributes).length>0,f=d&&void 0!==t.morphAttributes.normal;if(e.isPoints){var v="PointsMaterial:"+r.uuid,m=this.cache.get(v);m||(m=new n.PointsMaterial,n.Material.prototype.copy.call(m,r),m.color.copy(r.color),m.map=r.map,m.sizeAttenuation=!1,this.cache.add(v,m)),r=m}else if(e.isLine){v="LineBasicMaterial:"+r.uuid;var y=this.cache.get(v);y||(y=new n.LineBasicMaterial,n.Material.prototype.copy.call(y,r),y.color.copy(r.color),this.cache.add(v,y)),r=y}if(o||l||h||c||d){v="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(v+="specular-glossiness:"),c&&(v+="skinning:"),o&&(v+="vertex-tangents:"),l&&(v+="vertex-colors:"),h&&(v+="flat-shading:"),d&&(v+="morph-targets:"),f&&(v+="morph-normals:");var x=this.cache.get(v);x||(x=r.clone(),c&&(x.skinning=!0),o&&(x.vertexTangents=!0),l&&(x.vertexColors=!0),h&&(x.flatShading=!0),d&&(x.morphTargets=!0),f&&(x.morphNormals=!0),this.cache.add(v,x),this.associations.set(x,this.associations.get(r))),r=x}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),r.normalScale&&!o&&(r.normalScale.y=-r.normalScale.y),r.clearcoatNormalScale&&!o&&(r.clearcoatNormalScale.y=-r.clearcoatNormalScale.y),e.material=r},Z.prototype.getMaterialType=function(){return n.MeshStandardMaterial},Z.prototype.loadMaterial=function(e){var t,o=this,l=this.json,h=this.extensions,c=l.materials[e],d={},f=c.extensions||{},v=[];if(f[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var m=h[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=m.getMaterialType(),v.push(m.extendParams(d,c,o))}else if(f[r.KHR_MATERIALS_UNLIT]){var y=h[r.KHR_MATERIALS_UNLIT];t=y.getMaterialType(),v.push(y.extendParams(d,c,o))}else{var x=c.pbrMetallicRoughness||{};if(d.color=new n.Color(1,1,1),d.opacity=1,Array.isArray(x.baseColorFactor)){var w=x.baseColorFactor;d.color.fromArray(w),d.opacity=w[3]}void 0!==x.baseColorTexture&&v.push(o.assignTexture(d,"map",x.baseColorTexture)),d.metalness=void 0!==x.metallicFactor?x.metallicFactor:1,d.roughness=void 0!==x.roughnessFactor?x.roughnessFactor:1,void 0!==x.metallicRoughnessTexture&&(v.push(o.assignTexture(d,"metalnessMap",x.metallicRoughnessTexture)),v.push(o.assignTexture(d,"roughnessMap",x.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),v.push(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,d)})))}!0===c.doubleSided&&(d.side=n.DoubleSide);var S=c.alphaMode||G;return S===V?(d.transparent=!0,d.depthWrite=!1):(d.transparent=!1,S===j&&(d.alphaTest=void 0!==c.alphaCutoff?c.alphaCutoff:.5)),void 0!==c.normalTexture&&t!==n.MeshBasicMaterial&&(v.push(o.assignTexture(d,"normalMap",c.normalTexture)),d.normalScale=new n.Vector2(1,1),void 0!==c.normalTexture.scale&&d.normalScale.set(c.normalTexture.scale,c.normalTexture.scale)),void 0!==c.occlusionTexture&&t!==n.MeshBasicMaterial&&(v.push(o.assignTexture(d,"aoMap",c.occlusionTexture)),void 0!==c.occlusionTexture.strength&&(d.aoMapIntensity=c.occlusionTexture.strength)),void 0!==c.emissiveFactor&&t!==n.MeshBasicMaterial&&(d.emissive=(new n.Color).fromArray(c.emissiveFactor)),void 0!==c.emissiveTexture&&t!==n.MeshBasicMaterial&&v.push(o.assignTexture(d,"emissiveMap",c.emissiveTexture)),Promise.all(v).then((function(){var l;return l=t===T?h[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(d):new t(d),c.name&&(l.name=c.name),l.map&&(l.map.encoding=n.sRGBEncoding),l.emissiveMap&&(l.emissiveMap.encoding=n.sRGBEncoding),X(l,c),o.associations.set(l,{type:"materials",index:e}),c.extensions&&W(h,l,c),l}))},Z.prototype.loadGeometries=function(e){var t=this,o=this.extensions,l=this.primitiveCache;function h(e){return o[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(r){return Q(r,e,t)}))}for(var c,d,f=[],i=0,v=e.length;i<v;i++){var m,y=e[i],x=(d=void 0,(d=(c=y).extensions&&c.extensions[r.KHR_DRACO_MESH_COMPRESSION])?"draco:"+d.bufferView+":"+d.indices+":"+Y(d.attributes):c.indices+":"+Y(c.attributes)+":"+c.mode),w=l[x];if(w)f.push(w.promise);else m=y.extensions&&y.extensions[r.KHR_DRACO_MESH_COMPRESSION]?h(y):Q(new n.BufferGeometry,y,t),l[x]={primitive:y,promise:m},f.push(m)}return Promise.all(f)},Z.prototype.loadMesh=function(e){for(var t,r=this,o=this.json.meshes[e],l=o.primitives,h=[],i=0,c=l.length;i<c;i++){var d=void 0===l[i].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new n.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.FrontSide})),t.DefaultMaterial):this.getDependency("material",l[i].material);h.push(d)}return h.push(r.loadGeometries(l)),Promise.all(h).then((function(t){for(var h=t.slice(0,t.length-1),c=t[t.length-1],d=[],i=0,f=c.length;i<f;i++){var v,m=c[i],y=l[i],x=h[i];if(y.mode===R||y.mode===B||y.mode===P||void 0===y.mode)!0!==(v=!0===o.isSkinnedMesh?new n.SkinnedMesh(m,x):new n.Mesh(m,x)).isSkinnedMesh||v.geometry.attributes.skinWeight.normalized||v.normalizeSkinWeights(),y.mode===B?v.geometry=$(v.geometry,n.TriangleStripDrawMode):y.mode===P&&(v.geometry=$(v.geometry,n.TriangleFanDrawMode));else if(y.mode===E)v=new n.LineSegments(m,x);else if(y.mode===F)v=new n.Line(m,x);else if(y.mode===C)v=new n.LineLoop(m,x);else{if(y.mode!==U)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);v=new n.Points(m,x)}Object.keys(v.geometry.morphAttributes).length>0&&K(v,o),v.name=o.name||"mesh_"+e,c.length>1&&(v.name+="_"+i),X(v,o),r.assignFinalMaterial(v),d.push(v)}if(1===d.length)return d[0];var w=new n.Group;for(i=0,f=d.length;i<f;i++)w.add(d[i]);return w}))},Z.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],o=r[r.type];if(o)return"perspective"===r.type?t=new n.PerspectiveCamera(n.MathUtils.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):"orthographic"===r.type&&(t=new n.OrthographicCamera(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),r.name&&(t.name=r.name),X(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},Z.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return r.inverseBindMatrices=e,r}))},Z.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],o=[],l=[],h=[],c=[],i=0,d=t.channels.length;i<d;i++){var f=t.channels[i],v=t.samplers[f.sampler],m=f.target,y=void 0!==m.node?m.node:m.id,input=void 0!==t.parameters?t.parameters[v.input]:v.input,output=void 0!==t.parameters?t.parameters[v.output]:v.output;r.push(this.getDependency("node",y)),o.push(this.getDependency("accessor",input)),l.push(this.getDependency("accessor",output)),h.push(v),c.push(m)}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(l),Promise.all(h),Promise.all(c)]).then((function(r){for(var o=r[0],l=r[1],h=r[2],c=r[3],d=r[4],f=[],i=0,v=o.length;i<v;i++){var m=o[i],y=l[i],x=h[i],w=c[i],S=d[i];if(void 0!==m){var T;switch(m.updateMatrix(),m.matrixAutoUpdate=!0,D[S.path]){case D.weights:T=n.NumberKeyframeTrack;break;case D.rotation:T=n.QuaternionKeyframeTrack;break;case D.position:case D.scale:default:T=n.VectorKeyframeTrack}var M=m.name?m.name:m.uuid,A=void 0!==w.interpolation?N[w.interpolation]:n.InterpolateLinear,U=[];D[S.path]===D.weights?m.traverse((function(object){!0===object.isMesh&&object.morphTargetInfluences&&U.push(object.name?object.name:object.uuid)})):U.push(M);var E=x.array;if(x.normalized){var C;if(E.constructor===Int8Array)C=1/127;else if(E.constructor===Uint8Array)C=1/255;else if(E.constructor==Int16Array)C=1/32767;else{if(E.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");C=1/65535}for(var F=new Float32Array(E.length),R=0,B=E.length;R<B;R++)F[R]=E[R]*C;E=F}for(R=0,B=U.length;R<B;R++){var track=new T(U[R]+"."+D[S.path],y.array,E,A);"CUBICSPLINE"===w.interpolation&&(track.createInterpolant=function(e){return new _(this.times,this.values,this.getValueSize()/3,e)},track.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),f.push(track)}}}var P=t.name?t.name:"animation_"+e;return new n.AnimationClip(P,void 0,f)}))},Z.prototype.loadNode=function(e){var t=this.json,o=this.extensions,l=this,h=t.nodes[e];return function(){var e=[];if(void 0!==h.mesh&&e.push(l.getDependency("mesh",h.mesh).then((function(e){var t=l._getNodeRef(l.meshCache,h.mesh,e);return void 0!==h.weights&&t.traverse((function(e){if(e.isMesh)for(var i=0,t=h.weights.length;i<t;i++)e.morphTargetInfluences[i]=h.weights[i]})),t}))),void 0!==h.camera&&e.push(l.getDependency("camera",h.camera).then((function(e){return l._getNodeRef(l.cameraCache,h.camera,e)}))),h.extensions&&h.extensions[r.KHR_LIGHTS_PUNCTUAL]&&void 0!==h.extensions[r.KHR_LIGHTS_PUNCTUAL].light){var t=h.extensions[r.KHR_LIGHTS_PUNCTUAL].light;e.push(l.getDependency("light",t).then((function(e){return l._getNodeRef(l.lightCache,t,e)})))}return Promise.all(e)}().then((function(t){var r;if((r=!0===h.isBone?new n.Bone:t.length>1?new n.Group:1===t.length?t[0]:new n.Object3D)!==t[0])for(var i=0,c=t.length;i<c;i++)r.add(t[i]);if(h.name&&(r.userData.name=h.name,r.name=n.PropertyBinding.sanitizeNodeName(h.name)),X(r,h),h.extensions&&W(o,r,h),void 0!==h.matrix){var d=new n.Matrix4;d.fromArray(h.matrix),r.applyMatrix4(d)}else void 0!==h.translation&&r.position.fromArray(h.translation),void 0!==h.rotation&&r.quaternion.fromArray(h.rotation),void 0!==h.scale&&r.scale.fromArray(h.scale);return l.associations.set(r,{type:"nodes",index:e}),r}))},Z.prototype.loadScene=function(){function e(t,r,o,l){var h=o.nodes[t];return l.getDependency("node",t).then((function(e){return void 0===h.skin?e:l.getDependency("skin",h.skin).then((function(e){for(var r=[],i=0,n=(t=e).joints.length;i<n;i++)r.push(l.getDependency("node",t.joints[i]));return Promise.all(r)})).then((function(r){return e.traverse((function(e){if(e.isMesh){for(var o=[],l=[],h=0,c=r.length;h<c;h++){var d=r[h];if(d){o.push(d);var f=new n.Matrix4;void 0!==t.inverseBindMatrices&&f.fromArray(t.inverseBindMatrices.array,16*h),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}e.bind(new n.Skeleton(o,l),e.matrixWorld)}})),e}));var t})).then((function(t){r.add(t);var n=[];if(h.children)for(var c=h.children,i=0,d=c.length;i<d;i++){var f=c[i];n.push(e(f,t,o,l))}return Promise.all(n)}))}return function(t){var r=this.json,o=this.extensions,l=this.json.scenes[t],h=new n.Group;l.name&&(h.name=l.name),X(h,l),l.extensions&&W(o,h,l);for(var c=l.nodes||[],d=[],i=0,f=c.length;i<f;i++)d.push(e(c[i],h,r,this));return Promise.all(d).then((function(){return h}))}}(),e}()}}]);