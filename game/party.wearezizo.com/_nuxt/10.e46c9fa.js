(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{399:function(e,t,n){"use strict";n.r(t);var o=n(160),r=n(161),c=(n(221),n(1)),l=n(33),h=(new(function(){function e(){Object(o.a)(this,e),this.time=window.performance.now(),this.spentTime=0,this.goodFrames=0,this.badFrames=0,this.frames=[],this.fpsGoodThreshold=50,this.fpsThreshold=44,this.fpsLowRaf=50,this.lastTime=-1,this.start=this.start.bind(this),this.pause=this.pause.bind(this),this.onTick=this.onTick.bind(this),this.start(),this.focused=!0}return Object(r.a)(e,[{key:"start",value:function(){this.startTime=window.performance.now(),this.spentTime=0,this.goodFrames=0,this.badFrames=0,this.deltaLow=0,this.frames=[],this.fpsGoodThreshold=58,this.fpsThreshold=44,this.lastTime=-1,this.oldTime=this.startTime,this.isPaused=!1,this.onTick(this.startTime)}},{key:"pause",value:function(){this.isPaused=!0}},{key:"updatePerfMonitor",value:function(dt){if(!l.a.renderUserCtrl){this.frames.unshift(dt),this.frames.length=Math.min(this.frames.length,60);var e=this.frames.reduce((function(e,time){return e+1/(time/1e3)}),0)/this.frames.length;e>this.fpsGoodThreshold&&this.frames.length>=60&&(this.goodFrames++,!l.a.hd&&this.goodFrames>=30&&(l.a.hd=!0,c.b.trigger({name:"upGradePerfCb"}))),e<this.fpsThreshold&&this.frames.length>=60?(this.goodFrames=Math.max(--this.goodFrames,0),this.badFrames++,l.a.hd&&this.badFrames>=30&&(l.a.hd=!1,c.b.trigger({name:"downGradePerfCb"}),l.a.renderUserCtrl=!0)):this.badFrames=Math.max(--this.badFrames,0)}}},{key:"onTick",value:function(e){this.time=e;var t=e-this.oldTime,n=e-this.deltaLow;this.updatePerfMonitor(e-this.oldTime),this.isPaused||(this.delta=t/1e3,this.oldTime=e,c.b.trigger({name:"raf"},{delta:this.delta,now:e}),n>this.fpsLowRaf&&(this.deltaLow=e-n%this.fpsLowRaf,c.b.trigger({name:"lowRaf"},{delta:this.delta,deltaLow:this.deltaLow,now:e}))),window.requestAnimationFrame(this.onTick)}}]),e}()),new(function(){function e(){Object(o.a)(this,e),this.width=this.calculateWidth(),this.height=this.calculateHeight(),this.ratio=this.width/this.height,this.onResize=this.onResize.bind(this),this.onResize(),window.addEventListener("resize",this.onResize)}return Object(r.a)(e,[{key:"calculateWidth",value:function(){return window.innerWidth}},{key:"calculateHeight",value:function(){return window.innerHeight}},{key:"onResize",value:function(){this.width=this.calculateWidth(),this.height=this.calculateHeight(),this.ratio=this.width/this.height,c.b.trigger({name:"resize",fireAtStart:!0},{width:this.width,height:this.height,ratio:this.ratio})}}]),e}())),d=(n(352),n(18)),m=n(390),v=(n(38),n(19),n(348),n(45),n(39),n(162)),f=n(351),y=n(349),x=n(350),w=n(6);function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(x.a)(e);if(t){var r=Object(x.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(y.a)(this,n)}}var S=new(function(e){Object(f.a)(n,e);var t=k(n);function n(){var e;Object(o.a)(this,n),e=t.call(this,45,0,1,200),Object(c.a)(Object(v.a)(e));var r=window.innerWidth<769,l=window.innerWidth<400;return e.trackCamera=new d.Object3D,e.staticPulse={value:0},e.zoomIntro={val:0},e.heartBeat={value:1.2},e.positionOffset=new d.Vector3(l?-.47:0,l?5.4:3.3,r?l?9:12.7:9),e.followMode=new d.Vector3(0),e.followTargetVec=new d.Vector3(0),e.fakeTracker=new d.Group,e.fakeTracker.position.x=0,e.fakeTracker.position.y=r?l?2:3.5:1,e.fakeTracker.position.z=0,e.fakeTrackerChild=new d.Object3D,e.trackCameraSmooth=new d.Vector3,e.target={x:0,y:0},e.fakeTracker.add(e.fakeTrackerChild),e.position.copy(e.positionOffset),e._cachedCameraDest=e.positionOffset,e._cachedTrackerDest=e.fakeTracker.position,e._cachedLerp=1,e}return Object(r.a)(n,[{key:"calculateUnitSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.position.z,t=this.fov*Math.PI/180,n=2*Math.tan(t/2)*e,o=n*this.aspect;return{width:o,height:n}}},{key:"onStartSite",value:function(){var e=this;this.animIntro=w.a.timeline({duration:4200,easing:"easeOutExpo",delay:300,autoplay:!1,complete:function(){e.animIntro=null,l.a.cameraIntroEnded=!0}}).add({targets:this.fakeTracker.position,y:this.fakeTracker.position.y,duration:4200},0).add({targets:this.positionOffset,y:[24,2],z:[40,this.positionOffset.z],duration:4200},0),this.initCamera()}},{key:"onResize",value:function(e){var t=e.ratio;this.aspect=t,this.updateProjectionMatrix()}},{key:"onStartGame",value:function(e){var t=e.game;this.gameMod=0!==t}},{key:"followTarget",value:function(e,t){this.lerpVector(this.followTargetVec,e,t||.14)}},{key:"lookAtTarget",value:function(e,t){this.lerpVector(this.fakeTracker.position,e,t||.14)}},{key:"stopFollow",value:function(){this.followTargetVec=new d.Vector3(0)}},{key:"initCamera",value:function(){this.animPulse=Object(w.a)({targets:this.staticPulse,value:[-1.5,1.5],easing:"easeInOutSine",loop:!0,direction:"alternate",duration:12e3,delay:60,autoplay:!1})}},{key:"animateToPoint",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1500,r=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.isAnimating=!0,this.animCamera=w.a.timeline({duration:o,autoplay:!1,complete:function(){n.isAnimating=!1,n.animCamera=null,c()}}),e&&(l?this.animCamera.add({targets:this.positionOffset,keyframes:[{x:this.positionOffset.x,y:this.positionOffset.y,z:this.positionOffset.z,duration:0},{x:e.x,y:this.positionOffset.y,z:this.positionOffset.z+15},{x:e.x,y:e.y,z:e.z,duration:900}],duration:o,easing:"easeInOutSine"},0):this.animCamera.add({targets:this.positionOffset,x:e.x,y:e.y,z:e.z,duration:o,easing:r||"easeOutSine"},0)),t&&this.animCamera.add({targets:this.fakeTracker.position,x:t.x,y:t.y,z:t.z,duration:o,easing:r||"easeOutSine"},0)}},{key:"animateToPointKeyFrames",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e3,r=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0,l=3;this.isAnimating=!0,this.animCamera=w.a.timeline({autoplay:!1,targets:this.positionOffset,duration:o,complete:function(){n.isAnimating=!1,n.animCamera=null,c()}});var h,i=0;e.forEach((function(e){h={duration:o/l,easing:r||"easeOutSine"},e.forEach((function(e){Object.assign(h,e)})),n.animCamera.add(h,o/l*i),i++})),t&&(i=0,t.forEach((function(e){h={targets:n.fakeTracker.position,duration:o/l,easing:r||"easeOutSine"},e.forEach((function(e){Object.assign(h,e)})),n.animCamera.add(h,o/l*i),i++})))}},{key:"lerpVector",value:function(a,b,e){a.x=this.lerp(a.x,b.x,e),a.y=this.lerp(a.y,b.y,e),a.z=this.lerp(a.z,b.z,e)}},{key:"lerp",value:function(a,b,e){return(1-e)*a+e*b}},{key:"updateCamera",value:function(e,t,n){if(this.target){this.gameMod&&(this.staticPulse.value=this.lerp(this.staticPulse.value,0,.024)),t?(this.target.x=this.lerp(this.target.x,0,.024),this.target.y=this.lerp(this.target.y,0,.024)):e<1&&(this.target.x=this.lerp(this.target.x,n.x,e),this.target.y=this.lerp(this.target.y,n.y,e));var o=this.isAnimating?1:e,r=parseFloat(this.positionOffset.x),c=parseFloat(this.positionOffset.y),l=parseFloat(this.positionOffset.z),h=d.MathUtils.smoothstep(this.fakeTracker.position.distanceTo(new d.Vector3(r,c,l)),0,10),m=.8*this.target.x*3.5*h,v=.8*this.target.y*4.5*h;this.lerpVector(this.followMode,this.followTargetVec,o);var f=1-1/Math.min(this.aspect||1);this.lerpVector(this.position,new d.Vector3(r+m+this.followMode.x+this.staticPulse.value/5,Math.max(0,c+v+1.18*this.followMode.y)+this.staticPulse.value/4,l+v+1.1*this.followMode.z-f),o),this.fakeTracker.updateMatrixWorld();var y=new d.Vector3(this.fakeTracker.position.x+this.followMode.x,this.fakeTracker.position.y+this.followMode.y,this.fakeTracker.position.z+this.followMode.z);this.lookAt(y),this.fov=this.lerp(this.fov,45-(this.staticPulse?this.staticPulse.value:0),.04),this.updateProjectionMatrix()}}},{key:"onRaf",value:function(e){var t=e.now;l.a.introEnded&&(this.animIntro&&this.animIntro.tick(t),this.animCamera&&(this.animIntro&&(this.animIntro=null,l.a.cameraIntroEnded=!0),this.animCamera.tick(t)),!this.gameMod&&this.animPulse&&this.animIntro)}},{key:"onLaunchDevMode",value:function(e){var t=e.gui,n=t.addFolder("Tracker Position");n.open(),n.add(this.fakeTracker.position,"x").min(-10).max(50).step(.01),n.add(this.fakeTracker.position,"y").min(-30).max(30).step(.01),n.add(this.fakeTracker.position,"z").min(-30).max(50).step(.01);var o=t.addFolder("Camera Position");o.open(),o.add(this.positionOffset,"x").min(-10).max(50).step(.01),o.add(this.positionOffset,"y").min(-10).max(50).step(.01),o.add(this.positionOffset,"z").min(-30).max(50).step(.01)}}]),n}(d.PerspectiveCamera));new(function(){function e(){Object(o.a)(this,e),this.x=0,this.y=0,this.isTouching=!0,this.distance=0,this.hold=new d.Vector2,this.last=new d.Vector2,this.delta=new d.Vector2,this.move=new d.Vector2,this.world=new d.Vector3,this.normalized=new d.Vector2,this._tmp=new d.Vector3,this.bind()}return Object(r.a)(e,[{key:"bind",value:function(){var e=window;e.addEventListener("touchstart",this.onStart.bind(this),{passive:!1}),e.addEventListener("touchmove",this.onMove.bind(this),{passive:!1}),e.addEventListener("touchend",this.onEnd.bind(this),{passive:!1}),e.addEventListener("touchcancel",this.onEnd.bind(this),{passive:!1}),e.addEventListener("mousedown",this.onStart.bind(this)),e.addEventListener("mousemove",this.onMove.bind(this)),e.addEventListener("mouseup",this.onEnd.bind(this)),e.addEventListener("contextmenu",this.onEnd.bind(this))}},{key:"convertEvent",value:function(e){e.stopPropagation&&e.stopPropagation();var t={x:0,y:0};return e?e.windowsPointer?e:(e.touches||e.changedTouches?e.touches.length?(t.x=e.touches[0].pageX,t.y=e.touches[0].pageY):(t.x=e.changedTouches[0].pageX,t.y=e.changedTouches[0].pageY):(t.x=e.pageX,t.y=e.pageY),t.x=Object(m.a)(0,h.width,t.x),t.y=Object(m.a)(0,h.height,t.y),t):t}},{key:"onStart",value:function(e){var t=this.convertEvent(e);this.isTouching=!0,this.x=t.x,this.y=t.y,this.hold.set(t.x,t.y),this.last.set(t.x,t.y),this.delta.set(0,0),this.move.set(0,0),this.normalized.x=this.x/h.width*2-1,this.normalized.y=-this.y/h.height*2+1,this.distance=0,c.b.trigger({name:"pointerStart"},{pointer:this,e:e}),l.a.isMobile()&&c.b.trigger({name:"pointerMove"},{pointer:this})}},{key:"onMove",value:function(e){var t=this.convertEvent(e);this.isTouching&&(this.move.x=t.x-this.hold.x,this.move.y=t.y-this.hold.y),this.x=t.x,this.y=t.y,this.delta.x=t.x-this.last.x,this.delta.y=t.y-this.last.y,this.distance+=this.delta.length(),this.normalized.x=this.x/h.width*2-1,this.normalized.y=-this.y/h.height*2+1,this._tmp.x=this.normalized.x,this._tmp.y=this.normalized.y,this._tmp.z=.5,this._tmp.unproject(S);var n=this._tmp.sub(S.position).normalize(),o=-S.position.z/n.z;this.world.copy(S.position).add(n.multiplyScalar(o)),c.b.trigger({name:"pointerMove"},{pointer:this}),this.isTouching&&c.b.trigger({name:"pointerDrag"},{pointer:this})}},{key:"onEnd",value:function(){this.isTouching=!1,this.move.set(0,0),c.b.trigger({name:"pointerEnd"},{pointer:this})}}]),e}()),n(79),n(377),n(58),n(222),n(24),n(220),n(71);function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(x.a)(e);if(t){var r=Object(x.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(y.a)(this,n)}}var C=function(e){Object(f.a)(n,e);var t=M(n);function n(){var e;return Object(o.a)(this,n),e=t.call(this,35,0,.1,500),Object(c.a)(Object(v.a)(e)),e.init(),e}return Object(r.a)(n,[{key:"init",value:function(){this.position.set(0,0,1),this.lookAt(new d.Vector3(0,0,0)),this.unit=this.calculateUnitSize()}},{key:"calculateUnitSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.position.z,t=this.fov*Math.PI/180,n=2*Math.tan(t/2)*e,o=n*this.aspect;return{width:o,height:n}}},{key:"onResize",value:function(e){var t=e.ratio;this.aspect=t,this.unit=this.calculateUnitSize(),this.updateProjectionMatrix()}}]),n}(d.PerspectiveCamera),T="precision highp float;\nprecision highp int;\n#define GLSLIFY 1\n#define PI 3.1415926535897932384626433832795\nuniform float timev;\nuniform float speed;\nuniform float frequency;\nuniform float amplitude;\nuniform float strong;\nuniform float bean;\nuniform float beanTime;\nuniform vec2 vRes;\nvarying vec2 vUv;\nvarying vec2 meshUv;\n\nvoid main() {\n\n\t#include <begin_vertex>\n\tmeshUv = uv;\n\tvUv = vec4(position,1.0).xy;\n\n    vec3 offset = normalize(\n        vec3( 0.5 ) - position ) * ( amplitude * sin( speed * timev + position.y + position.x * frequency )\n    );\n    float ofY = offset.y;\n    if (strong > .5) {\n        ofY = sin(offset.y) * 20.;\n    }\n    if (bean > .5) {\n        ofY = offset.y + (.012 * sin( ((meshUv.x * vRes.x) / vRes.x) * PI) * (2.0 - (sin(beanTime)+1.)/2.)) + (amplitude * 3.5 * max(0., sin( ((meshUv.x * vRes.x) / vRes.x) * PI) - 0.9));\n    }\n    vec3 newPosition = position + vec3( offset.x, ofY, 0. );\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n}\n",P="precision highp float;\n#define GLSLIFY 1\nuniform float time;\nuniform float factor;\nuniform float local;\nuniform float rad;\nuniform sampler2D map;\nuniform vec4 color;\nuniform vec2 vRes;\nuniform vec2 uRes;\nvarying vec2 vUv;\nvarying vec2 meshUv;\n\nfloat udRoundBox( vec2 p, vec2 b, float r )\n{\n    float ur = length(max(abs(p)-b+r,0.0))-r;\n    return length(max(abs(p)-b+r,0.0))-r;\n}\n\nvoid main()\t{\n  // meshUv = propr to the mesh\n  // vUv = proportional to the viewport\n\tvec2 u = .5-vUv;\n  if (local == 1.0) {\n    u = meshUv;\n  }\n  float freq = 3.0*sin(0.5*time);\n  vec2 warp = 0.5000*cos( u.xy*1.0*freq + vec2(0.0,1.0) + time ) +\n                0.2500*cos( u.yx*2.3*freq + vec2(1.0,2.0) + time) +\n                0.1250*cos( u.xy*4.1*freq + vec2(5.0,3.0) + time ) +\n                0.0625*cos( u.yx*7.9*freq + vec2(3.0,4.0) + time );\n  u.x += warp.x * 2.5;\n  \n  u.x-= (1.) + (.25 * factor);\n  u.x-= .25*cos(u.y) * factor;\n\n  if (rad > .5) {\n    vec2 re = vRes.xy;\n    float iRadius = min(re.x, re.y) * .5;\n    vec2 halfRes = .5 * re.xy;\n    float b = udRoundBox( (meshUv.xy * re.xy) - halfRes, halfRes, iRadius );\n    vec4 c = mix(mix(vec4(1.0,1.0,1.0, 1.0), color, factor * factor * factor), vec4(1.,1.,1., 0.), step(0.001, b) );\n    //gl_FragColor = c smoothstep(.01 - fwidth(.0001),.01,c)\n    //Using smoothstep(x - fwidth(x), x, u) instead of step(x, u) \n\n    gl_FragColor = c * step(.01, u.x);\n    // gl_FragColor = c*smoothstep(.01 - fwidth(.01),.01,u.x);\n  } else {\n    gl_FragColor = color * step(.01, u.x);\n    //gl_FragColor = color*smoothstep(.01 - fwidth(.01),.01,u.x);\n  }\n}",A=(n(163),n(59),n(63),n(47),n(100),n(72),n(382));function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(x.a)(e);if(t){var r=Object(x.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(y.a)(this,n)}}var _=function(e){Object(f.a)(n,e);var t=O(n);function n(e){var r;return Object(o.a)(this,n),r=t.call(this),e&&(r.dom=document.querySelector(e)),r}return Object(r.a)(n,[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.dom){var t=this.dom.innerHTML.replace(/<br\s*\/?>/gi,"\n");if(this.text=t,!e){var n=window.innerWidth,o=window.innerHeight;this.aspect=n/o,this.unit=this.calculateUnitSize();var rect=this.dom.getBoundingClientRect(),style=getComputedStyle(this.dom);if(style.color){var r=style.color.split("(")[1].split(")")[0].split(",").map((function(e){return 1==(e=parseInt(e).toString(16)).length?"0"+e:e}));this.color=parseInt("0x"+r.join(""))}this.maxWidth=rect.width/n,this.anchorY="top",this.textAlign=style.textAlign;var c=Number(style.fontSize.replace("px",""));this.fontSize=1/1555*c*(1e3/o),this.anchorX="left",this.position.x=this.unit.width*(rect.left/n)-.5*this.unit.width,this.position.y=this.unit.height*(-rect.top/o)+.5*this.unit.height,this.lineHeight=1}this.sync()}}},{key:"calculateUnitSize",value:function(){var e=35*Math.PI/180,t=2*Math.tan(e/2)*1;return{width:t*this.aspect,height:t}}}]),n}(A.Text),D=function(){function e(t){Object(o.a)(this,e),Object(c.a)(this),this.scene=t,this.animComplete=!1}return Object(r.a)(e,[{key:"onFinishedLoaded",value:function(){var e=this;this.material=new d.ShaderMaterial({defines:{},fragmentShader:P,vertexShader:T,transparent:!0,uniforms:{color:{type:"v4",value:new d.Vector4(232/255,223/255,46/255,1)},vResolution:{type:"v2",value:new d.Vector2},factor:{value:1},time:{type:"f",value:0},local:{type:"f",value:0},rad:{value:0},timev:{type:"f",value:0},amplitude:{type:"f",value:0},speed:{type:"f",value:1.15},frequency:{type:"f",value:6},direction:{value:0}}}),this.material.blending=d.CustomBlending,this.material.blendSrc=d.OneFactor,this.material.blendDst=d.OneMinusSrcAlphaFactor,this.vsl=this.addText(".vsl"),this.scene.add(this.vsl),this.vslmat=this.vsl.material,this.vsr=this.addText(".vsr"),this.scene.add(this.vsr),this.vsrmat=this.vsr.material,this.vsr.visible=this.vsl.visible=!1,this.txt=this.addTextFirst(),this.scene.add(this.txt),this.txt.sync(),this.txt.material.uniforms.factor.value=-4,this.txt.material.uniforms.time.value=-18.65,this.animateText=!1,this.animIntro=w.a.timeline({autoplay:!1,delay:700,easing:"easeOutBack",duration:1300}),this.animIntro.add({targets:this.txt.material.uniforms.color.value,x:[.9411764706,.9098039216],y:[.902,.8745098039],z:[.196,.1803921569],easing:"easeOutSine",duration:800},0).add({targets:this.txt.material.uniforms.amplitude,value:[4,.11]},0).add({targets:this.txt.material.uniforms.timev,value:[4,4.8],complete:function(){e.animateText=!0}},0),this.onResize({width:window.innerWidth})}},{key:"addTextFirst",value:function(){var e=new A.Text;window.innerWidth;e.fontSize=.8,e.lineHeight=.9,e.text="CHOOSE YOUR CHARACTER",e.position.y=0,e.font="/fonts/Ambit-Black.woff",e.position.x=0,e.anchorX="center",e.anchorY="middle",e.textAlign="center",e.maxWidth=1,e.glyphGeometryDetail=400;var t=this.material.clone();return t.uniforms.amplitude.value=.22,t.uniforms.frequency.value=0,e.material=t,e}},{key:"addText",value:function(e){var t=new _(e);t.font="/fonts/Ambit-Black.woff";var n=this.material.clone();return t.glyphGeometryDetail=400,t.material=n,".vsl"==e&&(n.uniforms.local.value=1),t}},{key:"onPickCharacter",value:function(){var e=this;this.vsr.visible=this.vsl.visible=!0,this.animateText=!1;this.animIntro=w.a.timeline({autoplay:!1,easing:"easeOutSine",duration:1200,delay:1200}),this.animIntro.add({targets:this.txt.position,y:-2,delay:400,duration:1100},0).add({targets:this.txt.material.uniforms.color.value,x:.9411764706,y:.902,z:.196,duration:1100,delay:400,complete:function(){e.scene.remove(e.txt),e.txt.dispose(),e.txt=null}},0).add({targets:this.txt.material.uniforms.amplitude,value:4,delay:400,duration:1100},0).add({targets:this.txt.material.uniforms.timev,value:11,delay:400,duration:1100},0).add({targets:[this.vslmat.uniforms.amplitude,this.vsrmat.uniforms.amplitude],value:[.165,.012]},0).add({targets:this.vslmat.uniforms.timev,value:[1.5,6.5]},0).add({targets:this.vsrmat.uniforms.timev,value:[-6.5,-1.5]},0).add({targets:[this.vslmat.uniforms.time,this.vsrmat.uniforms.time],value:[-1.5,-6],complete:function(){e.animComplete=!0,e.animIntro=null}},0)}},{key:"onIntroOut",value:function(){var e=this;this.animComplete=!1,this.animIntro=w.a.timeline({autoplay:!1,easing:"easeInSine",duration:1e3}),this.animIntro.add({targets:[this.vslmat.uniforms.amplitude,this.vsrmat.uniforms.amplitude],value:.125},0).add({targets:this.vslmat.uniforms.timev,value:this.vslmat.uniforms.timev.value+6.5},0).add({targets:this.vsrmat.uniforms.timev,value:this.vsrmat.uniforms.timev.value-6.5},0).add({targets:[this.vslmat.uniforms.time,this.vsrmat.uniforms.time],value:-1.5,complete:function(){e.dispose()}},0)}},{key:"onResize",value:function(e){var t=e.width;this.vsl&&(this.vsl.update(),this.vsr.update(),this.vsr.position.z=this.vsl.position.z=t<700?-2:-1),this.txt&&(this.txt.position.z=t<700?-2:-3,this.txt.fontSize=t>1330?.8:t>768?t/2e3:t/1400,this.txt.sync())}},{key:"onRaf",value:function(e){var t=e.delta,n=e.now;this.animIntro&&this.animIntro.tick(n),this.animComplete&&(this.vslmat.uniforms.timev.value+=1.5*t,this.vsrmat.uniforms.timev.value-=1.5*t),this.animateText&&this.txt&&(this.txt.material.uniforms.timev.value>11.45&&(this.txt.material.uniforms.timev.value=6),this.txt.material.uniforms.timev.value+=t)}},{key:"dispose",value:function(){this.txt&&(this.scene.remove(this.txt),this.txt.dispose(),this.txt=null),this.animIntro=null,this.scene.remove(this.vsl),this.scene.remove(this.vsr),this.vsl.dispose(),this.vsr.dispose(),this.material.dispose(),this.vsrmat.dispose(),this.vslmat.dispose(),this.vsl=null,this.vslmat=this.vsrmat=null}}]),e}();function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(x.a)(e);if(t){var r=Object(x.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(y.a)(this,n)}}var I=function(e){Object(f.a)(n,e);var t=B(n);function n(e,r,l){var h;return Object(o.a)(this,n),(h=t.call(this,e,r)).cachedGeometry=e.clone(),h.cachedGeometry.translate(.5,-.5,0),h.cachedDom=l,l&&(h.dom=document.querySelector(l)),h.geometry.translate(.5,-.5,0),h.aspect=h.winW/h.winH,h.unit=h.calculateUnitSize(),Object(c.a)(Object(v.a)(h)),h}return Object(r.a)(n,[{key:"set",value:function(e){var t=this;if(this.css=e,this.css.width){var n=this.css.width;if("string"==typeof n&&n.includes("%")){var o=parseFloat(n.substr(0,n.length-1));n=this.unit.width*(o/100)}else n=this.unit.width*(this.css.width/this.winW);this.w=n,this.material&&this.material.uniforms&&this.material.uniforms.vRes&&(this.material.uniforms.vRes.value.x=n*this.winW),this.material&&this.material.uniforms&&this.material.uniforms.uRes&&(this.material.uniforms.uRes.value.x=this.winW)}if(this.css.height){var r=this.css.height;if("string"==typeof r&&r.includes("%")){var c=parseFloat(r.substr(0,r.length-1));r=this.unit.height*(c/100)}else r=this.unit.height*(this.css.height/this.winH);this.h=r,this.material&&this.material.uniforms&&this.material.uniforms.vRes&&(this.material.uniforms.vRes.value.y=r*this.winH/(this.winH/this.winW)),this.material&&this.material.uniforms&&this.material.uniforms.uRes&&(this.material.uniforms.uRes.value.y=this.winH)}Object.entries(e).forEach((function(e){var n=e[0],o=e[1];t[n](o)})),this.updateMatrix(),this.geometry.applyMatrix4(this.matrix),this.position.set(0,0,0),this.rotation.set(0,0,0),this.scale.set(1,1,1),this.updateMatrix()}},{key:"left",value:function(e){this.css.left=e,"string"==typeof e&&e.includes("%")?(e=parseFloat(e.substr(0,e.length-1)),this.position.x=this.unit.width*(e/100)-.5*this.unit.width-this.w/2):this.position.x=this.unit.width*(e/this.winW)-.5*this.unit.width}},{key:"right",value:function(e){this.css.right=e,"string"==typeof e&&e.includes("%")?(e=parseFloat(e.substr(0,e.length-1)),this.position.x=this.unit.width*(-e/100)+.5*this.unit.width-this.w):this.position.x=this.unit.width*(-e/this.winW)+.5*this.unit.width-this.w}},{key:"top",value:function(e){this.css.top=e,"string"==typeof e&&e.includes("%")?(e=parseFloat(e.substr(0,e.length-1)),this.position.y=this.unit.height*(-e/100)+.5*this.unit.height+this.h/2):this.position.y=this.unit.height*(-e/this.winH)+.5*this.unit.height}},{key:"bottom",value:function(e){this.css.bottom=e,"string"==typeof e&&e.includes("%")?(e=parseFloat(e.substr(0,e.length-1)),this.position.y=this.unit.height*(e/100)-.5*this.unit.height+this.h):this.position.y=this.unit.height*(e/this.winH)-.5*this.unit.height+this.h}},{key:"width",value:function(e){this.css.width=e,"string"==typeof e&&e.includes("%")?(e=parseFloat(e.substr(0,e.length-1)),this.scale.x=this.unit.width*(e/100)):this.scale.x=this.unit.width*(e/this.winW)}},{key:"height",value:function(e){this.css.height=e,"string"==typeof e&&e.includes("%")?(e=parseFloat(e.substr(0,e.length-1)),this.scale.y=this.unit.height*(e/100)):this.scale.y=this.unit.height*(e/this.winH)}},{key:"calculateUnitSize",value:function(){var e=35*Math.PI/180,t=2*Math.tan(e/2)*1;return{width:t*this.aspect,height:t}}},{key:"updateDom",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this.geometry.attributes.position.array;this.dom=document.querySelector(e);var rect=this.dom.getBoundingClientRect();if(this.css={left:rect.left,top:rect.top,width:rect.width,height:rect.height},this.geometry=this.cachedGeometry.clone(),this.set(this.css),n){var b={};return o.forEach((function(element,e){b[e]=[element,t.geometry.attributes.position.array[e]]})),b}}},{key:"onResize",value:function(e){var t=e.ratio,n=e.width,o=e.height;if(this.aspect=t,this.winW=n,this.winH=o,this.cachedDom&&(this.dom=document.querySelector(this.cachedDom)),this.dom){var rect=this.dom.getBoundingClientRect();this.css={left:rect.left,top:rect.top,width:rect.width,height:rect.height}}this.unit=this.calculateUnitSize(),this.css&&(this.geometry=this.cachedGeometry.clone(),this.set(this.css))}}]),n}(d.Mesh),L="#define GLSLIFY 1\nvarying vec2 vUv;\nvarying vec2 meshUv;\n\nvoid main() {\n\t#include <begin_vertex>\n\tmeshUv = uv;\n\tvUv = vec4(position,1.0).xy;\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n}",z=n(3),E=function(){function e(t){Object(o.a)(this,e),Object(c.a)(this),this.scene=t,this.init()}return Object(r.a)(e,[{key:"init",value:function(){var e={};this.showPopinComplete=!1,this.material=new d.ShaderMaterial({defines:e,fragmentShader:P,vertexShader:L,transparent:!0,uniforms:{color:{type:"v4",value:new d.Vector4(.9411764706,.902,.196,1)},vRes:{type:"v2",value:new d.Vector2},factor:{value:1},time:{type:"f",value:0},direction:{value:0},rad:{type:"f",value:0},local:{type:"f",value:0},bean:{type:"f",value:0},beanTime:{type:"f",value:0}}}),this.material.extensions.derivatives=!0,this.bg=new I(new d.PlaneBufferGeometry(1,1,2,2),this.material),this.bg.set({width:"100.001%",height:"100%",left:0,top:0}),this.scene.add(this.bg),this.materialPopin=new d.ShaderMaterial({defines:e,fragmentShader:P,vertexShader:T,transparent:!0,depthWrite:!1,uniforms:{color:{type:"v4",value:new d.Vector4(1,1,1,1)},vRes:{type:"v2",value:new d.Vector2},factor:{value:1},time:{type:"f",value:0},timev:{type:"f",value:0},amplitude:{type:"f",value:.025},rad:{type:"f",value:0},speed:{type:"f",value:1.15},frequency:{type:"f",value:6},local:{type:"f",value:0},direction:{value:0},bean:{type:"f",value:0},beanTime:{type:"f",value:0}}}),this.materialPopin.extensions.derivatives=!0,this.bgPopin=new I(new d.PlaneBufferGeometry(1,1,20,20),this.materialPopin,".end-game"),this.scene.add(this.bgPopin),this.animateIn()}},{key:"animateIn",value:function(){var e=this;if(!this.animIn){this.bgPopin&&this.bgPopin.onResize({ratio:window.innerWidth/window.innerHeight,width:window.innerWidth,height:window.innerHeight}),this.animIn=!0;this.materialPopin.uniforms.local.value=0,c.b.trigger({name:"lowPass"},!0),z.g.sound.commit("sound/playSound",{fileName:"generic_woosh_"+Math.round(.5+5.5*Math.random()),volume:1}),this.countdownInTL=w.a.timeline({easing:"easeInQuint",duration:2e3,delay:300,autoplay:!1}),this.countdownInTL.add({targets:this.material.uniforms.time,value:[-1.5,-6],delay:0}).add({targets:this.materialPopin.uniforms.amplitude,value:[.125,.009]},0).add({targets:this.materialPopin.uniforms.timev,value:[1.5,6.5]},0).add({targets:this.materialPopin.uniforms.time,value:[-1.5,-6],complete:function(t){e.animateInComplete()}},0)}}},{key:"animateInComplete",value:function(){var e=this;this.animIn=!1;this.materialPopin.uniforms.local.value=1,this.materialPopin.uniforms.time.value=12.2,this.showPopinComplete=!0,this.countdownInTL=w.a.timeline({duration:1500,autoplay:!1}).add({targets:this.material.uniforms.factor,value:[-2.1,.4],easing:"easeOutExpo"}).add({targets:this.material.uniforms.time,value:[.5,.8],easing:"easeOutExpo",complete:function(t){e.countdownInTL=null}},0),c.b.trigger({name:"showEndScreen"})}},{key:"onHideEndScreen",value:function(){var e=this;this.bg.visible=!1,this.countdownHideTL=w.a.timeline({duration:700,autoplay:!1,delay:300}),this.countdownHideTL.add({targets:this.materialPopin.uniforms.amplitude,value:[.009,2.99],easing:"easeInQuint",complete:function(){e.showPopinComplete=!1,e.countdownHideTL=null}}).add({targets:this.materialPopin.uniforms.time,value:[12.2,11.7],easing:"easeInOutSine"},0)}},{key:"onRaf",value:function(e){var t=e.delta,n=e.now;this.showPopinComplete&&(this.materialPopin.uniforms.timev.value+=t),this.countdownInTL&&this.countdownInTL.tick(n),this.countdownHideTL&&this.countdownHideTL.tick(n)}},{key:"hide",value:function(){this.bg.visible=this.bgPopin.visible=!1}},{key:"show",value:function(){this.bg.visible=this.bgPopin.visible=!0}},{key:"onLaunchDevMode",value:function(e){var t=e.gui,n=t.addFolder("INTRO");n.open(),n.add(this.materialPopin.uniforms.amplitude,"value").min(0).max(2).step(.001);var o=t.addFolder("time");o.open(),o.add(this.materialPopin.uniforms.timev,"value").min(-7.6).max(7.6).step(.001)}}]),e}(),G=function(){function e(t){Object(o.a)(this,e),Object(c.a)(this),this.scene=t,this.init()}return Object(r.a)(e,[{key:"init",value:function(){var e=this,t={};this.currentNav=0,this.fromChallengeEnd=!1,this.showTitleDesc=!0;var n=new d.Vector4(.1411764706,.09411764706,.09019607843,1),o=new d.Vector4(.9411764706,.902,.196,1);this.animateInFirst=!0;var r=new d.ShaderMaterial({defines:t,fragmentShader:P,vertexShader:T,transparent:!0,uniforms:{color:{type:"v4",value:o},vRes:{type:"v2",value:new d.Vector2},uRes:{type:"v2",value:new d.Vector2},vMouse:{type:"v2",value:new d.Vector2},factor:{value:1},rad:{value:1},time:{type:"f",value:-.3},direction:{value:0},timev:{type:"f",value:0},amplitude:{type:"f",value:0},speed:{type:"f",value:1.15},frequency:{type:"f",value:6},local:{type:"f",value:1},bean:{type:"f",value:0},beanTime:{type:"f",value:0},map:{value:null}}});r.extensions.derivatives=!0,this.material=r.clone(),this.timerMeshMat=new d.ShaderMaterial({defines:t,fragmentShader:"precision highp float;\n#define GLSLIFY 1\nuniform float time;\nuniform float alpha;\nvarying vec2 vUv;\nvarying vec2 meshUv;\n\n#define PI 3.141592653589793\n#define PI2 6.2831853072\nuniform vec2 uProgressEdges;\n\nfloat createCircle(vec2 uv, float s) {\n    float scale = 1. / s;\n    float dist = length(vec2(uv - .5) * scale);\n    float edge = fwidth(dist) * 1.5;\n    float strokeWidth = dFdx(uv.x) * 3.;\n    float innerRadius = .5 - strokeWidth;\n    float circ = smoothstep(innerRadius - edge, innerRadius, dist) * \n    smoothstep(.5, .5 - edge, dist);\n    return circ;\n}\n\nfloat createBorder(vec2 center) {\n    float angleFromCenter = atan(-center.x, -center.y);\n    return (angleFromCenter + PI) / PI2;\n}\n\nvoid main()\t{\n  float circ = createCircle(meshUv, 1.);\n  float border = createBorder(meshUv - .5);\n  float start = step(uProgressEdges.x, border);\n  float finish = 1. - step(uProgressEdges.y, border);\n  gl_FragColor = vec4(vec3(1.), start * finish * circ);\n}",vertexShader:T,transparent:!0,uniforms:{color:{type:"v4",value:n},vRes:{type:"v2",value:new d.Vector2},uRes:{type:"v2",value:new d.Vector2},uProgressEdges:{type:"v2",value:new d.Vector2(0,0)},timev:{type:"f",value:0},amplitude:{type:"f",value:0},speed:{type:"f",value:1.15},frequency:{type:"f",value:6}}}),this.timerMeshMat.extensions.derivatives=!0,this.timerMesh=new I(new d.CircleBufferGeometry(.5,40),this.timerMeshMat,".game-time-bg"),this.scene.add(this.timerMesh),this.materialAbove=r.clone(),this.materialAbove.uniforms.color.value=n,this.bgNavBarAbove=new I(new d.CircleBufferGeometry(.5,20),this.materialAbove,".bg-hlt-0"),this.scene.add(this.bgNavBarAbove),this.materialAboveBlack=r.clone(),this.materialAboveBlack.transparent=!0,this.materialAboveBlack.uniforms.color.value=n,this.bgNavBarAboveBlack=new I(new d.PlaneBufferGeometry(1,1,12,2),this.materialAboveBlack,".cbc-target"),this.scene.add(this.bgNavBarAboveBlack),this.currentTexture=0,this.textureArr=["","",""],this.gameDescIcon=this.addText(),this.gameDescIconMat=this.gameDescIcon.material,this.gameDescIconMat.uniforms.rad.value=0,this.gameDescIconMat.uniforms.frequency.value=12,this.scene.add(this.gameDescIcon),this.gameDescIcon.scale.x=0,this.gameDescIcon.rotateZ(-.09),this.gameDescIcon.sync(),this.gameDescMat=r.clone(),this.gameDescMat.uniforms.rad.value=window.innerWidth<721?0:1,this.gameDescMat.uniforms.bean.value=1,this.gameDescMat.depthWrite=this.gameDescMat.depthTest=!1,this.gameDescMat.uniforms.color.value=new d.Vector4(1,1,1,.7),this.gameDesc=new I(new d.PlaneBufferGeometry(1,1,12,2),this.gameDescMat,".content-gd"),this.scene.add(this.gameDesc),this.gameDesc.scale.x=0,this.titleDescJa=this.addText(!1,!0),this.scene.add(this.titleDescJa),this.updateKatakana(886/window.innerHeight),this.titleDesc=this.addText(!1),this.scene.add(this.titleDesc),this.titleDesc.sync(),this.gameTtlMat=this.titleDesc.material,this.onResize({width:window.innerWidth,height:window.innerHeight}),this.animateIn(),this.animeDotInit=Object(w.a)({targets:this.materialAbove.uniforms.time,easing:"easeOutSine",value:[.5,0],duration:1500,autoplay:!1,delay:1100,complete:function(){e.animeDotInit=null}}),this.animeBtnNav=w.a.timeline({easing:"easeOutBack",duration:700,autoplay:!1}).add({targets:".game-nav li button",scale:[0,1],translateZ:0,delay:w.a.stagger(90,{start:1e3,from:"first"})},0),window.innerWidth>720?this.animeBtnNav.add({targets:".challenge-btn span",translateY:[60,0],translateZ:0,complete:function(){e.animeBtnNav=null}},1650):this.animeBtnNav.add({targets:".challenge-btn-content",scale:[0,1],translateZ:0,complete:function(){e.animeBtnNav=null}},1150),this.animateInFirst=!1,document.querySelector(".play-btn").style.transform="scaleX(0)",this.animateDesc(!0,!0,1150)}},{key:"addText",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new A.Text;n.fontSize=e?.17:.1,n.text=e?this.textureArr[0]:t?"ワクワク":"Waku",n.position.y=e?.07:.18,n.font=e?"/fonts/icomoon.woff":t?"/fonts/katakana.woff":"/fonts/Ambit-Black.woff",n.position.x=e?.11:0,n.anchorX=e?"left":"center",n.anchorY="bottom",n.glyphGeometryDetail=400;var o=this.material.clone();return o.premultipliedAlpha=!0,o.uniforms.color.value=new d.Vector4(.1411764706,.09411764706,.09019607843,1),n.material=o,n}},{key:"onNavigation",value:function(e){var t=e.cat,n=e.isNext,o=Math.abs(this.currentNav-t),r=3==this.currentNav;this.currentNav=t,this.descToUpdate=!0,3!=t&&(this.titleDesc.text=0==t?"Waku":1==t?"Hiya":"Doki",this.titleDescJa.text=0==t?"ワクワク":1==t?"ヒヤヒヤ":"ドキドキ",this.titleDesc.sync(),this.updateKatakana(886/window.innerHeight)),r&&this.fixResize(),n||(this.fromChallengeEnd&&(this.fromChallengeEnd=!1,this.displayUi()),this.animateDotUi(".bg-hlt-"+this.currentNav,!0,!1,o),this.animateDesc(3!=this.currentNav,r))}},{key:"onEndGame",value:function(e){var t=this,n=e.cancel;this.timerTl=w.a.timeline({autoplay:!1,easing:"easeOutSine"}).add({targets:this.timerMeshMat.uniforms.uProgressEdges.value,y:1,x:1,duration:400,complete:function(){t.timerMeshMat.uniforms.uProgressEdges.value.y=0,n&&(t.timerTl=null)}},0),n||this.timerTl.add({targets:this.bgNavBarAbove.position,x:-.4,y:-.4,duration:600,delay:300,easing:"easeInBack",complete:function(){t.bgNavBarAbove.visible=!1,t.timerTl=null}},0)}},{key:"animateDotUi",value:function(e){var t=this,nav=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=-.4==this.bgNavBarAbove.position.x,b=this.bgNavBarAbove.updateDom(e,!0),c=n?500:0;this.dotAnimTL=w.a.timeline({autoplay:!1,easing:nav?"easeInOutSine":"easeInSine",duration:nav?600:400+c}),this.dotAnimTL.add(Object.assign({targets:this.bgNavBarAbove.geometry.attributes.position.array,easing:nav?"easeInOutSine":"easeOutElastic(1, 1)",duration:nav?600:1200,delay:nav?0:300+c,update:function(){t.bgNavBarAbove.geometry.attributes.position.needsUpdate=!0}},b)).add({targets:this.materialAbove.uniforms.amplitude,value:[0,.005*(nav?1:10),0]},0).add({targets:this.materialAbove.uniforms.timev,value:[0,o<2?4:8,0]},0),r&&this.dotAnimTL.add({targets:this.bgNavBarAbove.position,x:[-.5,0],y:[-.5,0],delay:c,easing:"easeOutBack"},0)}},{key:"animateDesc",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e&&(this.currentTexture=this.currentNav,this.gameDescIcon.text=this.textureArr[this.currentNav],this.gameDescIcon.sync());var o=e?"easeOutBack":"easeInBack",r=e?"easeInBack":"easeOutBack";this.playBtnAnimTL=w.a.timeline({easing:"easeOutSine",duration:1e3,autoplay:!1,delay:n}).add({targets:[this.gameTtlMat.uniforms.amplitude,this.titleDescJa.material.uniforms.amplitude],value:[.022,.009],easing:"easeInOutBack"},0).add({targets:this.gameDescMat.uniforms.amplitude,value:[.013,0],delay:n+100},0).add({easing:e?"easeOutSine":"easeInBack",targets:this.gameDescIconMat.uniforms.amplitude,value:[.023,.009],delay:1.1*n+(t?400:0)},0).add({targets:[this.gameDescMat.uniforms.timev,this.gameTtlMat.uniforms.timev,this.titleDescJa.material.uniforms.timev],value:[0,8]},0).add({targets:this.gameDescIconMat.uniforms.timev,easing:o,value:[6,16],delay:1.1*n+(t?400:0)},0).add({targets:this.gameDesc.scale,easing:o,x:[t?0:1,1.3,e?1:0],y:[t?0:1,1.1,e?1:0],duration:1e3-(e?0:400),delay:0,begin:function(){e?(z.g.sound.commit("sound/playSound","text_bulb_in"),z.g.sound.commit("sound/playSound","text_bulb_in_design_1"),z.g.sound.commit("sound/playSound","text_bulb_in_design_2"),z.g.sound.commit("sound/playSound","text_bulb_in_design_3")):z.g.sound.commit("sound/playSound","text_bulb_out")}},n+(1150===n?400:0)).add({targets:".play-btn",easing:o,scaleX:[e?0:1,e?1:0],scaleY:[e?0:1,e?1:0],rotate:[0,-6,0],translateZ:0,duration:e?800:450,delay:n+(t?500:0)},0).add({targets:".content-gd",easing:e?"easeOutElastic(1, .5)":"easeInElastic(1, .5)",opacity:e?[0,1]:0,scale:e?[1.5,1]:0,translateZ:0,duration:e?1e3:450,delay:n+(e?500:0)},0).add({targets:[".challenge h2 span",".challenge p span"],easing:r,translateZ:0,translateY:e?"120%":["120%",0],duration:e?400:600,delay:w.a.stagger(80,{start:e?0:550,direction:e?"reverse":"normal"})},0).add({targets:".complete-game",easing:r,translateZ:0,opacity:e?0:[0,1],translateY:e?200:[200,0],duration:e?400:600,delay:e?0:700},0).add({targets:[".create-player",".share",".mail-sub"],easing:r,translateZ:0,opacity:e?0:[0,1],translateY:e?200:[200,0],duration:e?400:600,delay:w.a.stagger(80,{start:e?0:710,direction:e?"reverse":"normal"})},0).add({targets:[this.titleDesc.scale,this.titleDescJa.scale,this.gameDescIcon.scale],easing:o,x:e?[0,1]:0,y:e?[0,1]:0,duration:600,delay:w.a.stagger(e?80:0,{start:1.1*n+(t?400:0)})},0)}},{key:"onStartGame",value:function(e){var t=this;e.isNext||(this.bgNavBarAbove.visible=!0,0!=e.game?(setTimeout((function(){t.animateDotUi(".game-time",!1)}),0),this.timerMeshMat.uniforms.uProgressEdges.value.x=this.timerMeshMat.uniforms.uProgressEdges.value.y=0,this.timerMesh.visible=!0,this.animateNavBtn(!0)):(setTimeout((function(){t.animateDotUi(".bg-hlt-"+t.currentNav,!1,!0)}),0),this.timerMesh.visible=!1,this.animateNavBtn(!1)))}},{key:"updateKatakana",value:function(hr){this.titleDescJa.fontSize=.01+.008*hr,this.titleDescJa.position.y=.3-(2==this.currentNav?.06:.05)*hr,this.titleDescJa.position.x=(2==this.currentNav?.03:-.01)+.12*hr,this.titleDescJa.sync()}},{key:"onResize",value:function(e){var t=e.width,n=e.height;if(this.gameDescIcon){var o=t>620,hr=886/n;this.titleDesc.fontSize=.01+.09*hr,this.titleDesc.position.y=.3-.12*hr,this.titleDesc.sync(),this.updateKatakana(886/n),this.titleDescJa.visible=this.titleDesc.visible=this.showTitleDesc&&o,this.gameDescIcon.position.y=(.19-.11*hr+0+(o?0:.1))*(n>1e3?1.25:1),this.gameDescIcon.position.x=o?.13*hr:0,this.gameDescIcon.anchorX=o?"left":"center",this.gameDescIcon.fontSize=(.11+.09*hr-(t<1025?.04:.015))*(n>1e3?.85:1),this.gameDescIcon.sync()}this.gameDescMat&&(this.gameDescMat.uniforms.rad.value=t<721?0:1,this.bgNavBarAboveBlack.visible=this.gameDescIcon.visible&&t>720)}},{key:"onRaf",value:function(e){var t=e.delta,n=e.now;this.gameDescIconMat&&(this.gameDescIconMat.uniforms.timev.value+=1.3*t,this.gameTtlMat.uniforms.timev.value+=t,this.titleDescJa.material.uniforms.timev.value+=1.2*t),this.animeDotInit&&this.animeDotInit.tick(n),this.playBtnAnimTL&&this.playBtnAnimTL.tick(n),this.animNavBarTL&&this.animNavBarTL.tick(n),this.dotAnimTL&&this.dotAnimTL.tick(n),this.animeBtnNav&&this.animeBtnNav.tick(n),this.contactAnimTL&&this.contactAnimTL.tick(n),this.timerTl&&this.timerTl.tick(n),this.gameDesc&&(this.gameDescMat.uniforms.beanTime.value+=t)}},{key:"onGameClockProgress",value:function(time){this.timerMeshMat.uniforms.uProgressEdges.value.y=time.value}},{key:"animateContact",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.contactAnimTL=w.a.timeline({easing:"easeOutSine",duration:400,autoplay:!1,delay:t?0:1600}).add({targets:[".content-gd",".challenge"],opacity:t?[1,0]:[0,1]},0).add({targets:".play-btn span",translateY:t?[0,"-110%"]:0,duration:600,easing:t?"easeInBack":"easeOutBack",translateZ:0},0).add({targets:".play-btn",easing:t?"easeInBack":"easeOutBack",scaleX:[t?1:0,t?0:1],scaleY:[t?1:0,t?0:1],rotate:[0,6,0],translateZ:0,duration:600,complete:function(){e.contactAnimTL=null}},0),this.animateNavBtn(t,!0)}},{key:"animateNavBtn",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?e?0:1100:0;this.animeBtnNav=w.a.timeline({easing:t?e?"easeInElastic(1, 1)":"easeOutBack":e?"easeInBack":"easeOutElastic(1, 1)",duration:t?600:e?400:600,autoplay:!1}).add({targets:".game-nav li button",delay:t||e?w.a.stagger(80,{start:n,from:0==this.currentNav?"first":2==this.currentNav?"last":"center"}):w.a.stagger(100,{start:t?3e3:1400,from:"center"}),scale:e?0:[0,1],translateZ:0},0).add({targets:".challenge-btn-content",delay:t||e?n:t?3e3:1400,scale:e?0:1,translateZ:0},0)}},{key:"fixResize",value:function(){var e=this,t=window.innerWidth,n=window.innerHeight,o=t/n;this.gameDesc.visible&&0==this.gameDesc.css.width&&setTimeout((function(){document.querySelector(".content-gd").removeAttribute("style"),e.gameDesc.onResize({ratio:o,width:t,height:n})}),0),this.bgNavBarAboveBlack.visible&&0==this.bgNavBarAboveBlack.css.width&&setTimeout((function(){document.querySelector(".cbc-target").removeAttribute("style"),e.bgNavBarAboveBlack.onResize({ratio:o,width:t,height:n})}),0)}},{key:"displayUi",value:function(){this.showTitleDesc=this.gameDesc.visible=this.gameDescIcon.visible=!0,this.fixResize();var e=window.innerWidth;this.titleDescJa.visible=this.titleDesc.visible=e>620,this.bgNavBarAboveBlack.visible=e>720}},{key:"animateIn",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=t?"easeInSine":"easeOutSine",o=t?200:this.animateInFirst?300:200,r=(this.animateInFirst,.8);t||this.displayUi(),this.animNavBarTL=w.a.timeline({easing:n,duration:1e3*r,autoplay:!1}).add({targets:this.bgNavBarAboveBlack.position,easing:n,y:t?[0,-.2]:[-.2,0],complete:function(){t&&(e.bgNavBarAboveBlack.visible=!1)}},o).add({targets:[this.materialAboveBlack.uniforms.amplitude],easing:"easeOutSine",value:t?[0,.022]:[.022,0],duration:t?1e3*r:3e3},o).add({targets:this.materialAboveBlack.uniforms.timev,easing:"easeOutSine",value:[0,8],duration:t?1e3*r:2e3},o),!t&&this.animateInFirst?this.animNavBarTL.add({targets:this.materialAboveBlack.uniforms.time,value:[-1.7,-.3],duration:1200,delay:300},0):this.animateInFirst||this.animNavBarTL.add({targets:[this.titleDesc.scale,this.titleDescJa.scale],easing:t?"easeInBack":"easeOutBack",x:t?0:1,y:t?0:1,duration:400},t?0:o).add({targets:[this.gameDescIcon.scale,this.gameDesc.scale],easing:t?"easeInBack":"easeOutBack",x:t?0:1,y:t?0:1,duration:400,complete:t?function(){e.showTitleDesc=e.gameDesc.visible=e.gameDescIcon.visible=e.titleDesc.visible=e.titleDescJa.visible=!1}:null},t?100:o).add({targets:".content-gd",easing:t?"easeInElastic(1, .5)":"easeOutElastic(1, .5)",opacity:t?0:[0,1],scale:t?0:[1.5,1],translateZ:0,duration:400},t?0:o).add({targets:".play-btn",easing:t?"easeInBack":"easeOutBack",scaleX:[t?1:0,t?0:1],scaleY:[t?1:0,t?0:1],rotate:[0,-6,0],translateZ:0,duration:400},t?0:o)}},{key:"animateOut",value:function(){this.gameDescIcon.visible&&this.animateIn(!0)}},{key:"onChallengeFromEnd",value:function(){var e=this;this.animateDesc(!1,!0),this.animateNavBtn(!1,!0),this.currentNav=3,this.fromChallengeEnd=!0,setTimeout((function(){e.bgNavBarAbove.visible=!0,e.animateDotUi(".bg-hlt-"+e.currentNav,!1,!0),e.animNavBarTL=w.a.timeline({easing:"easeOutSine",duration:0,autoplay:!1}).add({targets:e.bgNavBarAboveBlack.position,y:0},0).add({targets:e.materialAboveBlack.uniforms.amplitude,easing:"easeOutSine",value:0},0).add({targets:e.materialAboveBlack.uniforms.timev,easing:"easeOutSine",value:[0,8]},0)}),0)}},{key:"onLaunchDevMode",value:function(e){var t=e.gui.addFolder("fsefdsfdsfdsfs");t.open(),t.add(this.material.uniforms.rad,"value").min(-40).max(1e3).step(.001),t.add(this.material.uniforms.vRes.value,"y").min(-1e3).max(1e3).step(.001)}}]),e}(),R=function(){function e(t){Object(o.a)(this,e),Object(c.a)(this),this.scene=t,this.init()}return Object(r.a)(e,[{key:"init",value:function(){this.material=new d.ShaderMaterial({defines:{},fragmentShader:P,vertexShader:T,transparent:!0,depthTest:!1,depthWrite:!0,renderOrder:1,uniforms:{color:{type:"v4",value:new d.Vector4(.9411764706,.902,.196,1)},vRes:{type:"v2",value:new d.Vector2},factor:{value:1},time:{type:"f",value:0},direction:{value:0},rad:{value:0},bean:{type:"f",value:0},beanTime:{type:"f",value:0},timev:{type:"f",value:0},local:{type:"f",value:1},amplitude:{type:"f",value:0},speed:{type:"f",value:1},frequency:{type:"f",value:0}}}),this.wmaterial=this.material.clone(),this.wmaterial.uniforms.color.value=new d.Vector4(1,1,1,1),this.bgw=new I(new d.PlaneBufferGeometry(1,1,10,10),this.wmaterial),this.bgw.set({width:"100.001%",height:"100%",left:0,top:0}),this.scene.add(this.bgw),this.bmaterial=this.material.clone(),this.bmaterial.uniforms.color.value=new d.Vector4(.1411764706,.09411764706,.09019607843,1),this.bgb=new I(new d.PlaneBufferGeometry(1,1,10,10),this.bmaterial),this.bgb.set({width:"100.001%",height:"100%",left:0,top:0}),this.scene.add(this.bgb),this.bg=new I(new d.PlaneBufferGeometry(1,1,10,10),this.material),this.bg.set({width:"100.001%",height:"100%",left:0,top:0}),this.scene.add(this.bg),this.txt=this.addText(),this.scene.add(this.txt),this.txt.sync(),this.tmMat=this.txt.material,this.animateIn()}},{key:"addText",value:function(){var e=new A.Text,t=window.innerWidth;e.fontSize=(t>1330?.2:t/7600)*(t<400?1.5:1),e.text="About",e.position.y=0,e.font="/fonts/Ambit-Bold.woff",e.position.x=0,e.anchorX="center",e.anchorY="middle",e.glyphGeometryDetail=400;var n=this.bmaterial.clone();return n.uniforms.amplitude.value=.22,n.uniforms.frequency.value=0,n.uniforms.color.value=new d.Vector4(.9098039216,.8745098039,.1803921569,1),e.material=n,e}},{key:"animateIn",value:function(){var e=this;this.animationComplete=!1,this.bg.visible=this.bgb.visible=this.bgw.visible=this.txt.visible=!0,c.b.trigger({name:"lowPass"},!0),this.animTL=w.a.timeline({easing:"easeInSine",duration:1200,autoplay:!1}),this.animTL.add({targets:this.wmaterial.uniforms.time,value:[1.8,6.24],duration:900},0).add({targets:this.bmaterial.uniforms.time,value:[-1.5,-6.24],delay:100},0).add({targets:this.material.uniforms.time,value:[-1.5,-6.24],delay:200},0).add({targets:this.tmMat.uniforms.time,value:[-1.5,-6.24],delay:290},0).add({targets:".contact",opacity:[0,1],easing:"easeOutBack",duration:500,complete:function(){e.animationComplete=!0,e.animTL=null}},1200)}},{key:"animateOut",value:function(){var e=this;this.animationComplete=!1;c.b.trigger({name:"lowPass"},!1),this.animTL=w.a.timeline({easing:"easeOutSine",duration:1400,autoplay:!1}),this.animTL.add({targets:this.wmaterial.uniforms.time,value:1.5,delay:300,complete:function(){e.bg.visible=e.bgb.visible=e.bgw.visible=e.txt.visible=!1,e.animTL=null}}).add({targets:this.bmaterial.uniforms.time,value:-1.5,delay:200},0).add({targets:this.material.uniforms.time,value:-1.5,delay:100},0).add({targets:this.tmMat.uniforms.time,value:this.tmMat.uniforms.time.value>-6.24?-1.5:-10.7,duration:this.tmMat.uniforms.time.value>-6.24?1200:800,delay:0},0).add({targets:".contact",opacity:0,easing:"easeOutBack",duration:700},0)}},{key:"onResize",value:function(){this.txt&&(this.txt.fontSize=window.innerWidth>1330?.2:window.innerWidth/7600,this.txt.sync())}},{key:"onRaf",value:function(e){var t=e.delta,n=e.now;this.animationComplete&&(this.tmMat.uniforms.time.value+=t/3,this.tmMat.uniforms.time.value>-1.65&&(this.tmMat.uniforms.time.value=-10.7)),this.animTL&&this.animTL.tick(n)}}]),e}(),j=function(){function e(t,n){Object(o.a)(this,e),this.currentGame=n,this.scene=t,Object(c.a)(this),this.init()}return Object(r.a)(e,[{key:"init",value:function(){this.material=new d.ShaderMaterial({defines:{},fragmentShader:P,vertexShader:T,transparent:!0,depthTest:!1,renderOrder:1,uniforms:{color:{type:"v4",value:new d.Vector4(.1411764706,.09411764706,.09019607843,1)},vRes:{type:"v2",value:new d.Vector2},factor:{value:1},time:{type:"f",value:0},local:{type:"f",value:1},direction:{value:0},timev:{type:"f",value:0},amplitude:{type:"f",value:0},speed:{type:"f",value:1.15},frequency:{type:"f",value:0}}}),this.group=new d.Group,this.steps=["3","2","1","start"],this.step=0,this.txtbg=this.addText(!0),this.bgMaterial=this.txtbg.material,this.group.add(this.txtbg),this.txt=this.addText(!1),this.txtMaterial=this.txt.material,this.group.add(this.txt),this.group.visible=!1,this.scene.add(this.group),this.group.scale.x=this.group.scale.y=0,this.animateIn(!0,this.currentGame)}},{key:"addText",value:function(e){var t=new A.Text,n=window.innerWidth>760?.17:window.innerWidth/5500;if(t.fontSize=e?1.0588*n:n,t.text="start",t.font="/fonts/Ambit-Bold.woff",t.anchorX="center",t.anchorY="middle",t.material=this.material,t.glyphGeometryDetail=400,!e){var o=this.material.clone();t.material=o,o.uniforms.color.value=new d.Vector4(.9411764706,.902,.196,1)}return t.sync(),t}},{key:"animateIn",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.currentGame=n,this.step<3){this.group.visible=!0,this.step=t?0:this.step+1,this.txtbg.text=this.txt.text=this.steps[this.step],t&&n<3?z.g.sound.commit("sound/playSound",{fileName:"transition_"+n,volume:2===n?4:1}):3==this.step&&z.g.sound.commit("sound/playSound","sifflet"),z.g.sound.commit("sound/playSound","decompte");var o=window.innerWidth,r=o>920?.17:o/(o<700?5500:11e3);.17!=r&&this.step<3&&(r*=2),this.txtbg.fontSize=1.0588*r,this.txt.fontSize=r,this.txtbg.sync(),this.txt.sync();var c=600,l=t?0:60,h="easeOutElastic(1, .5)",d="easeOutBack";this.countdownTL=w.a.timeline({easing:h,duration:c,delay:l,autoplay:!1}),this.countdownTL.add({targets:this.group.scale,x:[0==this.step?0:.02,1],y:[0==this.step?0:.02,1],complete:function(){return e.animateOut()}}).add({targets:[this.txtMaterial.uniforms.amplitude,this.bgMaterial.uniforms.amplitude],easing:d,value:[-.22,0]},0).add({targets:this.txtMaterial.uniforms.timev,easing:d,value:[-.5,-.05]},0).add({targets:this.txtMaterial.uniforms.frequency,easing:d,value:[0,10]},0).add({targets:this.bgMaterial.uniforms.frequency,value:[0,30],duration:c+400},0).add({targets:this.bgMaterial.uniforms.timev,value:[-.5,-.05],duration:c+400},0)}else this.cancel()}},{key:"onStartGame",value:function(e){0==e.game&&this.group.visible&&this.animateOut(!0)}},{key:"cancel",value:function(){this.group.visible=!1,this.step=-1,this.txt.text="start",this.txtbg.text="start",this.txt.sync(),this.txtbg.sync(),this.countdownTL=null}},{key:"animateOut",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=600,o=t?0:400,r="easeInElastic(1, 1)";t&&(z.g.sound.commit("sound/stopSound","transition_1"),z.g.sound.commit("sound/stopSound","transition_2")),this.countdownTL=w.a.timeline({easing:r,duration:n,delay:o,autoplay:!1}),this.countdownTL.add({targets:this.group.scale,x:3==this.step?0:.02,y:3==this.step?0:.02,complete:function(){return t?e.cancel():e.animateIn(!1,e.currentGame)}}).add({targets:[this.txtMaterial.uniforms.amplitude,this.bgMaterial.uniforms.amplitude],value:-.22},0).add({targets:[this.txtMaterial.uniforms.timev,this.bgMaterial.uniforms.timev],value:-.5},0).add({targets:this.txtMaterial.uniforms.frequency,value:0},0).add({targets:this.bgMaterial.uniforms.frequency,value:0},0)}},{key:"onRaf",value:function(e){var t=e.now;this.countdownTL&&this.countdownTL.tick(t)}}]),e}();function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(x.a)(e);if(t){var r=Object(x.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(y.a)(this,n)}}var V=function(e){Object(f.a)(n,e);var t=F(n);function n(e){var r;return Object(o.a)(this,n),r=t.call(this),e&&(r.dom=document.querySelector(e)),r.aspect=r.winW/r.winH,r.unit=r.calculateUnitSize(),Object(c.a)(Object(v.a)(r)),r}return Object(r.a)(n,[{key:"set",value:function(e){var t=this;if(this.css=e,this.css.width){var n=this.css.width;if("string"==typeof n&&n.includes("%")){var o=parseFloat(n.substr(0,n.length-1));n=this.unit.width*(o/100)}else n=this.unit.width*(this.css.width/this.winW);this.w=n}if(this.css.height){var r=this.css.height;if("string"==typeof r&&r.includes("%")){var c=parseFloat(r.substr(0,r.length-1));r=this.unit.height*(c/100)}else r=this.unit.height*(this.css.height/this.winH);this.h=r}Object.entries(e).forEach((function(e){var n=e[0],o=e[1];t[n](o)})),this.updateMatrix(),this.position.set(0,0,0),this.rotation.set(0,0,0),this.scale.set(1,1,1),this.updateMatrix()}},{key:"left",value:function(e){this.css.left=e,"string"==typeof e&&e.includes("%")?(e=parseFloat(e.substr(0,e.length-1)),this.position.x=this.unit.width*(e/100)-.5*this.unit.width-this.w/2):this.position.x=this.unit.width*(e/this.winW)-.5*this.unit.width}},{key:"right",value:function(e){this.css.right=e,"string"==typeof e&&e.includes("%")?(e=parseFloat(e.substr(0,e.length-1)),this.position.x=this.unit.width*(-e/100)+.5*this.unit.width-this.w):this.position.x=this.unit.width*(-e/this.winW)+.5*this.unit.width-this.w}},{key:"top",value:function(e){this.css.top=e,"string"==typeof e&&e.includes("%")?(e=parseFloat(e.substr(0,e.length-1)),this.position.y=this.unit.height*(-e/100)+.5*this.unit.height+this.h/2):this.position.y=this.unit.height*(-e/this.winH)+.5*this.unit.height}},{key:"bottom",value:function(e){this.css.bottom=e,"string"==typeof e&&e.includes("%")?(e=parseFloat(e.substr(0,e.length-1)),this.position.y=this.unit.height*(e/100)-.5*this.unit.height+this.h):this.position.y=this.unit.height*(e/this.winH)-.5*this.unit.height+this.h}},{key:"width",value:function(e){this.css.width=e,"string"==typeof e&&e.includes("%")?(e=parseFloat(e.substr(0,e.length-1)),this.scale.x=this.unit.width*(e/100)):this.scale.x=this.unit.width*(e/this.winW),this.scale.z=2.25*this.scale.x}},{key:"height",value:function(e){this.css.height=e,"string"==typeof e&&e.includes("%")?(e=parseFloat(e.substr(0,e.length-1)),this.scale.y=this.unit.height*(e/100)):this.scale.y=this.unit.height*(e/this.winH)}},{key:"calculateUnitSize",value:function(){var e=35*Math.PI/180,t=2*Math.tan(e/2)*1;return{width:t*this.aspect,height:t}}},{key:"updateDom",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.dom=document.querySelector(e);var rect=this.dom.getBoundingClientRect();this.css={left:rect.left,top:rect.top,width:rect.width,height:rect.height},this.set(this.css)}},{key:"onResize",value:function(e){var t=e.ratio,n=e.width,o=e.height;if(this.aspect=t,this.winW=n,this.winH=o,this.dom){var rect=this.dom.getBoundingClientRect();this.css={left:rect.left,top:rect.top,width:rect.width,height:rect.height}}this.unit=this.calculateUnitSize(),this.css&&this.set(this.css)}}]),n}(d.Group),U=(n(70),n(40),n(46),n(27),n(8)),N=(n(99),n(378),n(379),n(353),n(354),n(355),n(356),n(357),n(358),n(359),n(360),n(361),n(362),n(363),n(364),n(365),n(366),n(367),n(368),n(369),n(370),n(371),n(372),n(373),n(374),n(375),n(376),n(164),n(36)),W=function(e){d.Loader.call(this,e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={format:null,astcSupported:!1,bptcSupported:!1,etcSupported:!1,dxtSupported:!1,pvrtcSupported:!1}};W.taskCache=new WeakMap,W.prototype=Object.assign(Object.create(d.Loader.prototype),{constructor:W,setTranscoderPath:function(path){return this.transcoderPath=path,this},setWorkerLimit:function(e){return this.workerLimit=e,this},detectSupport:function(e){var t=this.workerConfig;if(t.astcSupported=!!e.extensions.get("WEBGL_compressed_texture_astc"),t.bptcSupported=!!e.extensions.get("EXT_texture_compression_bptc"),t.etcSupported=!!e.extensions.get("WEBGL_compressed_texture_etc1"),t.dxtSupported=!!e.extensions.get("WEBGL_compressed_texture_s3tc"),t.pvrtcSupported=!!e.extensions.get("WEBGL_compressed_texture_pvrtc")||!!e.extensions.get("WEBKIT_WEBGL_compressed_texture_pvrtc"),t.astcSupported)t.format=W.BASIS_FORMAT.cTFASTC_4x4;else if(t.bptcSupported)t.format=W.BASIS_FORMAT.cTFBC7_M5;else if(t.dxtSupported)t.format=W.BASIS_FORMAT.cTFBC3;else if(t.pvrtcSupported)t.format=W.BASIS_FORMAT.cTFPVRTC1_4_RGBA;else{if(!t.etcSupported)throw new Error("THREE.BasisTextureLoader: No suitable compressed texture format found.");t.format=W.BASIS_FORMAT.cTFETC1}return this},load:function(e,t,n,o){var r=this,c=new d.FileLoader(this.manager);c.setResponseType("arraybuffer"),c.load(e,(function(n){if(W.taskCache.has(n))return W.taskCache.get(n).promise.then(t).catch(o);r._createTexture(n,e).then(t).catch(o)}),n,o)},_createTexture:function(e,t){var n,o,r=this,c=e.byteLength,l=this._allocateWorker(c).then((function(t){return n=t,o=r.workerNextTaskID++,new Promise((function(t,r){n._callbacks[o]={resolve:t,reject:r},n.postMessage({type:"transcode",id:o,buffer:e},[e])}))})).then((function(e){var t,n=r.workerConfig,o=e.width,c=e.height,l=e.mipmaps;switch(e.format){case W.BASIS_FORMAT.cTFASTC_4x4:t=new d.CompressedTexture(l,o,c,d.RGBA_ASTC_4x4_Format);break;case W.BASIS_FORMAT.cTFBC7_M5:t=new d.CompressedTexture(l,o,c,d.RGBA_BPTC_Format);break;case W.BASIS_FORMAT.cTFBC1:case W.BASIS_FORMAT.cTFBC3:t=new d.CompressedTexture(l,o,c,W.DXT_FORMAT_MAP[n.format],d.UnsignedByteType);break;case W.BASIS_FORMAT.cTFETC1:t=new d.CompressedTexture(l,o,c,d.RGB_ETC1_Format);break;case W.BASIS_FORMAT.cTFPVRTC1_4_RGB:t=new d.CompressedTexture(l,o,c,d.RGB_PVRTC_4BPPV1_Format);break;case W.BASIS_FORMAT.cTFPVRTC1_4_RGBA:t=new d.CompressedTexture(l,o,c,d.RGBA_PVRTC_4BPPV1_Format);break;default:throw new Error("THREE.BasisTextureLoader: No supported format available.")}return t.minFilter=1===l.length?d.LinearFilter:d.LinearMipmapLinearFilter,t.magFilter=d.LinearFilter,t.generateMipmaps=!1,t.needsUpdate=!0,t}));return l.catch((function(){return!0})).then((function(){n&&o&&(n._taskLoad-=c,delete n._callbacks[o])})),W.taskCache.set(e,{url:t,promise:l}),l},_initTranscoder:function(){var e=this;if(!this.transcoderPending){var t=new d.FileLoader(this.manager);t.setPath(this.transcoderPath);var n=new Promise((function(e,n){t.load("basis_transcoder.js",e,void 0,n)})),o=new d.FileLoader(this.manager);o.setPath(this.transcoderPath),o.setResponseType("arraybuffer");var r=new Promise((function(e,t){o.load("basis_transcoder.wasm",e,void 0,t)}));this.transcoderPending=Promise.all([n,r]).then((function(t){var n=Object(N.a)(t,2),o=n[0],r=n[1],c=W.BasisWorker.toString(),body=["/* basis_transcoder.js */",o,"/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([body])),e.transcoderBinary=r}))}return this.transcoderPending},_allocateWorker:function(e){var t=this;return this._initTranscoder().then((function(){var n;t.workerPool.length<t.workerLimit?((n=new Worker(t.workerSourceURL))._callbacks={},n._taskLoad=0,n.postMessage({type:"init",config:t.workerConfig,transcoderBinary:t.transcoderBinary}),n.onmessage=function(e){var t=e.data;switch(t.type){case"transcode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.BasisTextureLoader: Unexpected message, "'+t.type+'"')}},t.workerPool.push(n)):t.workerPool.sort((function(a,b){return a._taskLoad>b._taskLoad?-1:1}));return(n=t.workerPool[t.workerPool.length-1])._taskLoad+=e,n}))},dispose:function(){for(var i=0;i<this.workerPool.length;i++)this.workerPool[i].terminate();return this.workerPool.length=0,this}}),W.BASIS_FORMAT={cTFETC1:0,cTFETC2:1,cTFBC1:2,cTFBC3:3,cTFBC4:4,cTFBC5:5,cTFBC7_M6_OPAQUE_ONLY:6,cTFBC7_M5:7,cTFPVRTC1_4_RGB:8,cTFPVRTC1_4_RGBA:9,cTFASTC_4x4:10,cTFATC_RGB:11,cTFATC_RGBA_INTERPOLATED_ALPHA:12,cTFRGBA32:13,cTFRGB565:14,cTFBGR565:15,cTFRGBA4444:16},W.DXT_FORMAT={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779},(W.DXT_FORMAT_MAP={})[W.BASIS_FORMAT.cTFBC1]=W.DXT_FORMAT.COMPRESSED_RGB_S3TC_DXT1_EXT,W.DXT_FORMAT_MAP[W.BASIS_FORMAT.cTFBC3]=W.DXT_FORMAT.COMPRESSED_RGBA_S3TC_DXT5_EXT,W.BasisWorker=function(){var e,t,n;onmessage=function(o){var r,c,l=o.data;switch(l.type){case"init":e=l.config,r=l.transcoderBinary,t=new Promise((function(e){c={wasmBinary:r,onRuntimeInitialized:e},BASIS(c)})).then((function(){var e=c,t=e.BasisFile,o=e.initializeBasis;n=t,o()}));break;case"transcode":t.then((function(){try{for(var t=function(t){var o=new n(new Uint8Array(t)),r=o.getImageWidth(0,0),c=o.getImageHeight(0,0),l=o.getNumLevels(0),h=o.getHasAlpha();function d(){o.close(),o.delete()}if(!h)switch(e.format){case 9:e.format=8}if(!r||!c||!l)throw d(),new Error("THREE.BasisTextureLoader:\tInvalid .basis file");if(!o.startTranscoding())throw d(),new Error("THREE.BasisTextureLoader: .startTranscoding failed");for(var m=[],v=0;v<l;v++){var f=o.getImageWidth(0,v),y=o.getImageHeight(0,v),x=new Uint8Array(o.getImageTranscodedSizeInBytes(0,v,e.format));if(!o.transcodeImage(x,0,v,e.format,0,h))throw d(),new Error("THREE.BasisTextureLoader: .transcodeImage failed.");m.push({data:x,width:f,height:y})}return d(),{width:r,height:c,hasAlpha:h,mipmaps:m,format:e.format}}(l.buffer),o=t.width,r=t.height,c=t.hasAlpha,h=t.mipmaps,d=t.format,m=[],i=0;i<h.length;++i)m.push(h[i].data.buffer);self.postMessage({type:"transcode",id:l.id,width:o,height:r,hasAlpha:c,mipmaps:h,format:d},m)}catch(e){console.error(e),self.postMessage({type:"error",id:l.id,error:e.message})}}))}}};n(219);var H=function(e,t){e.traverse((function(e){!function(e,t){e.material&&(e.material.uniforms&&Object.keys(e.material.uniforms).forEach((function(t){var n=e.material.uniforms[t];n&&(n.value instanceof d.CanvasTexture||n.value instanceof d.Texture)&&n.value.dispose()})),e.material.dispose()),e.geometry&&e.geometry.dispose(),t.remove(e)}(e,t)}))},X=function(){function e(t,n,r){var l=this;Object(o.a)(this,e),this.settings={},this.scene=n,this.cap=r.cap,Object.assign(this.settings,r),Object(c.a)(this),this.model=new d.Group,t.traverse((function(e){e instanceof d.Mesh&&l.addModel(e)}))}return Object(r.a)(e,[{key:"destroy",value:function(){c.b.listeners=[],c.b.unregister(this),H(this.model,this.scene)}},{key:"addBody",value:function(e,t,n){var o=new d.Mesh(new d.BoxBufferGeometry(.28,.387,.28));return o.name="body"+("player"===e.type?"player":""),this.body=o,this.body.physicVelocity=new d.Vector3,this.body.visible=!1,n.add(o),t.addMesh(o,3),t.setMeshPosition(o,e.position),o}},{key:"addModel",value:function(e){var t=this.cap.default;e.name.includes("skin")?t=this.cap.skin:"hair"===e.name?t=this.cap.hair:"Body"===e.name&&(t=this.cap.yellow);var n={};this.settings.alphaMap&&(n.USE_ALPHAMAP=!0),n.USE_FOG=!0,n.FOG_EXP2=!0,e.material.normalMap&&(n.TANGENTSPACE_NORMALMAP=!0),e.material.normalMap&&(n.USE_NORMALMAP=!0),this.settings.shadow&&(n.USE_SHADOW=!0),t&&(n.USE_MATCAP=!0),e.material.map&&(n.USE_MAP=!0),n.USE_UV=!0;var o=new d.ShaderMaterial({defines:n,wireframe:!1,transparent:this.settings.transparent||!1,flatShading:this.settings.flatShading||!1,side:this.settings.side||d.FrontSide,vertexShader:"#define GLSLIFY 1\n#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\nvarying vec2 vUv;\nvarying vec2 vUv2;\nuniform float time;\n\n#include <common>\n#include <displacementmap_pars_vertex>\nvarying float fogDepth;\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#ifdef USE_SHADOW\nuniform mat4 viewMatrixCamera;\nuniform mat4 projectionMatrixCamera;\nuniform mat4 modelMatrixCamera;\nvarying vec4 vWorldPosition;\n//varying vec3 vNNormal;\nvarying vec4 vTexCoords;\n#endif\n\n#define SCALE 1.0\nfloat calculateSurface(float x, float z) {\n\tfloat y = 0.0;\n\ty += (sin(x * 1.0 / SCALE + time * 1.0) + sin(x * 2.3 / SCALE + time * 1.5) + sin(x * 3.3 / SCALE + time * 0.4)) / 3.0;\n\ty += (sin(z * 0.2 / SCALE + time * 1.8) + sin(z * 1.8 / SCALE + time * 1.8) + sin(z * 2.8 / SCALE + time * 0.8)) / 3.0;\n\treturn y;\n}\nvec3 mod289(vec3 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat snoise(vec3 v) {\n\tconst vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\tconst vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\n\t// First corner\n\tvec3 i  = floor(v + dot(v, C.yyy) );\n\tvec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\n\t// Other corners\n\tvec3 g = step(x0.yzx, x0.xyz);\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min( g.xyz, l.zxy );\n\tvec3 i2 = max( g.xyz, l.zxy );\n\t\n\t//   x0 = x0 - 0.0 + 0.0 * C.xxx;\n\t//   x1 = x0 - i1  + 1.0 * C.xxx;\n\t//   x2 = x0 - i2  + 2.0 * C.xxx;\n\t//   x3 = x0 - 1.0 + 3.0 * C.xxx;\n\tvec3 x1 = x0 - i1 + C.xxx;\n\tvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\tvec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\t\n\t// Permutations\n\ti = mod289(i);\n\tvec4 p = permute( permute( permute(\n\t\t\t\ti.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t+ i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n\t\t\t\t+ i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t\t\t\n\t// Gradients: 7x7 points over a square, mapped onto an octahedron.\n\t// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n\tfloat n_ = 0.142857142857; // 1.0/7.0\n\tvec3  ns = n_ * D.wyz - D.xzx;\n\t\n\tvec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\t\n\tvec4 x_ = floor(j * ns.z);\n\tvec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\n\tvec4 x = x_ *ns.x + ns.yyyy;\n\tvec4 y = y_ *ns.x + ns.yyyy;\n\tvec4 h = 1.0 - abs(x) - abs(y);\n\t\n\tvec4 b0 = vec4( x.xy, y.xy );\n\tvec4 b1 = vec4( x.zw, y.zw );\n\t\n\t//vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n\t//vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n\tvec4 s0 = floor(b0)*2.0 + 1.0;\n\tvec4 s1 = floor(b1)*2.0 + 1.0;\n\tvec4 sh = -step(h, vec4(0.0));\n\t\n\tvec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\tvec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\n\tvec3 p0 = vec3(a0.xy,h.x);\n\tvec3 p1 = vec3(a0.zw,h.y);\n\tvec3 p2 = vec3(a1.xy,h.z);\n\tvec3 p3 = vec3(a1.zw,h.w);\n\t\n\t// Normalise gradients\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\t\n\t// Mix final noise value\n\tvec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\tm = m * m;\n\treturn 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t}\n\n\t\nvoid main() {\n  \tvUv = uv;\n\tvUv2 = uv;\n\tvec3 pos = position;\n\t#include <beginnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\tfloat strength = 1.0;\n\t#include <begin_vertex>\n\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\n\tfloat noiseFreq = 3.5;\n\tfloat noiseAmp = 0.025; \n\tvec3 noisePos = vec3(pos.x * noiseFreq + (time), pos.y, pos.z);\n\tpos.z += snoise(noisePos) * noiseAmp * noiseAmp;\n\tpos.y += snoise(noisePos) * noiseAmp;\n\n\tvec4 worldPosition = modelMatrix * vec4( pos, 1.0 );\n\tvec4 mvvPosition =  viewMatrix * worldPosition; // used in fog_vertex\n\n\tgl_Position = projectionMatrix * mvvPosition;\n\tfogDepth = -mvvPosition.z;\n\n\t//#include <logdepthbuf_vertex>\n}",fragmentShader:"#define GLSLIFY 1\nuniform float alpha;\nuniform float time;\nuniform vec2 repeat;\nuniform float useMatCap;\nuniform float useMixColor;\nuniform float zoomScale;\nuniform float useFakeFog;\nuniform vec3 color;\nuniform sampler2D map;\nuniform sampler2D matcap;\nuniform sampler2D aoMap;\nuniform float aoMapIntensity;\nvarying vec2 vUv;\n\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include <normalmap_pars_fragment>\n#include <uv2_pars_fragment>\nvarying float fogDepth;\n#define saturate(a) clamp( a, 0.0, 1.0 )\n\nuniform sampler2D shadow;\n\n#ifdef USE_SHADOW\nvarying vec4 vTexCoords;\nuniform mat4 viewMatrixCamera;\nuniform mat4 projectionMatrixCamera;\nuniform mat4 modelMatrixCamera;\n#endif\n\n// varying vec4 vWorldPosition;\n// varying vec3 vNNormal;\n\nconst float gamma = 1.8;\n\nfloat toGamma(float v) {\n  return pow(v, 1.0 / gamma);\n}\n\nvec2 toGamma(vec2 v) {\n  return pow(v, vec2(1.0 / gamma));\n}\n\nvec3 toGamma(vec3 v) {\n  return pow(v, vec3(1.0 / gamma));\n}\n\nvec4 toGamma(vec4 v) {\n  return vec4(toGamma(v.rgb), v.a);\n}\n\nvec3 linearToneMapping(vec3 color) {\n  float exposure = 2.;\n  color = clamp(exposure * color, 0., 1.);\n  color = pow(color, vec3(1. / 2.2));\n  return color;\n}\n\nvec4 layer(vec4 foreground, vec4 background) {\n    return foreground * foreground.a + background * (1.0 - foreground.a);\n}\n\nvoid main() {\n\n  #ifdef USE_SHADOW\n    vec2 uvCloud = (vTexCoords.xy / vTexCoords.w) * 0.05 + 0.5;\n    uvCloud.x -= time / 50.;\n    vec4 outColor = texture2D(shadow, uvCloud);\n    outColor.a *= .8;\n  #endif\n\n\tvec4 diffuseColor = vec4( vec3(1.), alpha );\n  //vec3 material = texture2D(matCap, viewNormal).rgb;\n\n  #ifdef USE_MAP\n    vec2 sUv = vUv; \n    sUv.x *= repeat.x;\n    sUv.y *= repeat.x;\n    vec4 texelColor = texture2D( map, sUv);\n   // texelColor = mapTexelToLinear( texelColor );\n   diffuseColor *= texelColor;\n  #endif\n\n  #ifndef USE_MAP\n    diffuseColor.rgb = linearToneMapping(color);\n  #endif\n  \n  #include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n  vec3 viewDir = normalize( vViewPosition );\n  vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n  vec3 y = cross( viewDir, x );\n  vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n   \n   // ao override matcap\n    #ifdef USE_AOMAP\n      // reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n      float ambientOcclusion = ( texture2D( aoMap, vUv * repeat.x).r - 1.0 ) * .7 + 1.0;\n    \tdiffuseColor.rgb *= ambientOcclusion;\n    #endif\n\n    #ifdef USE_MATCAP\n      vec4 matcapColor = texture2D( matcap, uv );\n    //  gl_FragColor = vec4(mix(diffuseColor, material, colorIntense), alpha - zoomScale);\n    #endif\n    #ifndef USE_MATCAP\n      vec4 matcapColor = vec4( 1.0 );\n    #endif\n\n  vec3 outgoingLight = toGamma(diffuseColor.rgb * matcapColor.rgb).rgb;\n  vec4 mx;\n\n  #ifdef USE_SHADOW\n    mx = layer(outColor, vec4( outgoingLight.rgb, diffuseColor.a ));\n    gl_FragColor = vec4(mx.rgb, alpha);\n  #endif\n  #ifndef USE_SHADOW\n    mx = vec4( outgoingLight.rgb, diffuseColor.a );\n    gl_FragColor = mx;\n  #endif\n\n  #include <tonemapping_fragment>\n\t#include <encodings_fragment>\n  if (useFakeFog > 0.0) {\n    float fogFactor = 1.0 - exp( - 0.0025 * fogDepth * fogDepth );\n    gl_FragColor = mix( vec4(mx.rgb, alpha), vec4(.0), fogFactor );\n  }\n}\n",uniforms:{repeat:{type:"vec2",value:e.material.map.repeat||new d.Vector2(1)},color:{value:e.material.color},map:{type:"t",value:e.material.map},elementFocused:{type:"f",value:0},zoomScale:{type:"f",value:0},normalScale:{value:new d.Vector2(5)},normalMap:{value:e.material.normalMap},alphaMap:{type:"t",value:null},useFakeFog:{value:0},time:{value:0},matcap:{type:"t",value:t},useMixColor:{type:"f",value:1},colorIntense:{type:"f",value:.4},alpha:{type:"f",value:1},viewMatrixCamera:{type:"m4",value:this.settings.viewMatrixCamera},projectionMatrixCamera:{type:"m4",value:this.settings.projectionMatrixCamera},modelMatrixCamera:{type:"mat4",value:this.settings.modelMatrixCamera},projPosition:{type:"v3",value:this.settings.projPosition},shadow:{value:this.settings.shadow}}});o.extensions.derivatives=!!e.material.normalMap;var r=new d.Mesh(e.geometry,o);r.name=e.name,e.name.includes("hand")&&(r.scale.z=-1,e.name.includes("left")?this.leftHand=r:this.rightHand=r),this.model.add(r)}},{key:"resetHands",value:function(e){if(this.animCharacter=null,void 0!==e){e.animKatana&&e.animKatana.pause();var t=e.ref.getObjectByName("katana");t&&(t.visible=!1);var n=e.ref.children.find((function(e){return e.name.includes("left")})),o=e.ref.children.find((function(e){return e.name.includes("right")}));n.position.set(0,0,0),o.position.set(0,0,0)}else this.leftHand.position.set(0,0,0),this.rightHand.position.set(0,0,0)}},{key:"animateHands",value:function(e){var t=this;this.animCharacter=w.a.timeline({autoplay:!1,duration:e,easing:"easeOutQuint",delay:0,complete:function(){t.animCharacter=null}}),this.animCharacter.add({targets:this.leftHand.position,x:[0,0,.06,.06,.06,.06,0],y:[0,.3,0],duration:1200},0),this.animCharacter.add({targets:this.rightHand.position,x:[0,0,-.06,-.06,-.06,-.06,0],y:[0,.3,0],duration:1200},0)}},{key:"handsPhysics",value:function(e,t,n){e.ball=e.ref.getObjectByName("ball");var o=e.ref.children.find((function(e){return e.name.includes("left")})),r=e.ref.children.find((function(e){return e.name.includes("right")})),c=d.MathUtils.clamp(t.y/10,-.25,.25);n?(o.position.z=2*-c,r.position.z=2*-c):(o.position.y=-c,r.position.y=-c),t.y<.1&&n&&(o.position.z=0,r.position.z=0,o.position.y=0,r.position.y=0)}},{key:"animateKatana",value:function(e,t){var n=this,o=e.ref.getObjectByName("katana");if(o){e.ball=e.ref.getObjectByName("ball");var r=e.ref.children.find((function(e){return e.name.includes("left")})),c=e.ref.children.find((function(e){return e.name.includes("right")}));if(o.visible=!0,t)return e.animKatana&&e.animKatana.pause(),e.ball.visible=!1,r.position.set(.14,.4,.3),c.position.set(-.14,.4,.3),o.position.set(0,.32,.45),o.rotation.set(-.3,0,0),void(e.ref.rotation.y=0);if(e.animKatana=w.a.timeline({duration:300,easing:"easeOutQuint",delay:0,complete:function(){e.ball.visible=!1,o.visible=!1,e.animKatana=null,e.invincible&&n.animateKatana(e,!0)}}),e.animKatana.add({targets:r.position,x:[.14,.14,.14,.14,.14,.14,0],z:[.4,.4,.4,.4,.4,0],y:[.3,0,0,0,0],duration:300},0),e.animKatana.add({targets:c.position,x:[-.14,-.14,-.14,-.14,-.14,0],z:[.4,.4,.4,.4,.4,0],y:[.3,0,0,0,0],duration:300},0),e.animKatana.add({targets:o.position,y:[.32,-.08,-.08,-.08,-.08],z:[.45,.28,.28,.28,.28],duration:300},0),e.animKatana.add({targets:e.ref.rotation,y:[0,2.7,2.7,2.7,2.7],duration:300},0),e.animKatana.add({targets:o.rotation,x:[0,1.3,1.3,1.3,1.3],duration:300},0),e.ball){e.ball.visible=!0;var l=e.ball.getObjectByName("sphereleft"),h=e.ball.getObjectByName("sphereright");setTimeout((function(){e.ball.visible=!1,e.ref.rotation.y=0,o.visible=!1}),300),e.animKatana.add({targets:l.position,y:[0,1],x:[0,-1],duration:300,complete:function(){e.ball.visible=!1,o.visible=!1,e.ref.rotation.y=0}},0),e.animKatana.add({targets:h.position,y:[0,.6],x:[0,1],duration:300},0)}}}},{key:"onRaf",value:function(e){var t=e.now;this.animCharacter&&this.animCharacter.tick(t),this.model.children.forEach((function(e){e.material.uniforms.time}))}}]),e}(),Y=!l.a.safari&&!l.a.ios,K=Y?"basis/":"",J=null,Z={asset:[{id:"capw",type:"texture",url:"/img/matcaps/"+K+"white."+(Y?"basis":"png")},{id:"capRock",type:"texture",url:"/img/matcaps/"+K+"rock2."+(Y?"basis":"png")},{id:"captoon",type:"texture",url:"/img/matcaps/"+K+"midtoon."+(Y?"basis":"jpg")},{id:"iron2",type:"texture",url:"/img/matcaps/"+K+"iron2."+(Y?"basis":"png")},{id:"gold",type:"texture",url:"/img/matcaps/"+K+"gold."+(Y?"basis":"jpg")},{id:"hair",type:"texture",url:"/img/matcaps/"+K+"hair."+(Y?"basis":"png")},{id:"yellow2",type:"texture",url:"/img/matcaps/"+K+"yellow2."+(Y?"basis":"png")},{id:"bomb",type:"texture",url:"/img/textures/"+K+"bomb."+(Y?"basis":"jpg")},{id:"wood",type:"texture",url:"/img/textures/"+K+"wood."+(Y?"basis":"png")},{id:"rock",type:"texture",url:"/img/textures/"+K+"rock."+(Y?"basis":"png")},{id:"clouds",type:"texture",url:"/img/textures/"+K+"clouds"+(Math.random()<.6?"":Math.random()<.6?"2":"3")+"."+(Y?"basis":"png")},{id:"sky",type:"texture",url:"/img/textures/"+K+"sky."+(Y?"basis":"jpg")},{id:"water",type:"texture",url:"/img/textures/"+K+"water2."+(Y?"basis":"png")},{id:"ball",type:"texture",url:"/img/normals/"+K+"ball."+(Y?"basis":"jpg")}]},Q=[],$={dad:"",neko:"",girl:"",girl2:"",happy:"",kid:"",mom:"",ninja:"",sushi:""},ee=[{font:"/fonts/Ambit-Black.woff",characters:"VS"},{font:"/fonts/Ambit-Bold.woff",characters:["1","2","3","start","About","Great!","Ouch!"]},{font:"/fonts/katakana.woff",characters:["ドキドキ","ヒヤヒヤ","ワクワク"]},{font:"/fonts/icomoon.woff",characters:["","",""]}],te=function(){function e(){Object(o.a)(this,e),Object(c.a)(this),this.camera=new C,this.charactersGroup=new d.Group,this.charactersGroup.position.z=-.8,this.charactersGroup.scale.set(0,0,0),this.charactersPickedGroup=new d.Group,this.init(),this.rotateY=.17,this.rotateYModulo=.17,this.rotateYModuloTgt=.17,this.deltaAdded=0,this.deltaAlpha=0,this.mouse=new d.Vector2,this.onResize({width:window.innerWidth})}return Object(r.a)(e,[{key:"init",value:function(){this.currentGame=0,this.scene=new d.Scene,this.intro=new D(this.scene),this.scene.add(this.charactersGroup),this.scene.add(this.charactersPickedGroup)}},{key:"onResize",value:function(e){var t=e.width;this.charactersGroup&&(this.charactersGroup.position.y=t<700?.2:0,this.charactersGroup.position.z=t<700?0:-.8),this.charactersPickedGroup&&(this.charactersPickedGroup.position.z=t<700?-1:0)}},{key:"presentCharacters",value:function(){var e=this,i=0;Object.entries($).forEach((function(t){i++;var n=new V(".chmain");n.add(t[1].model),n.ref=t[1],n.name=t[0];var o=i/9*Math.PI*2;t[1].model.position.x=Math.cos(o),t[1].model.position.z=Math.sin(o),n.position.set(0,0,0),n.scale.set(1,1,1),n.visible=!0,n.idVisible=i,n.children[0].children[0].rys=n.children[0].children[0].rotation.y,n.children[0].children.forEach((function(e){var t=e.rotation.y;e.rys=t})),e.charactersGroup.add(n)})),this.modelTL=w.a.timeline({autoplay:!1,easing:"easeOutQuint",duration:2400,delay:1e3,complete:function(){e.charLoaded=!0,e.bounceVal(!0)}}),c.b.trigger({name:"charLoaded"}),this.modelTL.add({targets:this.charactersGroup.scale,x:[.5,1],y:[.5,1],z:[.5,1],duration:2400},0),this.modelTL.add({targets:this.charactersGroup.position,y:[-1,this.charactersGroup.position.y],duration:2400},0),this.modelTL.add({targets:this.charactersGroup.rotation,y:[-2,.17],duration:2400},0)}},{key:"onPickChange",value:function(e){var t=e.direction;this.bounceVal("left"!==t,!0)}},{key:"onPickCharacter",value:function(){var e=this;if(!l.a.skipIntro){var t;if(this.characterIsPicking=!0,z.d.character.length>0){var n=this.charactersGroup.children.findIndex((function(element){return element.name==z.d.character})),o=this.charactersGroup.children.splice(n,1);this.charactersGroup.children.unshift(o[0]),t=this.charactersGroup.children[0]}else t=this.charactersGroup.children.sort((function(a,b){return b.position.y-a.position.y}))[0];Object.entries($).forEach((function(e){e[1].animCharacter=null})),this.modelTL=w.a.timeline({autoplay:!1,easing:"easeInQuint",duration:1200,delay:0,complete:function(){e.characterIsPicking=!1,e.characterPickedAnimDone=!0,Object.entries($).forEach((function(e){e[1].resetHands()})),e.charactersGroup.children.forEach((function(e){e.visible=!1})),t.visible=!0,e.pickStep2(t)}}),this.modelTL.add({targets:this.charactersGroup.scale,x:[1,0],y:[1,0],z:[1,0]},0).add({targets:this.charactersGroup.position,y:-1},0).add({targets:this.charactersGroup.rotation,y:this.charactersGroup.rotation.y+.6},0);var r=4*Math.PI;this.charactersGroup.children.forEach((function(t){t.children.forEach((function(t){e.modelTL.add({easing:"easeInBack",targets:t.rotation,y:[t.rotation.y-r,t.rys]},0)}))}))}}},{key:"pickStep2",value:function(e){this.characterPicked=e,this.characterPicked.ref.selected=!0,$[z.a[0].character].selected=!0,$[z.a[1].character].selected=!0,Object.entries($).forEach((function(e){var t=e[1];t.animateHands=null,t.animCharacter=null,t.selected||t.destroy()})),z.d.character=this.characterPicked.name,this.characterPicked.children[0].rotation.y=0,this.characterPicked.traverse((function(e){e.rotation.y=0})),this.charactersPickedGroup.add(this.characterPicked),$[z.a[0].character].model.rotation.y=0,$[z.a[0].character].model.traverse((function(e){e.rotation.y=0})),this.IA1=$[z.a[0].character].model.clone(),this.IA1.scale.set(.6,.6,.6),this.IA1.position.x=-.35,this.IA1.children[0].rotation.y=0,this.IA1.position.y=-.1,this.IA1.position.z=-.8;var t=new V(".chleft");t.add(this.IA1),this.charactersPickedGroup.add(t),this.IA1.visible=!0,$[z.a[1].character].model.rotation.y=0,$[z.a[1].character].model.traverse((function(e){e.rotation.y=0})),this.IA2=$[z.a[1].character].model.clone(),this.IA2.scale.set(.6,.6,.6);var n=new V(".chright");this.IA2.position.x=.35,this.IA2.position.y=-.1,this.IA2.position.z=-.8,this.IA2.children[0].rotation.y=0,n.add(this.IA2),this.charactersPickedGroup.add(n),this.IA2.visible=!0,z.g.sound.commit("sound/playSound","spinning_characters_trio_in"),this.modelTL=w.a.timeline({easing:"easeOutQuint",duration:2e3,autoplay:!1}).add({targets:this.charactersPickedGroup.scale,x:[0,1],y:[0,1]}).add({targets:this.IA2.rotation,y:[50,0]},0).add({targets:this.IA1.rotation,y:[-50,0]},0),null!=z.b.uid&&this.modelTL.add({targets:this.charactersGroup.scale,x:1,y:1,duration:600},0),this.animCharacter=w.a.timeline({duration:150,loop:!0,direction:"alternate",easing:"linear",delay:0}),this.animCharacter.add({targets:this.characterPicked.children[0].children.find((function(e){return e.name.includes("left")})).position,x:{value:[-.03,.01]},y:{value:[.07,.17]},z:[.2,.2]},0),c.b.trigger({name:"characterLocked"})}},{key:"onIntroOut",value:function(){var e=this;l.a.introEnded,z.g.sound.commit("sound/playSound","spinning_characters_trio_out"),this.modelTL=w.a.timeline({easing:"easeInBack",duration:1200,autoplay:!1}),this.modelTL.add({targets:this.charactersPickedGroup.scale,x:0,y:0}),l.a.introEnded=!0,this.characterPicked&&(this.animCharacter=null,this.characterPicked.ref.resetHands(),this.modelTL.add({targets:this.characterPicked.scale,x:0,y:0,delay:100,complete:function(){e.uiIntroEnded=!0,H(e.charactersPickedGroup,e.scene),H(e.charactersGroup,e.scene)}},0)),this.IA2&&this.modelTL.add({targets:this.IA2.rotation,y:this.IA2.rotation.y+30},0),this.IA1&&this.modelTL.add({targets:this.IA1.rotation,y:this.IA1.rotation.y-30},0)}},{key:"updateCharactersVisibility",value:function(){}},{key:"onStartSite",value:function(){var e=this;setTimeout((function(){e.mainNav=new G(e.scene),e.score={value:0}}),0)}},{key:"onPointerMove",value:function(e){var t=e.pointer;this.mouse.x=t.x/window.innerWidth*2-1,this.mouse.y=-t.y/window.innerHeight*2+1,l.a.isMobile()||(this.mouse.x=35e-5*(t.x-window.innerWidth/2),this.mouse.y=55e-5*(t.y-window.innerHeight/2))}},{key:"lerp",value:function(a,b,e){return(1-e)*a+e*b}},{key:"bounceVal",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this,r=n?this.rotateYModuloTgt:this.rotateYModulo,c=r+(t?1:-1)/9*Math.PI*2;this.rotateYModuloTgt=c,this.bounceTween=w.a.timeline({duration:n?1e3:1900,easing:n?"easeOutBack":"easeOutElastic(1.5, 1.)",autoplay:!1}).add({targets:o,rotateYModulo:c,complete:n?null:function(){e.bounceVal(!0)}});var l=4*Math.PI;this.charactersGroup.children.forEach((function(o){o.ref.animateHands&&(o.ref.animateHands(n?1600:1900),o.children[0].children.forEach((function(o){e.bounceTween.add({easing:"easeInOutQuint",duration:n?1600:1900,targets:o.rotation,y:[o.rotation.y+(Math.abs(o.rotation.y)<14?t?-l:l:0),o.rys]},0)})))}))}},{key:"onPointerStart",value:function(){this.characterPicked||(this.mouse.x<0?this.deltaAlpha-1<0?this.deltaAlpha=10:this.deltaAlpha--:this.deltaAlpha++,this.updateCharactersVisibility())}},{key:"lerpVector",value:function(a,b,e){a.x=this.lerp(a.x,b.x,e),a.y=this.lerp(a.y,b.y,e),a.z=this.lerp(a.z,b.z,e)}},{key:"onRaf",value:function(e){var t=this,n=e.delta,o=e.now;this.uiIntroEnded||(this.charLoaded&&(this.rotateY+=n/1.5,!this.characterPickedAnimDone&&this.bounceTween&&this.bounceTween.tick(o)),this.modelTL&&this.modelTL.tick(o),this.characterPicked&&this.IA1&&this.IA2?(this.IA1.rotation.y=this.lerp(this.IA1.rotation.y,this.rotateY,.08),this.IA2.rotation.y=this.lerp(this.IA2.rotation.y,-this.rotateY,.08),this.characterPicked.children.forEach((function(e){e.position.y=.02*Math.sin(o/200)})),this.lerpVector(this.characterPicked.position,new d.Vector3(0,-.2,-.8),.07),this.lerpVector(this.characterPicked.children[0].position,new d.Vector3(0,0,0),.07)):""==z.d.character&&(this.charactersGroup.children.forEach((function(e){e.position.y=(-3-1.5*e.children[0].getWorldPosition(new d.Vector3(0)).z)/4,e.children[0].rotation.y=-t.rotateYModulo})),this.charLoaded&&!this.characterIsPicking&&(this.charactersGroup.rotation.y=this.rotateYModulo)))}},{key:"startCountdown",value:function(){this.countdown?this.countdown.animateIn(!0,this.currentGame):this.countdown=new j(this.scene,this.currentGame)}},{key:"onStartGame",value:function(e){var t=e.game;if(!e.isNext)switch(this.endScreen&&this.endScreen.hide(),0==this.currentGame&&this.mainNav.animateOut(),this.currentGame=t,t){case 0:this.mainNav.animateIn();break;case 1:case 2:case 3:this.startCountdown()}}},{key:"onEndGame",value:function(e){var t=this;e.cancel||setTimeout((function(){t.endScreen?(t.endScreen.show(),t.endScreen.animateIn()):t.endScreen=new E(t.scene)}),0)}},{key:"onOpenContact",value:function(){z.g.sound.commit("sound/playSound",{fileName:"generic_woosh_"+Math.round(.5+5.5*Math.random()),volume:1}),this.mainNav.animateContact(),this.contact?this.contact.animateIn():this.contact=new R(this.scene)}},{key:"onCloseContact",value:function(){z.g.sound.commit("sound/playSound",{fileName:"generic_woosh_"+Math.round(.5+5.5*Math.random()),volume:1}),this.mainNav.animateContact(!1),this.contact.animateOut()}}]),e}(),ie=(n(53),n(393)),ae=n(44),ne=function(){function e(t,n){return Object(o.a)(this,e),this.geometry=t,this.name=n.name,this.settings={},this.instancedPosition={},Object.assign(this.settings,n),Object(c.a)(this),this.init()}return Object(r.a)(e,[{key:"init",value:function(){var e,t={};return this.settings.alphaMap&&(t.USE_ALPHAMAP=!0),this.settings.map&&(this.settings.map.encoding=d.sRGBEncoding),this.settings.cap&&(this.settings.cap.encoding=d.sRGBEncoding),t.USE_FOG=!0,t.FOG_EXP2=!0,this.settings.normalMap&&(t.TANGENTSPACE_NORMALMAP=!0),this.settings.normalMap&&(t.USE_NORMALMAP=!0),this.settings.cap&&(t.USE_MATCAP=!0),this.settings.aoMap&&(t.USE_AOMAP=!0),this.settings.shadow&&(t.USE_SHADOW=!0),this.settings.map&&(t.USE_MAP=!0),t.USE_UV=!0,this.settings.usemorphtargets&&(t.USE_MORPHTARGETS=!0),this.settings.alphaMap&&(t.ALPHATEST=.5),this.material=new d.ShaderMaterial({defines:t,wireframe:!1,transparent:this.settings.transparent||!1,flatShading:this.settings.flatShading||!1,side:this.settings.side||d.FrontSide,vertexShader:"#define GLSLIFY 1\n#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\nvarying vec2 vUv;\nvarying vec2 vUv2;\n\n#include <common>\n#include <displacementmap_pars_vertex>\nvarying float fogDepth;\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#ifdef USE_SHADOW\nuniform mat4 viewMatrixCamera;\nuniform mat4 projectionMatrixCamera;\nuniform mat4 modelMatrixCamera;\nvarying vec4 vWorldPosition;\n//varying vec3 vNNormal;\nvarying vec4 vTexCoords;\n#endif\n\nvoid main() {\n  \tvUv = uv;\n\tvUv2 = uv;\n\t#include <beginnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\n  \t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tfogDepth = -mvPosition.z;\n\tvViewPosition = - mvPosition.xyz;\n\n\t// todo maybe project from matrix of object in the sky on 0 in z and x and y 40\n\t#ifdef USE_SHADOW\n\t//\tvNNormal = mat3(modelMatrix) * normal;\n\t\tvWorldPosition = modelMatrix * vec4(position, 1.0);\n\t\tvTexCoords = viewMatrixCamera * vWorldPosition;\n\t#endif\n\n}",fragmentShader:"#define GLSLIFY 1\nuniform float alpha;\nuniform float time;\nuniform vec2 repeat;\nuniform float useMatCap;\nuniform float useMixColor;\nuniform float zoomScale;\nuniform float useFakeFog;\nuniform vec3 color;\nuniform sampler2D map;\nuniform sampler2D matcap;\nuniform sampler2D aoMap;\nuniform float aoMapIntensity;\nvarying vec2 vUv;\n\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include <normalmap_pars_fragment>\n#include <uv2_pars_fragment>\nvarying float fogDepth;\n#define saturate(a) clamp( a, 0.0, 1.0 )\n\nuniform sampler2D shadow;\n\n#ifdef USE_SHADOW\nvarying vec4 vTexCoords;\nuniform mat4 viewMatrixCamera;\nuniform mat4 projectionMatrixCamera;\nuniform mat4 modelMatrixCamera;\n#endif\n\n// varying vec4 vWorldPosition;\n// varying vec3 vNNormal;\n\nconst float gamma = 2.2;\n\nfloat toGamma(float v) {\n  return pow(v, 1.0 / gamma);\n}\n\nvec2 toGamma(vec2 v) {\n  return pow(v, vec2(1.0 / gamma));\n}\n\nvec3 toGamma(vec3 v) {\n  return pow(v, vec3(1.0 / gamma));\n}\n\nvec4 toGamma(vec4 v) {\n  return vec4(toGamma(v.rgb), v.a);\n}\n\nvec3 linearToneMapping(vec3 color) {\n  float exposure = 2.;\n  color = clamp(exposure * color, 0., 1.);\n  color = pow(color, vec3(1. / 2.2));\n  return color;\n}\n\nvec4 layer(vec4 foreground, vec4 background) {\n    return foreground * foreground.a + background * (1.0 - foreground.a);\n}\n\nvoid main() {\n\n  #ifdef USE_SHADOW\n    vec2 uvCloud = (vTexCoords.xy / vTexCoords.w) * 0.05 + 0.5;\n    uvCloud.x -= time / 50.;\n    vec4 outColor = texture2D(shadow, uvCloud);\n    outColor.a *= .8;\n  #endif\n\n\tvec4 diffuseColor = vec4( vec3(1.), alpha );\n  //vec3 material = texture2D(matCap, viewNormal).rgb;\n\n  #ifdef USE_MAP\n    vec2 sUv = vUv; \n    sUv.x *= repeat.x;\n    sUv.y *= repeat.x;\n    vec4 texelColor = texture2D( map, sUv);\n   // texelColor = mapTexelToLinear( texelColor );\n   diffuseColor *= texelColor;\n  #endif\n\n  #ifndef USE_MAP\n    diffuseColor.rgb = linearToneMapping(color);\n  #endif\n  \n  #include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n  vec3 viewDir = normalize( vViewPosition );\n  vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n  vec3 y = cross( viewDir, x );\n  vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n   \n   // ao override matcap\n    #ifdef USE_AOMAP\n      // reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n      float ambientOcclusion = ( texture2D( aoMap, vUv * repeat.x).r - 1.0 ) * .7 + 1.0;\n    \tdiffuseColor.rgb *= ambientOcclusion;\n    #endif\n\n    #ifdef USE_MATCAP\n      vec4 matcapColor = texture2D( matcap, uv );\n    //  gl_FragColor = vec4(mix(diffuseColor, material, colorIntense), alpha - zoomScale);\n    #endif\n    #ifndef USE_MATCAP\n      vec4 matcapColor = vec4( 1.0 );\n    #endif\n\n  vec3 outgoingLight = toGamma(diffuseColor.rgb * matcapColor.rgb).rgb;\n  vec4 mx;\n\n  #ifdef USE_SHADOW\n    mx = layer(outColor, vec4( outgoingLight.rgb, diffuseColor.a ));\n    gl_FragColor = vec4(mx.rgb, alpha);\n  #endif\n  #ifndef USE_SHADOW\n    mx = vec4( outgoingLight.rgb, diffuseColor.a );\n    gl_FragColor = mx;\n  #endif\n\n  #include <tonemapping_fragment>\n\t#include <encodings_fragment>\n  if (useFakeFog > 0.0) {\n    float fogFactor = 1.0 - exp( - 0.0025 * fogDepth * fogDepth );\n    gl_FragColor = mix( vec4(mx.rgb, alpha), vec4(.0), fogFactor );\n  }\n}\n",uniforms:(e={repeat:{type:"vec2",value:this.settings.repeat||new d.Vector2(1)},repeatN:{type:"vec2",value:this.settings.repeatN||new d.Vector2(1)},color:{value:this.settings.color},map:{type:"t",value:this.settings.map},time:{type:"f",value:0},zoomScale:{type:"f",value:0},normalScale:{value:this.settings.normalScale||new d.Vector2(5)},normalMap:{value:this.settings.normalMap},aoMap:{value:this.settings.aoMap},aoMapIntensity:{value:0},useMixColor:{type:"f",value:1},shadow:{value:this.settings.shadow},alphaMap:{type:"t",value:null},useFakeFog:{value:this.name&&this.name.includes("water")?1:0},matcap:{type:"t",value:null}},Object(ae.a)(e,"useMixColor",{type:"f",value:1}),Object(ae.a)(e,"colorIntense",{type:"f",value:.4}),Object(ae.a)(e,"alpha",{type:"f",value:this.settings.isBubble?.75:1}),Object(ae.a)(e,"viewMatrixCamera",{type:"m4",value:this.settings.viewMatrixCamera}),Object(ae.a)(e,"projectionMatrixCamera",{type:"m4",value:this.settings.projectionMatrixCamera}),Object(ae.a)(e,"modelMatrixCamera",{type:"mat4",value:this.settings.modelMatrixCamera}),Object(ae.a)(e,"projPosition",{type:"v3",value:this.settings.projPosition}),e)}),this.material.metalness=0,this.material.extensions.derivatives=!!this.settings.normalMap,this.settings.alphaMap&&(this.material.uniforms.alphaMap.value=this.settings.alphaMap,this.material.uniforms.alphaMap.value.needsUpdate=!0),this.settings.cap&&(this.material.uniforms.matcap.value=this.settings.cap),this.settings.instanced?("Cylinder"===this.settings.name?this.ref=new d.InstancedMesh(this.geometry,new d.MeshBasicMaterial({map:this.settings.map}),this.settings.count):this.ref=new d.InstancedMesh(this.geometry,this.settings.map?this.material:new d.MeshBasicMaterial({color:0}),this.settings.count),this):this.material}},{key:"setInstancedScaleAt",value:function(i,e){var t=new d.Object3D;t.scale.set(e.x,e.y,e.z),t.position.copy(this.instancedPosition[i]),t.updateMatrix(),this.ref.setMatrixAt(i,t.matrix),this.ref.instanceMatrix.needsUpdate=!0}},{key:"setPositionAndRotationX",value:function(i,e,t){var n=new d.Object3D;n.position.set(e),n.rotation.set(t,0,0),n.updateMatrix(),this.ref.setMatrixAt(i,n.matrix),this.ref.instanceMatrix.needsUpdate=!0}},{key:"onRaf",value:function(e){var t=e.delta;this.material&&(this.material.uniforms.time.value+=t)}},{key:"setInstancedMeshPositionAt",value:function(i,e){var t=new d.Matrix4;this.instancedPosition[i]=e,t.setPosition(e),this.ref.setMatrixAt(i,t),this.ref.needsUpdate=!0,this.ref.instanceMatrix.needsUpdate=!0}}]),e}(),oe=n(385);function re(e,t,n,o){var r=t.x,c=t.y,l=t.z,h=t.w,d=r+r,m=c+c,v=l+l,f=r*d,y=r*m,x=r*v,w=c*m,k=c*v,S=l*v,M=h*d,C=h*m,T=h*v;n[o+0]=1-(w+S),n[o+1]=y+T,n[o+2]=x-C,n[o+3]=0,n[o+4]=y-T,n[o+5]=1-(f+S),n[o+6]=k+M,n[o+7]=0,n[o+8]=x+C,n[o+9]=k-M,n[o+10]=1-(f+w),n[o+11]=0,n[o+12]=e.x,n[o+13]=e.y,n[o+14]=e.z,n[o+15]=1}function se(){var e=new oe.m;function t(e){var t=e.parameters||{};switch(e.type){case"BoxBufferGeometry":return(n=new oe.l).x=void 0!==t.width?t.width/2:.5,n.y=void 0!==t.height?t.height/2:.5,n.z=void 0!==t.depth?t.depth/2:.5,new oe.b(n);case"PlaneBufferGeometry":return new oe.g;case"BufferGeometry":var n;return(n=new oe.l).x=void 0!==t.width?t.width/2:.5,n.y=void 0!==t.height?t.height/2:.5,n.z=void 0!==t.depth?t.depth/2:.5,new oe.b(n);case"SphereBufferGeometry":var o=t.radius;return new oe.j(o)}return null}e.gravity.set(0,-9.8,0),e.broadphase=new oe.f,e.defaultContactMaterial.contactEquationStiffness=1e7,e.defaultContactMaterial.contactEquationRelaxation=5,e.allowSleep=!0;var n=[],o=new WeakMap;function r(t,r,c,l){var h=new oe.l;h.copy(t.position);var d=new oe.h;d.copy(t.quaternion);var m=oe.a.DYNAMIC;c instanceof oe.g||(0===r||l)&&(m=oe.a.KINEMATIC);var body=new oe.a(Object(ae.a)({position:h,quaternion:d,mass:r,shape:c,type:m,angularDamping:0,fixedRotation:!0},"type",m));body.fixedRotation=!0,r>0||c instanceof oe.g?body.allowSleep=!1:(body.allowSleep=!0,body.sleepSpeedLimit=.5,body.sleepTimeLimit=1),t.physic=body,e.addBody(body),n.push(t),o.set(t,body)}function c(body,e){e||body.position.setZero(),body.previousPosition.setZero(),body.interpolatedPosition.setZero(),body.initPosition.setZero(),body.quaternion.set(0,0,0,1),body.initQuaternion.set(0,0,0,1),body.previousQuaternion&&body.previousQuaternion.set(0,0,0,1),body.interpolatedQuaternion.set(0,0,0,1),body.velocity.setZero(),body.initVelocity.setZero(),body.angularVelocity.setZero(),body.initAngularVelocity.setZero(),body.force.setZero(),body.torque.setZero()}function l(t,r,c,l){for(var h=t.instanceMatrix.array,d=[],i=0;i<t.count;i++){var m=16*i,v=new oe.l;v.set(h[m+12],h[m+13],h[m+14]);var body=new oe.a({position:v,mass:r,shape:c,type:l||oe.a.DYNAMIC});e.addBody(body),d.push(body)}t.physic=d,r>0&&(t.instanceMatrix.setUsage(35048),n.push(t),o.set(t,d))}return{addMesh:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0,c=t(e.geometry);null!==c&&(e.isInstancedMesh?l(e,n,c,o):e.isMesh&&r(e,n,c,o))},setMeshPosition:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e&&e.isInstancedMesh){var r=o.get(e);r&&r[n]&&r[n].position.copy(t)}else if(e&&e.isMesh){var body=o.get(e);body&&body.position.copy(t)}},createImpulse:function(e,t,n){var body=o.get(e);if(body){c(body,!0);var r=new oe.l(0,0,0),l=new oe.l(0,.05*t,n||0);body.applyLocalImpulse(l,r)}},shootBallImpulse:function(e,t,n,r,c,progress){if(o.get(t)){var body=o.get(t)[e];if(body){var l=new oe.l,h=new oe.l(n.x,n.y,n.z);new oe.l(r.x,r.y,r.z).vsub(h,l);var d=l.length();l.normalize();var m=new oe.l(0,0,.04);body.quaternion.setFromVectors(m,l);var v=new oe.l;if(0===progress){var f=d/c;l.scale(f,body.velocity)}else progress>0?(l.scale(progress*d,v),v.y=6*Math.sin(Math.PI*progress),h.vadd(v,body.position)):progress>=1&&(body.velocity.set(0,0,0),body.position.copy(r))}}},world:e,step:function(t){for(var i=0,r=n.length;i<r;i++){var c=n[i];if(c.isInstancedMesh){var l=c.instanceMatrix.array,h=o.get(c);if(h)for(var d=0;d<h.length;d++){(body=h[d])&&re(body.position,body.quaternion,l,16*d)}c.instanceMatrix.needsUpdate=!0}else if(c.isMesh){var body;(body=o.get(c))&&(c.position.copy(body.position),c.quaternion.copy(body.quaternion))}}e.step(1/60,t,20)},moveToPosition:function(body,e,t){var n=new oe.l,o=new oe.l(e.x,0,e.z);o.vsub(body.position,n),n.y=0,n.normalize();var r=new oe.l(0,0,.04);body.quaternion.setFromVectors(r,n),3.5*body.position.distanceTo(o)<.05?(t=0,body.velocity.set(0,0,0),body.position.copy(e)):n.vmul(new oe.l(t,t,t),body.velocity)},moveKinematicToPosition:function(body,e,t,n,progress){var o=new oe.l,r=new oe.l(e.x,0,e.z);new oe.l(t.x,0,t.z).vsub(r,o);var c=o.length();o.y=0,o.normalize();var l=new oe.l(0,0,.04);body.quaternion.setFromVectors(l,o);var h=new oe.l;if(0===progress){var d=c/n;o.scale(d,body.velocity)}else progress>0?(o.scale(progress*c,h),r.vadd(h,body.position)):progress>=1&&(body.velocity.set(0,0,0),body.position.copy(t))},resetPhysic:c,enableMeshFromWeakMap:function(t,n){var data=null;if(n&&t&&t.physic)if(data=t.physic,t.physic.length>0)for(var i=0;i<t.physic;i++)e.addBody(t.physic[i]);else e.addBody(t.physic);else if(t&&t.physic)if(t.physic.length>0)for(i=0;i<t.physic;i++)e.removeBody(t.physic[i]);else e.removeBody(t.physic);t&&o.set(t,data)}}}function ce(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1,this.paused=!1}Object.assign(ce.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0,this.paused=!1},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},pause:function(){this.paused||(this.getDelta(),this.paused=!0)},resume:function(){this.paused&&(this.paused=!1,this.oldTime=(performance||Date).now())},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.paused)return 0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var le=function(e,t){e&&e.traverse((function(e){e instanceof d.Mesh&&(e.material.uniforms&&e.material.uniforms.alpha?e.material.uniforms.alpha.value=t:e.material.opacity=t)}))},ue=new d.Vector3(0),he=function(){function e(t,n){Object(o.a)(this,e),Object(c.a)(this)}return Object(r.a)(e,[{key:"start",value:function(e){this.clock.start(),c.b.trigger({name:"gameBegin"}),e<3&&c.b.trigger({name:"changeMusic"},{name:1==e?"game_jump_loop":"game_pirates",forceRepeat:!0})}},{key:"stop",value:function(){this.clock.stop()}},{key:"addGround",value:function(){this.plane=new d.Mesh(new d.PlaneBufferGeometry(8,8)),this.plane.rotation.x=-Math.PI/2,this.plane.visible=!1,this.gameGroup.add(this.plane),this.physics.addMesh(this.plane)}},{key:"init",value:function(e,t){this.shipWave=!1,this.scene=e,this.fakeCameraCloud=t,this.gameGroup=new d.Group,this.scene.add(this.gameGroup),this.cloud=Q.clouds,this.cloud.wrapS=this.cloud.wrapT=d.RepeatWrapping,this.counterModelGroup=new d.Group,this.counterModelCylinderGroup=new d.Group,this.clock=new ce(!1),this.duration=0,this.incrementPos=0,this.hadAlreadyContact={},this.currentGame=0,this.currentCat=0,this.gameDuration=30,this.scores={},this.charactersState={},this.initPhysics(),this.loadCharactersTextures()}},{key:"fixPhysicMeshPositions",value:function(e){var t=this;Object.keys(this.charactersState).forEach((function(n,o){var r=t.charactersState[n];e&&t.physics.resetPhysic(r.body.physic,!0),r.animMove&&(r.animMove=null),r.ref.rotation.set(0,0,0),r.class.resetHands(),r.body.physic.position.x=r.positionXCached,r.body.physic.position.z=0,2!==t.currentGame&&2!==t.currentCat&&(r.body.physic.type=1)}))}},{key:"onNavigation",value:function(e){var t=this,n=e.cat,o=2e3,r=window.innerWidth<769,c=window.innerWidth<400;this.currentCat=n,Object.keys(this.charactersState).forEach((function(e,n){var o=t.charactersState[e];o.animMove&&(o.animMove=null),o.body.physic.type=1,t.physics.createImpulse(o.body,600)})),z.g.sound.commit("sound/playSound","jump"),this.shipWave=!1,0==n?(this.scene.camera.animateToPoint(new d.Vector3(c?-.47:0,c?5.4:3.3,r?c?9:12.7:9),new d.Vector3(0,r?c?2:3.5:1,0),o,"easeInOutCubic",(function(){})),this.animScene=w.a.timeline({autoplay:!1,duration:o,easing:"easeInOutSine",complete:function(){t.animScene=null,t.fixPhysicMeshPositions()}}),this.animScene.add({targets:this.scene.island.position,y:0,x:0,z:0},0),this.animScene.add({targets:this.scene.water.position,x:0,z:0},0),this.animScene.add({targets:this.gameGroup.position,y:0,x:0},0),this.animScene.add({targets:this.scene.island.scale,y:1,x:1,z:1},0),this.animScene.add({targets:this.scene.position,x:0,y:0,z:0},0),this.animScene.add({targets:this.scene.island.rotation,y:0},0),this.animScene.add({targets:this.scene.water.rotation,z:0},0),this.animScene.add({targets:this.shipGroup.position,x:60,complete:function(){t.shipGroup.visible=!1}},0),this.animScene.add({targets:this.shipAlpha,value:0,delay:1700,duration:300,update:function(e){le(t.shipGroup,t.shipAlpha.value)}},0),this.animScene.add({targets:this.scene.mixer,time:0,update:function(){t.scene.mixer.setTime(t.scene.mixer.time),Object.keys(t.charactersState).forEach((function(e,n){t.charactersState[e];t.physics.setMeshPosition(t.plane,new d.Vector3(0,-.13*t.scene.mixer.time,0),0)}))}},0)):1==n?(this.shipGroup.visible=!0,this.scene.camera.animateToPoint(new d.Vector3(-1.13,1.52,r?9.18:4.7),new d.Vector3(0,r?1.52:.5,r?2.12:0),o,"easeInOutCubic",(function(){})),this.animScene=w.a.timeline({autoplay:!1,duration:o,easing:"easeInOutCubic",complete:function(){t.animScene=null,t.shipWave=!0,t.fixPhysicMeshPositions()}}),this.animScene.add({targets:this.scene.island.position,y:0,x:2,z:-12.6},0),this.animScene.add({targets:this.scene.water.position,x:2,z:-12.6},0),this.animScene.add({targets:this.gameGroup.position,y:0,x:0},0),this.animScene.add({targets:this.scene.island.scale,y:1,x:1,z:1},0),this.animScene.add({targets:this.scene.island.rotation,y:3.33},0),this.animScene.add({targets:this.scene.water.rotation,z:3.33},0),this.animScene.add({targets:this.scene.position,x:0,y:0,z:0},0),this.animScene.add({targets:this.sails.scale,x:[2,2,.4],easing:"easeOutQuad"},0),this.animScene.add({targets:this.shipAlpha,value:1,duration:300,update:function(e){le(t.shipGroup,t.shipAlpha.value)}},0),this.animScene.add({targets:this.shipGroup.position,y:[.4,-.4,.3,-.3,0],easing:"easeOutQuad",x:-2},0),this.animScene.add({targets:this.scene.mixer,time:0,update:function(){t.scene.mixer.setTime(t.scene.mixer.time),Object.keys(t.charactersState).forEach((function(e,n){var o=t.charactersState[e];o.ref.position.y=0,o.ref.position.z=-24.3*t.scene.mixer.time,t.physics.setMeshPosition(t.plane,new d.Vector3(0,-.13*t.scene.mixer.time,0),0)}))}},0)):2==n?(this.scene.camera.animateToPoint(new d.Vector3(c?-10:-6.45,14.07,r?c?15.36:10:6.6),new d.Vector3(r?c?2.84:.6:2.18,c?11.44:9.46,-6.74),o,"easeInOutCubic",(function(){}),!0),this.animScene=w.a.timeline({autoplay:!1,duration:o,easing:"easeInOutCubic",complete:function(){t.animScene=null,t.fixPhysicMeshPositions()}}),this.animScene.add({targets:this.scene.position,x:0,y:0,z:0},0),this.animScene.add({targets:this.scene.island.position,y:9,x:-.94,z:2.68},0),this.animScene.add({targets:this.gameGroup.position,y:9.8,x:0},0),this.animScene.add({targets:this.shipGroup.position,x:60,complete:function(){t.shipGroup.visible=!1}},0),this.animScene.add({targets:this.shipAlpha,value:0,delay:1700,duration:300,update:function(e){le(t.shipGroup,t.shipAlpha.value)}},0),this.animScene.add({targets:this.scene.island.scale,y:.5,x:.5,z:.5},0),this.animScene.add({targets:this.scene.island.rotation,y:0},0),this.scene.water&&this.animScene.add({targets:this.scene.water.rotation,z:0},0),this.animScene.add({targets:this.scene.mixer,time:1,update:function(){t.scene.mixer.setTime(t.scene.mixer.time),Object.keys(t.charactersState).forEach((function(e,n){var o=t.charactersState[e];o.position.x=o.positionXCached,t.physics.setMeshPosition(t.plane,new d.Vector3(0,-.13*t.scene.mixer.time,0),0)}))}},0)):(this.scene.camera.animateToPoint(new d.Vector3(c?-.5:-1.5,r?c?3.5:5:4.87,r?-25:-30),new d.Vector3(r?5.93:0,r?0:7.6,r?45:30),o,"easeInOutCubic",(function(){})),this.animScene=w.a.timeline({autoplay:!1,duration:o,easing:"easeInOutSine",complete:function(){t.animScene=null,t.fixPhysicMeshPositions()}}),this.animScene.add({targets:this.scene.position,x:0,y:0,z:0},0),this.animScene.add({targets:this.scene.island.position,y:0,x:3,z:1},0),this.animScene.add({targets:this.gameGroup.position,y:0,x:0},0),this.animScene.add({targets:this.scene.island.scale,y:1,x:1,z:1},0),this.animScene.add({targets:this.scene.island.rotation,y:0},0),this.animScene.add({targets:this.scene.water.rotation,z:0},0),this.animScene.add({targets:this.shipGroup.position,easing:"easeOutQuad",x:60,complete:function(){t.shipGroup.visible=!1}},0),this.animScene.add({targets:this.shipAlpha,value:0,delay:1700,duration:300,update:function(e){le(t.shipGroup,t.shipAlpha.value)}},0),this.animScene.add({targets:this.scene.mixer,time:0,update:function(){t.scene.mixer.setTime(t.scene.mixer.time),Object.keys(t.charactersState).forEach((function(e,n){t.charactersState[e].ref.rotation.y=1.7*t.scene.mixer.time,t.physics.setMeshPosition(t.plane,new d.Vector3(0,-.13*t.scene.mixer.time,0),0)}))}},0))}},{key:"displayPlayersName",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=[],o=null;Object.keys(this.charactersState).forEach((function(t,r){n.push(e.charactersState[t].nameRef),"player"==e.charactersState[t].type&&(o=e.charactersState[t].nameRef)})),t&&(o&&(o.text="You",o.fontSize=.1,o.color=16777215,o.sync()),n[0].visible=n[1].visible=n[2].visible=t),this.tlTxt=w.a.timeline({autoplay:!1,duration:600,delay:t?4800:0}).add({targets:[n[0].scale,n[1].scale,n[2].scale],easing:t?"easeInOutBack":"easeInBack",x:t?[0,1]:0,y:t?[0,1]:0,complete:t?null:function(){n[0].visible=n[1].visible=n[2].visible=t,e.tlTxt=null}},0).add({targets:[n[0].position,n[1].position,n[2].position],easing:t?"easeInOutBack":"easeInBack",y:t?[0,.48]:0},0)}},{key:"onGreet",value:function(e){var t=this,n=e.positive,o=null;Object.keys(this.charactersState).forEach((function(e,n){"player"==t.charactersState[e].type&&(o=t.charactersState[e].nameRef)})),o&&(o.visible=!0,o.fontSize=.3,o.color=n?15787570:9324429,o.text=n?"Great!":"Ouch!",o.sync(),this.tlTxt=w.a.timeline({autoplay:!1,duration:n?400:600,easing:"easeOutBack",delay:n?0:1100}).add({targets:o.scale,x:[0,1],y:[0,1],complete:function(){t.hideGreet(o,n)}},0).add({targets:o.position,y:[0,.8]},0))}},{key:"hideGreet",value:function(e,t){var n=this;this.tlTxt=w.a.timeline({autoplay:!1,duration:t?300:600,easing:"easeInBack"}).add({targets:e.scale,x:0,y:0,onComplete:function(){n.tlTxt=null,e.visible=!1}},0).add({targets:e.position,y:0},0)}},{key:"onStartGame",value:function(e){var t=e.game;this.currentGame=t,this.gameDuration=2===t?9999999:30,this.displayPlayersName(0!=t),this.fixPhysicMeshPositions(!0),0===t?(this.quitLevel(),this.physics.world.gravity.set(0,-9.8,0)):1===t?this.physics.world.gravity.set(0,-19.8,0):this.physics.world.gravity.set(0,-9.8,0),3===t&&c.b.trigger({name:"changeMusic"},{name:"game_bowser",forceRepeat:!0})}},{key:"quitLevel",value:function(){this.scene.camera.stopFollow(),this.clock.running&&(this.clock=new ce(!1),c.b.trigger({name:"endGame"},{cancel:!0}))}},{key:"initPhysics",value:function(){this.physics=new se,this.addGround(),this.debug()}},{key:"loadModel",value:function(e){"player"===e.type&&(e.character=z.d.character,this.currentPlayerRef=e),""==e.character&&(e.character="neko");var t=$[e.character];t.resetHands();var n=t.model.clone();n.rotation.x=0,n.rotation.y=0,n.rotation.z=0,t.leftHand=n.children.find((function(e){return e.name.includes("left")})),t.rightHand=n.children.find((function(e){return e.name.includes("right")})),n.children.forEach((function(e,t){})),t.katana=this.katanaRef.clone(),t.katana.visible=!1,n.add(t.katana),t.ball=this.splitBall.clone(),n.add(t.ball),"player"===e.type?(e.position=new d.Vector3(0,0,0),e.positionXCached=0,e.positionZCached=0,e.orderPosId=1):(e.position=new d.Vector3(this.incrementPos>0?1:-1,0,0),e.positionXCached=this.incrementPos>0?1:-1,e.positionZCached=0,e.orderPosId=e.position.x+1,this.incrementPos++),e.rotateSpeedX=0,e.stunLevel=0,e.life=0,e.wmStacked=0,e.invincible=!1,e.alreadyHitBall={},e.cannonAnim={},e.colorState=new d.Color(16634889),e.colorStateLerp=new d.Color(16634889),t.addBody(e,this.physics,this.gameGroup),n.position.copy(e.position),this.gameGroup.add(n),e.class=t,e.ref=n,e.body=t.body,e.body.collisionFilterGroup=1,e.body.uid=e.id,e.body.physic.uid=e.id,e.scores={level1:{max:z.d.savedMax1?z.d.savedMax1:0,current:0},level2:{max:z.d.savedMax2?z.d.savedMax2:0,current:0},level3:{max:z.d.savedMax3?z.d.savedMax3:0,current:0}},this.charactersState[e.id]=e,this.addPlayerName(e),this.addPlayerLifebar(e),this.addScore(e.id);var o=this.charactersState[e.id];o.counterRef=this.counterModelGroup.clone(),o.planeScore=o.counterRef.getObjectByName("plane"),o.planeScore.name="plane"+o.id,o.planeScore.material=new d.MeshBasicMaterial({color:0}),o.counterRef.position.set(o.position.x,o.position.y,0),o.counterRef.add(o.scoreModel),o.cylinderRef=o.counterRef.getObjectByName("Cylinder"),this.gameGroup.add(o.counterRef)}},{key:"loadCharacters",value:function(){var e=this;return new Promise((function(t){var n=[];n.push(new Promise((function(t,n){e.loadKatanaModel().then((function(data){t(data)}))}))),n.push(new Promise((function(t,n){e.loadBallModel().then((function(data){t(data)}))}))),n.push(new Promise((function(t,n){e.loadWatermelon().then((function(data){t(data)}))}))),n.push(new Promise((function(t,n){e.loadDrake().then((function(data){t(data)}))}))),n.push(new Promise((function(t,n){e.loadShip(),e.loadCounterModel().then((function(data){t(data)}))}))),Promise.all(n).then((function(n){z.a.forEach((function(t){e.loadModel(t)})),e.loadModel(z.d),c.b.trigger({name:"everyModelsLoaded"}),t(n)}))}))}},{key:"onCharacterLocked",value:function(){this.loadCharacters()}},{key:"loadCharactersTextures",value:function(){this.capMap=Q.captoon,this.iron2=Q.iron2,this.gold=Q.gold,this.yellow=Q.yellow2}},{key:"lerpVector",value:function(a,b,e){a.x=this.lerp(a.x,b.x,e),a.y=this.lerp(a.y,b.y,e),a.z=this.lerp(a.z,b.z,e),a.w&&b.w&&(a.w=this.lerp(a.w,b.w,e))}},{key:"updateCharactersPositionFromPhysicEngine",value:function(){var e=this;Object.keys(this.charactersState).forEach((function(t,n){var o=e.charactersState[t],r=o.ref,body=o.body;r&&(2===e.currentCat||3===e.currentGame||2===e.currentGame?(r.scale.x=1,2===e.currentGame?(r.position.y=0,r.position.z=0):(r.position.z=e.lerp(r.position.z,body.position.z,.5),r.position.x=e.lerp(r.position.x,body.position.x,.5),r.position.y=e.lerp(r.position.y,Math.max(.0634,body.position.y)-body.geometry.parameters.height/2,.5),3===e.currentGame&&e.dragonGroup?(o.playerStunned&&"player"===o.type?r.lookAt(e.scene.camera.getWorldPosition(ue)):(o.playerStunned||(r.rotation.x=e.lerp(r.rotation.x,0,.14),r.rotation.z=e.lerp(r.rotation.z,0,.14)),r.rotation.y=e.lerp(r.rotation.y,Math.atan2(e.dragonGroup.position.x-r.position.x,e.dragonGroup.position.z-r.position.z),.14)),Math.abs(body.position.y)<=.6&&!o.isBumped&&(o.playerStunned=!1)):e.animScene||o.destinationlevel3&&(o.playerStunned||(r.rotation.x=e.lerp(r.rotation.x,0,.14),r.rotation.z=e.lerp(r.rotation.z,0,.14)),r.rotation.y=e.lerp(r.rotation.y,Math.atan2(o.destinationlevel3.x-r.position.x,o.destinationlevel3.z-r.position.z),.14))),e.updateBodyShapeCharacter(o)):(r.rotation.y=0,r.position.x=e.lerp(r.position.x,o.position.x,.5),1===e.currentGame||0===e.currentGame?r.position.z=0:r.position.z=e.lerp(r.position.z,body.position.z,.5),e.updateBodyShapeCharacter(o)))}))}},{key:"updateBodyShapeCharacter",value:function(e){if(e.nameRef.lookAt(this.scene.camera.getWorldPosition(ue)),e.lifeBar.lookAt(this.scene.camera.getWorldPosition(ue)),e&&e.ref){var t=d.Math.smootherstep(e.body.physic.velocity.y,0,6),n=d.Math.smootherstep(e.body.physic.velocity.y,-7,-5);if(this.hadAlreadyContact[e.id]&&(e.hadAlreadyContact=!1,this.hadAlreadyContact[e.id]=!1),2!==this.currentGame&&3!==this.currentGame&&2!==this.currentCat&&(e.ref.position.y=this.lerp(e.ref.position.y,e.body.position.y-e.body.geometry.parameters.height/2-(.2-n/5),1)),3===this.currentGame&&!e.playerStunned)return e.ref.scale.y=this.lerp(e.ref.scale.y,1,.25),e.ref.scale.x=this.lerp(e.ref.scale.x,1,.25),void(e.ref.scale.z=this.lerp(e.ref.scale.z,1,.25));if(2!==this.currentGame&&e.class.handsPhysics(e,e.body.physic.velocity,3===this.currentGame||!this.animScene&&2===this.currentCat),2===this.currentGame&&e.died&&1==e.stunLevel)return e.ref.scale.x=0,e.ref.scale.y=0,void(e.ref.scale.z=0);e.ref.scale.y=this.lerp(e.ref.scale.y,1+t-(.5-n/2)-(e.stunLevel||0),.25),e.ref.scale.x=this.lerp(e.ref.scale.x,1-t/2+(.5-n/2),.25),e.ref.scale.z=this.lerp(e.ref.scale.z,1-t/2+(.5-n/2),.25)}}},{key:"checkEndGame",value:function(e){(this.clock.running&&this.gameElapsedTime>this.gameDuration||e)&&(this.stop(),this.clock=new ce(!1),c.b.trigger({name:"endGame"},{cancel:!1}))}},{key:"addPlayerLifebar",value:function(e){var t=new d.PlaneBufferGeometry(.5,.07),n=new d.ShaderMaterial({defines:{},fragmentShader:"precision highp float;\n#define GLSLIFY 1\nuniform float direction;\nuniform float factor;\nuniform vec2 vRes;\nuniform float time;\n\nvarying vec2 meshUv;\n\nfloat udRoundBox( vec2 p, vec2 b, float r )\n{\n    return length(max(abs(p)-b+r,0.0))-r;\n}\n\nvoid main()\t{\n  vec2 u = .5 - meshUv;\n\tvec4 c = mix(vec4(0.9411764706, 0.902, 0.196, 1.), vec4(0.9294117647, 0.737254902, 0.04705882353, 1.), factor * factor * factor);\n  u.x += 0.5 - factor;\n\tgl_FragColor = mix(vec4(0.1411764706, 0.09411764706, 0.09019607843, 1.), c, step(.01,u.x));\n}",vertexShader:L,transparent:!0,uniforms:{color:{type:"v4",value:new d.Vector4(.1411764706,.09411764706,.09019607843,1)},vRes:{type:"v2",value:new d.Vector2},factor:{value:1},rad:{type:"f",value:0},time:{type:"f",value:.49},direction:{value:0},local:{type:"f",value:1}}}),o=new d.Mesh(t,n);o.position.y=.5,e.ref.add(o),this.charactersState[e.id].lifeBar=o,o.visible=!1}},{key:"addPlayerName",value:function(e){var t=new A.Text;e.ref.add(t),this.charactersState[e.id].nameRef=t,t.text=e.name,t.fontSize=.1,t.textAlign="center",t.position.y=.48,t.font="/fonts/Ambit-Bold.woff",t.position.x=0,t.maxWidth=100,t.anchorX="center",t.color=16777215,t.sync(),t.visible=!1}},{key:"addScore",value:function(e){var t=new A.Text;t.text="000",t.name="score"+e,t.fontSize=.1,t.textAlign="center",t.position.y=.07,t.position.z=.12,t.visible=!1,t.font="/fonts/Ambit-Bold.woff",t.position.x=0,t.maxWidth=2,t.anchorX="center",t.color=15856113,t.sync(),this.charactersState[e].scoreModel=t}},{key:"loadDrake",value:function(){var e=this;return new Promise((function(t){e.viewMatrixCamera=e.fakeCameraCloud.matrixWorldInverse.clone(),e.projectionMatrixCamera=e.fakeCameraCloud.projectionMatrix.clone(),e.modelMatrixCamera=e.fakeCameraCloud.matrixWorld.clone(),e.projPosition=e.fakeCameraCloud.position.clone(),e.dragonGroup=new d.Group,e.dragonGroup.position.z=-3,e.gameGroup.add(e.dragonGroup),e.scene.loaderDraco.load("dragon2.glb",(function(n){var o=n.scene||n.scenes[0];o.traverse((function(t){t instanceof d.Mesh&&(t.material=new ne(t.geometry,{map:t.material.map,color:t.material.color,name:t.name,transparent:!0,cap:e.gold}),t.visible=!1)})),e.dragonGroup.add(o.clone()),t()}))}))}},{key:"loadShip",value:function(){var e=this;return new Promise((function(t){e.viewMatrixCamera=e.fakeCameraCloud.matrixWorldInverse.clone(),e.projectionMatrixCamera=e.fakeCameraCloud.projectionMatrix.clone(),e.modelMatrixCamera=e.fakeCameraCloud.matrixWorld.clone(),e.projPosition=e.fakeCameraCloud.position.clone(),e.shipGroup=new d.Group,e.shipAlpha={value:0},e.shipGroup.position.z=-18,e.shipGroup.position.x=60,e.shipGroup.rotation.y=.6,e.sails=[],e.scene.add(e.shipGroup),e.shipGroup.visible=!1,e.scene.loaderDraco.load("ship.glb",(function(n){(n.scene||n.scenes[0]).children.forEach((function(t){t.material&&(t.material=new ne(t.geometry,{map:t.material.map,color:t.material.color,name:t.name,transparent:!0,side:t.name.includes("flag")?d.DoubleSide:d.FrontSide,cap:Q.captoon})),t.visible=!0;var n=t.clone();e.shipGroup.add(n),"flagAn"==t.name?e.sails.push(n):"flagSn"==t.name&&(e.flag=n)})),t()}))}))}},{key:"updateScore",value:function(e,t){var n=this.charactersState[e].scoreModel;n.visible=!0,n.text=t+"",n.sync()}},{key:"loadWatermelon",value:function(){var e=this;return new Promise((function(t){e.scene.loaderDraco.load("watermelon.glb",(function(n){var o=n.scene||n.scenes[0];o.children.forEach((function(n){var r=new ne(n.geometry,{name:n.name,map:n.material.map,cap:Q.captoon,color:new d.Color(16777215),instanced:!0,side:d.DoubleSide,normalMap:!1,count:17}).ref;o.name="watermelon",o.visible=!0,e.watermelon=r,e.gameGroup.add(e.watermelon),t()}))}))}))}},{key:"loadKatanaModel",value:function(){var e=this;return new Promise((function(t){e.scene.loaderDraco.load("katana.glb",(function(n){var o=n.scene||n.scenes[0];e.katanaRef=new X(o,e.scene,{cap:{default:Q.yellow},transparent:!0}).model.children[0].clone(),e.katanaRef.visible=!0,e.katanaRef.name="katana",t()}))}))}},{key:"loadBallModel",value:function(){var e=this;return new Promise((function(t){e.scene.loaderDraco.load("splitball.glb",(function(n){var o=n.scene||n.scenes[0];o.children.forEach((function(e){e.material=new ne(e.geometry,{name:e.name,map:e.material.map,side:d.DoubleSide,color:e.material.color,flatShading:!(!e.name.includes("rock")&&"grass"!=e.name&&!e.name.includes("grass2")),normalMap:!1}),e.matrixAutoUpdate=!0})),o.name="ball",o.position.y=.6,o.visible=!1,e.splitBall=o,t()}))}))}},{key:"loadCounterModel",value:function(){var e=this;return new Promise((function(t){e.viewMatrixCamera=e.fakeCameraCloud.matrixWorldInverse.clone(),e.projectionMatrixCamera=e.fakeCameraCloud.projectionMatrix.clone(),e.modelMatrixCamera=e.fakeCameraCloud.matrixWorld.clone(),e.projPosition=e.fakeCameraCloud.position.clone(),e.scene.loaderDraco.load("counter.glb",(function(n){(n.scene||n.scenes[0]).children.forEach((function(t){"Cylinder"===t.name?t.material=new ne(t.geometry,{map:t.material.map,color:new d.Color(16777215),name:t.name,transparent:!0,side:d.DoubleSide,normalMap:Q.capRock,aoMap:Q.capRock}):t.material.map?t.material=new ne(t.geometry,{map:t.material.map,name:t.name,transparent:!0,cap:Q.iron2}):t.material=new d.MeshBasicMaterial({color:0}),t.visible=!1,e.counterModelGroup.add(t.clone())})),e.counterModelGroup.add(e.counterModelCylinderGroup),Object.keys(e.charactersState).forEach((function(t,n){e.charactersState[t]})),t()}))}))}},{key:"onRaf",value:function(e){var t=e.now,n=e.delta;this.delta=n,this.animScene&&this.animScene.tick(t),this.tl&&this.tl.tick(t),this.tlTxt&&this.tlTxt.tick(t),this.physics&&(this.physics.step(n),this.updateCharactersPositionFromPhysicEngine()),this.cannonDebugRenderer&&this.cannonDebugRenderer.update(),this.clock&&(this.gameElapsedTime=this.clock.getElapsedTime(),c.b.trigger({name:"gameClockProgress"},{value:this.gameElapsedTime/this.gameDuration})),this.shipGroup&&this.shipWave&&(this.shipGroup.position.y=.025+-.05*Math.cos(t/900),this.shipGroup.visible&&(this.flag.rotation.y=-.036*Math.cos(t/60),this.sails&&this.sails.length>0&&this.sails.forEach((function(e){e.rotation.y=-.018*Math.cos(t/180)}))))}},{key:"onLowRaf",value:function(e){e.delta,e.deltaLow;l.a.introEnded&&this.clock&&this.checkEndGame()}},{key:"lerp",value:function(a,b,e){return(1-e)*a+e*b}},{key:"addHelpers",value:function(e,t,n){var o=this,r=e.addFolder(t),c=n.ref;r.open(),r.add(c.position,"x").min(-1.6).max(1.6).step(.001).onChange((function(){o.physics.setMeshPosition(n.body,c.position)})),r.add(c.position,"y").min(-1.6).max(1.6).step(.001).onChange((function(){o.physics.setMeshPosition(n.body,c.position)})),r.add(c.position,"z").min(-1.6).max(1.6).step(.001).onChange((function(){o.physics.setMeshPosition(n.body,c.position)}))}},{key:"debug",value:function(){var e=this;l.a.dev&&!window.debugModeLoaded&&n.e(9).then(n.bind(null,398)).then((function(t){e.cannonDebugRenderer=new t.CannonDebugRenderer(e.gameGroup,e.physics.world)}))}},{key:"onLaunchDevMode",value:function(e){var t=this,n=e.gui;this.plane.material.wireframe=!0,this.plane.visible=!0;var o=n.addFolder("Gravity");o.open(),o.add(this.physics.world.gravity,"y").min(-40.6).max(40.6).step(.001),Object.keys(this.charactersState).forEach((function(e,o){var r=t.charactersState[e];t.addHelpers(n,r.name,r)}));var r=n.addFolder("Scene island position");r.open(),r.add(this.scene.dragonChara.position,"x").min(-12).max(12).step(.01),r.add(this.scene.dragonChara.position,"y").min(-12).max(12).step(.01),r.add(this.scene.dragonChara.rotation,"y").min(-10).max(10).step(.01),r.add(this.scene.dragonChara.position,"z").min(-12).max(12).step(.01)}}]),e}(),de=n(394),me=function(){function e(t){Object(o.a)(this,e),this.mouse=t,void 0!==window.DeviceOrientationEvent&&this.startHandleDeviceOrientation()}return Object(r.a)(e,[{key:"handleDeviceOrientation",value:function(e){var t=this;window.addEventListener("orientationchange",(function(e){t.handleRotation(e)}),!1),window.addEventListener("deviceorientation",(function(e){t.handleRotation(e)}),!1)}},{key:"handleRotation",value:function(e){e.alpha;var b=e.beta,t=.004*e.gamma,n=.004*(32-b);this.mouse.x=Math.abs(t)>.4?t>0?.4:-.4:t,this.mouse.y=Math.abs(n)>.4?n>0?.4:-.4:n}},{key:"startHandleDeviceOrientation",value:function(){window.DeviceOrientationEvent&&(document.querySelector(".screen-ori-btn")&&document.querySelector(".screen-ori-btn").classList.add("disable"),this.handleDeviceOrientation())}}]),e}(),ve=function(){function e(img){var t=this;Object(o.a)(this,e),this.onRaf=function(e){var n=e.delta,o=e.now;l.a.introEnded&&(t.material.uniforms.time.value+=n/1e3,t.animeBg&&t.animeBg.tick(o))},this.onChange=function(){t.mesh.material.uniforms.color0.value.setHex(t.config.color0),t.mesh.material.uniforms.color1.value.setHex(t.config.color1)},Object(c.a)(this),this.config={color0:16777215,color1:37869},this.material=new d.ShaderMaterial({uniforms:{map:{value:img},color0:{value:new d.Color(this.config.color0)},color1:{value:new d.Color(this.config.color1)},color2:{value:new d.Vector3(.9411764706,.902,.196)},challenge:{value:-1.9},challengePow:{value:0},strength:{value:10},powStrength:{value:.8},time:{value:0},hd:{value:1}},vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;\nvarying float fogDepth;\n#include <common>\n\nvoid main() {\n    vUv = uv;\n\n    #include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    fogDepth = -mvPosition.z;\n}",fragmentShader:"#define GLSLIFY 1\nuniform vec3 color0;\nuniform vec3 color1;\nuniform vec3 color2;\nuniform sampler2D map;\nuniform float strength;\nuniform float time;\nuniform float challenge;\nuniform float challengePow;\nuniform float hd;\nuniform float powStrength;\nvarying vec2 vUv;\nvarying float fogDepth;\n\nvec2 rotateUV(vec2 uv, float rotation)\n{\n    float mid = 0.5;\n    return vec2(\n        (uv.x - mid) + rotation, uv.y);\n}\n\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3333333333333333) * direction;\n  color += texture2D(image, uv) * 0.29411764705882354;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n  return color; \n}\n\nvoid main() {\n    vec2 uv = vUv;\n    uv.x = 1.0 - uv.x;\n    uv.y = 1.0 - uv.y;\n    uv.y *= .95;\n    vec2 uvT = rotateUV(uv, time);\n    vec4 blur;\n    if (hd > 0.0) {\n      blur = blur9(map, uvT, vec2(1024, 1024), vec2(.5));\n    } else {\n      blur = blur5(map, uvT, vec2(1024, 1024), vec2(.5));\n    }\n\n    float c = uv.y;\n    float freq = 3.0*sin(0.5*challenge);\n    vec2 warp = 0.5000*cos( uv.xy*1.0*freq + vec2(0.0,1.0) + challenge ) +\n                  0.2500*cos( uv.yx*2.3*freq + vec2(1.0,2.0) + challenge) +\n                  0.1250*cos( uv.xy*4.1*freq + vec2(5.0,3.0) + challenge ) +\n                  0.0625*cos( uv.yx*7.9*freq + vec2(3.0,4.0) + challenge );\n    c += (warp.y * 2.5) - 1.25;\n    c -= .25*cos(uv.y);\n    // warp.x += time;\n\n    vec4 mc = mix(blur, vec4(color2, 1.), step(.01,c));\n    gl_FragColor = mix(blur, mc, challengePow);\n    // float fogFactor = 1.0 - exp( - 0.00025 * fogDepth * fogDepth );\n    // gl_FragColor.rgb = mix( gl_FragColor.rgb, vec3(1.), min(fogFactor, .6) - (distance(0.5, vUv.y) * 2.) + (distance(0.5, vUv.x) * 2.));\n}",side:d.BackSide}),this.material.extensions.derivatives=!0,this.mesh=new d.Mesh(new d.SphereBufferGeometry(100,32,18),this.material),this.mesh.matrixAutoUpdate=!0,this.mesh.updateMatrix()}return Object(r.a)(e,[{key:"onNavigation",value:function(e){var t=this,n=e.cat;this.animeBg=w.a.timeline({easing:"easeOutExpo",autoplay:!1}).add({targets:this.material.uniforms.challenge,value:3!=n?-1.9:-.885,duration:2200,delay:3!=n?600:200,complete:function(){t.animeBg=null}},0).add({targets:this.material.uniforms.challengePow,value:3!=n?0:1.2,duration:900,delay:3!=n?1400:200},0)}},{key:"onLaunchDevMode",value:function(e){var t=e.gui.addFolder("background");t.open(),t.add(this.material.uniforms.strength,"value",0,10).name("strength").onChange(this.onChange),t.add(this.material.uniforms.powStrength,"value",0,10).name("powStrength").onChange(this.onChange),t.add(this.material.uniforms.time,"value",-3.6,3.6).step(.001).name("time"),t.addColor(this.config,"color0").onChange(this.onChange),t.addColor(this.config,"color1").onChange(this.onChange)}},{key:"onUpGradePerfCb",value:function(){this.material.uniforms.hd.value=1}},{key:"onDownGradePerfCb",value:function(){this.material.uniforms.hd.value=0}}]),e}(),fe=function e(t,map){Object(o.a)(this,e),map.wrapS=map.wrapT=d.RepeatWrapping;var n={uMap:{type:"t",value:map},time:{type:"f",value:0},uColor:{type:"f",value:new d.Color(37869)}},r=new d.ShaderMaterial({uniforms:n,vertexShader:"\n\t\t#define SCALE 5.0\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tvarying vec2 vUv;\n\t\t\n\t\tuniform float time;\n\t\tvarying float fogDepth;\n\n\t\tfloat calculateSurface(float x, float z) {\n\t\t\tfloat y = 0.0;\n\t\t\ty += (sin(x * 1.0 / SCALE + time * 1.0) + sin(x * 2.3 / SCALE + time * 1.5) + sin(x * 3.3 / SCALE + time * 0.4)) / 3.0;\n\t\t\ty += (sin(z * 0.2 / SCALE + time * 1.8) + sin(z * 1.8 / SCALE + time * 1.8) + sin(z * 2.8 / SCALE + time * 0.8)) / 3.0;\n\t\t\treturn y;\n\t\t}\n\t\tvec3 mod289(vec3 x) {\n\t\t\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n\t\t}\n\t\t\n\t\tvec4 mod289(vec4 x) {\n\t\t\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n\t\t}\n\t\t\n\t\tvec4 permute(vec4 x) {\n\t\t\treturn mod289(((x*34.0)+1.0)*x);\n\t\t}\n\t\t\n\t\tvec4 taylorInvSqrt(vec4 r)\n\t\t{\n\t\t\treturn 1.79284291400159 - 0.85373472095314 * r;\n\t\t}\n\t\tfloat snoise(vec3 v) {\n\t\t\tconst vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t\tconst vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t\t\n\t\t\t// First corner\n\t\t\tvec3 i  = floor(v + dot(v, C.yyy) );\n\t\t\tvec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t\t\n\t\t\t// Other corners\n\t\t\tvec3 g = step(x0.yzx, x0.xyz);\n\t\t\tvec3 l = 1.0 - g;\n\t\t\tvec3 i1 = min( g.xyz, l.zxy );\n\t\t\tvec3 i2 = max( g.xyz, l.zxy );\n\t\t  \n\t\t\t//   x0 = x0 - 0.0 + 0.0 * C.xxx;\n\t\t\t//   x1 = x0 - i1  + 1.0 * C.xxx;\n\t\t\t//   x2 = x0 - i2  + 2.0 * C.xxx;\n\t\t\t//   x3 = x0 - 1.0 + 3.0 * C.xxx;\n\t\t\tvec3 x1 = x0 - i1 + C.xxx;\n\t\t\tvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\t\t\tvec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\t\t\t\n\t\t\t// Permutations\n\t\t\ti = mod289(i);\n\t\t\tvec4 p = permute( permute( permute(\n\t\t\t\t\t   i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t\t + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n\t\t\t\t\t + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t\t\t\t \n\t\t\t// Gradients: 7x7 points over a square, mapped onto an octahedron.\n\t\t\t// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n\t\t\tfloat n_ = 0.142857142857; // 1.0/7.0\n\t\t\tvec3  ns = n_ * D.wyz - D.xzx;\n\t\t  \n\t\t\tvec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\t\t  \n\t\t\tvec4 x_ = floor(j * ns.z);\n\t\t\tvec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  \n\t\t\tvec4 x = x_ *ns.x + ns.yyyy;\n\t\t\tvec4 y = y_ *ns.x + ns.yyyy;\n\t\t\tvec4 h = 1.0 - abs(x) - abs(y);\n\t\t  \n\t\t\tvec4 b0 = vec4( x.xy, y.xy );\n\t\t\tvec4 b1 = vec4( x.zw, y.zw );\n\t\t  \n\t\t\t//vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n\t\t\t//vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n\t\t\tvec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t\tvec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t\tvec4 sh = -step(h, vec4(0.0));\n\t\t  \n\t\t\tvec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t\tvec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  \n\t\t\tvec3 p0 = vec3(a0.xy,h.x);\n\t\t\tvec3 p1 = vec3(a0.zw,h.y);\n\t\t\tvec3 p2 = vec3(a1.xy,h.z);\n\t\t\tvec3 p3 = vec3(a1.zw,h.w);\n\t\t\t\n\t\t\t// Normalise gradients\n\t\t\tvec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t\tp0 *= norm.x;\n\t\t\tp1 *= norm.y;\n\t\t\tp2 *= norm.z;\n\t\t\tp3 *= norm.w;\n\t\t\t\n\t\t\t// Mix final noise value\n\t\t\tvec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t\tm = m * m;\n\t\t\treturn 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n\t\t\t\t\t\t\t\t\t\t  dot(p2,x2), dot(p3,x3) ) );\n\t\t  }\n\n\t\t  \n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tvec3 pos = position;\n\t\t\t\n\t\t\tfloat strength = 1.0;\n\t\t\tpos.y += strength * calculateSurface(pos.x, pos.z);\n\t\t\tpos.y -= strength * calculateSurface(0.0, 0.0);\n\t\t\n\n\t\t\tfloat noiseFreq = 1.23;\n\t\t\tfloat noiseAmp = 0.23; \n\t\t\tvec3 noisePos = vec3(pos.x * noiseFreq + (time / 10.), pos.y, pos.z);\n\t\t\tpos.z += snoise(noisePos) * noiseAmp;\n\n\t\t\tvec4 worldPosition = modelMatrix * vec4( pos, 1.0 );\n\n\t\t\tvec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\t\t\tfogDepth = -mvPosition.z;\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t}  \n\t\t",transparent:!0,wireframe:!1,fragmentShader:"\n\t\t#include <common>\n\t\tvarying float fogDepth;\n\t\t#include <logdepthbuf_pars_fragment>\n\t\n\t\tvarying vec2 vUv;\n\t\t\n\t\tuniform sampler2D uMap;\n\t\tuniform float time;\n\t\tuniform vec3 uColor;\n\t\t\n\t\tvoid main() {\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tfloat fogFactor = 1.0 - exp( - 0.0105 * fogDepth * (fogDepth / 8.) );\n\t\t\tif (fogFactor >= 1.0) {\n\t\t\t\tdiscard;\n\t\t\t}\n\t\t\tvec2 uv = vUv * 30.0 + vec2(time * -0.025);\n\t\t\n\t\t\tuv.y += 0.01 * (sin(uv.x * 3.5 + time * 0.35) + sin(uv.x * 4.8 + time * 1.05) + sin(uv.x * 7.3 + time * 0.45)) / 3.0;\n\t\t\tuv.x += 0.12 * (sin(uv.y * 4.0 + time * 0.5) + sin(uv.y * 6.8 + time * 0.75) + sin(uv.y * 11.3 + time * 0.2)) / 3.0;\n\t\t\tuv.y += 0.12 * (sin(uv.x * 4.2 + time * 0.64) + sin(uv.x * 6.3 + time * 1.65) + sin(uv.x * 8.2 + time * 0.45)) / 3.0;\n\t\t\n\t\t\tvec4 tex1 = texture2D(uMap, uv * 1.0);\n\t\t\tvec4 tex2 = texture2D(uMap, uv * 1.0 + vec2(0.2));\n\t\t\n\t\t\tvec3 blue = uColor;\n\t\t\n\t\t\tgl_FragColor = vec4(blue + vec3(tex1.a * 0.9 - tex2.a * 0.02), .7);\n\n            // multiply water color with the mix of both textures\n\t\t\tgl_FragColor.a = .7 - fogFactor;\n\t\t}\n\t\t",side:d.DoubleSide});return new d.Mesh(t,r)};function pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(x.a)(e);if(t){var r=Object(x.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(y.a)(this,n)}}var ge=function(e){Object(f.a)(n,e);var t=pe(n);function n(e){var r;return Object(o.a)(this,n),r=t.call(this,{defines:{USE_SHADOW:!0},uniforms:{near:{value:6},far:{value:18},time:{value:0},hd:{value:1},color:{value:new d.Vector3(1)},shadow:{value:e.shadow},viewMatrixCamera:{type:"m4",value:e.viewMatrixCamera},projectionMatrixCamera:{type:"m4",value:e.projectionMatrixCamera},modelMatrixCamera:{type:"mat4",value:e.modelMatrixCamera},projPosition:{type:"v3",value:e.projPosition}},vertexShader:"\n                varying vec2 vUv;\n                varying vec3 vViewPosition;\n                varying vec3 vNormal;\n                varying vec3 fogPosition;\n                uniform mat4 viewMatrixCamera;\n                uniform mat4 projectionMatrixCamera;\n                uniform mat4 modelMatrixCamera;\n                \n                varying vec4 vWorldPosition;\n                varying vec3 vNNormal;\n                varying vec4 vTexCoords;\n                varying float fogDepth;\n                void main() {\n                    vUv = uv;\n                    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n                    vViewPosition = -mvPosition.xyz;\n                    vNormal = normalize( normalMatrix * normal );\n                    gl_Position = projectionMatrix * mvPosition;\n                    // fogPosition = mvPosition.xyz;\n                    fogDepth = -mvPosition.z;\n                    vNNormal = mat3(modelMatrix) * normal;\n                    vWorldPosition = modelMatrix * vec4(position, 1.0);\n\n                    vTexCoords = viewMatrixCamera * vWorldPosition;\n                }\n            ",fragmentShader:"#define GLSLIFY 1\nuniform float time;\nuniform float near;\nuniform float hd;\nuniform float far;\nuniform vec3 color;\n\nvarying vec2 vUv;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;\nvarying vec3 fogPosition;\n\nuniform sampler2D shadow;\nvarying vec4 vTexCoords;\nuniform mat4 viewMatrixCamera;\nuniform mat4 projectionMatrixCamera;\nuniform mat4 modelMatrixCamera;\n\nvarying vec4 vWorldPosition;\nvarying vec3 vNNormal;\nvarying float fogDepth;\nvec4 layer(vec4 foreground, vec4 background) {\n    return foreground * foreground.a + background * (1.0 - foreground.a);\n}\n\nvoid main() {\n\n    vec4 colors = vec4(0.196, 0.49, 0.0431372549, 1.);\n    vec4 colors2 = vec4(0.196, 0.49, 0.0431372549, 1.);\n\n    #ifdef USE_SHADOW\n        vec2 uvCloud = (vTexCoords.xy / vTexCoords.w) * 0.05 + 0.5;\n        uvCloud.x -= time / 50.;\n        vec4 outColor = texture2D(shadow, uvCloud);\n        outColor.a *= .8;\n    #endif\n        \n    float distDepth = fogDepth;\n    if (distDepth < far) {\n        float distFactor = smoothstep( far * .3, far, distDepth );\n        colors.rgb += (1. - distFactor) / 6.;\n    }\n    gl_FragColor = colors;\n\n    #ifdef USE_SHADOW\n        gl_FragColor = layer(outColor, gl_FragColor);\n    #endif\n}"}),Object(c.a)(Object(v.a)(r)),r}return Object(r.a)(n,[{key:"onRaf",value:function(e){var t=e.delta;this.uniforms.time.value+=t}},{key:"onUpGradePerfCb",value:function(){this.uniforms.hd.value=1}},{key:"onDownGradePerfCb",value:function(){this.uniforms.hd.value=0}}]),n}(d.ShaderMaterial),ye=n(77),xe=function(){function e(t,n){Object(o.a)(this,e),Object(c.a)(this),this.game=n,this.level=1,this.progressComplexity=1,this.patternY=3,this.distanceJump=.2,this.scene=t,this.levelGroup=new d.Group,this.jumpForceRatio=2.2,this.boxes=new d.Group,this.currentPlayerScore=0,this.game.gameGroup.add(this.levelGroup),this.keyboardBind(),Object.assign(this,this.game)}return Object(r.a)(e,[{key:"onStartGame",value:function(e){var t=e.game;clearInterval(this.intervalAnimEnd),this.levelActive&&0===t&&(this.levelActive=!1,this.quitLevel()),this.levelActive=1===t,this.levelActive&&this.startLevel()}},{key:"quitLevel",value:function(){var e=this,t=window.innerWidth<769,n=window.innerWidth<400;this.game.scene.camera.animateToPoint(new d.Vector3(n?-.47:0,n?5.4:3.3,t?n?9:12.7:9),new d.Vector3(0,t?n?2:3.5:1,0),1500,null,(function(){})),this.game.stop(),Object.keys(this.game.charactersState).forEach((function(t){var n=e.game.charactersState[t],o=n.scoreModel;o._derivedMaterial&&(o._derivedMaterial.visible=!1),e.game.physics.enableMeshFromWeakMap(n.bodyCounter,!1),e.game.physics.enableMeshFromWeakMap(n.bodyFloor,!1)})),this.resetLevel(),clearInterval(this.intervalAnimEnd)}},{key:"resetLevel",value:function(){var e=this;this.currentPlayerScore=0,Object.keys(this.game.charactersState).forEach((function(t,n){var o=e.game.charactersState[t];o.position.y=0,o.playerStunned=!1,o.stunLevel=0,o.ref.position.y=0,o.body.physic.angularDamping=0,o.body.rotation.x=0,o.body.rotation.y=0,o.body.rotation.z=0,o.body.physic&&e.game.physics.resetPhysic(o.body.physic),o.mixerGameOne||(o.mixerGameOne=e.game.scene["mixerFlower"+(o.orderPosId+1)]),o.counterRef.traverse((function(e){e.visible=!1,le(e,0)})),o.mixerGameOne.setTime(1e-4),e.game.physics.setMeshPosition(o.body,new d.Vector3(o.positionXCached,0,0)),e.game.scene.camera.followTarget(z.d.ref.position,1),o.scores["level"+e.level].current=0,o.scores["level"+e.level].lerpCurrent=0,e.elevateCounter(0),e.game.updateScore(t,0),o.pattern&&o.pattern["level"+e.level].forEach((function(pattern){pattern.trigerredStart=!1}))}))}},{key:"startLevel",value:function(){var e=this;this.resetLevel(),this.tl=Object(w.a)({duration:800,autoplay:!1,easing:"easeInOutCubic",complete:function(){e.tl=null,Object.keys(e.charactersState).forEach((function(t,n){var o=e.charactersState[t],r=o.counterRef;e.game.physics.enableMeshFromWeakMap(o.bodyCounter,!0),e.game.physics.enableMeshFromWeakMap(o.bodyFloor,!0),r.traverse((function(e){e.visible=!0}))})),e.updateBoxPos()},update:function(t){Object.keys(e.charactersState).forEach((function(n,o){e.charactersState[n].counterRef.traverse((function(e){if(e.visible=!0,"Mesh"===e.type&&e.material.transparent){var n=t.progress/100;le(e,n)}}))}))}}),setTimeout((function(){Object.keys(e.charactersState).forEach((function(t){var n=e.charactersState[t].scoreModel;n._derivedMaterial&&(n._derivedMaterial.visible=!0)}))}),800),this.scene.camera.animateToPointKeyFrames([[{x:[-9,-3.7]},{y:[4,3.3]},{z:[-11,-4.2]}],[{x:[-9,2]},{y:[3.3,3.3]},{z:[-2.3,2.12]}],[{x:[9,-1.7]},{y:[1.2,2.1]},{z:[2,3.2]}]],[[{x:[0,0]},{y:[0,0]},{z:[0,0]}],[{x:[0,0]},{y:[0,0]},{z:[-17,-17]}],[{x:[0,0]},{y:[0,0]},{z:[0,0]}]],4500,null,(function(){e.animateToStart()}))}},{key:"animateToStart",value:function(){var e=this;this.scene.camera.animateToPoint(new d.Vector3(-.65,.68,5.02),new d.Vector3(0,1.12,0),1500,null,(function(){e.game.start(1)}))}},{key:"init",value:function(){this.handleEvents()}},{key:"onEveryModelsLoaded",value:function(){this.addTarget(),this.updateIAFromPattern()}},{key:"handleEvents",value:function(){}},{key:"stunPlayer",value:function(e){e.playerStunned=!0,e.stunLevel=1,"player"===e.type&&c.b.trigger({name:"shakeScreen"}),z.g.sound.commit("sound/playSound",{fileName:"neko"!=e.character?"hit_normal":"hit_chat_"+Math.round(.5+1.5*Math.random()),volume:"player"===e.type?1:.35}),Object(w.a)({targets:e,stunLevel:[1,0],duration:2e3,easing:"easeInQuint",complete:function(){e.playerStunned=!1}})}},{key:"createImpulse",value:function(e,t){if(e&&e.body){if(0!==Math.round(e.body.position.z))return;this.game.physics.createImpulse(e.body,t),z.g.sound.commit("sound/playSound",{fileName:"jump",volume:"player"===e.type?1:.35})}}},{key:"updateIAFromPattern",value:function(){var e=this;Object.keys(this.game.charactersState).forEach((function(t,n){var o=e.game.charactersState[t];if("player"!==o.type){var pattern=o.pattern?o.pattern.level1:null,r=e;if(pattern)for(var i=0;i<pattern.length;i++){var c=pattern[i];if(!c.trigerredStart&&r.game.gameElapsedTime>c.s){if(c.trigerredStart=!0,o.playerStunned)return;r.createImpulse(o,600);break}}}}))}},{key:"updateBoxPos",value:function(){var e=this;Object.keys(this.game.charactersState).forEach((function(t,n){var o=e.game.charactersState[t],r=o.scores["level"+e.level].current;if(o.bodyCounter&&o.bodyCounter.physic){var c=Math.min(6.8,o.scores["level"+e.level].current/7.2);e.game.physics.setMeshPosition(o.bodyCounter,new d.Vector3(o.bodyCounter.xFixedPos,Math.min(45,r/2)*e.distanceJump+1.5-c/12,0),0),e.game.physics.setMeshPosition(o.bodyFloor,new d.Vector3(o.bodyFloor.xFixedPos,Math.min(45,r/2)*e.distanceJump-.5,0))}}))}},{key:"checkUpdateScore",value:function(){var e=z.d.scores["level"+this.level];e.max<e.current&&(e.max=e.current)}},{key:"checkEndGame",value:function(){this.game.clock.running&&this.game.gameElapsedTime>this.gameDuration&&this.checkUpdateScore()}},{key:"onEndGame",value:function(){this.checkUpdateScore()}},{key:"addTarget",value:function(){var e,t=this,n=this.game.charactersState;Object.keys(n).forEach((function(o,r){0;var c=new d.Mesh(new d.BoxBufferGeometry(.8,.2,1.2),new d.MeshBasicMaterial({wireframe:!0})),l=new d.Mesh(new d.BoxBufferGeometry(.8,1.6,1),new d.MeshBasicMaterial({wireframe:!0}));l.rotation.x=-Math.PI/2,c.visible=!1,l.visible=!1,e=n[o],c.position.y=1.5,l.position.y=-.5,c.boxId=e.id,l.boxId=e.id,t.hadAlreadyContact[c.boxId]=!1,t.hadAlreadyContact[l.boxId]=!1,c.position.x=e.position.x,l.position.x=e.position.x,c.xFixedPos=e.position.x,l.xFixedPos=e.position.x,t.game.physics.addMesh(c,0),t.game.physics.addMesh(l,0),t.game.gameGroup.add(c),t.game.gameGroup.add(l),e.bodyCounter=c,e.bodyFloor=l,c.physic.boxId=e.id,c.physic.incId=e.orderPosId,l.physic.boxId=e.id,l.physic.incId=e.orderPosId,t.game.physics.enableMeshFromWeakMap(e.bodyCounter,!1),t.game.physics.enableMeshFromWeakMap(e.bodyFloor,!1),c.physic.addEventListener("collide",(function(e){var n=e.target.boxId;t.hadAlreadyContact[n]||(t.game.charactersState[n].hadAlreadyContact=!0,t.hadAlreadyContact[n]=!0,t.increaseScore(n),t.game.updateScore(n,t.game.charactersState[n].scores["level"+t.level].current),t.animeCounterOnHit(t.game.charactersState[n],e.target.incId))}))}))}},{key:"lerpVector",value:function(a,b,e){a.r=this.lerp(a.r,b.r,e),a.g=this.lerp(a.g,b.g,e),a.b=this.lerp(a.b,b.b,e)}},{key:"lerp",value:function(a,b,e){return(1-e)*a+e*b}},{key:"increaseScore",value:function(e){var t=this.game.charactersState[e];if(t.cylinderRef){var n=d.Math.radToDeg(t.cylinderRef.rotation.x)%360;n>=320||n>=0&&n<=40?(t.scores["level"+this.level].current+=6,c.b.trigger({name:"scoreUpdate"},{character:t.orderPosId,score:t.scores["level"+this.level].current}),z.g.sound.commit("sound/playSound",{fileName:"jeux_1_coin_max",volume:"player"===t.type?.5:.15}),"player"==t.type&&c.b.trigger({name:"greet"},{positive:!0})):n>=210&&n<=270?("player"==t.type&&c.b.trigger({name:"greet"},{positive:!1}),this.stunPlayer(t)):(t.scores["level"+this.level].current+=1,c.b.trigger({name:"scoreUpdate"},{character:t.orderPosId,score:t.scores["level"+this.level].current}),z.g.sound.commit("sound/playSound",{fileName:"jeux_1_coin",volume:"player"===t.type?.5:.15}))}}},{key:"elevateCounter",value:function(e){var t=this;Object.keys(this.game.charactersState).forEach((function(n,o){var r=t.game.charactersState[n];r.mixerGameOne&&r.scores&&r.scores["level"+t.level]&&(r.scores["level"+t.level].current>0&&(void 0===r.scores["level"+t.level].lerpCurrent&&(r.scores["level"+t.level].lerpCurrent=0),r.mixerGameOne.setTime(Math.min(.985,.12+.88*r.scores["level"+t.level].lerpCurrent))));var c=Math.min(6.8,r.scores["level"+t.level].current/7.2),l=Math.min(45,r.scores["level"+t.level].current/2)*t.distanceJump-r.stunLevel*(1.5-c/12);r.counterRef.position.y=e>0?t.lerp(r.counterRef.position.y,1.5-c/12+l,.11):1,e>0?r.cylinderRef.rotation.x+=e*(1+c):r.cylinderRef.rotation.x=0;var h=d.Math.radToDeg(r.cylinderRef.rotation.x)%360;r.colorStateLerp=h>=320||h>=0&&h<=40?new d.Color(16634889):h>=200&&h<=280?new d.Color(9324429):new d.Color(8120301),t.lerpVector(r.colorState,r.colorStateLerp,1),r.planeScore.material.color.setRGB(r.colorState.r,r.colorState.g,r.colorState.b)}))}},{key:"animeCounterOnHit",value:function(e,t){var n=new d.Vector3(1,1,1);this.bounceAnim=w.a.timeline({duration:1e3}),this.bounceAnim.add({targets:e.scores["level"+this.level],lerpCurrent:this.normalize(e.scores["level"+this.level].current,2,92),duration:1e3,delay:0,easing:"easeOutElastic(3.5, .5)"},0),this.bounceAnim.add({targets:n,x:[1.45,1],y:[.6,1],z:[.92,1],duration:1e3,delay:0,easing:"easeOutElastic(1, .5)",update:function(){e.counterRef&&(e.counterRef.scale.x=n.x,e.counterRef.scale.y=n.y),e.scoreModel&&(e.scoreModel.scale.x=n.x*n.x,e.scoreModel.scale.y=1/n.y*n.x)}},0)}},{key:"onFinishedLoaded",value:function(e){var t=this;Object.keys(this.game.charactersState).forEach((function(n,o){var r=t.game.charactersState[n];r.mixerGameOne=e["mixerFlower"+(r.orderPosId+1)],r.mixerGameOne.setTime(1e-4)}))}},{key:"onNavigation",value:function(e){e.cat}},{key:"keyboardBind",value:function(){var e=this;document.addEventListener("keydown",(function(t){if(27===t.keyCode){if(0!==e.game.currentCat)return;if(e.game.animScene)return;if(e.levelActive&&!e.game.clock.running)return;c.b.trigger({name:"endGameKeyboard"})}}));document.addEventListener("keydown",(function(t){32===t.keyCode&&e.playerJump()}))}},{key:"onPointerStart",value:function(){this.playerJump()}},{key:"playerJump",value:function(){if(z.d.scores){var e=z.d.scores["level"+this.level].current*this.distanceJump/2;if(!(z.d.playerStunned||0!==this.game.currentCat||z.d.body.position.y>e+.3)&&!this.game.animScene&&(!this.levelActive||this.game.clock.running)){var t=250;this.levelActive&&(t=600);var n=this.game.clock.elapsedTime;this.startTimeRef=n,this.game.clock.running&&z.b.session["level"+this.level].push({s:Math.round(100*this.startTimeRef)/100}),this.createImpulse(z.d,t)}}}},{key:"onLowRaf",value:function(){this.levelActive&&this.game.clock.running&&(this.progressComplexity=this.game.gameElapsedTime/this.game.gameDuration*10,this.updateBoxPos(),this.updateIAFromPattern())}},{key:"normalize",value:function(e,t,n){return n-t==0?1:(e-t)/(n-t)}},{key:"bounce",value:function(e){}},{key:"onRaf",value:function(e){var t=e.delta,n=e.now;this.tl&&this.tl.tick(n),this.bounceAnim,this.levelActive&&(this.game.scene.camera.followTarget(z.d.ref.position,.04),this.elevateCounter(t))}},{key:"lerp",value:function(a,b,e){return(1-e)*a+e*b}}]),e}(),be=n(35),we=function(){function e(t,n,r){Object(o.a)(this,e),Object(c.a)(this),this.canceled=!1,this.cutLow=0,this.bomb=r.bomb,this.bomb.wrapS=this.bomb.wrapT=d.RepeatWrapping,this.game=n,this.scene=t,this.throwIndexElement=0,this.level=2,this.ballsNumber=36,this.levelGroup=new d.Group,this.currentPlayerScore=0,this.boxes=new d.Group,this.delta=0,this.rocks=[],this.cannonAnim={},this.lifeDuration=8,this.game.gameGroup.add(this.levelGroup),this.keyboardBind(),Object.assign(this,this.game),this.generateThrowPattern()}return Object(r.a)(e,[{key:"quitLevel",value:function(){var e=this;if(!this.canceled){var t=this.game.charactersState;Object.keys(t).forEach((function(n,o){e.lifeUpdate(t[n],1)})),this.canceled=!0,this.checkUpdateScore(),this.resetLevel(),this.rocks&&this.game.physics.enableMeshFromWeakMap(this.rocks.ref,!1),this.game.stop();var n=window.innerWidth<769;this.scene.camera.animateToPoint(new d.Vector3(-1.13,1.52,n?9.18:4.7),new d.Vector3(0,n?1.52:.5,n?2.12:0),1500,null,(function(){}))}}},{key:"checkUpdateScore",value:function(){var e=8*this.game.gameElapsedTime,t=z.d.scores["level"+this.level];t.max<e&&(t.max=e),t.current=e}},{key:"onStartGame",value:function(e){var t=e.game;this.levelActive&&2!==t&&(this.levelActive=!1,this.game.quitLevel(),this.quitLevel()),this.levelActive=2===t,this.levelActive&&this.startLevel()}},{key:"generateThrowPattern",value:function(){for(var p=[0,2,2.5,4,4.5,5,7.5,8,8.5],e=[0,2,2.5,3,4.25,7.25,7.5,7.75,8],t=[],s=0,n=0,o=0,i=0;i<16*p.length;i++)0==(n=i%p.length)&&(s++,0!=i&&(o=t[t.length-1].start+1)),t.push({start:(s>5?p[n]:(s%2==1?p[n]:e[n])/(1+.15*(s-1)))+o});this.throwPattern=t}},{key:"startLevel",value:function(){var e=this;this.canceled=!1,this.currentPlayerScore=0,z.d.scores["level"+this.level].current=0,z.d.scores["level"+this.level].lerpCurrent=0,this.resetLevel(),this.scene.camera.animateToPointKeyFrames([[{x:[-4.23]},{y:[1.7,8.57]},{z:[9,-10.9]}],[{x:[-20.56,-20.56]},{y:[5.91,10]},{z:[-21.88,-29.38]}],[{x:[-1.1,.3]},{y:[4.02,1.2]},{z:[-10.52,6]}]],[[{x:[0,0]},{y:[2.4,9]},{z:[0,-22.53]}],[{x:[2.62,2.62]},{y:[4.6,4.6]},{z:[-17.23,-11.94]}],[{x:[0,.24]},{y:[0,1.4]},{z:[-30,.04]}]],4500,null,(function(){e.animateToStart()})),0==this.rocks.length&&this.addRockInstanceMesh(),this.rocks&&this.game.physics.enableMeshFromWeakMap(this.rocks.ref,!0)}},{key:"animateToStart",value:function(){var e=this;this.scene.camera.animateToPoint(new d.Vector3(.3,1.2,6.45),new d.Vector3(.24,1.4,.04),1500,null,(function(){e.canceled||(e.game.start(2),e.rocks.ref.visible=!0,e.animateLifeBar())}));var t=this.game.charactersState;Object.keys(t).forEach((function(n,o){t[n].life=0,e.lifeUpdate(t[n],0,!1)}))}},{key:"init",value:function(){}},{key:"updateIAFromPattern",value:function(){var e=this;Object.keys(this.game.charactersState).forEach((function(t,n){var o=e.game.charactersState[t];if("player"!==o.type){var pattern=o.pattern?o.pattern.level2:null,r=e;if(pattern)for(var i=0;i<pattern.length;i++){var c=pattern[i];if(!c.trigerredStart&&r.game.gameElapsedTime>c.s&&o.life<1){c.trigerredStart=!0;var l=e.game.clock.elapsedTime;o.startTime=l,r.enableGoldMode(o,!0)}if(!c.trigerredEnd&&r.game.gameElapsedTime>c.e){c.trigerredEnd=!0;var h=e.game.clock.elapsedTime;if(o.endTime=h,o.life+=(o.endTime-o.startTime)/e.lifeDuration,o.playerStunned&&o.life<1)return;r.enableGoldMode(o,!1);break}}}}))}},{key:"resetLevel",value:function(){var e=this;this.cannonAnim={},this.throwIndexElement=0,this.resetBalls(),Object.keys(this.game.charactersState).forEach((function(t,n){var o=e.game.charactersState[t];o.position.y=0,o.position.z=0,o.died=!1,o.ref.rotation.z=0,o.ref.rotation.y=0,o.class.resetHands(o),o.stunLevel=0,o.invincible=!1,o.life=0,o.lifeCached=0,o.currentRealLife=0,o.startTime=0,o.endTime=0,o.body.rotation.x=0,o.body.rotation.y=0,o.body.rotation.z=0,o.body.physic&&(o.position.x=o.positionXCached,o.body.physic.fixedRotation=!0),o.alreadyHitBall={},e.enableGoldMode(o,!1),c.b.trigger({name:"showAura"},{aura:1}),o.playerStunned=!1;var pattern=e.throwPattern;if(pattern)for(var i=0;i<pattern.length;i++){var r=pattern[i];r.trigerredStart=!1,r.trigerredEnd=!1}o.pattern&&o.pattern["level"+e.level].forEach((function(pattern){pattern.trigerredStart=!1,pattern.trigerredEnd=!1}))}))}},{key:"enableGoldMode",value:function(e,t){e.invincible=t,t?(e.class.animateKatana(e,!0),z.g.sound.commit("sound/playSound",{fileName:"sword_move_"+Math.round(.5+6.5*Math.random()),volume:"player"===e.type?.7:.25})):e.class.resetHands(e)}},{key:"lifeUpdate",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.lifeBar.material.uniforms.factor.value=t<1?t:1,e.lifeBar.material.uniforms.direction.value=1,n&&(e.lifeBar.visible=!(1==t))}},{key:"animateLifeBar",value:function(){var e=this,t=[],n=this.game.charactersState;Object.keys(n).forEach((function(e,o){n[e].lifeBar.visible=!0,t.push(n[e].lifeBar)})),this.alb=Object(w.a)({autoplay:!1,targets:[t[0].position,t[1].position,t[2].position],y:[0,.6],duration:700,easing:"easeOutBack",begin:function(){},complete:function(){e.alb=null}})}},{key:"keyboardBind",value:function(){var e=this;document.addEventListener("keydown",(function(t){if(27===t.keyCode){if(1!==e.game.currentCat)return;if(2!==e.game.currentGame)return;if(e.game.animScene)return;if(e.levelActive&&!e.game.clock.running)return;c.b.trigger({name:"endGameKeyboard"})}}));document.addEventListener("keydown",(function(t){32===t.keyCode&&e.defend()}));document.addEventListener("keyup",(function(t){32===t.keyCode&&e.defendStop()}))}},{key:"onPointerStart",value:function(e){var t=e.e;this.defend(t)}},{key:"defend",value:function(e){if(!this.clickActive&&2===this.game.currentGame&&!this.game.animScene&&(!this.levelActive||this.game.clock.running))if(e&&(e.cancelBubble=!0,e.returnValue=!1),z.d.life<1){this.duration=0,this.startTime=new Date;var t=this.game.clock.elapsedTime;this.startTimeRef=t,z.d.startTime=t,this.enableGoldMode(z.d,this.levelActive),this.clickActive=!0,c.b.trigger({name:"showAura"},{aura:z.d.life})}else this.startTime=!1}},{key:"defendStop",value:function(){2===this.game.currentGame&&(this.game.animScene||this.levelActive&&!this.game.clock.running||0!=this.startTime&&(this.now=new Date,this.duration=this.now-this.startTime,this.clickActive=!1,z.b.session["level"+this.level].push({s:Math.round(100*this.startTimeRef)/100,e:Math.round(100*this.game.clock.elapsedTime)/100}),z.d.endTime=this.game.clock.elapsedTime,z.d.life+=(z.d.endTime-z.d.startTime)/this.lifeDuration,this.enableGoldMode(z.d,!1),c.b.trigger({name:"showAura"},{aura:1})))}},{key:"checkLifeTimeSpent",value:function(e){e.startTime&&(e.lifeCached=(this.game.clock.elapsedTime-e.startTime)/this.lifeDuration,e.currentRealLife=e.life+e.lifeCached,e.currentRealLife>=1&&(e.life=1,this.die(e))),"player"===e.type&&c.b.trigger({name:"showAura"},{aura:z.d.currentRealLife}),this.lifeUpdate(e,e.currentRealLife)}},{key:"onPointerEnd",value:function(){this.defendStop()}},{key:"addRockInstanceMesh",value:function(){var e=this;this.rocks=new ne(new d.SphereBufferGeometry(.2,32,32),{map:this.bomb,instanced:!0,count:this.ballsNumber,cap:Q.captoon}),this.game.physics.addMesh(this.rocks.ref,5,4),this.rocks.ref.visible=!1,this.resetBalls();var t=this;this.game.physics.enableMeshFromWeakMap(this.rocks.ref,!1),this.rocks.ref.physic.forEach((function(e){e.isBall=!0})),Object.keys(t.game.charactersState).forEach((function(n,a){var o=t.game.charactersState[n];o.body.physic.addEventListener("collide",(function(n){if(e.levelActive&&n.body.isBall){var r=n.body;if(o.invincible||o.playerStunned)o.invincible&&o.life<1?(t.cannonAnim[r.index]=null,o.alreadyHitBall[r.index]=!0,setTimeout((function(){var e=new d.Vector3(o.positionXCached,0,-18);r.position.copy(e)}),0),o.class.animateKatana(o,!1),z.g.sound.commit("sound/playSound",{fileName:"sword_cut",volume:"player"===o.type?1:.35})):z.g.sound.commit("sound/playSound",{fileName:"boulet",volume:"player"===o.type?.7:.25});else if(o.life+=.1,o.life>1&&(o.life=1),t.cannonAnim[r.index]=null,setTimeout((function(){var e=new d.Vector3(o.positionXCached,0,-18);r.position.copy(e)}),200),e.lifeUpdate(o,o.life),"player"==o.type&&1==o.life&&setTimeout((function(){t.quitLevel(),t.game.checkEndGame(!0)}),1e3),o.life<1&&!o.playerStunned){if(o.alreadyHitBall[r.index])return;t.stunPlayer(o),o.alreadyHitBall[r.index]=!0}}}))})),this.levelGroup.add(this.rocks.ref)}},{key:"stunPlayer",value:function(e){var t=this;e.playerStunned=!0,e.class.resetHands(e),e.stunLevel=1,"player"===e.type&&c.b.trigger({name:"shakeScreen"}),z.g.sound.commit("sound/playSound",{fileName:"neko"!=e.character?"hit_normal":"hit_chat_"+Math.round(.5+1.5*Math.random()),volume:"player"===e.type?1:.35}),Object(w.a)({targets:e,stunLevel:[1,0],duration:500,easing:"easeInQuint",complete:function(){t.game.physics.resetPhysic(e.body.physic,!0),t.game.physics.setMeshPosition(e.body,new d.Vector3(e.positionXCached,0,0)),e.playerStunned=!1}})}},{key:"resetBalls",value:function(){var e=this,t=0;Object.keys(this.game.charactersState).forEach((function(n,o){for(var r=e.game.charactersState[n],c=0;c<e.ballsNumber/3;c++){var l=new d.Vector3(r.positionXCached,0,-18-c);e.game.physics.setMeshPosition(e.rocks.ref,l,t),t++}})),this.rocks.ref&&(this.rocks.ref.visible=!1,this.game.physics.step(this.game.delta))}},{key:"throwRockImpulse",value:function(){var pattern=this.throwPattern,e=this;if(pattern)for(var i=0;i<pattern.length;i++){var t=pattern[i];if(!t.trigerredStart&&e.game.gameElapsedTime>t.start){var n=function(){t.trigerredStart=!0;return z.d.life>=1?{v:void 0}:(z.g.sound.commit("sound/playSound",{fileName:"coup_canon",volume:1}),Object.keys(e.game.charactersState).forEach((function(t,n){var o=e.game.charactersState[t],r=e.throwIndexElement+o.orderPosId*(e.ballsNumber/3);if(o.alreadyHitBall[r]=!1,!(o.life>=1)&&e.rocks.ref.physic[r]){e.game.physics.shootBallImpulse(r,e.rocks.ref,new d.Vector3(o.positionXCached,0,-18),new d.Vector3(o.positionXCached,0,.25),1700,0);var c={value:0};e.cannonAnim[e.rocks.ref.physic[r].index]=Object(w.a)({targets:c,autoplay:!1,value:[0,1],easing:"linear",duration:1700,update:function(){e.game.physics.shootBallImpulse(r,e.rocks.ref,new d.Vector3(o.positionXCached,0,-18),new d.Vector3(o.positionXCached,0,.25),1700,c.value)},complete:function(){e.cannonAnim[e.rocks.ref.physic[r].index]=null,e.game.physics.shootBallImpulse(r,e.rocks.ref,new d.Vector3(o.positionXCached,0,-18),o.body.position,1700,1),setTimeout((function(){var t=new d.Vector3(o.positionXCached,0,-18);e.rocks.ref.physic[r].position.copy(t)}),50)}})}})),e.throwIndexElement>e.ballsNumber/3-1?e.throwIndexElement=0:e.throwIndexElement++,"break")}();switch(n){case"break":break;default:if("object"===Object(be.a)(n))return n.v}}}}},{key:"calculateVelocity",value:function(e,t,time){var n=e.sub(t),o=new d.Vector3(n.x,0,n.z),r=Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z)/time,c=n.y/time+.5*Math.abs(this.game.physics.world.gravity.y)*time,l=o.normalize();return l.multiplyScalar(r),l.y=c,l}},{key:"onLowRaf",value:function(){var e=this;this.levelActive&&this.game.clock.running&&0!=this.rocks.length&&(this.throwRockImpulse(),this.updateIAFromPattern(),this.cutLow++,this.cutLow%4==0&&Object.keys(this.game.charactersState).forEach((function(t,n){var o=e.game.charactersState[t];o.died||c.b.trigger({name:"scoreUpdate"},{character:o.orderPosId,score:e.game.gameElapsedTime})})))}},{key:"onRaf",value:function(e){var t=this,n=e.delta,o=e.now;this.delta=n,1===this.game.currentCat&&(this.game.animScene||this.levelActive&&!this.game.clock.running||(this.alb&&this.alb.tick(o),Object.keys(this.cannonAnim).forEach((function(e,n){var r=t.cannonAnim[e];r&&r.tick(o)})),Object.keys(this.game.charactersState).forEach((function(e,n){var o=t.game.charactersState[e];o.playerStunned||t.physics.setMeshPosition(o.body,new d.Vector3(o.positionXCached,.19,0)),o.ref.children.forEach((function(e){"Mesh"==e.constructor.name.toString()&&(o.invincible?e.material.uniforms.time.value+=t.delta:e.material.uniforms.time.value=0)}))})),this.levelActive&&this.game.clock.running&&(this.game.scene.camera.followTarget(z.d.ref.position,.04),Object.keys(this.game.charactersState).forEach((function(e,n){var o=t.game.charactersState[e];o.invincible&&t.checkLifeTimeSpent(o),t.die(o)})))))}},{key:"lerp",value:function(a,b,e){return(1-e)*a+e*b}},{key:"die",value:function(e){var t=this;e.life>=1&&("player"===e.type&&(c.b.trigger({name:"showAura"},{aura:1}),setTimeout((function(){t.quitLevel(),t.game.checkEndGame(!0)}),1e3)),e.died||Object(w.a)({targets:e,stunLevel:1,duration:500,easing:"easeOutQuint"}),e.class.resetHands(e),e.died=!0,e.life=1,c.b.trigger({name:"lifeUpdate"},{character:e.orderPosId,life:1}),this.lifeUpdate(e,1))}},{key:"onLaunchDevMode",value:function(e){e.gui}}]),e}();n(41),n(60),n(61),n(62),n(223);function ke(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Se(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Se(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,c=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,r=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw r}}}}function Se(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var Me=function(){function e(t,n){Object(o.a)(this,e),Object(c.a)(this),this.game=n,this.level=3,this.offsetAnchor=new d.Vector3(1.86,2.79,-5.55),this.currentCameraRotation=0,this.currentCameraRotationNoLerp=0,this.distanceCameraRotate=6,this.scene=t,this.patternBossTrigerred={},this.patternWaterMTrigerred={},this.constraintArr={},this.positionCursorClicked=new d.Vector3,this.cursorDestination=new d.Vector3,this.pointer=new d.Vector2,this.dist=new d.Vector2,this.distL=new d.Vector2,this.momentum=new d.Vector2,this.momentumL=new d.Vector2,this.bossTargetPosition=new d.Vector3,this.levelGroup=new d.Group,this.jumpForceRatio=2.2,this.boxes=new d.Group,this.game.gameGroup.add(this.levelGroup),this.addCursor(),this.initCamera(),this.keyboardBind(),this.raycaster=new d.Raycaster,Object.assign(this,this.game),this.patternBoss=new Map(z.e),this.patternWatermelon=new Map(z.f)}return Object(r.a)(e,[{key:"keyboardBind",value:function(){var e=this;document.addEventListener("keydown",(function(t){if(27===t.keyCode){if(2!==e.game.currentCat)return;if(e.game.animScene)return;if(e.levelActive&&!e.game.clock.running)return;c.b.trigger({name:"endGameKeyboard"})}}))}},{key:"onStartGame",value:function(e){var t=e.game;clearInterval(this.intervalAnimEnd),this.levelActive&&0===t&&(this.levelActive=!1,this.quitLevel()),this.levelActive=3===t,this.levelActive&&this.startLevel()}},{key:"addWatermelons",value:function(){var e=this;this.game.watermelon.geometry.parameters={width:.18,height:.18,depth:.36},this.game.physics.addMesh(this.game.watermelon,5,1),this.game.watermelon.physic.forEach((function(t){t.addEventListener("collide",(function(n){var o=n.body.uid,r=e.game.charactersState[o];if(o&&!t.stacked&&r){t.stacked=!0,r.wmStacked++,c.b.trigger({name:"scoreUpdate"},{character:r.orderPosId,score:r.wmStacked});var l=new oe.e(t,r.body.physic);Array.isArray(e.constraintArr[o])||(e.constraintArr[o]=[]),e.constraintArr[o].push(l),e.game.physics.world.addConstraint(l)}}))})),this.resetWM()}},{key:"resetWM",value:function(){this.patternWaterMTrigerred={},this.game.watermelon.visible=!1,this.game.physics.enableMeshFromWeakMap(this.game.watermelon,!0);var e,t=0,n=ke(this.patternWatermelon);try{for(n.s();!(e=n.n()).done;){var o=Object(N.a)(e.value,2),r=(o[0],o[1],new d.Vector3(0,-1,-200.5-t));this.game.physics.setMeshPosition(this.game.watermelon,r,t),t++}}catch(e){n.e(e)}finally{n.f()}this.game.physics.enableMeshFromWeakMap(this.game.watermelon,!1)}},{key:"resetPosition",value:function(){var e,t=0,n=ke(this.patternWatermelon);try{for(n.s();!(e=n.n()).done;){var o=Object(N.a)(e.value,2),r=(o[0],o[1],new d.Vector3(0,-1,-200.5-t));this.game.physics.setMeshPosition(this.game.watermelon,r,t),t++}}catch(e){n.e(e)}finally{n.f()}}},{key:"initCamera",value:function(){this.cameraArray=[];for(var i=0;i<9;i++){var e=i/9*Math.PI*2;this.cameraArray.push({id:i+1,pos:new d.Vector3(9*Math.cos(e),14.07,9*Math.sin(e))})}}},{key:"followCamera",value:function(e){var t=window.innerWidth<769,n=window.innerWidth<400,o=new d.Vector3(z.d.ref.position.x,9.5,z.d.ref.position.z).distanceTo(new d.Vector3(this.game.dragonGroup.position.x,9.5,this.game.dragonGroup.position.z)),r=new d.Vector3(z.d.ref.position.x,9.5,z.d.ref.position.z).distanceTo(this.game.scene.camera.position),c=(n?-6:-3.45)+o/2+(t?r/4:0),l=t?(n?15.36:10)+.75*o-(t?r/2:r/4):6.6,h=20.07-r/4+(t?1.45*o:0);this.game.scene.camera.positionOffset.x=this.lerp(this.game.scene.camera.positionOffset.x,c,.14),this.game.scene.camera.positionOffset.z=this.lerp(this.game.scene.camera.positionOffset.z,l,.14),this.game.scene.camera.positionOffset.y=this.lerp(this.game.scene.camera.positionOffset.y,h,.14)}},{key:"updatePatternWM",value:function(){var e=0;if(this.game.watermelon){this.game.watermelon.visible=!0;var t,n=ke(this.patternWatermelon);try{for(n.s();!(t=n.n()).done;){var o=Object(N.a)(t.value,2),r=o[0],c=o[1];if(!this.patternWaterMTrigerred[r]&&this.game.gameElapsedTime>r){this.patternWaterMTrigerred[r]=!0;var l=c;l.y=2,this.game.physics.setMeshPosition(this.game.watermelon,l,e),this.game.watermelon.physic&&this.game.watermelon.physic[e]&&this.game.watermelon.physic[e].wakeUp()}e++}}catch(e){n.e(e)}finally{n.f()}}}},{key:"onEveryModelsLoaded",value:function(){this.addWatermelons(),this.addDragonPhysic()}},{key:"addDragonPhysic",value:function(){var e,t,n=this;this.dragonBody=new d.Mesh(new d.BoxBufferGeometry(1.3,1.3,1.3)),e=this.dragonBody.geometry,t=new d.Vector3,e.computeBoundingBox(),e.boundingBox.getCenter(t),e.center(),this.dragonBody.name="bodydragon",this.dragonBody.visible=!1,this.game.dragonGroup.add(this.dragonBody),this.physics.addMesh(this.dragonBody,14),this.physics.setMeshPosition(this.dragonBody,new d.Vector3(0,0,this.game.dragonGroup.position.z)),this.physics.enableMeshFromWeakMap(this.dragonBody,!1),this.dragonBody.physic.addEventListener("collide",(function(e){e.target.boxId;var t=n.game.charactersState[e.body.uid];t&&(n.constraintArr[e.body.uid]&&n.constraintArr[e.body.uid].length>0&&(n.constraintArr[e.body.uid].forEach((function(e){e&&e.bodyA&&e.bodyA.stacked&&(e.bodyA.stacked=!1),n.game.physics.world.removeConstraint(e)})),t.wmStacked=0,c.b.trigger({name:"scoreUpdate"},{character:t.orderPosId,score:t.wmStacked})),t.playerStunned=!0,t.isBumped=!0,setTimeout((function(){t.isBumped=!1}),300),t.animMove&&(t.animMove.pause(),t.animMove=null))}))}},{key:"updatePatternBoss",value:function(){var e=this;if(this.patternBoss){var t,n=this,o=ke(n.patternBoss);try{for(o.s();!(t=o.n()).done;){var r=Object(N.a)(t.value,2),c=r[0],l=r[1];if(!n.patternBossTrigerred[c]&&n.game.gameElapsedTime>c)if("break"===function(){e.patternBossTrigerred[c]=!0;var t=l/12*Math.PI*2,o=new d.Vector3(0);o.x=3.1*Math.cos(t),o.z=3.1*Math.sin(t),o.y=0,n.bossTargetPosition.copy(o);var r=(new d.Vector3).copy(n.dragonBody.position),h={value:0};return z.g.sound.commit("sound/playSound",{fileName:"boss_motor_dash_"+Math.round(.5+6.5*Math.random()),volume:1}),z.g.sound.commit("sound/playSound",{fileName:"boss_voix_"+Math.round(.5+15.5*Math.random()),volume:1}),n.animBoss=Object(w.a)({targets:h,autoplay:!1,value:[0,1],easing:"easeInOutSine",duration:1600,update:function(){n.game.physics.moveKinematicToPosition(n.dragonBody.physic,r,n.bossTargetPosition,1600,h.value)},complete:function(){z.g.sound.commit("sound/playSound",{fileName:"boss_voix_"+Math.round(.5+15.5*Math.random()),volume:1}),z.g.sound.commit("sound/playSound",{fileName:"boss_motor_dash_"+Math.round(.5+6.5*Math.random()),volume:1}),n.game.physics.moveKinematicToPosition(n.dragonBody.physic,r,n.bossTargetPosition,1600,1)}}),n.game.physics.moveKinematicToPosition(n.dragonBody.physic,r,n.bossTargetPosition,1600,0),"break"}())break}}catch(e){o.e(e)}finally{o.f()}}}},{key:"updateIAFromPattern",value:function(){var e=this;Object.keys(this.game.charactersState).forEach((function(t,n){var o=e.game.charactersState[t];if("player"!==o.type){var pattern=o.pattern?o.pattern.level3:null,r=e;if(pattern)for(var i=0;i<pattern.length;i++){var c=pattern[i];if(!c.trigerredStart&&r.game.gameElapsedTime>c.s){if(c.trigerredStart=!0,o.playerStunned)return;var l=new d.Vector3(o.ref.position.x,o.ref.position.y,o.ref.position.z),h=new d.Vector3(c.d.x,c.d.y,c.d.z);r.initAnimMovementCharacter(o,l,h);break}}}}))}},{key:"updateVisualBoss",value:function(){if(this.game.dragonGroup&&this.dragonBody){var e=this.game.dragonGroup,t=e.children[0].getObjectByName("rails"),head=e.children[0].getObjectByName("head"),body=this.dragonBody;e.position.z=this.lerp(e.position.z,body.position.z,.5),e.position.y=this.lerp(e.position.y,Math.max(.0634,body.position.y),.5),e.position.x=this.lerp(e.position.x,body.position.x,.5),t.rotation.y=this.lerp(t.rotation.y,Math.atan2(this.bossTargetPosition.x-e.position.x,this.bossTargetPosition.z-e.position.z),.14),head.rotation.y=this.lerp(head.rotation.y,t.rotation.y,.06),this.startFollowBike&&(this.game.scene.dragonChara.rotation.y=head.rotation.y,this.game.scene.dragonChara.position.z=2*e.position.z+this.offsetAnchor.z,this.game.scene.dragonChara.position.y=2*e.position.y+this.offsetAnchor.y,this.game.scene.dragonChara.position.x=2*e.position.x+this.offsetAnchor.x),t.children.forEach((function(e){e.name.includes("Cylin")&&(e.rotation.x+=.1)}))}}},{key:"quitLevel",value:function(){var e=this;clearInterval(this.intervalAnimEnd),c.b.trigger({name:"stopLoop"},{name:"boss_motor_loop"}),this.resetLevel();var t=window.innerWidth<769,n=window.innerWidth<400;this.game.scene.camera.animateToPoint(new d.Vector3(n?-10:-6.45,14.07,t?n?15.36:10:6.6),new d.Vector3(t?n?2.84:.6:2.18,n?11.44:9.46,-6.74),1200,"easeInOutCubic",(function(){}),!0),this.tl=w.a.timeline({autoplay:!1,duration:800,easing:"easeInOutCubic",complete:function(){e.circleCharacterAn=null}}),this.tl.add({targets:this.circleCharacter.material,opacity:[.9,0]},0),this.tl.add({targets:this.circle.material,opacity:[.7,0]},0),this.tl.add({targets:this.circleL.material,opacity:[.7,0]},0),this.scene.camera.animateToPoint(new d.Vector3(-6.45,14.07,6.55),new d.Vector3(-1.8,10.8,1.24),1500,null,(function(){})),this.game.stop()}},{key:"resetLevel",value:function(){var e=this;this.startFollowBike=!1,this.game.scene.dragonChara.getObjectByName("sundbl").visible=!1,this.initiaDragonPos||(this.initiaDragonPos=new d.Vector3(.12560279,3.477148,-19.552007)),this.game.scene.dragonChara.position.copy(this.initiaDragonPos),this.game.scene.dragonChara.rotation.y=0,this.constraintArr&&Object.keys(this.constraintArr).forEach((function(t,n){e.constraintArr[t]&&e.constraintArr[t].length>0&&e.constraintArr[t].forEach((function(t){t&&t.bodyA&&t.bodyA.stacked&&(t.bodyA.stacked=!1),e.game.physics.world.removeConstraint(t)}))})),this.patternBossTrigerred={},this.bossTargetPosition=new d.Vector3(0,0,-3),this.game.physics.moveKinematicToPosition(this.dragonBody.physic,this.bossTargetPosition,this.bossTargetPosition,1600,1),this.animBoss=null,this.dragonBody.position.set(0,0,-3),this.game.dragonGroup.traverse((function(e){e.visible=!1})),this.resetWM(),this.game.physics.enableMeshFromWeakMap(this.dragonBody,!1),Object.keys(this.game.charactersState).forEach((function(t,n){var o=e.game.charactersState[t];o.position.y=0,o.playerStunned=!1,o.stunLevel=0,o.ref.position.y=0,o.wmStacked=0,o.isBumped=!1,o.body.physic.angularDamping=1,o.body.rotation.x=0,o.body.rotation.y=0,o.body.rotation.z=0,o.animMove=null,o.body.physic&&e.game.physics.resetPhysic(o.body.physic),o.mixerGameOne||(o.mixerGameOne=e.game.scene["mixerFlower"+(o.orderPosId+1)]),o.mixerGameOne.setTime(0),e.game.physics.setMeshPosition(o.body,new d.Vector3(o.positionXCached,0,0)),o.pattern&&o.pattern["level"+e.level]&&o.pattern["level"+e.level].length>0&&o.pattern["level"+e.level].forEach((function(pattern){pattern.trigerredStart=!1,pattern.trigerredEnd=!1}))}))}},{key:"showDragonBike",value:function(){z.g.sound.commit("sound/playSound",{fileName:"boss_beginning_motor",volume:1}),c.b.trigger({name:"playLoop"},{name:"boss_motor_loop"}),this.game.dragonGroup&&this.game.dragonGroup.traverse((function(e){"bodydragon"!==e.name&&(e.visible=!0)}))}},{key:"startLevel",value:function(){var e=this;this.resetLevel(),z.d.scores["level"+this.level].current=0,z.d.scores["level"+this.level].lerpCurrent=0,this.game.physics.enableMeshFromWeakMap(this.game.watermelon,!0),this.game.physics.enableMeshFromWeakMap(this.dragonBody,!0),this.circleCharacterAn=Object(w.a)({targets:this.circleCharacter.scale,x:[.9,1.1],y:[.9,1.1],z:[.9,1.1],loop:!0,autoplay:!1,duration:500,easing:"easeInOutSine",direction:"alternate"}),this.tl=w.a.timeline({autoplay:!1,duration:4500,easing:"easeOutSine",complete:function(){e.tl=null,e.destinationDragonPos=(new d.Vector3).copy(e.game.scene.dragonChara.position),e.startFollowBike=!0}});var t=this.game.scene.dragonChara.getObjectByName("sundbl");this.tl.add({targets:t.position,y:[2,0],duration:1500,easing:"easeOutQuint",begin:function(){t.visible=!0}},1500),this.initiaDragonPos||(this.initiaDragonPos=new d.Vector3(.12560279,3.477148,-19.552007)),this.tl.add({targets:this.game.scene.dragonChara.position,x:[this.initiaDragonPos.x,this.initiaDragonPos.x,1.86],y:[this.initiaDragonPos.y,this.bossTargetPosition.y+10,this.bossTargetPosition.y+3.1],z:[this.initiaDragonPos.z,this.initiaDragonPos.z,-11.1],easing:"easeInOutSine",duration:1500},3e3),this.tl.add({targets:this.game.scene.dragonChara.scale,y:[2,3,2],easing:"easeInOutSine",duration:1500},3e3),this.tl.add({targets:this.circle.material,opacity:[0,.7],duration:800},0),this.tl.add({targets:this.circleCharacter.material,opacity:[0,.9],duration:800},0),this.tl.add({targets:this.circleL.material,opacity:[0,.7],duration:800},0),this.scene.camera.animateToPointKeyFrames([[{x:[0,0]},{y:[40,12]},{z:[10,1.2]}],[{x:[0,0]},{y:[12,12.1]},{z:[1.2,-2.29]}],[{x:[0,0]},{y:[12.1,12.11]},{z:[-2.29,5.6]},{begin:function(){return e.showDragonBike()}}]],[[{x:[0,0]},{y:[6.6,11.3]},{z:[-5.82,-5.82]}],[{x:[0,0]},{y:[11.3,12]},{z:[-5.82,-9.35]}],[{x:[0,0]},{y:[12,8.65]},{z:[-9.35,-20.5]}]],4500,null,(function(){e.animateToStart()}))}},{key:"animateToStart",value:function(){var e=this;this.scene.camera.animateToPoint(new d.Vector3(-.65,16.6,7.82),new d.Vector3(0,9.2,0),1500,null,(function(){Object.keys(e.game.charactersState).forEach((function(t,n){var o=e.game.charactersState[t];o.isBumped=!1,o.playerStunned=!1})),e.game.start(3)}))}},{key:"init",value:function(){this.handleEvents()}},{key:"onCharacterLocked",value:function(){}},{key:"handleEvents",value:function(){}},{key:"dealWithIt",value:function(){this.game.scene.dragonChara.getObjectByName("sundbl")}},{key:"jumpToBike",value:function(){}},{key:"checkUpdateScore",value:function(){var e=z.d.scores["level"+this.level],t=18*z.d.wmStacked;e.max<t&&(e.max=t),e.current=t}},{key:"onEndGame",value:function(){var e=this;this.checkUpdateScore(),this.intervalAnimEnd=setInterval((function(){Object.keys(e.game.charactersState).forEach((function(t,n){e.game.charactersState[t].type}))}),400)}},{key:"lerpVector",value:function(a,b,e){a.r=this.lerp(a.r,b.r,e),a.g=this.lerp(a.g,b.g,e),a.b=this.lerp(a.b,b.b,e)}},{key:"lerp",value:function(a,b,e){return(1-e)*a+e*b}},{key:"addCursor",value:function(){var e=new d.CircleBufferGeometry(.25,32),t=new d.MeshBasicMaterial({color:16777215,transparent:!0,opacity:0,side:d.DoubleSide});this.circleCharacter=new d.Mesh(e,t),this.circleCharacter.rotation.x=-Math.PI/2,this.circleCharacter.position.y=9.675;e=new d.CircleBufferGeometry(.2,32);var n=new d.MeshBasicMaterial({color:16776960,transparent:!0,opacity:0});this.circle=new d.Mesh(e,n),this.circle.rotation.x=-Math.PI/2,this.circle.position.y=.003;e=new d.CircleBufferGeometry(.15,32),n=new d.MeshBasicMaterial({color:0,transparent:!0,opacity:0});this.circleL=new d.Mesh(e,n),this.circleL.rotation.x=-Math.PI/2,this.circleL.position.y=.002,this.game.scene.add(this.circle,this.circleL,this.circleCharacter)}},{key:"onFinishedLoaded",value:function(e){this.floor=e.floorLevel3}},{key:"lerpVector",value:function(a,b,e){a.x=this.lerp(a.x,b.x,e),a.y=this.lerp(a.y,b.y,e),a.z=this.lerp(a.z,b.z,e)}},{key:"lerp",value:function(a,b,e){return(1-e)*a+e*b}},{key:"followMouse",value:function(){this.cursorDestination&&(this.dist.x=(this.circle.position.x-this.cursorDestination.x)/5,this.dist.y=(this.circle.position.z-this.cursorDestination.z)/5,this.distL.x=(this.circleL.position.x-this.cursorDestination.x)/5,this.distL.y=(this.circleL.position.z-this.cursorDestination.z)/5,this.momentum.x-=this.dist.x/6,this.momentum.y-=this.dist.y/6,this.momentumL.x-=this.distL.x/4.5,this.momentumL.y-=this.distL.y/4.5,this.momentum.x=this.lerp(this.momentum.x,0,.14),this.momentum.y=this.lerp(this.momentum.y,0,.14),this.momentumL.x=this.lerp(this.momentumL.x,0,.09),this.momentumL.y=this.lerp(this.momentumL.y,0,.09),this.circle.position.x+=this.momentum.x,this.circle.position.z+=this.momentum.y,this.circleL.position.x+=this.momentumL.x,this.circleL.position.z+=this.momentumL.y)}},{key:"onPointerMove",value:function(e){var t=e.pointer;if((z.d.scores||this.floor)&&2===this.game.currentCat&&!this.game.animScene&&(!this.levelActive||this.game.clock.running)){this.pointer.x=t.x/window.innerWidth*2-1,this.pointer.y=-t.y/window.innerHeight*2+1,this.raycaster.setFromCamera(this.pointer,this.game.scene.camera);var n=this.raycaster.intersectObject(this.floor);if(n.length>0){var o=n[0];this.cursorDestination.copy(o.point),this.circle.position.y=this.cursorDestination.y+.003,this.circleL.position.y=this.cursorDestination.y+.002}}}},{key:"onPointerStart",value:function(){if(2===this.game.currentCat&&!this.game.animScene&&(!this.levelActive||this.game.clock.running)&&!z.d.playerStunned){this.positionCursorClicked.copy(this.cursorDestination);var e=(new d.Vector3).copy(new d.Vector3(z.d.body.physic.position.x,z.d.body.physic.position.y,z.d.body.physic.position.z)),t=this.game.clock.elapsedTime;this.startTimeRef=t;var n=(new d.Vector3).copy(new d.Vector3(this.cursorDestination.x,z.d.body.physic.position.y,this.cursorDestination.z));z.b.session["level"+this.level].push({s:Math.round(100*this.startTimeRef)/100,d:this.roundVec3(n)}),this.initAnimMovementCharacter(this.game.currentPlayerRef,e,n)}}},{key:"roundVec3",value:function(e){return e.x=Math.round(100*e.x)/100,e.y=Math.round(100*e.y)/100,e.z=Math.round(100*e.z)/100,e}},{key:"initAnimMovementCharacter",value:function(e,t,n){var o=this;e.destinationlevel3=n,e.startlevel3=t,e.animMove=null;var r={value:0};z.g.sound.commit("sound/playSound",{fileName:"move_"+Math.round(.5+3.5*Math.random()),volume:"player"===e.type?.9:.45});var c=d.MathUtils.smootherstep(e.destinationlevel3.distanceTo(e.startlevel3),0,7.6),l=1+.6*d.MathUtils.smootherstep(e.wmStacked,0,10);this.game.physics.moveKinematicToPosition(e.body.physic,e.startlevel3,e.destinationlevel3,2e3,0),e.animMove=Object(w.a)({targets:r,autoplay:!1,value:[0,1],easing:"linear",duration:(400+2e3*c)*l,update:function(){o.game.physics.moveKinematicToPosition(e.body.physic,e.startlevel3,e.destinationlevel3,2e3,r.value)},complete:function(){e.animMove=!1,o.game.physics.moveKinematicToPosition(e.body.physic,e.startlevel3,e.destinationlevel3,2e3,1)}})}},{key:"updateAnimMovementCharacter",value:function(e){var t=this;Object.keys(this.game.charactersState).forEach((function(n,o){var r=t.game.charactersState[n];r.animMove&&r.animMove.tick(e)}))}},{key:"onLaunchDevMode",value:function(e){var t=e.gui.addFolder("Amcsavrdx");t.open(),t.add(this.offsetAnchor,"x").min(-6).max(6).step(.01),t.add(this.offsetAnchor,"y").min(-6).max(6).step(.01),t.add(this.offsetAnchor,"z").min(-6).max(6).step(.01)}},{key:"onLowRaf",value:function(){this.levelActive&&this.game.clock.running&&this.updateIAFromPattern()}},{key:"normalize",value:function(e,t,n){return n-t==0?1:(e-t)/(n-t)}},{key:"getPointInBetweenByLen",value:function(e,t,n){var o=t.clone().sub(e),r=o.length();return o=o.normalize().multiplyScalar(r*n),e.clone().add(o)}},{key:"onRaf",value:function(e){e.delta;var t=e.now;this.tl&&this.tl.tick(t),this.circleCharacterAn&&(this.circleCharacter.position.x=z.d.ref.position.x,this.circleCharacter.position.z=z.d.ref.position.z,this.circleCharacterAn.tick(t)),2===this.game.currentCat&&(this.game.animScene||(this.game.dragonGroup&&this.dragonBody&&(this.updatePatternBoss(),this.updateVisualBoss()),this.levelActive&&!this.game.clock.running||(this.animBoss&&this.animBoss.tick(t),this.followMouse(),this.updateAnimMovementCharacter(t),this.levelActive&&this.game.clock.running&&(this.followCamera(t),this.game.scene.camera.lookAtTarget(this.getPointInBetweenByLen(new d.Vector3(z.d.ref.position.x,9.5,z.d.ref.position.z),new d.Vector3(this.game.dragonGroup.position.x,9.5,this.game.dragonGroup.position.z),.6),.04),this.game.dragonGroup&&this.dragonBody&&this.updatePatternWM()))))}},{key:"lerp",value:function(a,b,e){return(1-e)*a+e*b}}]),e}();function Ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(x.a)(e);if(t){var r=Object(x.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(y.a)(this,n)}}var Te=null,Pe=new d.Camera,Ae=function(e){Object(f.a)(m,e);var t,h=Ce(m);function m(e){var t;Object(o.a)(this,m),t=h.call(this),Object(c.a)(Object(v.a)(t)),t.island=new d.Group,t.add(t.island),t.effectController={mode:"relief",scale:.1,minLayers:12,maxLayers:22},t.params={color:"#d4f9f9",scale:1.2,flowX:.15,flowY:.9},t.aoArr={},t.ui=window.ui=e,t.mixer=null,t.clips=null,t.mouse=new d.Vector2(0,0),t.events=new me(t.mouse),t.isIos=void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission,t.wallMirror=[],t.pointer=new d.Vector2,t.background=new d.Color(16777215),t.dominant=16777215,t.raycaster=new d.Raycaster,t.camera=S,t.capMap=null;var n=new ie.a;return n.setDecoderPath("/js/draco/"),t.loaderDraco=(new de.a).setPath("/models/"),t.loaderDraco.setDRACOLoader(n),t.init(),t}return Object(r.a)(m,[{key:"loadTextures",value:function(){var e=this;!function(e,t){var n=new d.WebGLRenderer,b=1;function o(e,i){return new Promise((function(t){switch(e.type){case"texture":Y?J||((J=new W).setTranscoderPath("/js/basis/"),J.detectSupport(n)):J||(J=new d.TextureLoader),J.load(e.url,(function(n){var o=n;o.encoding=d.sRGBEncoding,b++,c.b.trigger({name:"loading"},{progress:48+2*b,content:"texture",variable:e.id}),t(o)}))}}))}Object(U.a)(regeneratorRuntime.mark((function n(){var r,i,c,l,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:for(r=[],i=0;i<e.length;i+=1)r[i]=o(e[i]);return n.next=4,Promise.all(r);case 4:for(c=n.sent,l=0;l<e.length;l+=1)h=e[l].id,Q[h]=c[l];t(Q);case 7:case"end":return n.stop()}}),n)})))()}(Z.asset,(function(t){e.loadScene(),e.game=new he,e.game.init(e,Pe),e.one=new xe(e,e.game),e.one.init(),e.two=new we(e,e.game,t),e.two.init(),e.third=new Me(e,e.game),e.third.init(),l.a.skipIntro&&(c.b.trigger({name:"characterLocked"}),c.b.trigger({name:"startSite"}))}))}},{key:"onUpGradePerfCb",value:function(){this.water&&(this.water.visible=!0)}},{key:"bindEvent",value:function(){!l.a.isMobile()||this.initTouch||(this.initTouch=!0)}},{key:"feedUserData",value:function(e,t){z.b.nickname=e.nickname?e.nickname:e.name,z.b.mailed=e.mail.length>0,z.b.mail=e.mail,z.b.mailed=e.mail.length>0,z.b.labID=e.labID?e.labID:e.lab1,z.d.character=e.character,z.d.pattern=t.pattern?t.pattern:{level1:t.level1,level2:t.level2,level3:t.level3}}},{key:"getUserSave",value:function(){var e=this;return new Promise((function(t){var n=null;l.a.resetLocalStorage&&localStorage.clear();var o=localStorage?localStorage.getItem("user"):null;if(o){o=JSON.parse(o);var r=JSON.parse(localStorage.getItem("lab"));r.level1=JSON.parse(r.level1),r.level2=JSON.parse(r.level2),r.level3=JSON.parse(r.level3),z.b.uid=o._id,e.feedUserData(o,r),r.score1&&(e.level,z.d.savedMax1=parseInt(r.score1),z.d.savedMax2=parseInt(r.score2),z.d.savedMax3=parseInt(r.score3)),t()}else z.b.uid?n=Object(ye.e)(z.b.uid).then((function(o){(n=o)&&0==n.ban?Object(ye.d)(n,!0).then((function(o){o&&(z.d.savedMax1=parseInt(o[0].score1),z.d.savedMax2=parseInt(o[0].score2),z.d.savedMax3=parseInt(o[0].score3),o={pattern:{level1:JSON.parse(o[0].level1),level2:JSON.parse(o[0].level2),level3:JSON.parse(o[0].level3)}},e.feedUserData(n,o)),t()})):t()})):t()}))}},{key:"getData",value:(t=Object(U.a)(regeneratorRuntime.mark((function e(){var t,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!z.c.id){e.next=5;break}return e.next=4,Object(ye.e)(z.c.id);case 4:t=e.sent;case 5:return e.next=7,Object(ye.c)();case 7:return data=e.sent,t&&0==t.ban&&("employee"!=t.type&&(t.type="ai"),data[0]._id===z.c.id&&data.shift(),data.unshift(t)),e.abrupt("return",data.slice(0,2));case 10:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"init",value:function(){var e=this;this.getUserSave().then((function(){c.b.trigger({name:"loading"},{progress:10,content:"AI"}),e.getData().then((function(t){c.b.trigger({name:"loading"},{progress:20,content:"AI"});var n=[];t.forEach((function(e){n.push(new Promise((function(t,n){Object(ye.d)(e).then((function(data){t()}))})))})),function(e){var t=[];ee.forEach((function(e){t.push(new Promise((function(t){Object(A.preloadFont)(e,(function(){t()}))})))})),Promise.all(t).then((function(t){e()}))}((function(e){c.b.trigger({name:"loading"},{content:"fonts"})})),Promise.all(n).then((function(t){c.b.trigger({name:"loading"},{progress:30,content:"users"}),function(e,t,n){var o=new d.WebGLRenderer({antialiasing:!1,gammaOutput:!1,alpha:!1,depth:!0,autoClear:!0,autoClearDepth:!1,physicallyCorrectLights:!1,premultipliedAlpha:!1,gammaFactor:2.2});o.setPixelRatio(1),o.shadowMap.autoUpdate=!1,o.debug.checkShaderErrors=!0;var r=[];Y?J||((J=new W).setTranscoderPath("/js/basis/"),J.detectSupport(o)):J||(J=new d.TextureLoader);var i=1;J.load("/img/matcaps/"+K+"white."+(Y?"basis":"png"),(function(o){J.load("/img/matcaps/"+K+"hair."+(Y?"basis":"png"),(function(l){J.load("/img/matcaps/"+K+"porcelain."+(Y?"basis":"jpg"),(function(h){Object.keys($).forEach((function(n){r.push(new Promise((function(r){var d=t.matrixWorldInverse.clone(),m=t.projectionMatrix.clone(),v=t.matrixWorld.clone(),f=t.position.clone();e.loaderDraco.load("characters/draco/".concat(n,".glb"),(function(t){var y=t.scene||t.scenes[0],x=new X(y,e,{cap:{default:h,skin:o,hair:l},viewMatrixCamera:d,projectionMatrixCamera:m,modelMatrixCamera:v,projPosition:f,shadow:null});c.b.trigger({name:"loading"},{progress:30+2*i,content:"character",variable:n}),i++,$[n]=x,r(x)}))})))})),Promise.all(r).then((function(e){n()}))}))}))}))}(e,Pe,(function(t){l.a.skipIntro&&(e.ui.intro.scope.unregister(e.ui.intro),l.a.introEnded=!0),e.loadTextures(),e.camera.initCamera()}))}))}))}))}},{key:"loadScene",value:function(){var e=this;this.loaderDraco.load("scene2_draco.glb",(function(t){var n=t.scene||t.scenes[0];e.mixer=new d.AnimationMixer(n),e.mixerLoop=new d.AnimationMixer(n),e.mixerFlower1=new d.AnimationMixer(n),e.mixerFlower2=new d.AnimationMixer(n),e.mixerFlower3=new d.AnimationMixer(n),e.mixer.timeScale=1,e.mixerLoop.timeScale=1,e.mixerFlower1.timeScale=1,e.mixerFlower2.timeScale=1,e.mixerFlower3.timeScale=1,(t.animations||[]).forEach((function(t){t.name.includes("flower")?(t.name.includes("flower1")?e.mixerFlower1.clipAction(t).reset().play():t.name.includes("flower2")?e.mixerFlower2.clipAction(t).reset().play():e.mixerFlower3.clipAction(t).reset().play()).setDuration(1.001):t.name.includes("LOOP")?e.mixerLoop.clipAction(t).reset().play().setDuration(5.001):e.mixer.clipAction(t).reset().play().setDuration(1.001)})),Q.sky.repeat.set(2,1),Q.sky.wrapS=Q.sky.wrapT=d.RepeatWrapping,Q.sky.center=new d.Vector2(.5,0),Q.sky.offset=new d.Vector2(0,1),e.background=new ve(Q.sky),e.add(e.background.mesh),e.water=new fe(new d.PlaneBufferGeometry(100,100,42,42),Q.water),e.water.position.x=0,e.water.position.y=-.35968,e.water.position.z=0,e.water.rotation.x=-.5*Math.PI,e.water.matrixAutoUpdate=!0,e.add(e.water),Pe.position.set(0,1,-.1),Pe.lookAt(0,0,0),Pe.updateMatrixWorld(),Pe.updateWorldMatrix();var o=Pe.matrixWorldInverse.clone(),r=Pe.projectionMatrix.clone(),l=Pe.matrixWorld.clone(),h=Pe.position.clone(),m=Q.clouds,v=new d.Group;n.children.forEach((function(t){t.traverse((function(t){if(t instanceof d.Mesh||t instanceof d.InstancedMesh){var n=Q.captoon,c=new d.Vector2(1),f=new d.Vector2(1),y=t.material.map;if("watero"===t.name)return;if("grassanim"===t.name||"grass2anim"===t.name){var x=new ge({viewMatrixCamera:o,projectionMatrixCamera:r,modelMatrixCamera:l,projPosition:h,shadow:m});x.uniforms.color.value=t.material.color,x.extensions.derivatives=!0,t.material=x,setTimeout((function(){v.add(t)}),0)}else{if("grasslevel3anim"===t.name)return t.material=new d.MeshBasicMaterial({transparent:!0,opacity:0,side:d.DoubleSide}),e.floorLevel3=t,void setTimeout((function(){v.add(t)}),0);if(t.name.includes("pav")&&(n=Q.capw),t.name.includes("gold")&&(n=Q.gold),t.name.includes("ao"))return void(e.aoArr[t.name]=t);y&&c.x>1&&(y.wrapS=y.wrapT=d.RepeatWrapping),m.wrapS=m.wrapT=d.RepeatWrapping,t.material=new ne(t.geometry,{name:t.name,cap:n,aoMap:t.material.aoMap,map:y||t.material.emissiveMap,side:t.name.includes("dbl")||t.name.includes("tuto")||t.name.includes("light")||t.name.includes("river")||t.name.includes("rock")||t.name.includes("dragon")?d.DoubleSide:d.FrontSide,color:t.material.color,flatShading:!(!t.name.includes("rock")&&!t.name.includes("grass2")),normalMap:!1,transparent:!!t.name.includes("dark"),repeat:c,repeatN:f,viewMatrixCamera:o,projectionMatrixCamera:r,modelMatrixCamera:l,projPosition:h,shadow:m}),t.matrixAutoUpdate=t.parent.name.includes("castle")||t.name.includes("LOOP")||t.name.includes("anim")||t.name.includes("flower"),setTimeout((function(){t.name.includes("PLANTLOO")||t.parent.name.includes("dragon_chara")||t.parent.name.includes("castle")||t.parent.name.includes("plantsanim")||v.add(t)}),0)}}})),t.name&&(t.name.includes("dragon_chara")||t.name.includes("plantsanim")||t.name.includes("castleanim"))&&setTimeout((function(){if(t.name.includes("dragon_chara")){e.dragonChara=t;var n=e.dragonChara.getObjectByName("sundbl");n.visible=!1,n.matrixAutoUpdate=!0}v.add(t)}),0)})),e.island.add(v),Object.keys(e.aoArr).forEach((function(t){var n=e.aoArr[t];n.material=new d.MeshBasicMaterial({color:1118481,transparent:!0,alphaMap:n.material.map}),n.material.opacity=.38,v.add(n)})),c.b.trigger({name:"loading"},{progress:100,content:"model",variable:"scene.glb"}),setTimeout((function(){e.ui.presentCharacters($),c.b.trigger({name:"finishedLoaded"},e),e.loaded=!0}),300),e.manageDebug()}))}},{key:"onRaf",value:function(e){var t=e.delta;l.a.introEnded&&(this.water&&(this.water.material.uniforms.time.value+=t/4),Te&&Te.update(),this.camera&&this.loaded&&(this.camera.updateCamera(.21,this.stopMove,this.mouse),this.mixerLoop&&this.mixerLoop.update(t)))}},{key:"onPointerMove",value:function(e){var t=e.pointer;this.pointer.x=t.x/window.innerWidth*2-1,this.pointer.y=-t.y/window.innerHeight*2+1,l.a.isMobile()||(this.mouse.x=35e-5*(t.x-window.innerWidth/2),this.mouse.y=55e-5*(t.y-window.innerHeight/2))}},{key:"manageDebug",value:function(){if(l.a.dev&&!window.debugModeLoaded){window.debugModeLoaded=!0;var img=document.createElement("div");img.innerText="DEBUG";Object.assign(img.style,{background:"red","background-size":"cover",position:"fixed",color:"#fff",top:"0",height:"60px",width:"90px",right:"0","line-height":"60px","text-align":"center",cursor:"pointer"}),document.body.appendChild(img),img.addEventListener("click",(function(){window.devMode(),img.style.display="none"})),window.devMode=function(){n.e(12).then(n.bind(null,396)).then((function(e){Te=new e.default,document.body.appendChild(Te.dom)})),n.e(11).then(n.bind(null,397)).then((function(e){var t=new e.GUI;document.querySelector(".dg.ac").style["z-index"]="1000",t.show(),t.open(),c.b.trigger({name:"launchDevMode"},{gui:t})}))}}}},{key:"onLaunchDevMode",value:function(e){e.gui}}]),m}(d.Scene);function Oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(x.a)(e);if(t){var r=Object(x.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(y.a)(this,n)}}var _e=new(function(e){Object(f.a)(n,e);var t=Oe(n);function n(){var e;return Object(o.a)(this,n),e=t.call(this,{powerPreference:"high-performance",antialiasing:!1,precision:"highp",gammaOutput:!1,alpha:!1,depth:!0,autoClear:!0,autoClearDepth:!1,physicallyCorrectLights:!1,premultipliedAlpha:!1,gammaFactor:2.2,stencil:!0}),Object(c.a)(Object(v.a)(e)),e.setPixelRatio(l.a.dpr),e.shadowMap.autoUpdate=!1,e.debug.checkShaderErrors=!0,e}return Object(r.a)(n,[{key:"onResize",value:function(e){var t=e.width,n=e.height;this.setSize(t,n)}}]),n}(d.WebGLRenderer)),De=(n(380),new Float32Array([-1,-1,3,-1,-1,3])),Be=new d.BufferGeometry;Be.setAttribute("position",new d.BufferAttribute(De,2));var Ie=Be,Le=new(function(){function e(canvas){Object(o.a)(this,e),Object(c.a)(this);var t=l.a.isMobile();this.isDesktop=!t,this.init()}return Object(r.a)(e,[{key:"init",value:function(){this.currentGame=0,this.renderer=_e,this.currentCat=0,this.isWebGL2=this.renderer.capabilities.isWebGL2,document.body.appendChild(this.renderer.domElement),this.pointer=new d.Vector2,this.dist=new d.Vector2,this.distL=new d.Vector2,this.momentum=new d.Vector2,this.momentumL=new d.Vector2,this.blur=0,this.deformPercent=0,this.scene=new d.Scene,this.sceneui=new d.Scene,this.dummyCamera=new d.Camera,this.resolution=new d.Vector2,this.renderer.getDrawingBufferSize(this.resolution);var e={stencilBuffer:!1,depthBuffer:!0,antialias:!1,format:d.RGBFormat,powerPreference:"high-performance"},t={stencilBuffer:!0,depthBuffer:!0,antialias:!1,format:d.RGBAFormat,powerPreference:"high-performance"};this.targetUI=new d.WebGLRenderTarget(this.resolution.x,this.resolution.y,t),this.target=!l.a.isMobile()&&this.isWebGL2?new d.WebGLMultisampleRenderTarget(this.resolution.x,this.resolution.y,e):new d.WebGLRenderTarget(this.resolution.x,this.resolution.y,e),this.renderer.getDrawingBufferSize(this.resolution),this.target.setSize(this.resolution.x,this.resolution.y),this.targetUI.setSize(this.resolution.x,this.resolution.y);var n={};l.a.fxaa&&(n.FXAA=!0),this.material=new d.RawShaderMaterial({defines:n,fragmentShader:"precision highp float;\n#define GLSLIFY 1\nuniform sampler2D uScene;\nuniform sampler2D uInterface;\nuniform vec2 uResolution;\nuniform vec2 vMouse;\nuniform vec2 vMouseL;\nuniform vec2 momentum;\nuniform vec2 momentumL;\nuniform vec3 colCirc;\nuniform vec4 fixTransparency;\nuniform float radCirc;\nuniform float gamma;\nuniform float factorEnergy;\nuniform float factor;\nuniform float time;\nuniform float gravityIntensity;\nuniform float introAnim;\nuniform float dpr;\nuniform float hd;\nuniform float menuFactor;\nuniform float noAlpha;\nuniform float blur;\nuniform float shake;\n\nvec2 shake_direction = normalize(vec2(0.0, 1.0));\t// Direction in which the shaking occurs\nfloat shake_freq = 20.0;\t\t// Number of shakes\nfloat shake_size = 0.01;\t// How much it shakes, as a proportion of the screen size\nfloat trans_freq = 10.0;\t\t// Number of sideways shakes\nfloat trans_size = 0.1;\t\t// How much sideways shake there is, as a proportion of the main shake\nfloat shake_often = .4;\t// Time between shakes, in seconds\nfloat shake_duration = 0.4;\t// Length of a shake, in seconds\n\n#define PI 3.1415926535897932384626433832795\n\nfloat voronoi(in vec2 uv) {\n    vec2 lp = abs(uv)*10.;\n    vec2 sp = fract(lp)-.5;\n    lp = floor(lp);\n    \n    float d = 1.;\n    \n    for (int x = -1; x < 2; x++) {\n        for (int y = -1; y < 2; y++) {\n            \n            vec2 mp = vec2(float(x),float(y));\n            vec2 p = lp+mp;\n            \n            d = min(d,length(sp+(cos(p.x+time)+cos(p.y+time))*.3-mp));\n            \n        }\n    }\n    \n    return d;\n}\n\nvec3 linearToneMapping(vec3 color) {\n  float exposure = 1.;\n  color = clamp(exposure * color, 0., 1.);\n  color = pow(color, vec3(1. / gamma));\n  return color;\n}\nvec4 layer(vec4 foreground, vec4 background) {\n    return foreground * foreground.a + background * (1.0 - foreground.a);\n}\n\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);\n}\nvec2 rotateUV(vec2 uv, float rotation) {\n    float mid = 0.5;\n    return vec2(\n    cos(rotation) * (uv.x - mid) + sin(rotation) * (uv.y - mid) + mid, cos(rotation) * (uv.y - mid) - sin(rotation) * (uv.x - mid) + mid\n    );\n}\nfloat smoothClamp(float x, float a, float b)\n{\n    return smoothstep(0., 1., (x - a)/(b - a))*(b - a) + a;\n}\n\nfloat ellipse(vec2 p, vec2 r) {\n    return (length(p / r) - .5);\n}\nfloat smoothedge(float v) {\n    return smoothstep(0.0, 1.0 / uResolution.x, v);\n}\n\nvec2 random2(vec2 st){\n    st = vec2( dot(st,vec2(127.1,311.7)),\n              dot(st,vec2(269.5,183.3)) );\n    return -1.0 + 2.0*fract(sin(st)*43758.5453123);\n}\n\nfloat noise(vec2 st) {\n    vec2 i = floor(st);\n    vec2 f = fract(st);\n\n    vec2 u = f*f*(3.0-2.0*f);\n\n    return mix( mix( dot( random2(i + vec2(0.0,0.0) ), f - vec2(0.0,0.0)  )/ 90., \n                     dot( random2(i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x)/ 90.,\n                mix( dot( random2(i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) )/ 90., \n                     dot( random2(i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x), u.y)/ 90.;\n}\n\nvec4 circle(vec2 uv, vec2 pos, float rad, vec3 color, vec2 moment) {\n//\tfloat d = length(pos - uv) - rad;\n  rad *= dpr;\n  pos *= dpr;\n\n  float d = ellipse(pos - uv, vec2(rad * (1.5 -smoothClamp(moment.y/50., 0., .5)), rad * (1.5 - smoothClamp(moment.x/50., 0., .5))));\n\tfloat t = smoothClamp(d, 0.0, 1.0);\n\treturn vec4(color, 1. - smoothedge(t));\n}\nfloat triangle(float x)\n{\n\treturn abs(1.0 - mod(abs(x), 2.0)) * 2.0 - 1.0;\n}\n\nfloat rand(float x)\n{\n    return fract(sin(x) * 43758.5453);\n}\n\n//#pragma glslify: fxaa = require(glsl-fxaa)\n\nvoid main() {\n\tvec2 uv = gl_FragCoord.xy / uResolution.xy;\n  vec4 cc;\n  vec4 cd;\n  if (radCirc > 0.) {\n    cd = circle(gl_FragCoord.xy, vMouseL.xy, radCirc * (1. + smoothClamp((momentumL.x + momentumL.y) / 50., 0., 2.5)), vec3(0.1411764706, 0.09411764706, 0.09019607843), momentumL * 1.4);\n    cc = circle(gl_FragCoord.xy, vMouse.xy, (radCirc * 1.4) + ((radCirc * .4) - smoothClamp((momentum.x + momentum.y) / 50., 0., 4.)), colCirc, momentum);\n  }\n\n\tvec4 color = vec4(1.);\n  vec2 uvGravity = uv;\n  // if (gravityIntensity > 0.) {\n  //   uvGravity.x += noise(uvGravity + time *3.);\n  //   uvGravity += vec2(triangle(uvGravity.y * rand(time) * 1.0) * rand(time * 1.9) * 0.0009,\n  //     triangle(uvGravity.x * rand(time * 3.4) * 1.0) * rand(time * 2.1) * 0.0009);\n  // }\n  \n  if (shake < 1.) {\n  // Time varying pixel color\n    color = texture2D(uScene, uv);\n  } else {\n    vec2 uvShake = uv;\n    uvShake -= 0.5;\n    uvShake *= (1.0 - 2.0 * max(shake_size, trans_size * shake_size));\n    uvShake += 0.5;\n    float t = mod(time, shake_often);\n\n    float shake_magnitude = shake_size * sin(shake_freq * 2.0*3.14159*t) * (t+0.5)*t*t*(t-1.0)*(t-1.0)*15.5;\n    uvShake += shake_direction * shake_magnitude;\n\n    // A little sideways shake, for flavor\n    vec2 shake_transverse = vec2(-shake_direction.y, shake_direction.x);\n    float trans_magnitude = trans_size * shake_size * sin(trans_freq * 2.*3.14159*t) * -t*(t-1.);\n    uvShake += trans_magnitude * shake_transverse;\n    color = texture2D(uScene, uvShake); \n  }\n\n  if (factorEnergy < 1.) {\n    vec2 uvAura = gl_FragCoord.xy / uResolution.xy - vec2(.5, .33);\n    uvAura.y *= uResolution.y/uResolution.x;\n    uvAura.x += .048 / (uResolution.x/uResolution.y);\n    float ang = atan(uvAura.y,uvAura.x);\n    float dst = length(uvAura);\n    float cfade = clamp(dst*90.-4.+cos(ang*1.+cos(ang*6.)*1.+time*1.)*.68,0.,1.);\n    \n    float a = 0.;\n    float fi = 10.;\n    vec2 luv = uv+cos((ang-dst)*fi+(time * .35)+uv+fi)/4.;\n    a += voronoi(luv)*(.7+(cos(luv.x*14.234)+cos(luv.y*16.234))*.4);\n    vec3 colorAura = vec3(1.);\n    \n    vec4 color2 = vec4(colorAura*a*cfade,1.);\n    float test = 0.;\n    \n    if (dst < .3) {\n      test = smoothstep(.3, 0., dst);\n      dst += test / 1.5;\n    }\n    dst *= 2.;\n    float rat = .5 + clamp(dst, 0., 1.) / 2.;\n    float rat2 = clamp(dst, 0., 1.);\n\n    vec4 color3 = mix(texture2D(uScene, uv * a*cfade * (1. - factorEnergy)), color, rat);\n    color = mix(vec4(colorAura, .1), color3, rat2);\n  }\n\t// vec4 color2 = texture2D(uScene, uv * p);\n  // color = fxaa(uScene, uv, uResolution);\n\t// vec4 colorMx = vec4(mix(color.rgb, vec3(1.,0.,0.), .2 * gravityIntensity), 1.0);\n\tvec4 colorMx = vec4(color.rgb, 1.0);\n  \n\t//colorMx = vec4(mix(colorMx.rgb, color2.rgb, step(.01,color2.r)), 1.);\n\n  // if (hd == 0.0) {\n  //   float rStr = 0.07;\n  //   colorMx += mix(-rStr/2.0, rStr/2.0, r);\n  // }\n\n\t//vec4 ui = texture2D(uInterface, mix(uv, mouse, p));\n  //if (radCirc <= 0.) {\n    colorMx = layer(cc, colorMx);\n  //}\n\n\t//vec4 ui = fxaa(uInterface, gl_FragCoord.xy, uResolution);\n\tvec4 ui = texture2D(uInterface, uv);\n  //vec4 ui = fxaa(uInterface, gl_FragCoord.xy, uResolution);\n // if (radCirc <= 0.) {\n    ui = layer(cd, ui);\n    ui = layer(cc, ui);\n    ui = layer(ui, fixTransparency);\n  //}\n\n\tif(introAnim < -0.45) {\n\t\tvec2 u = .5-uv;\n\t\tfloat freq = 3.0*sin(0.5*introAnim);\n\t\tvec2 warp = 0.5000*cos( u.xy*1.0*freq + vec2(0.0,1.0) + introAnim ) +\n\t\t\t\t\t\t0.2500*cos( u.yx*2.3*freq + vec2(1.0,2.0) + introAnim) +\n\t\t\t\t\t\t0.1250*cos( u.xy*4.1*freq + vec2(5.0,3.0) + introAnim ) +\n\t\t\t\t\t\t0.0625*cos( u.yx*7.9*freq + vec2(3.0,4.0) + introAnim );\n\t\tu.x += warp.x * 2.5;\n\t\tu.x-= (1.) + (.25 * factor);\n    gl_FragColor = layer(ui, mix(vec4(0.9411764706, 0.902, 0.196, 1.), colorMx, step(.01,u.x)));\n\t} else {\n\t  gl_FragColor = layer(ui, colorMx);\n\t}\n}\n\n",vertexShader:"precision highp float;\n#define GLSLIFY 1\nattribute vec2 position;\n\nvoid main() {\n  gl_Position = vec4(position, 1.0, 1.0);\n}",uniforms:{vMouse:{value:new d.Vector2(-1,-1)},vMouseL:{value:new d.Vector2(-1,-1)},uScene:{value:this.targetUI.texture},uInterface:{value:this.targetUI.texture},radCirc:{value:10},colCirc:{value:new d.Vector3(1,1,1)},gamma:{value:1.15},blur:{value:this.blur},dispFactor:{value:1},fxaa:{value:1},momentum:{value:this.momentum},momentumL:{value:this.momentumL},hd:{value:1},time:{value:0},dpr:{value:l.a.dpr},gravityIntensity:{value:0},introAnim:{value:-2},factor:{value:1},noAlpha:{value:1},menuFactor:{value:0},factorEnergy:{value:1},deformScroll:{value:0},shake:{value:0},colorWB:{value:new d.Color(16777215)},uResolution:{value:this.resolution},fixTransparency:{value:new d.Vector4(.9411764706,.902,.196,0)}}}),this.triangle=new d.Mesh(Ie,this.material),this.triangle.frustumCulled=!1,this.triangleui=new d.Mesh(Ie,this.material),this.triangleui.frustumCulled=!1,this.triangleui.material.uniforms.fxaa.value=0,this.triangleui.material.uniforms.uScene.value=this.target.texture,this.triangleui.material.uniforms.dpr.value=l.a.dpr,this.triangle.material.uniforms.dpr.value=l.a.dpr,this.triangle.material.uniformsNeedUpdate=!0,this.triangleui.material.uniformsNeedUpdate=!0,this.scene.add(this.triangle),this.sceneui.add(this.triangleui)}},{key:"lerp",value:function(a,b,e){return(1-e)*a+e*b}},{key:"onShowAura",value:function(e){var t=e.aura;this.material.uniforms.factorEnergy.value=t}},{key:"onUpGradePerfCb",value:function(){this.target.samples&&(this.target.samples=4),this.targetUI.samples&&(this.targetUI.samples=4),this.material.uniforms.hd.value=1}},{key:"onGameClockProgress",value:function(time){time.value>0&&(this.resetGravity=!1,this.material.uniforms.gravityIntensity.value=time.value)}},{key:"onEndGame",value:function(){this.resetGravity=!0}},{key:"onDownGradePerfCb",value:function(){this.material.uniforms.hd.value=0,this.target.samples&&(this.target.samples=1),this.targetUI.samples}},{key:"toggleRadiusColor",value:function(b){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.radCol=w.a.timeline({autoplay:!1}).add({targets:this.material.uniforms.colCirc.value,x:b||e?.1411764706:.9411764706,y:b||e?.09411764706:.902,z:b||e?.09019607843:.196,easing:"easeOutBack",duration:600},0)}},{key:"onNavigation",value:function(e){var t=e.cat;3!=this.currentCat&&3!=t||this.toggleRadiusColor(!1,3==t),this.currentCat=t}},{key:"onOpenContact",value:function(){this.toggleRadiusColor(!0)}},{key:"onCloseContact",value:function(){this.toggleRadiusColor(!1,3==this.currentCat)}},{key:"onContactOver",value:function(e){var t=e.over,n=e.color;0!=this.currentGame||l.a.isMobile()||(this.radTl=w.a.timeline({autoplay:!1,duration:600,easing:"easeOutBack"}).add({targets:this.material.uniforms.radCirc,value:t?80:10},0),n&&this.radTl.add({easing:"easeOutSine",duration:300,targets:this.material.uniforms.colCirc.value,x:n[0],y:n[1],z:n[2]},0))}},{key:"onStartGame",value:function(e){var t=e.game;0!=this.currentGame&&(this.material.uniforms.colCirc.value=new d.Vector4(.9411764706,.902,.196,1)),this.currentGame=t,this.radTl=w.a.timeline({autoplay:!1}).add({targets:this.material.uniforms.radCirc,value:0===t?10:0,easing:0===t?"easeOutBack":"easeInBack",duration:0===t?900:700},0)}},{key:"onResize",value:function(e){var t=e.width,n=e.height;l.a.dpr=Math.min(1.75,(l.a.isMobile()?window.devicePixelRatio:1)||1),this.isDesktop&&l.a.isMobile()&&window.location.reload(),this.isDesktop=!l.a.isMobile(),this.uiRenderer&&this.uiRenderer.setSize(t,n),this.renderer&&(this.renderer.getDrawingBufferSize(this.resolution),this.material.uniforms.uResolution.value=this.resolution),this.target&&(this.target.setSize(this.resolution.x,this.resolution.y),this.targetUI.setSize(this.resolution.x,this.resolution.y))}},{key:"onStartSite",value:function(){var e=this;this.toggleRadiusColor(!1,!1),this.introAnim=Object(w.a)({targets:this.triangle.material.uniforms.introAnim,autoplay:!1,value:[-2.4,-.45],easing:"easeOutCubic",duration:1400,complete:function(){e.introAnim=null}}),this.material.uniforms.fixTransparency.value=new d.Vector4(1.5,1.5,1.5,0)}},{key:"onPointerMove",value:function(e){var t=e.pointer;this.pointer.x=t.x,this.pointer.y=-t.y+window.innerHeight}},{key:"easeOutElastic",value:function(e,t,n,o){var s=1.70158,p=0,a=n;return 0===e?t:1==(e/=o)?t+n:(p||(p=.3*o),a<Math.abs(n)?(a=n,s=p/4):s=p/(2*Math.PI)*Math.asin(n/a),a*Math.pow(2,-10*e)*Math.sin((e*o-s)*(2*Math.PI)/p)+n+t)}},{key:"followMouse",value:function(){this.dist.x=(this.material.uniforms.vMouse.value.x-this.pointer.x)/5,this.dist.y=(this.material.uniforms.vMouse.value.y-this.pointer.y)/5,this.distL.x=(this.material.uniforms.vMouseL.value.x-this.pointer.x)/5,this.distL.y=(this.material.uniforms.vMouseL.value.y-this.pointer.y)/5,this.momentum.x-=this.dist.x/6,this.momentum.y-=this.dist.y/6,this.momentumL.x-=this.distL.x/4.5,this.momentumL.y-=this.distL.y/4.5,this.momentum.x=this.lerp(this.momentum.x,0,.14),this.momentum.y=this.lerp(this.momentum.y,0,.14),this.momentumL.x=this.lerp(this.momentumL.x,0,.09),this.momentumL.y=this.lerp(this.momentumL.y,0,.09),this.material.uniforms.vMouse.value.x+=this.momentum.x,this.material.uniforms.vMouse.value.y+=this.momentum.y,this.material.uniforms.vMouseL.value.x+=this.momentumL.x,this.material.uniforms.vMouseL.value.y+=this.momentumL.y}},{key:"onRaf",value:function(e){var t=e.delta,n=e.now;this.material&&this.material.uniforms&&this.material.uniforms.time&&(this.material.uniforms.time.value+=t),this.introAnim&&this.introAnim.tick(n),this.radTl&&this.radTl.tick(n),this.radCol&&this.radCol.tick(n),this.shake&&this.shake.tick(n)}},{key:"onShakeScreen",value:function(e){var t=this;this.shake=Object(w.a)({autoplay:!1,duration:600,easing:"linear",begin:function(){t.material.uniforms.shake.value=e||1},complete:function(){t.material.uniforms.shake.value=0,t.shake=null}})}},{key:"render",value:function(e,t,n){this.pointer&&this.material&&this.material.uniforms&&this.material.uniforms.vMouse&&(this.followMouse(),this.resetGravity&&(this.material.uniforms.gravityIntensity.value=this.lerp(this.material.uniforms.gravityIntensity.value,0,.04))),this.renderer.setRenderTarget(this.target),this.renderer.render(e,t),this.renderer.setRenderTarget(this.targetUI),this.renderer.render(n.scene,n.camera),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.dummyCamera)}},{key:"onLaunchDevMode",value:function(e){var t=e.gui;t.open(),t.addFolder("Blur postfx").open()}}]),e}()),ze=n(156),Ee=new(function(){function e(){Object(o.a)(this,e),Object(c.a)(this),this.currentMusic=null,this.volume={value:0},this.frequency=4400,this.postAssets=["game_jump_loop","game_pirates","game_bowser","boss_motor_loop"],this.music={},this.load(["menu_loop"])}return Object(r.a)(e,[{key:"init",value:function(){this.load(this.postAssets)}},{key:"load",value:function(e){var t=this;e.forEach((function(audio){var e="game_pirates"===audio||"game_bowser"===audio?"game_pirates"===audio?.26:.18:.7,n=new ze.Howl({src:["/sounds/opus/".concat(audio,".opus"),"/sounds/mp3/".concat(audio,".mp3")],loop:!0,volume:e,preload:!0});t.music[audio]=n}))}},{key:"onPlayLoop",value:function(e){var t=e.name;this.music[t]&&this.music[t].play()}},{key:"onStopLoop",value:function(e){var t=e.name;this.music[t]&&this.music[t].stop()}},{key:"onPickCharacter",value:function(){this.currentMusic="menu_loop",this.music[this.currentMusic].play()}},{key:"onStopMusic",value:function(){this.currentMusic&&this.music[this.currentMusic]&&(this.music[this.currentMusic].stop(),this.currentMusic=!1)}},{key:"onChangeMusic",value:function(e){var t=e.name,n=e.forceRepeat;if((void 0!==n&&n||t!=this.currentMusic)&&(this.onStopMusic(),this.music[t])){if(this.currentMusic=t,this.music[this.currentMusic].play(),this.music[this.currentMusic]._frequency&&this.music[this.currentMusic]._frequency>0)return;this.music[this.currentMusic].addFilter({filterType:"lowpass",frequency:this.frequency,Q:3})}}},{key:"onLowPass",value:function(e){var t=this;this.lowPassAnim=Object(w.a)({autoplay:!1,targets:this,easing:"easeOutSine",frequency:e?250:4400,duration:1200,complete:function(){t.lowPassAnim=null},update:function(e){Object.keys(t.music).forEach((function(e,n){t.music[e].frequency(t.frequency)}))}})}},{key:"onMute",value:function(e){var t=this;this.muteAnim=Object(w.a)({autoplay:!1,targets:this.volume,easing:"easeOutSine",value:e?0:.7,duration:600,complete:function(){t.muteAnim=null},update:function(e){ze.Howler.volume(t.volume.value)}})}},{key:"onRaf",value:function(e){var t=e.now;this.muteAnim&&this.muteAnim.tick(t),this.lowPassAnim&&this.lowPassAnim.tick(t)}}]),e}()),Ge=function(){function e(){Object(o.a)(this,e),Object(c.a)(this),this.ui=new te,this.scene=new Ae(this.ui),this.init(),l.a.dev&&Ee.init()}return Object(r.a)(e,[{key:"init",value:function(){}},{key:"onCharLoaded",value:function(){Ee.init()}},{key:"onRaf",value:function(){this.scene&&this.scene.camera&&this.scene.camera instanceof d.Camera&&Le.render(this.scene,this.scene.camera,this.ui)}}]),e}();t.default=new Ge}}]);